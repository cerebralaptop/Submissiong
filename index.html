<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Star Buildings | Submission Assistant</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Green Star Buildings v1.1 Submission Tracker and Assistant">
    <meta name="theme-color" content="#2E6B3F">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Green Star">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%232E6B3F'/><path d='M50 20 C35 30 25 45 25 60 C25 75 35 85 50 85 C65 85 75 75 75 60 C75 45 65 30 50 20 Z M50 30 C55 35 60 45 60 55 C60 65 55 72 50 75 C45 72 40 65 40 55 C40 45 45 35 50 30 Z' fill='white'/></svg>">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts - Clean modern fonts like GBCA -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- SheetJS for Excel import/export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class', // Only apply dark mode when 'dark' class is present, not based on OS setting
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['ui-sans-serif', 'system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                        'display': ['Plus Jakarta Sans', 'ui-sans-serif', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        // GBCA Brand Greens
                        'green': {
                            '900': '#1F4B2E',
                            '700': '#2E6B3F',
                            '500': '#4F8A55',
                            '300': '#9CCB8A',
                            '200': '#CDE6C3',
                            '100': '#EAF4E6',
                        },
                        // Ink colors (text)
                        'ink': {
                            DEFAULT: '#1C2320',
                            '2': '#34403A',
                            '3': '#5A6A62',
                        },
                        // Surface colors
                        'surface': {
                            '0': '#FFFFFF',
                            '1': '#F6F8F6',
                            '2': '#EFF3EF',
                        },
                        'line': '#D7DED8',
                        // Category Colors
                        'cat': {
                            'responsible': '#B45309',
                            'healthy': '#2E6B3F',
                            'resilient': '#1D4ED8',
                            'positive': '#B91C1C',
                            'places': '#6D28D9',
                            'people': '#BE185D',
                            'nature': '#0F766E',
                            'leadership': '#4338CA',
                        }
                    },
                    fontSize: {
                        'xs': '0.8125rem',
                        'sm': '0.9375rem',
                        'base': '1rem',
                        'lg': '1.125rem',
                        'xl': '1.375rem',
                        '2xl': '1.75rem',
                        '3xl': '2.25rem',
                        '4xl': '3rem',
                    },
                    lineHeight: {
                        'tight': '1.15',
                        'snug': '1.3',
                        'normal': '1.55',
                        'relaxed': '1.75',
                    },
                    letterSpacing: {
                        'tight': '-0.01em',
                        'normal': '0',
                        'wide': '0.02em',
                    },
                    borderRadius: {
                        'sm': '0.5rem',
                        'md': '0.75rem',
                        'lg': '1.25rem',
                    },
                    boxShadow: {
                        '1': '0 1px 2px rgba(28,35,32,0.06)',
                        '2': '0 8px 24px rgba(28,35,32,0.10)',
                    },
                    spacing: {
                        '18': '4.5rem',
                        '22': '5.5rem',
                    }
                }
            }
        }
    </script>

    <style>
        /* CSS Design Tokens */
        :root {
            /* Brand Greens */
            --color-green-900: #1F4B2E;
            --color-green-700: #2E6B3F;
            --color-green-500: #4F8A55;
            --color-green-300: #9CCB8A;
            --color-green-200: #CDE6C3;
            --color-green-100: #EAF4E6;

            /* Ink (text) colors */
            --color-ink: #1C2320;
            --color-ink-2: #34403A;
            --color-ink-3: #5A6A62;

            /* Surfaces */
            --color-surface-0: #FFFFFF;
            --color-surface-1: #F6F8F6;
            --color-surface-2: #EFF3EF;
            --color-line: #D7DED8;

            /* Semantic */
            --color-link: var(--color-green-700);
            --color-link-hover: var(--color-green-900);
            --color-focus: #7CCB8B;
            --heading-color: var(--color-green-900);

            /* Typography */
            --font-sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --leading-tight: 1.15;
            --leading-snug: 1.3;
            --leading-normal: 1.55;
            --leading-relaxed: 1.75;

            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.5rem;
            --space-6: 2rem;
            --space-7: 3rem;
            --space-8: 4rem;

            /* Radius & Shadow */
            --radius-sm: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1.25rem;
            --shadow-1: 0 1px 2px rgba(28,35,32,0.06);
            --shadow-2: 0 8px 24px rgba(28,35,32,0.10);
            --border-1: 1px solid var(--color-line);

            /* Motion */
            --ease-standard: cubic-bezier(0.2, 0.0, 0.0, 1);
            --dur-fast: 120ms;
            --dur-med: 200ms;

            /* Buttons */
            --btn-primary-bg: var(--color-green-700);
            --btn-primary-fg: #FFFFFF;
            --btn-primary-bg-hover: var(--color-green-900);

            /* Cards */
            --card-bg: var(--color-surface-0);
            --card-border: var(--border-1);
            --card-radius: var(--radius-lg);
            --card-shadow: var(--shadow-1);

            /* Focus ring */
            --focus-ring: 0 0 0 3px rgba(124,203,139,0.35);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: var(--color-surface-1);
            min-height: 100vh;
            color: var(--color-ink);
            line-height: var(--leading-normal);
        }

        .font-display {
            font-family: 'Plus Jakarta Sans', var(--font-sans);
            letter-spacing: -0.01em;
        }

        /* Headings */
        h1, h2, h3, h4, h5, h6 {
            color: var(--heading-color);
            line-height: var(--leading-snug);
            letter-spacing: -0.01em;
        }

        /* Body text */
        p, span, li, label {
            color: var(--color-ink);
        }

        /* Secondary text */
        .text-secondary {
            color: var(--color-ink-2);
        }

        /* Muted text */
        .text-muted {
            color: var(--color-ink-3);
        }

        /* Links */
        a {
            color: var(--color-link);
            text-decoration: none;
            transition: color var(--dur-med) var(--ease-standard);
        }

        a:hover {
            color: var(--color-link-hover);
        }

        /* Clean, calm header */
        .gbca-header {
            background: var(--color-green-700);
        }

        /* Clean card style */
        .glass-card {
            background: var(--card-bg);
            border: var(--card-border);
            box-shadow: var(--card-shadow);
            border-radius: var(--radius-md);
        }

        .category-badge {
            transition: all var(--dur-med) var(--ease-standard);
        }

        .category-badge:hover {
            transform: translateY(-1px);
            border-color: var(--color-line);
        }

        .credit-card {
            transition: all var(--dur-med) var(--ease-standard);
            border: var(--border-1);
            background: var(--color-surface-0);
        }

        .credit-card:hover {
            border-color: var(--color-green-300);
        }

        .credit-card.selected {
            background-color: var(--color-green-100);
            border-color: var(--color-green-700);
        }

        .circular-progress {
            transition: stroke-dashoffset 0.5s ease-in-out;
        }

        .fade-in {
            animation: fadeIn 0.25s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-backdrop {
            background: rgba(28, 35, 32, 0.4);
            backdrop-filter: blur(2px);
        }

        /* Custom checkbox - clean style */
        .custom-checkbox {
            appearance: none;
            width: 18px;
            height: 18px;
            border: 1.5px solid var(--color-line);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--dur-fast) var(--ease-standard);
            position: relative;
            background: var(--color-surface-0);
        }

        .custom-checkbox:checked {
            background-color: var(--color-green-700);
            border-color: var(--color-green-700);
        }

        .custom-checkbox:checked::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 2px;
            width: 5px;
            height: 9px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .custom-checkbox:focus-visible {
            box-shadow: var(--focus-ring);
        }

        .required-badge {
            font-size: var(--text-xs);
            letter-spacing: 0.05em;
            font-weight: 500;
        }

        /* Credit Detail Modal Styles */
        .modal-enter {
            animation: modalEnter var(--dur-med) var(--ease-standard);
        }

        @keyframes modalEnter {
            from {
                opacity: 0;
                transform: scale(0.98) translateY(8px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .section-card {
            background: var(--color-surface-0);
            border: var(--border-1);
            transition: border-color var(--dur-fast) var(--ease-standard);
        }

        .section-card:hover {
            border-color: var(--color-green-300);
        }

        .criteria-item {
            position: relative;
            padding-left: 1.25rem;
        }

        .criteria-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0.6rem;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--color-green-700);
        }

        .doc-item {
            transition: background-color var(--dur-fast) var(--ease-standard);
        }

        .doc-item:hover {
            background-color: var(--color-surface-2);
        }

        .pathway-card {
            background: var(--color-surface-1);
            border: var(--border-1);
            transition: border-color var(--dur-fast) var(--ease-standard);
        }

        .pathway-card:hover {
            border-color: var(--color-green-300);
        }

        .points-badge {
            background: var(--color-green-700);
        }

        .info-button {
            transition: opacity var(--dur-fast) var(--ease-standard);
        }

        .info-button:hover {
            opacity: 0.8;
        }

        .tab-button {
            transition: all var(--dur-fast) var(--ease-standard);
        }

        .tab-button.active {
            background: var(--color-green-700);
            color: white;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: var(--color-surface-2);
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: var(--color-line);
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: var(--color-ink-3);
        }

        /* Rating badge - clean, no stars */
        .rating-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: #F5F5F4;
            border: 1px solid #E7E5E4;
            border-radius: 6px;
            font-weight: 500;
            color: #374151;
        }

        .rating-badge.rating-4 {
            border-color: #1D4ED8;
            color: #1D4ED8;
        }

        .rating-badge.rating-5 {
            border-color: #047857;
            color: #047857;
        }

        .rating-badge.rating-6 {
            border-color: #2E6B3F;
            color: #2E6B3F;
            background: #F0FDF4;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background: #1a1a1a;
            color: #e5e5e5;
        }

        body.dark-mode .glass-card {
            background: #262626;
            border-color: #404040;
        }

        body.dark-mode .modal-backdrop {
            background: rgba(0, 0, 0, 0.6);
        }

        body.dark-mode input,
        body.dark-mode textarea,
        body.dark-mode select {
            background-color: #262626;
            border-color: #404040;
            color: #e5e5e5;
        }

        body.dark-mode input::placeholder,
        body.dark-mode textarea::placeholder {
            color: #737373;
        }

        body.dark-mode .section-card {
            background: #262626;
            border-color: #404040;
        }

        body.dark-mode .pathway-card {
            background: #1f2937;
            border-color: #374151;
        }

        body.dark-mode h1, body.dark-mode h2, body.dark-mode h3,
        body.dark-mode h4, body.dark-mode h5, body.dark-mode h6 {
            color: #e5e5e5;
        }

        body.dark-mode p, body.dark-mode span, body.dark-mode li {
            color: #d4d4d4;
        }

        /* Timeline View Styles */
        .timeline-phase {
            min-width: 120px;
        }

        .timeline-credit {
            transition: all 0.15s ease;
        }

        .timeline-credit:hover {
            transform: translateY(-1px);
        }

        /* Sidebar Styles - Clean, no gradients */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 320px;
            background: #FFFFFF;
            border-right: 1px solid var(--color-line);
            transition: transform 0.25s ease;
            z-index: 40;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .sidebar.collapsed {
            transform: translateX(-320px);
        }

        .sidebar-toggle {
            position: fixed;
            left: 320px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 40px;
            background: #FFFFFF;
            border: 1px solid #E7E5E4;
            border-left: none;
            border-radius: 0 6px 6px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: left 0.25s ease;
            z-index: 41;
            color: #6B7280;
        }

        .sidebar-toggle:hover {
            background: #F5F5F4;
            color: #374151;
        }

        .sidebar-toggle.collapsed {
            left: 0;
        }

        .main-content {
            margin-left: 320px;
            transition: margin-left 0.25s ease;
            min-height: 100vh;
        }

        .main-content.sidebar-collapsed {
            margin-left: 0;
        }

        body.dark-mode .sidebar {
            background: #1a1a1a;
            border-right-color: #404040;
        }

        body.dark-mode .sidebar-toggle {
            background: #262626;
            border-color: #404040;
            color: #a3a3a3;
        }

        body.dark-mode .sidebar-toggle:hover {
            background: #333333;
            color: #e5e5e5;
        }

        /* Mobile responsiveness */
        @media (max-width: 1024px) {
            .sidebar {
                width: 280px;
            }
            .sidebar.collapsed {
                transform: translateX(-280px);
            }
            .sidebar-toggle {
                left: 280px;
            }
            .sidebar-toggle.collapsed {
                left: 0;
            }
            .main-content {
                margin-left: 280px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                max-width: 320px;
            }
            .sidebar.collapsed {
                transform: translateX(-100%);
            }
            .sidebar-toggle {
                left: 320px;
            }
            .sidebar-toggle.collapsed {
                left: 0;
            }
            .main-content {
                margin-left: 0;
            }
            .main-content.sidebar-open {
                margin-left: 0;
            }
            .sidebar-overlay {
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,0.5);
                z-index: 39;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s;
            }
            .sidebar-overlay.visible {
                opacity: 1;
                pointer-events: auto;
            }
        }

        /* Scrollbar for sidebar */
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
        }

        body.dark-mode .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
        }

        /* Print Styles - Clean PDF export */
        @media print {
            body {
                background: white !important;
                color: #374151 !important;
                font-size: 11pt;
                line-height: 1.4;
            }

            .no-print,
            .sidebar,
            .sidebar-toggle,
            .modal-backdrop,
            button:not(.print-visible),
            .dark-mode-toggle,
            nav {
                display: none !important;
            }

            .main-content {
                margin-left: 0 !important;
                padding: 20px !important;
            }

            .glass-card,
            .credit-card,
            .section-card {
                box-shadow: none !important;
                border: 1px solid #E7E5E4 !important;
                page-break-inside: avoid;
            }

            .credit-card {
                margin-bottom: 10px;
            }

            h1, h2, h3, h4, h5, h6 {
                color: #2E6B3F !important;
                page-break-after: avoid;
            }

            a {
                text-decoration: none !important;
                color: #374151 !important;
            }

            /* Keep category headers with their content */
            .category-badge {
                page-break-inside: avoid;
            }

            /* Clean progress indicators for print */
            .circular-progress {
                border: 2px solid #2E6B3F !important;
            }

            /* Optimize rating badges for print */
            .rating-badge {
                border: 1px solid currentColor !important;
                background: white !important;
            }

            /* Page margins */
            @page {
                margin: 1.5cm;
                size: A4;
            }

            /* First page */
            @page :first {
                margin-top: 2cm;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ============================================
        // GBCA SVG ICONS - Fine-line, minimal style
        // ============================================

        // Category icon image paths - Official Green Star 2020 icons
        const categoryIconPaths = {
            responsible: '2020 Responsible icon 500x500px_72ppi.png',
            healthy: '2020 Healthy icon 500x500px_300ppi.png',
            resilient: '2020 Resilient icon 500x500px_72ppi.png',
            positive: '2020 Positive icon 500x500px_300ppi.png',
            places: '2020 Places icon 500x500px_300ppi.png',
            people: '2020 People icon 500x500px_300ppi.png',
            nature: '2020 Nature icon 500x500px_300ppi.png',
            leadership: '2020 Leadership icon 500x500px_300ppi.png'
        };

        const GBCAIcons = {
            // Main category icons - use official PNG images
            responsible: ({ size = 24, className = '' }) => (
                <img src={categoryIconPaths.responsible} alt="Responsible" width={size} height={size} className={`object-contain ${className}`} />
            ),
            healthy: ({ size = 24, className = '' }) => (
                <img src={categoryIconPaths.healthy} alt="Healthy" width={size} height={size} className={`object-contain ${className}`} />
            ),
            resilient: ({ size = 24, className = '' }) => (
                <img src={categoryIconPaths.resilient} alt="Resilient" width={size} height={size} className={`object-contain ${className}`} />
            ),
            positive: ({ size = 24, className = '' }) => (
                <img src={categoryIconPaths.positive} alt="Positive" width={size} height={size} className={`object-contain ${className}`} />
            ),
            places: ({ size = 24, className = '' }) => (
                <img src={categoryIconPaths.places} alt="Places" width={size} height={size} className={`object-contain ${className}`} />
            ),
            people: ({ size = 24, className = '' }) => (
                <img src={categoryIconPaths.people} alt="People" width={size} height={size} className={`object-contain ${className}`} />
            ),
            nature: ({ size = 24, className = '' }) => (
                <img src={categoryIconPaths.nature} alt="Nature" width={size} height={size} className={`object-contain ${className}`} />
            ),
            leadership: ({ size = 24, className = '' }) => (
                <img src={categoryIconPaths.leadership} alt="Leadership" width={size} height={size} className={`object-contain ${className}`} />
            ),
            // Generic checkmark for verification
            verification: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
            ),
            // Construction
            construction: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <rect x="2" y="6" width="20" height="12" rx="2"/>
                    <path d="M12 6v12"/>
                    <path d="M6 10v4"/>
                    <path d="M18 10v4"/>
                </svg>
            ),
            // Documentation
            documentation: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                    <polyline points="10 9 9 9 8 9"/>
                </svg>
            ),
            // Energy
            energy: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
            ),
            // Water
            water: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/>
                </svg>
            ),
            // Materials
            materials: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                </svg>
            ),
            // Air Quality - Wavy lines representing clean air
            airQuality: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M8 12h.01"/>
                    <path d="M12 12h.01"/>
                    <path d="M16 12h.01"/>
                    <path d="M3 8c2-2 4-2 6 0s4 2 6 0 4-2 6 0"/>
                    <path d="M3 16c2-2 4-2 6 0s4 2 6 0 4-2 6 0"/>
                </svg>
            ),
            // Acoustic - Sound waves
            acoustic: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M12 6v12"/>
                    <path d="M8 9v6"/>
                    <path d="M16 9v6"/>
                    <path d="M4 11v2"/>
                    <path d="M20 11v2"/>
                </svg>
            ),
            // Biodiversity - Multiple leaves/nature
            biodiversity: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 6c-2 0-4 2-4 4 0 1 .5 2 1 3"/>
                    <path d="M12 6c2 0 4 2 4 4 0 1-.5 2-1 3"/>
                    <path d="M12 22v-8"/>
                    <path d="M9 15c-1 0-3 1-3 3"/>
                    <path d="M15 15c1 0 3 1 3 3"/>
                </svg>
            ),
            // Transport/Bicycle
            transport: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <circle cx="5.5" cy="17.5" r="3.5"/>
                    <circle cx="18.5" cy="17.5" r="3.5"/>
                    <path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                    <path d="M12 17.5V14l-3-3 4-3 2 3h3"/>
                </svg>
            ),
            // Carbon Reduction - CO2 with down arrow
            carbonReduction: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <circle cx="7" cy="8" r="4"/>
                    <path d="M14 4h4v4"/>
                    <path d="M18 4l-5 5"/>
                    <path d="M12 15v6"/>
                    <path d="M9 18l3 3 3-3"/>
                </svg>
            ),
            // Recycle
            recycle: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M7 19H4.815a1.83 1.83 0 0 1-1.57-.881 1.785 1.785 0 0 1-.004-1.784L7.196 9.5"/>
                    <path d="M11 19h8.203a1.83 1.83 0 0 0 1.556-.89 1.784 1.784 0 0 0 0-1.775l-1.226-2.12"/>
                    <path d="m14 16-3 3 3 3"/>
                    <path d="M8.293 13.596 4.875 7.5l3.418-6.096"/>
                    <path d="m5 10 3-3-3-3"/>
                    <path d="M12.707 4.403 16.125 10.5l3.418 6.096"/>
                    <path d="m19 7-3 3 3 3"/>
                </svg>
            ),
            // Solar Energy - Sun with panel
            solarEnergy: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <circle cx="12" cy="6" r="3"/>
                    <path d="M12 1v2"/>
                    <path d="M17 6h2"/>
                    <path d="M5 6h2"/>
                    <path d="M15.5 3.5l1 1"/>
                    <path d="M7.5 3.5l-1 1"/>
                    <rect x="4" y="12" width="16" height="8" rx="1"/>
                    <path d="M8 12v8"/>
                    <path d="M12 12v8"/>
                    <path d="M16 12v8"/>
                </svg>
            ),
            // Handover - Key/handshake
            handover: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>
                </svg>
            ),
            // Efficiency - Speedometer/gauge
            efficiency: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M12 2a10 10 0 1 0 10 10"/>
                    <path d="M12 12l6-6"/>
                    <path d="M22 2l-4 4"/>
                    <circle cx="12" cy="12" r="2"/>
                </svg>
            ),
            // Indoor Environment
            indoorEnvironment: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                    <path d="M12 7v2"/>
                </svg>
            ),
            // Climate/Weather
            climate: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/>
                </svg>
            ),
            // Community
            community: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <path d="M9 22V12h6v10"/>
                    <circle cx="12" cy="7" r="2"/>
                </svg>
            ),
            // Innovation/Lightbulb
            innovation: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M9 18h6"/>
                    <path d="M10 22h4"/>
                    <path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"/>
                </svg>
            ),
            // Calculator
            calculator: ({ size = 24, className = '' }) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <rect x="4" y="2" width="16" height="20" rx="2"/>
                    <line x1="8" y1="6" x2="16" y2="6"/>
                    <line x1="8" y1="10" x2="8" y2="10"/>
                    <line x1="12" y1="10" x2="12" y2="10"/>
                    <line x1="16" y1="10" x2="16" y2="10"/>
                    <line x1="8" y1="14" x2="8" y2="14"/>
                    <line x1="12" y1="14" x2="12" y2="14"/>
                    <line x1="16" y1="14" x2="16" y2="14"/>
                    <line x1="8" y1="18" x2="8" y2="18"/>
                    <line x1="12" y1="18" x2="16" y2="18"/>
                </svg>
            )
        };

        // Icon component that renders GBCA icons
        function CategoryIcon({ category, size = 24, className = '' }) {
            const IconComponent = GBCAIcons[category];
            if (IconComponent) {
                return <IconComponent size={size} className={className} />;
            }
            return null;
        }

        // ============================================
        // DATA: Categories and Credits from Green Star Buildings v1.1
        // ============================================

        // Default data (fallback if no admin data exists)
        const defaultCategoriesData = [
            {
                id: 'responsible',
                name: 'Responsible',
                icon: 'ðŸ”§',
                faIcon: 'fa-solid fa-gear',
                color: 'amber',
                colorClasses: {
                    bg: 'bg-amber-500',
                    bgLight: 'bg-amber-50',
                    text: 'text-amber-600',
                    border: 'border-amber-500',
                    hover: 'hover:bg-amber-50'
                },
                maxPoints: 35,
                description: 'Responsible sourcing, construction practices, and materials',
                credits: [
                    {
                        id: 'ind-dev',
                        name: 'Industry Development',
                        points: 2,
                        required: false,
                        description: 'Supporting the development of the green building industry through training, research, and knowledge sharing.',
                        aims: 'To encourage and recognise projects that support the development of the green building industry and sustainability skills within the project team.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'No specific requirements at this level'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 1,
                                color: 'blue',
                                requirements: [
                                    'At least 2 project team members complete Green Star accreditation or equivalent training',
                                    'Project participates in one industry event (presentation, case study, or site tour)'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 2,
                                color: 'green',
                                requirements: [
                                    'At least 4 project team members complete Green Star accreditation',
                                    'Project participates in multiple industry events',
                                    'Project contributes to sustainability research or innovation initiatives'
                                ]
                            }
                        ],
                        criteria: [
                            'Professional Development: Project team members undertake Green Star-related professional development',
                            'Industry Contribution: The project contributes to the green building industry through case studies, tours, or presentations',
                            'Research & Innovation: The project supports sustainability research or innovation initiatives'
                        ],
                        documentation: [
                            'Evidence of professional development completion (certificates, attendance records)',
                            'Case study or presentation materials',
                            'Research collaboration agreements or outputs'
                        ],
                        tips: 'Start early - professional development can be completed throughout the project. Consider hosting site tours for industry groups.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev'],
                        difficulty: 'Easy',
                        commonMistakes: [
                            'Waiting until late in project to arrange training',
                            'Not documenting industry contributions as they happen',
                            'Forgetting to get signed attendance records for events'
                        ],
                        relatedCredits: ['resp-const', 'impacts-disc']
                    },
                    {
                        id: 'resp-const',
                        name: 'Responsible Construction',
                        points: 5,
                        required: true,
                        description: 'Implementing environmental management practices during construction.',
                        aims: 'To encourage and recognise construction practices that minimise environmental impacts and promote responsible site management.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Basic Environmental Management Plan is in place',
                                    'Compliance with local environmental regulations'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 3,
                                color: 'blue',
                                requirements: [
                                    'Comprehensive EMP with regular monitoring and reporting',
                                    'Air quality, noise, and stormwater management controls implemented',
                                    'At least 80% waste diversion from landfill'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 5,
                                color: 'green',
                                requirements: [
                                    'Third-party certified EMP (ISO 14001 or equivalent)',
                                    'Real-time environmental monitoring systems',
                                    'At least 95% waste diversion from landfill',
                                    'Zero environmental non-conformances'
                                ]
                            }
                        ],
                        criteria: [
                            'Environmental Management Plan: An EMP is implemented throughout construction',
                            'Air Quality Management: Dust and emissions are actively controlled on site',
                            'Noise Management: Construction noise is monitored and managed',
                            'Stormwater Management: Sediment and erosion controls are in place',
                            'Waste Management: Construction waste is sorted and diverted from landfill'
                        ],
                        documentation: [
                            'Environmental Management Plan (EMP)',
                            'Site inspection reports and photos',
                            'Waste tracking documentation',
                            'Complaints register and response actions',
                            'Third-party audit reports (if applicable)'
                        ],
                        tips: 'Implement robust systems from day one. Regular site inspections and photographic evidence are essential.',
                        projectPhases: ['Construction', 'Handover'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Not having EMP ready before construction begins',
                            'Inadequate monitoring and reporting systems',
                            'Poor waste tracking documentation'
                        ],
                        relatedCredits: ['ind-dev', 'resp-resource', 'impacts-nature']
                    },
                    {
                        id: 'verify-hand',
                        name: 'Verification and Handover',
                        points: 3,
                        required: false,
                        description: 'Ensuring building systems work as designed through commissioning and handover processes.',
                        aims: 'To ensure that building systems are properly commissioned, tuned, and handed over to enable optimal performance.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Basic commissioning of major systems',
                                    'Standard handover documentation provided'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Independent Commissioning Agent engaged',
                                    'All building systems commissioned and tested',
                                    'Comprehensive O&M manuals provided',
                                    'Building operator training completed'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'Enhanced commissioning with seasonal testing',
                                    '12-month building tuning period commitment',
                                    'Digital building logbook or BIM-based O&M',
                                    'Ongoing performance monitoring system installed'
                                ]
                            }
                        ],
                        criteria: [
                            'Commissioning Plan: A comprehensive commissioning plan is developed and implemented',
                            'Systems Testing: All building systems are tested and verified against design intent',
                            'Building Tuning: Post-occupancy tuning is undertaken for at least 12 months',
                            'Handover Documentation: Comprehensive O&M manuals and training are provided'
                        ],
                        documentation: [
                            'Commissioning plan and reports',
                            'Test certificates and results',
                            'Building tuning reports',
                            'O&M manuals',
                            'Training records for building operators'
                        ],
                        tips: 'Engage a commissioning agent early. Building tuning commitment should be included in contracts.',
                        projectPhases: ['Documentation', 'Construction', 'Handover'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Engaging commissioning agent too late in design',
                            'Insufficient time allocated for building tuning',
                            'O&M manuals not completed before handover'
                        ],
                        relatedCredits: ['resp-const', 'energy-use', 'ops-res']
                    },
                    {
                        id: 'resp-resource',
                        name: 'Responsible Resource Management',
                        points: 3,
                        required: false,
                        description: 'Managing construction waste and materials responsibly.',
                        aims: 'To encourage practices that reduce construction waste and promote material reuse and recycling.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Basic waste management plan in place',
                                    'Waste streams separated on site'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'At least 80% construction waste diverted from landfill',
                                    'Waste tracking and reporting system implemented',
                                    'On-site waste sorting with dedicated bins'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'At least 95% waste diversion from landfill',
                                    'Salvaged or reused materials incorporated (min 5% by cost)',
                                    'Closed-loop recycling partnerships established',
                                    'Waste-to-resource initiatives implemented'
                                ]
                            }
                        ],
                        criteria: [
                            'Waste Management Plan: A detailed waste management plan is implemented',
                            'Waste Diversion: At least 90% of construction waste is diverted from landfill',
                            'Material Reuse: Salvaged or reused materials are incorporated into the project'
                        ],
                        documentation: [
                            'Waste Management Plan',
                            'Waste tracking records and receipts',
                            'Recycling facility certifications',
                            'Photos of material reuse applications'
                        ],
                        tips: 'Set up clear waste streams on site from day one. Work with recyclers early to understand what they can accept.',
                        projectPhases: ['Construction', 'Handover'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Starting waste tracking too late in construction',
                            'Not having EMP ready before construction begins',
                            'Inadequate monitoring and reporting systems'
                        ],
                        relatedCredits: ['ind-dev', 'impacts-nature']
                    },
                    {
                        id: 'resp-proc',
                        name: 'Responsible Procurement',
                        points: 2,
                        required: false,
                        description: 'Sourcing products and materials with verified sustainability credentials.',
                        aims: 'To encourage the specification and procurement of products with third-party verified sustainability credentials.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Basic procurement documentation in place',
                                    'Awareness of sustainable procurement options'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 1,
                                color: 'blue',
                                requirements: [
                                    'Sustainable procurement policy documented and implemented',
                                    'At least 50% of products (by cost) have sustainability certifications',
                                    'Supply chain tracking for key materials'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 2,
                                color: 'green',
                                requirements: [
                                    'Comprehensive sustainable procurement policy with regular review',
                                    'At least 80% of products have third-party verified credentials',
                                    'Full supply chain transparency with public disclosure'
                                ]
                            }
                        ],
                        criteria: [
                            'Procurement Policy: A sustainable procurement policy is implemented',
                            'Certified Products: Products with recognised sustainability certifications are specified',
                            'Supply Chain Transparency: Product supply chains are documented and verified'
                        ],
                        documentation: [
                            'Sustainable procurement policy',
                            'Product certifications and EPDs',
                            'Supplier declarations and evidence',
                            'Procurement tracking spreadsheet'
                        ],
                        tips: 'Engage with suppliers early about certification requirements. EPDs are increasingly available for common products.',
                        projectPhases: ['Design Dev', 'Documentation', 'Construction'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Not including sustainability requirements in tender documents',
                            'Accepting substitutions without checking credentials',
                            'Poor tracking of procured vs specified products'
                        ],
                        relatedCredits: ['resp-struct', 'resp-finishes', 'impacts-disc']
                    },
                    {
                        id: 'resp-struct',
                        name: 'Responsible Structure',
                        points: 5,
                        required: false,
                        description: 'Using responsible structural materials with lower environmental impacts.',
                        aims: 'To encourage the use of structural materials with reduced environmental impacts and verified sustainability credentials.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Compliance with minimum code requirements for materials',
                                    'Basic material specifications documented'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 3,
                                color: 'blue',
                                requirements: [
                                    'At least 50% of concrete by mass uses SCMs or low-carbon cement',
                                    'Steel from ResponsibleSteel certified suppliers',
                                    'All timber FSC or PEFC certified',
                                    'EPDs for at least 50% of structural products by cost'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 5,
                                color: 'green',
                                requirements: [
                                    'At least 80% of concrete uses low-carbon alternatives',
                                    '100% steel from ResponsibleSteel certified sources',
                                    'All structural timber certified with chain of custody',
                                    'EPDs for at least 90% of structural products',
                                    'Material passports for major structural elements'
                                ]
                            }
                        ],
                        criteria: [
                            'Responsible Concrete: Concrete includes supplementary cementitious materials or uses low-carbon cement',
                            'Responsible Steel: Steel is sourced from responsible suppliers with verified credentials',
                            'Responsible Timber: Timber is certified under FSC or PEFC schemes',
                            'Product Transparency: Structural products have Environmental Product Declarations (EPDs)'
                        ],
                        documentation: [
                            'Material specifications and quantities',
                            'EPDs for structural products',
                            'Supplier certifications (ResponsibleSteel, FSC, PEFC)',
                            'Concrete mix designs and cement mill certificates',
                            'Responsible Products Calculator outputs'
                        ],
                        calculatorRequired: true,
                        relatedCalculator: 'responsible-products',
                        tips: 'Work with structural engineers early to optimise material quantities. Low-carbon concrete is increasingly available.',
                        projectPhases: ['Schematic', 'Design Dev', 'Documentation'],
                        difficulty: 'Hard',
                        commonMistakes: [
                            'Not engaging structural engineer early on material optimization',
                            'Missing EPD collection during procurement',
                            'Incomplete chain of custody documentation for timber'
                        ],
                        relatedCredits: ['resp-envelope', 'upfront-carbon-red', 'resp-proc']
                    },
                    {
                        id: 'resp-envelope',
                        name: 'Responsible Envelope',
                        points: 5,
                        required: false,
                        description: 'Using responsible envelope materials and systems.',
                        aims: 'To encourage the use of building envelope materials with reduced environmental impacts.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Envelope meets minimum thermal performance requirements',
                                    'Basic material documentation available'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 3,
                                color: 'blue',
                                requirements: [
                                    'At least 50% of facade materials have sustainability credentials',
                                    'Insulation products free from harmful substances (no HFCs, Red List chemicals)',
                                    'EPDs for at least 50% of envelope products by cost',
                                    'Glazing systems from certified sustainable sources'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 5,
                                color: 'green',
                                requirements: [
                                    'At least 80% of envelope products have third-party certifications',
                                    'All insulation products have EPDs and are Red List free',
                                    'EPDs for at least 90% of envelope products',
                                    'Whole-of-envelope LCA completed showing 20% reduction vs benchmark'
                                ]
                            }
                        ],
                        criteria: [
                            'Responsible Facade Materials: Facade systems use materials with sustainability credentials',
                            'Responsible Insulation: Insulation products have low embodied carbon and no harmful substances',
                            'Responsible Glazing: Glazing systems are responsibly sourced',
                            'Product Transparency: Envelope products have EPDs or equivalent documentation'
                        ],
                        documentation: [
                            'Material specifications for envelope systems',
                            'EPDs for envelope products',
                            'Supplier sustainability certifications',
                            'Responsible Products Calculator outputs'
                        ],
                        calculatorRequired: true,
                        relatedCalculator: 'responsible-products',
                        tips: 'Consider the whole envelope system including framing, insulation, and finishes.',
                        projectPhases: ['Schematic', 'Design Dev', 'Documentation'],
                        difficulty: 'Hard',
                        commonMistakes: [
                            'Not tracking sustainability credentials of substituted products',
                            'Overlooking thermal bridging from framing materials',
                            'Insulation specifications changed without checking EPD availability'
                        ],
                        relatedCredits: ['resp-struct', 'clean-air', 'upfront-carbon-red']
                    },
                    {
                        id: 'resp-systems',
                        name: 'Responsible Systems',
                        points: 5,
                        required: false,
                        description: 'Using responsible building systems and services.',
                        aims: 'To encourage the use of building services and systems with reduced environmental impacts.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building systems meet code compliance',
                                    'Basic equipment schedules documented'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 3,
                                color: 'blue',
                                requirements: [
                                    'At least 50% of HVAC equipment by cost has sustainability credentials',
                                    'Electrical systems use products with recognised certifications',
                                    'Water-efficient plumbing products with WELS ratings',
                                    'EPDs for at least 50% of major systems equipment'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 5,
                                color: 'green',
                                requirements: [
                                    'At least 80% of all building systems have sustainability credentials',
                                    'HVAC equipment uses low-GWP refrigerants (GWP < 750)',
                                    'EPDs for at least 90% of major systems equipment',
                                    'Whole-of-systems LCA completed',
                                    'Equipment designed for end-of-life recovery'
                                ]
                            }
                        ],
                        criteria: [
                            'Responsible HVAC: HVAC equipment and ductwork use responsible materials',
                            'Responsible Electrical: Electrical systems use products with sustainability credentials',
                            'Responsible Plumbing: Plumbing products are responsibly sourced',
                            'Product Transparency: Building systems products have EPDs'
                        ],
                        documentation: [
                            'Equipment specifications and schedules',
                            'EPDs for systems products',
                            'Supplier certifications',
                            'Responsible Products Calculator outputs'
                        ],
                        calculatorRequired: true,
                        relatedCalculator: 'responsible-products',
                        tips: 'Engage MEP consultants early on responsible product requirements.',
                        projectPhases: ['Design Dev', 'Documentation', 'Construction'],
                        difficulty: 'Hard',
                        commonMistakes: [
                            'Late engagement with MEP consultants on sustainability',
                            'Equipment substitutions without checking refrigerant GWP',
                            'Missing EPDs for major equipment items'
                        ],
                        relatedCredits: ['refrigerant', 'energy-use', 'verify-hand']
                    },
                    {
                        id: 'resp-finishes',
                        name: 'Responsible Finishes',
                        points: 3,
                        required: false,
                        description: 'Using responsible interior finishes and materials.',
                        aims: 'To encourage the use of interior finishes with reduced environmental impacts and health benefits.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Interior finishes comply with building code',
                                    'Basic finish schedules documented'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'At least 50% of flooring by area has sustainability certifications',
                                    'Ceiling systems from certified sustainable sources',
                                    'All paints and coatings meet GECA or equivalent low-VOC standards',
                                    'EPDs for at least 50% of finish products by cost'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'At least 80% of all finishes have third-party sustainability credentials',
                                    'All finishes are Declare labelled or HPD compliant',
                                    'Zero Red List chemicals in interior finishes',
                                    'EPDs for at least 90% of finish products',
                                    'Bio-based or recycled content in majority of finishes'
                                ]
                            }
                        ],
                        criteria: [
                            'Responsible Flooring: Floor finishes have sustainability certifications',
                            'Responsible Ceilings: Ceiling systems use responsible materials',
                            'Responsible Walls: Wall finishes and linings are responsibly sourced',
                            'Low-VOC Products: Interior finishes meet low-VOC requirements'
                        ],
                        documentation: [
                            'Finish schedules with product details',
                            'Product certifications (GECA, Declare, etc.)',
                            'EPDs for finish products',
                            'VOC test reports or certifications'
                        ],
                        calculatorRequired: true,
                        relatedCalculator: 'responsible-products',
                        tips: 'Coordinate with interior designers early. Many finish products now have sustainability certifications.',
                        projectPhases: ['Design Dev', 'Documentation', 'Construction'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Interior designer selections made without checking certifications',
                            'VOC testing not specified in contracts',
                            'Finish substitutions without re-checking sustainability credentials'
                        ],
                        relatedCredits: ['toxins', 'clean-air', 'resp-proc']
                    },
                    {
                        id: 'impacts-disc',
                        name: 'Impacts Disclosure',
                        points: 2,
                        required: false,
                        description: 'Disclosing environmental impacts of the building.',
                        aims: 'To encourage transparency about the environmental impacts of the building through public disclosure.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Basic environmental data collected',
                                    'Internal reporting on environmental performance'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 1,
                                color: 'blue',
                                requirements: [
                                    'Whole-building LCA completed using EN 15978 or equivalent',
                                    'Environmental impact data disclosed publicly (website or report)',
                                    'Key metrics reported: GWP, water use, waste generated'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 2,
                                color: 'green',
                                requirements: [
                                    'Third-party verified whole-building LCA',
                                    'Comprehensive public disclosure including all impact categories',
                                    'Commitment to ongoing environmental reporting',
                                    'Data shared with industry benchmarking databases'
                                ]
                            }
                        ],
                        criteria: [
                            'Whole Building LCA: A life cycle assessment is completed for the building',
                            'Public Disclosure: Environmental impact data is publicly disclosed',
                            'Third-Party Verification: Impact data is independently verified'
                        ],
                        documentation: [
                            'Life Cycle Assessment report',
                            'Public disclosure documentation (website, report)',
                            'Third-party verification statement'
                        ],
                        tips: 'Use LCA early in design to inform material selection decisions. Consider publishing an environmental disclosure report.',
                        projectPhases: ['Documentation', 'Handover'],
                        difficulty: 'Hard',
                        commonMistakes: [
                            'Starting LCA too late in design to influence decisions',
                            'Using inconsistent data sources across LCA',
                            'Not planning for public disclosure early enough'
                        ],
                        relatedCredits: ['upfront-carbon-red', 'resp-struct', 'ind-dev']
                    }
                ]
            },
            {
                id: 'healthy',
                name: 'Healthy',
                icon: 'â¤ï¸',
                faIcon: 'fa-solid fa-heart-pulse',
                color: 'green',
                colorClasses: {
                    bg: 'bg-emerald-500',
                    bgLight: 'bg-emerald-50',
                    text: 'text-emerald-600',
                    border: 'border-emerald-500',
                    hover: 'hover:bg-emerald-50'
                },
                maxPoints: 25,
                description: 'Indoor environment quality and occupant health',
                credits: [
                    {
                        id: 'clean-air',
                        name: 'Clean Air',
                        points: 6,
                        required: true,
                        description: 'Ensuring high indoor air quality through ventilation and low-emission materials.',
                        aims: 'To ensure good indoor air quality that supports occupant health and wellbeing.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Ventilation complies with AS 1668.2 minimum requirements',
                                    'Basic exhaust systems for toilets and kitchens'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 4,
                                color: 'blue',
                                requirements: [
                                    'Ventilation rates exceed code by at least 50%',
                                    'MERV 13 (or equivalent) filtration on outdoor air',
                                    'CO2 sensors in all occupied spaces connected to BMS',
                                    'All interior paints and adhesives meet GECA standards',
                                    'Direct exhaust from copy rooms and cleaning stores'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 6,
                                color: 'green',
                                requirements: [
                                    'Ventilation rates exceed code by at least 100%',
                                    'MERV 16 filtration or better with activated carbon',
                                    'Real-time IAQ monitoring (CO2, PM2.5, VOCs) publicly displayed',
                                    'All materials certified to meet WELL Air requirements',
                                    'Pre-occupancy flush-out completed and documented'
                                ]
                            }
                        ],
                        criteria: [
                            'Ventilation Rates: Fresh air supply exceeds minimum code requirements',
                            'Air Filtration: High-efficiency filtration is provided for outdoor air',
                            'CO2 Monitoring: CO2 sensors are installed to monitor air quality',
                            'Low-Emission Materials: Interior materials meet stringent VOC limits',
                            'Exhaust Systems: Pollutant sources are directly exhausted'
                        ],
                        documentation: [
                            'Mechanical ventilation design calculations',
                            'Air filtration specifications (MERV ratings)',
                            'CO2 sensor locations and BMS integration details',
                            'VOC test reports for interior materials',
                            'As-built drawings showing exhaust systems'
                        ],
                        tips: 'Consider demand-controlled ventilation based on CO2 levels. Low-VOC specifications should be included in contracts.',
                        projectPhases: ['Schematic', 'Design Dev', 'Documentation'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Undersizing ventilation rates without considering future flexibility',
                            'Not specifying filter ratings in design documentation',
                            'Leaving low-VOC requirements out of tender documents'
                        ],
                        relatedCredits: ['light-quality', 'toxins', 'amenity']
                    },
                    {
                        id: 'light-quality',
                        name: 'Light Quality',
                        points: 5,
                        required: false,
                        description: 'Providing adequate natural and artificial lighting for occupant comfort.',
                        aims: 'To provide high-quality lighting that supports visual comfort, health, and productivity.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Artificial lighting meets AS/NZS 1680 minimum requirements',
                                    'Basic daylight access to perimeter zones'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 3,
                                color: 'blue',
                                requirements: [
                                    'At least 60% of NLA achieves daylight factor of 2% or higher',
                                    'Glare controlled with automated blinds or fixed shading',
                                    'Lighting zones of max 100mÂ² with individual dimming control',
                                    'Colour rendering index (CRI) of 80+ for all task lighting'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 5,
                                color: 'green',
                                requirements: [
                                    'At least 80% of NLA achieves daylight factor of 2% or higher',
                                    'Direct sunlight access to occupied spaces for at least 2 hours',
                                    'Circadian lighting with tunable white (2700K-6500K)',
                                    'Views to outdoors from at least 75% of regularly occupied spaces',
                                    'Annual illumination modelling (Spatial Daylight Autonomy > 55%)'
                                ]
                            }
                        ],
                        criteria: [
                            'Daylight Access: Occupied spaces receive adequate natural daylight',
                            'Glare Control: Glare from windows and light sources is controlled',
                            'Lighting Levels: Artificial lighting meets recommended levels for tasks',
                            'Lighting Control: Occupants have control over their lighting environment',
                            'Circadian Lighting: Lighting supports natural circadian rhythms'
                        ],
                        documentation: [
                            'Daylight modelling reports',
                            'Glare analysis (UGR calculations)',
                            'Lighting design documentation',
                            'Lighting control zone drawings',
                            'Commissioning reports for lighting systems'
                        ],
                        tips: 'Use daylight modelling early in design. Consider automated blind systems for glare control.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Not running daylight simulations until late in design',
                            'Underestimating glare issues from large glazing areas',
                            'Lighting control zones too large for effective user control'
                        ],
                        relatedCredits: ['clean-air', 'amenity', 'nature-conn']
                    },
                    {
                        id: 'acoustic',
                        name: 'Acoustic Comfort',
                        points: 5,
                        required: false,
                        description: 'Managing noise levels and acoustic conditions within the building.',
                        aims: 'To provide acoustic conditions that support concentration, communication, and comfort.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building meets BCA acoustic requirements',
                                    'Basic acoustic separation between tenancies'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 3,
                                color: 'blue',
                                requirements: [
                                    'Background noise from HVAC < 40 dB(A) in open offices, < 35 dB(A) in enclosed offices',
                                    'Reverberation time < 0.8 seconds in open plan areas',
                                    'Sound insulation Rw â‰¥ 45 between enclosed spaces',
                                    'Acoustic treatment in at least 50% of ceiling area'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 5,
                                color: 'green',
                                requirements: [
                                    'Background noise from HVAC < 35 dB(A) in all occupied spaces',
                                    'Speech privacy achieved with Sound Transmission Class (STC) â‰¥ 50',
                                    'Dedicated quiet zones for focused work (< 40 dB(A))',
                                    'External noise intrusion < 40 dB(A) even in high-noise locations',
                                    'Post-occupancy acoustic verification testing'
                                ]
                            }
                        ],
                        criteria: [
                            'Background Noise: HVAC and equipment noise meets appropriate levels',
                            'Reverberation Time: Spaces have appropriate acoustic treatment',
                            'Sound Isolation: Adequate sound insulation between spaces',
                            'Speech Privacy: Confidential spaces have appropriate acoustic isolation',
                            'External Noise: Facade provides adequate noise attenuation'
                        ],
                        documentation: [
                            'Acoustic consultant report',
                            'Background noise measurements',
                            'Reverberation time calculations',
                            'Sound insulation test results',
                            'Facade acoustic specifications'
                        ],
                        tips: 'Engage an acoustic consultant early. Consider noise from all sources including HVAC, lifts, and external traffic.',
                        projectPhases: ['Schematic', 'Design Dev', 'Documentation'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Not coordinating acoustic requirements with HVAC design',
                            'Underspecifying wall and floor sound ratings',
                            'Open plan areas lacking sufficient acoustic treatment'
                        ],
                        relatedCredits: ['clean-air', 'light-quality', 'amenity']
                    },
                    {
                        id: 'toxins',
                        name: 'Exposure to Toxins',
                        points: 4,
                        required: false,
                        description: 'Minimizing occupant exposure to harmful chemicals and materials.',
                        aims: 'To reduce occupant exposure to harmful substances through careful material selection.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Compliance with Australian hazardous materials regulations',
                                    'No asbestos-containing materials'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Health Product Declarations (HPDs) for at least 20 products',
                                    'All furniture meets GECA or equivalent standards',
                                    'No lead-based paints or finishes',
                                    'Halogenated flame retardants avoided in furniture and textiles'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 4,
                                color: 'green',
                                requirements: [
                                    'Living Building Challenge Red List free for all interior products',
                                    'Declare labels or HPDs for at least 50 products',
                                    'PVC-free materials throughout interior finishes',
                                    'No PFAS (forever chemicals) in furniture or textiles',
                                    'Third-party verification of material health'
                                ]
                            }
                        ],
                        criteria: [
                            'Hazardous Materials: Known hazardous materials are avoided',
                            'Red List Chemicals: Products free from Red List chemicals are specified',
                            'Lead & Asbestos: Building is free from lead paint and asbestos',
                            'Flame Retardants: Furniture and finishes avoid harmful flame retardants'
                        ],
                        documentation: [
                            'Material declarations (Declare labels, HPDs)',
                            'Red List free product certifications',
                            'Hazardous materials survey (for refurbishments)',
                            'Furniture and fabric specifications'
                        ],
                        tips: 'Use Declare labels and Health Product Declarations to verify product contents. Create a project Red List.',
                        projectPhases: ['Design Dev', 'Documentation', 'Construction'],
                        difficulty: 'Hard',
                        commonMistakes: [
                            'Not requesting HPDs early enough from suppliers',
                            'Accepting product substitutions without checking declarations',
                            'Missing Red List chemicals in furniture specifications'
                        ],
                        relatedCredits: ['clean-air', 'resp-finishes', 'resp-proc']
                    },
                    {
                        id: 'amenity',
                        name: 'Amenity and Comfort',
                        points: 3,
                        required: false,
                        description: 'Providing comfortable thermal conditions and amenities.',
                        aims: 'To provide comfortable conditions and amenities that support occupant wellbeing.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building meets BCA thermal comfort requirements',
                                    'Basic amenities (toilets, kitchen/tea points) provided'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'PMV between -1 and +1 for at least 95% of occupied hours',
                                    'Personal control over temperature (thermostats per 100mÂ²)',
                                    'End-of-trip facilities: 1 locker per 10 occupants, showers provided',
                                    'Breakout spaces available on each floor'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'PMV between -0.5 and +0.5 for at least 95% of occupied hours',
                                    'Operable windows or personal fans for individual comfort control',
                                    'Premium end-of-trip: bike repair station, drying room, personal storage',
                                    'Accessible outdoor space for at least 25% of occupants',
                                    'Wellness rooms and quiet spaces provided'
                                ]
                            }
                        ],
                        criteria: [
                            'Thermal Comfort: Building achieves appropriate thermal comfort conditions',
                            'Individual Control: Occupants have control over their thermal environment',
                            'Amenities: Appropriate amenities are provided (end-of-trip, breakout spaces)',
                            'Outdoor Access: Occupants have access to quality outdoor spaces'
                        ],
                        documentation: [
                            'Thermal comfort modelling (PMV/PPD analysis)',
                            'HVAC zone drawings and control descriptions',
                            'Amenity floor plans and specifications',
                            'Outdoor space design documentation'
                        ],
                        tips: 'Consider operable windows where appropriate. Quality end-of-trip facilities encourage active transport.',
                        projectPhases: ['Schematic', 'Design Dev', 'Documentation'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Thermal comfort modelling not done until late in design',
                            'End-of-trip facilities undersized or poorly located',
                            'Limited outdoor amenity space for building occupants'
                        ],
                        relatedCredits: ['clean-air', 'light-quality', 'movement']
                    },
                    {
                        id: 'nature-conn',
                        name: 'Connection to Nature',
                        points: 2,
                        required: false,
                        description: 'Creating visual and physical connections to natural elements.',
                        aims: 'To provide connections to nature that support occupant health and wellbeing (biophilic design).',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Basic exterior views from occupied spaces',
                                    'Some natural elements in interior finishes'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 1,
                                color: 'blue',
                                requirements: [
                                    'At least 50% of occupied spaces have views to vegetation',
                                    'Indoor plants in common areas (lobby, breakout spaces)',
                                    'Natural materials (timber, stone) in at least 25% of visible surfaces',
                                    'Documented biophilic design strategy'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 2,
                                color: 'green',
                                requirements: [
                                    'At least 75% of occupied spaces have quality views to nature',
                                    'Living green walls or significant interior planting (min 1 plant per 10mÂ²)',
                                    'Water features incorporated in building design',
                                    'Natural patterns and fractals in architectural design',
                                    'Direct physical access to nature (gardens, green roofs)'
                                ]
                            }
                        ],
                        criteria: [
                            'Views to Nature: Occupied spaces have views to vegetation or natural features',
                            'Indoor Plants: Living plants are incorporated into interior spaces',
                            'Natural Materials: Natural materials and patterns are used in finishes',
                            'Water Features: Water elements are incorporated where appropriate'
                        ],
                        documentation: [
                            'Floor plans showing view lines to nature',
                            'Interior planting plans and specifications',
                            'Material schedules highlighting natural materials',
                            'Photos of biophilic design elements'
                        ],
                        tips: 'Biophilic design can be cost-effective. Even small interventions like indoor plants can make a difference.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev'],
                        difficulty: 'Easy',
                        commonMistakes: [
                            'Not developing a biophilic design strategy early',
                            'Indoor plants specified without maintenance plan',
                            'Views to nature blocked by interior partitions'
                        ],
                        relatedCredits: ['light-quality', 'amenity', 'biodiversity']
                    }
                ]
            },
            {
                id: 'resilient',
                name: 'Resilient',
                icon: 'ðŸ›¡ï¸',
                faIcon: 'fa-solid fa-shield-halved',
                color: 'blue',
                colorClasses: {
                    bg: 'bg-blue-500',
                    bgLight: 'bg-blue-50',
                    text: 'text-blue-600',
                    border: 'border-blue-500',
                    hover: 'hover:bg-blue-50'
                },
                maxPoints: 15,
                description: 'Climate adaptation and resilience',
                credits: [
                    {
                        id: 'climate-res',
                        name: 'Climate Resilience',
                        points: 4,
                        required: true,
                        description: 'Designing for current and future climate conditions.',
                        aims: 'To ensure buildings are designed to adapt to changing climate conditions and extreme weather events.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building complies with current BCA requirements',
                                    'Basic climate risk awareness documented'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Climate risk assessment completed for building lifetime (50+ years)',
                                    'Design addresses top 3 climate risks for the location',
                                    'Building designed for 2050 climate projections',
                                    'Adaptation measures documented in design'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 4,
                                color: 'green',
                                requirements: [
                                    'Comprehensive climate risk assessment using IPCC scenarios',
                                    'Building designed for 2090 RCP 8.5 climate projections',
                                    'Adaptive capacity built in (flexibility for future upgrades)',
                                    'Third-party verification of climate resilience strategy',
                                    'Ongoing monitoring and adaptation plan committed'
                                ]
                            }
                        ],
                        criteria: [
                            'Climate Risk Assessment: A comprehensive assessment of climate risks is undertaken',
                            'Future Climate Design: Building is designed for projected future climate conditions',
                            'Extreme Weather: Building can withstand increased frequency of extreme events',
                            'Adaptation Strategy: A climate adaptation strategy is documented'
                        ],
                        documentation: [
                            'Climate risk assessment report',
                            'Climate projections used in design',
                            'Design response to identified risks',
                            'Adaptation strategy documentation'
                        ],
                        tips: 'Use NARCliM or CSIRO projections for Australian climate data. Consider sea level rise for coastal locations.',
                        projectPhases: ['Concept', 'Schematic'],
                        difficulty: 'Hard',
                        commonMistakes: [
                            'Using outdated climate data or projections',
                            'Not considering full building lifetime in risk assessment',
                            'Failing to document design responses to identified risks'
                        ],
                        relatedCredits: ['heat-res', 'ops-res', 'grid-res']
                    },
                    {
                        id: 'ops-res',
                        name: 'Operations Resilience',
                        points: 3,
                        required: false,
                        description: 'Ensuring building can maintain operations during disruptions.',
                        aims: 'To ensure buildings can maintain critical operations during disruptions and emergencies.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building meets BCA requirements for emergency systems',
                                    'Basic emergency procedures in place'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Business continuity plan developed for building operations',
                                    'Backup power for essential services (min 4 hours)',
                                    'Water storage for 24 hours of essential use',
                                    'Critical systems identified with redundancy measures'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'Building can operate in island mode for 72+ hours',
                                    'On-site renewable generation with battery storage',
                                    'Multiple water sources (rainwater, recycled water)',
                                    'Passive survivability maintained during power outages',
                                    'Regular resilience testing and drills conducted'
                                ]
                            }
                        ],
                        criteria: [
                            'Backup Systems: Essential systems have backup power and redundancy',
                            'Passive Survivability: Building maintains safe conditions without power',
                            'Water Security: Alternative water sources are available',
                            'Business Continuity: Operations can continue during disruptions'
                        ],
                        documentation: [
                            'Business continuity plan',
                            'Backup power system specifications',
                            'Water storage and alternative supply documentation',
                            'Passive survivability analysis'
                        ],
                        tips: 'Consider battery storage with solar PV for resilient power. Passive design features improve survivability.',
                        projectPhases: ['Schematic', 'Design Dev', 'Documentation'],
                        difficulty: 'Hard',
                        commonMistakes: [
                            'Not developing business continuity plan until late',
                            'Backup power undersized for essential loads',
                            'Passive survivability not tested through modelling'
                        ],
                        relatedCredits: ['climate-res', 'grid-res', 'energy-source']
                    },
                    {
                        id: 'comm-res',
                        name: 'Community Resilience',
                        points: 3,
                        required: false,
                        description: 'Contributing to community resilience during emergencies.',
                        aims: 'To encourage buildings that contribute to community resilience during emergencies.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building does not negatively impact community resilience',
                                    'Emergency egress routes maintained and accessible'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Building offers space for community emergency use',
                                    'Coordination with local emergency services',
                                    'Communication systems to support emergency alerts',
                                    'First aid and emergency supplies stored on site'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'Designated community refuge space (minimum 100mÂ²)',
                                    'Emergency power and water for community use',
                                    'Cooling/heating centre capability during extreme weather',
                                    'Formal agreement with local council for emergency use',
                                    'Community resilience training programs supported'
                                ]
                            }
                        ],
                        criteria: [
                            'Emergency Shelter: Building can serve as emergency shelter for community',
                            'Resource Sharing: Emergency resources can be shared with community',
                            'Communication: Emergency communication systems are in place',
                            'Coordination: Building owner coordinates with emergency services'
                        ],
                        documentation: [
                            'Community resilience plan',
                            'Agreement with emergency services or council',
                            'Emergency shelter capacity documentation',
                            'Resource sharing arrangements'
                        ],
                        tips: 'Coordinate with local council on emergency planning. Consider building as a potential refuge during extreme events.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Not engaging with local council early enough',
                            'Community resilience features not planned from concept',
                            'Missing formal agreements with emergency services'
                        ],
                        relatedCredits: ['climate-res', 'ops-res', 'contribution']
                    },
                    {
                        id: 'heat-res',
                        name: 'Heat Resilience',
                        points: 3,
                        required: false,
                        description: 'Managing urban heat island effects and extreme heat events.',
                        aims: 'To reduce urban heat island effect and ensure buildings can protect occupants during extreme heat.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building meets minimum insulation requirements',
                                    'Basic air conditioning provided'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'At least 50% of roof area is high albedo (SRI > 78) or vegetated',
                                    'External shading reduces solar heat gain by 50%+',
                                    'Building maintains < 28Â°C during heatwaves without AC',
                                    'At least 25% of site area is vegetated'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'At least 75% of roof is green roof or high SRI',
                                    'Building maintains < 26Â°C during heatwaves passively',
                                    'Night flush ventilation or thermal mass cooling',
                                    'Urban heat island reduction demonstrated (site microclimate modelling)',
                                    'Public cooling spaces provided (shaded areas, water features)'
                                ]
                            }
                        ],
                        criteria: [
                            'Cool Surfaces: High-albedo roofing and paving reduce heat absorption',
                            'Shading: External shading minimises solar heat gain',
                            'Passive Cooling: Building can maintain comfortable temperatures passively',
                            'Vegetation: Trees and plants provide natural cooling'
                        ],
                        documentation: [
                            'Roof and paving SRI values',
                            'Shading design and calculations',
                            'Passive cooling analysis',
                            'Landscape design with vegetation coverage'
                        ],
                        tips: 'Green roofs provide cooling and other benefits. Light-coloured surfaces significantly reduce heat absorption.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Not modelling passive performance during heatwaves',
                            'Roof color or SRI not specified in documentation',
                            'Shading design not optimized for summer sun angles'
                        ],
                        relatedCredits: ['climate-res', 'biodiversity', 'energy-use']
                    },
                    {
                        id: 'grid-res',
                        name: 'Grid Resilience',
                        points: 2,
                        required: false,
                        description: 'Supporting electricity grid stability and reliability.',
                        aims: 'To support electricity grid stability through demand management and on-site energy storage.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building electrical systems comply with grid connection requirements',
                                    'Basic load monitoring in place'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 1,
                                color: 'blue',
                                requirements: [
                                    'Demand response capability for at least 20% of peak load',
                                    'Smart metering with 15-minute interval data',
                                    'Participation in demand response programs',
                                    'Load shifting strategies implemented (thermal storage, EV charging)'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 2,
                                color: 'green',
                                requirements: [
                                    'On-site battery storage (min 2 hours of typical load)',
                                    'Vehicle-to-grid capability or bi-directional chargers',
                                    'Automated demand response with grid signals',
                                    'Net zero peak demand capability',
                                    'Virtual power plant participation'
                                ]
                            }
                        ],
                        criteria: [
                            'Demand Response: Building can reduce load during peak periods',
                            'Energy Storage: On-site storage supports grid stability',
                            'Smart Controls: Automated systems respond to grid signals',
                            'Load Management: Peak demand is actively managed'
                        ],
                        documentation: [
                            'Demand response plan',
                            'Energy storage system specifications',
                            'Smart metering and controls documentation',
                            'Peak demand management strategy'
                        ],
                        tips: 'Battery storage with solar PV can provide grid services and backup power. Consider demand response program participation.',
                        projectPhases: ['Design Dev', 'Documentation', 'Construction'],
                        difficulty: 'Hard',
                        commonMistakes: [
                            'Not designing electrical infrastructure for future EV growth',
                            'Missing demand response capability in BMS specification',
                            'Battery storage not sized appropriately for grid services'
                        ],
                        relatedCredits: ['energy-source', 'ops-res', 'low-emissions']
                    }
                ]
            },
            {
                id: 'positive',
                name: 'Positive',
                icon: 'âš¡',
                faIcon: 'fa-solid fa-bolt',
                color: 'red',
                colorClasses: {
                    bg: 'bg-red-500',
                    bgLight: 'bg-red-50',
                    text: 'text-red-600',
                    border: 'border-red-500',
                    hover: 'hover:bg-red-50'
                },
                maxPoints: 40,
                description: 'Energy, carbon, and resource efficiency',
                credits: [
                    {
                        id: 'energy-source',
                        name: 'Energy Source',
                        points: 6,
                        required: true,
                        description: 'Using renewable or low-carbon energy sources.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Practice',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building meets minimum NCC energy requirements',
                                    'Standard grid electricity supply'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Good Practice',
                                points: 3,
                                color: 'blue',
                                requirements: [
                                    '25% of energy from renewable sources',
                                    'On-site solar PV or green power agreement',
                                    'Building is at least 50% electric'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 6,
                                color: 'green',
                                requirements: [
                                    '100% renewable energy (on-site or off-site)',
                                    'Fully electric building (no fossil fuels)',
                                    'Verified renewable energy certificates'
                                ]
                            }
                        ],
                        aims: 'To encourage the use of renewable energy sources and reduce reliance on fossil fuels.',
                        criteria: [
                            'On-site Renewables: Solar PV, wind, or other renewable generation is installed',
                            'Off-site Renewables: Green power purchase agreements are in place',
                            'Electrification: Building systems are fully electric (no gas)',
                            'Grid Decarbonisation: Building supports grid transition to renewables'
                        ],
                        pathways: [
                            { name: 'Pathway A: Owner Operated', description: 'For buildings where the owner controls energy procurement' },
                            { name: 'Pathway B: Tenant Operated', description: 'For multi-tenant buildings with separate tenant energy accounts' }
                        ],
                        documentation: [
                            'Solar PV system design and specifications',
                            'Power Purchase Agreement (PPA) documentation',
                            'GreenPower certification or LGCs',
                            'Energy modelling showing renewable contribution',
                            'Electrical single line diagrams'
                        ],
                        calculatorRequired: true,
                        relatedCalculator: 'energy-reference',
                        tips: 'Consider on-site solar PV as a priority. PPAs can provide cost-effective renewable energy for larger loads.',
                        projectPhases: ['Schematic', 'Design Dev', 'Documentation'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Not maximizing rooftop solar PV potential',
                            'PPA negotiations started too late',
                            'Electrification requirements conflicting with gas cooking preferences'
                        ],
                        relatedCredits: ['energy-use', 'grid-res', 'upfront-carbon-red']
                    },
                    {
                        id: 'energy-use',
                        name: 'Energy Use',
                        points: 10,
                        required: true,
                        description: 'Reducing operational energy consumption.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Practice',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building meets minimum NCC Section J requirements',
                                    'Standard efficiency HVAC and lighting'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Good Practice',
                                points: 5,
                                color: 'blue',
                                requirements: [
                                    '10% improvement over reference building',
                                    '4.5 Star NABERS Energy Commitment Agreement',
                                    'High-efficiency HVAC systems specified'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 10,
                                color: 'green',
                                requirements: [
                                    '30%+ improvement over reference building',
                                    '5.5+ Star NABERS Energy Commitment Agreement',
                                    'Best practice passive design and systems'
                                ]
                            }
                        ],
                        aims: 'To encourage energy efficient building design and systems that minimise operational energy use.',
                        criteria: [
                            'Energy Modelling: Building energy performance is modelled and optimised',
                            'Efficient Systems: High-efficiency HVAC, lighting, and equipment are specified',
                            'Passive Design: Building form and envelope minimise heating/cooling loads',
                            'Controls: Smart controls optimise energy use based on occupancy and conditions'
                        ],
                        pathways: [
                            { name: 'Pathway A: Reference Building', description: 'Compare energy use against a reference building model' },
                            { name: 'Pathway B: NABERS Commitment', description: 'Commit to achieving a NABERS Energy rating' },
                            { name: 'Pathway C: Residential', description: 'Use NatHERS star ratings for residential buildings' },
                            { name: 'Pathway D: Small Non-Residential', description: 'Simplified pathway for buildings under 2,500m2' }
                        ],
                        documentation: [
                            'Energy model and report',
                            'NABERS Commitment Agreement (if applicable)',
                            'NatHERS certificates (if applicable)',
                            'Equipment specifications showing efficiency ratings',
                            'Controls description and sequence of operations'
                        ],
                        calculatorRequired: true,
                        relatedCalculator: 'energy-reference',
                        tips: 'Start energy modelling early in design. Target at least 10% improvement over reference for 4 Star.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev', 'Documentation'],
                        difficulty: 'Hard',
                        commonMistakes: [
                            'Energy modelling not started until documentation phase',
                            'Unrealistic assumptions in energy model',
                            'NABERS Commitment Agreement not secured early'
                        ],
                        relatedCredits: ['energy-source', 'verify-hand', 'resp-systems']
                    },
                    {
                        id: 'upfront-carbon-red',
                        name: 'Upfront Carbon Reduction',
                        points: 10,
                        required: true,
                        description: 'Reducing embodied carbon in construction materials.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Practice',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Upfront carbon assessment completed',
                                    'Standard construction materials used'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Good Practice',
                                points: 5,
                                color: 'blue',
                                requirements: [
                                    '10% reduction below benchmark',
                                    'Low-carbon concrete specified for major elements',
                                    'Material optimization strategies implemented'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 10,
                                color: 'green',
                                requirements: [
                                    '30%+ reduction below benchmark',
                                    'Low-carbon materials throughout structure',
                                    'Mass timber or innovative low-carbon systems'
                                ]
                            }
                        ],
                        aims: 'To reduce the upfront carbon emissions from construction materials and processes.',
                        criteria: [
                            'Carbon Assessment: Upfront carbon is calculated using recognised methodology',
                            'Material Optimisation: Structure and envelope are optimised to reduce materials',
                            'Low-Carbon Materials: Low-carbon alternatives are specified where available',
                            'Carbon Reduction: Upfront carbon is reduced below benchmark/reference'
                        ],
                        pathways: [
                            { name: 'Pathway A: Benchmark', description: 'Compare upfront carbon against a benchmark value' },
                            { name: 'Pathway B: Reference Building', description: 'Compare against a reference building with standard materials' }
                        ],
                        documentation: [
                            'Life Cycle Assessment (LCA) report',
                            'Upfront Carbon Calculator outputs',
                            'Material quantities (Bill of Quantities)',
                            'EPDs for major materials',
                            'Evidence of low-carbon material specifications'
                        ],
                        calculatorRequired: true,
                        relatedCalculator: 'upfront-carbon',
                        tips: 'Focus on structure first - concrete and steel typically dominate upfront carbon. Low-carbon concrete can significantly reduce totals.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev'],
                        difficulty: 'Hard',
                        commonMistakes: [
                            'LCA not started until after structural design is fixed',
                            'Incorrect system boundaries in carbon calculations',
                            'Not collecting EPDs during procurement'
                        ],
                        relatedCredits: ['resp-struct', 'impacts-disc', 'circularity']
                    },
                    {
                        id: 'upfront-carbon-comp',
                        name: 'Upfront Carbon Compensation',
                        points: 3,
                        required: false,
                        description: 'Offsetting remaining embodied carbon emissions.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Practice',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Upfront carbon calculated',
                                    'No offset strategy in place'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Good Practice',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    '50% of upfront carbon offset',
                                    'Verified carbon offsets purchased',
                                    'Offset strategy documented'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    '100% of upfront carbon offset (carbon neutral)',
                                    'Gold Standard or equivalent offsets',
                                    'Public disclosure of offset strategy'
                                ]
                            }
                        ],
                        aims: 'To compensate for upfront carbon emissions that cannot be eliminated through design.',
                        criteria: [
                            'Carbon Calculation: Total upfront carbon has been accurately calculated',
                            'Offset Purchase: Verified carbon offsets are purchased',
                            'Offset Quality: Offsets meet recognised standards (Gold Standard, VCS)',
                            'Disclosure: Offset strategy is publicly disclosed'
                        ],
                        documentation: [
                            'Upfront carbon calculation',
                            'Carbon offset purchase receipts',
                            'Offset verification certificates',
                            'Public disclosure documentation'
                        ],
                        calculatorRequired: true,
                        relatedCalculator: 'carbon-compensation',
                        tips: 'Prioritise reduction over offsets. If offsetting, choose high-quality offsets with co-benefits.',
                        projectPhases: ['Documentation', 'Construction', 'Handover'],
                        difficulty: 'Easy',
                        commonMistakes: [
                            'Using poor quality carbon offsets without verification',
                            'Not calculating total upfront carbon accurately',
                            'Missing public disclosure requirements'
                        ],
                        relatedCredits: ['upfront-carbon-red', 'impacts-disc', 'market-transform']
                    },
                    {
                        id: 'refrigerant',
                        name: 'Refrigerant Systems Impacts',
                        points: 3,
                        required: false,
                        description: 'Using low global warming potential refrigerants.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Practice',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Standard refrigerants (R-410A or similar)',
                                    'Basic leak detection systems'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Good Practice',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Refrigerants with GWP < 750 (e.g., R-32)',
                                    'Enhanced leak detection and monitoring',
                                    'Refrigerant management plan in place'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'Natural or ultra-low GWP refrigerants (GWP < 150)',
                                    'Systems designed for minimal refrigerant charge',
                                    'Comprehensive leak prevention measures'
                                ]
                            }
                        ],
                        aims: 'To reduce the climate impact of refrigerant gases used in building systems.',
                        criteria: [
                            'Low-GWP Refrigerants: HVAC systems use refrigerants with GWP < 750',
                            'Natural Refrigerants: Consider CO2, ammonia, or hydrocarbons where feasible',
                            'Leak Prevention: Systems are designed to minimise refrigerant leakage',
                            'Future-Ready: Systems can transition to lower-GWP refrigerants'
                        ],
                        documentation: [
                            'HVAC equipment schedules showing refrigerant types',
                            'Refrigerant GWP values',
                            'Refrigerant charge quantities',
                            'Leak detection system specifications',
                            'Refrigerant Systems Calculator outputs'
                        ],
                        calculatorRequired: true,
                        relatedCalculator: 'refrigerant',
                        tips: 'Low-GWP options like R-32 are now widely available. Consider VRF alternatives with lower refrigerant charges.',
                        projectPhases: ['Design Dev', 'Documentation'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Not specifying low-GWP refrigerants in tender documents',
                            'Equipment substitutions without checking refrigerant type',
                            'Missing leak detection system specifications'
                        ],
                        relatedCredits: ['resp-systems', 'energy-use', 'climate-res']
                    },
                    {
                        id: 'low-emissions',
                        name: 'Low-Emissions Transport',
                        points: 3,
                        required: false,
                        description: 'Supporting electric vehicles and active transport.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Practice',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Basic bicycle parking provided',
                                    'No EV charging infrastructure'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Good Practice',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    '10% of parking spaces with EV charging',
                                    '25% of parking spaces EV-ready (conduit installed)',
                                    'End-of-trip facilities with showers and lockers'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    '25%+ of parking spaces with EV charging',
                                    '100% of parking spaces EV-ready',
                                    'Premium end-of-trip facilities exceeding requirements'
                                ]
                            }
                        ],
                        aims: 'To support the transition to low-emission transport through building infrastructure.',
                        criteria: [
                            'EV Charging: Electric vehicle charging infrastructure is provided',
                            'EV-Ready: Additional parking spaces are wired for future EV charging',
                            'Bicycle Facilities: Secure bicycle parking and end-of-trip facilities',
                            'Active Transport: Building supports walking and cycling access'
                        ],
                        documentation: [
                            'EV charging infrastructure drawings and specifications',
                            'Bicycle parking locations and quantities',
                            'End-of-trip facility floor plans',
                            'Site plan showing pedestrian and cyclist access'
                        ],
                        tips: 'Plan for future EV uptake - install conduit and switchboard capacity even if not installing chargers now.',
                        projectPhases: ['Schematic', 'Design Dev', 'Documentation'],
                        difficulty: 'Easy',
                        commonMistakes: [
                            'Not providing adequate electrical capacity for future EV growth',
                            'Poor location of EV chargers in car park',
                            'End-of-trip facilities undersized for cycling demand'
                        ],
                        relatedCredits: ['movement', 'grid-res', 'amenity']
                    },
                    {
                        id: 'circularity',
                        name: 'Design for Circularity',
                        points: 2,
                        required: false,
                        description: 'Designing for adaptability and material reuse.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Practice',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Standard construction methods',
                                    'No specific adaptability considerations'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Good Practice',
                                points: 1,
                                color: 'blue',
                                requirements: [
                                    'Design for adaptability strategy documented',
                                    'Flexible floor plates and services zones',
                                    'Some mechanical connections for disassembly'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 2,
                                color: 'green',
                                requirements: [
                                    'Comprehensive circularity strategy',
                                    'Material passports for major elements',
                                    'Design for disassembly throughout structure'
                                ]
                            }
                        ],
                        aims: 'To design buildings that can be adapted, disassembled, and have materials recovered at end of life.',
                        criteria: [
                            'Adaptability: Building can be adapted for different uses over time',
                            'Disassembly: Connections allow for non-destructive disassembly',
                            'Material Recovery: Materials can be recovered and reused at end of life',
                            'Material Passports: Building materials are documented for future recovery'
                        ],
                        documentation: [
                            'Design for adaptability report',
                            'Disassembly strategy documentation',
                            'Connection details showing reversibility',
                            'Material passport or register'
                        ],
                        tips: 'Use mechanical connections where possible instead of adhesives. Document all materials for future recovery.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Not considering future adaptability in structural design',
                            'Using permanent adhesives where mechanical connections possible',
                            'Missing material passport documentation'
                        ],
                        relatedCredits: ['upfront-carbon-red', 'resp-struct', 'resp-finishes']
                    },
                    {
                        id: 'water-use',
                        name: 'Water Use',
                        points: 3,
                        required: false,
                        description: 'Reducing potable water consumption.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Practice',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'WELS 4-star fixtures throughout',
                                    'Standard landscape irrigation'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Good Practice',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'WELS 5-star fixtures or better',
                                    'Rainwater harvesting for toilet flushing or irrigation',
                                    '30% reduction in potable water use'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    '60%+ reduction in potable water use',
                                    'Rainwater and/or recycled water systems',
                                    'Native/drought-tolerant landscaping with minimal irrigation'
                                ]
                            }
                        ],
                        aims: 'To reduce potable water consumption through efficiency and alternative water sources.',
                        criteria: [
                            'Efficient Fixtures: Water-efficient fixtures and fittings are installed',
                            'Rainwater Harvesting: Rainwater is collected and used on site',
                            'Recycled Water: Greywater or blackwater recycling is implemented',
                            'Landscape Efficiency: Landscaping minimises irrigation requirements'
                        ],
                        documentation: [
                            'Water balance calculations',
                            'Fixture schedules with WELS ratings',
                            'Rainwater tank sizing and plumbing drawings',
                            'Recycled water system specifications',
                            'Landscape irrigation specifications'
                        ],
                        calculatorRequired: true,
                        relatedCalculator: 'water',
                        tips: 'Rainwater harvesting is often cost-effective for toilet flushing and irrigation. Consider waterless urinals.',
                        projectPhases: ['Schematic', 'Design Dev', 'Documentation'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Rainwater tank undersized for demand',
                            'Not considering recycled water early enough',
                            'Irrigation designed without considering water efficiency'
                        ],
                        relatedCredits: ['waterway', 'biodiversity', 'ops-res']
                    }
                ]
            },
            {
                id: 'places',
                name: 'Places',
                icon: 'ðŸ“',
                faIcon: 'fa-solid fa-location-dot',
                color: 'purple',
                colorClasses: {
                    bg: 'bg-purple-500',
                    bgLight: 'bg-purple-50',
                    text: 'text-purple-600',
                    border: 'border-purple-500',
                    hover: 'hover:bg-purple-50'
                },
                maxPoints: 15,
                description: 'Place-making and community contribution',
                credits: [
                    {
                        id: 'movement',
                        name: 'Movement and Place',
                        points: 5,
                        required: true,
                        description: 'Supporting sustainable transport and walkability.',
                        aims: 'To encourage buildings that support sustainable transport choices and contribute to walkable neighbourhoods.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Site complies with local planning requirements for car parking',
                                    'Basic pedestrian access provided to building entrance'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 3,
                                color: 'blue',
                                requirements: [
                                    'Site within 400m of public transport (bus/tram stop)',
                                    'Car parking reduced by 25% below council requirements',
                                    'Secure bicycle parking exceeds Green Star minimums',
                                    'Pedestrian connectivity to local amenities demonstrated'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 5,
                                color: 'green',
                                requirements: [
                                    'Site within 200m of high-frequency public transport',
                                    'Car parking reduced by 50% or car-share scheme provided',
                                    'Premium end-of-trip and bicycle facilities',
                                    'Direct pedestrian links to 5+ key amenities within 800m',
                                    'Movement and Place assessment completed with council'
                                ]
                            }
                        ],
                        criteria: [
                            'Public Transport Access: Site has good access to public transport',
                            'Walking & Cycling: Infrastructure supports walking and cycling',
                            'Reduced Car Dependence: Car parking is minimised',
                            'Local Connectivity: Building connects to local pedestrian network'
                        ],
                        documentation: [
                            'Movement and Place Calculator outputs',
                            'Transport access study',
                            'Bicycle and end-of-trip facility plans',
                            'Pedestrian connectivity analysis'
                        ],
                        calculatorRequired: true,
                        tips: 'Engage with council early on car parking reductions. Quality end-of-trip facilities encourage cycling.',
                        projectPhases: ['Concept', 'Schematic'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Underestimating bicycle parking requirements',
                            'Not engaging with council early on parking reductions',
                            'Poor location of end-of-trip facilities'
                        ],
                        relatedCredits: ['enjoyable', 'contribution', 'culture']
                    },
                    {
                        id: 'enjoyable',
                        name: 'Enjoyable Places',
                        points: 4,
                        required: false,
                        description: 'Creating quality public and communal spaces.',
                        aims: 'To encourage the creation of high-quality public and communal spaces that support wellbeing.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building entrance is clearly defined and accessible',
                                    'Basic common areas provided within building'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'At least 30% of ground floor perimeter is active/engaging',
                                    'Quality communal space provided (min 50mÂ²)',
                                    'Outdoor seating and gathering spaces included',
                                    'Public art or cultural elements integrated'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 4,
                                color: 'green',
                                requirements: [
                                    'At least 60% of ground floor perimeter is active/engaging',
                                    'Multiple quality communal spaces (indoor and outdoor)',
                                    'Through-site link or public plaza provided',
                                    'Community facilities open to public use',
                                    'Place assessment demonstrates quality outcomes'
                                ]
                            }
                        ],
                        criteria: [
                            'Active Frontages: Ground floor engages with the street',
                            'Communal Spaces: Quality shared spaces are provided',
                            'Public Realm: Building contributes positively to public realm',
                            'Amenity: Spaces support social interaction and wellbeing'
                        ],
                        documentation: [
                            'Ground floor plans showing active uses',
                            'Communal space design and specifications',
                            'Public realm design documentation',
                            'Place quality assessment'
                        ],
                        tips: 'Engage with urban designers and council early. Quality public spaces add value to projects.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Ground floor retail designed without considering activation',
                            'Outdoor spaces not designed for comfort and use',
                            'Community spaces undersized or poorly located'
                        ],
                        relatedCredits: ['movement', 'contribution', 'culture']
                    },
                    {
                        id: 'contribution',
                        name: 'Contribution to Place',
                        points: 3,
                        required: false,
                        description: 'Contributing positively to the local area.',
                        aims: 'To encourage buildings that make a positive contribution to their local neighbourhood.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building complies with local planning controls',
                                    'No negative impacts on neighbouring properties'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Local stakeholder engagement undertaken during design',
                                    'Building respects local character and context',
                                    'Community benefit provided (public access, facilities)',
                                    'Local suppliers and contractors prioritised'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'Extensive community consultation informing design',
                                    'Significant community facilities provided',
                                    'Social enterprise space or affordable uses included',
                                    'Long-term community partnership established',
                                    'Post-occupancy community feedback program'
                                ]
                            }
                        ],
                        criteria: [
                            'Community Engagement: Local community is engaged in design process',
                            'Local Character: Building responds to local context',
                            'Community Benefit: Building provides benefit to local community',
                            'Local Economy: Project supports local businesses and workers'
                        ],
                        documentation: [
                            'Community engagement records',
                            'Urban design statement',
                            'Community benefit documentation',
                            'Local procurement evidence'
                        ],
                        tips: 'Early engagement with community groups builds support. Consider long-term relationships with local organisations.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev'],
                        difficulty: 'Easy',
                        commonMistakes: [
                            'Community engagement started too late to influence design',
                            'Not documenting engagement activities properly',
                            'Promises made to community not followed through'
                        ],
                        relatedCredits: ['enjoyable', 'culture', 'first-nations']
                    },
                    {
                        id: 'culture',
                        name: 'Culture, Heritage and Identity',
                        points: 3,
                        required: false,
                        description: 'Respecting and celebrating cultural heritage.',
                        aims: 'To encourage buildings that respect and celebrate cultural heritage and local identity.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Heritage assessment completed where required',
                                    'Compliance with heritage planning controls'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Heritage interpretation strategy developed',
                                    'Cultural elements integrated into design',
                                    'Engagement with Traditional Owners undertaken',
                                    'Local history and stories acknowledged in building'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'Significant heritage fabric retained and celebrated',
                                    'Deep engagement with Traditional Owners informing design',
                                    'Indigenous artwork or design elements incorporated',
                                    'Cultural education or interpretation program provided',
                                    'Ongoing cultural programming commitment'
                                ]
                            }
                        ],
                        criteria: [
                            'Heritage Respect: Heritage values are identified and respected',
                            'First Nations: Traditional Owners are engaged meaningfully',
                            'Cultural Expression: Cultural identity is expressed in design',
                            'Interpretation: Cultural stories are communicated'
                        ],
                        documentation: [
                            'Heritage assessment and response',
                            'First Nations engagement records',
                            'Cultural design elements documentation',
                            'Interpretation strategy'
                        ],
                        tips: 'Engage with Traditional Owners early and meaningfully. Heritage consultants can help identify opportunities.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Traditional Owner engagement started too late',
                            'Heritage interpretation treated as afterthought',
                            'Cultural elements not integrated authentically'
                        ],
                        relatedCredits: ['first-nations', 'contribution', 'enjoyable']
                    }
                ]
            },
            {
                id: 'people',
                name: 'People',
                icon: 'ðŸ‘¥',
                faIcon: 'fa-solid fa-users',
                color: 'pink',
                colorClasses: {
                    bg: 'bg-pink-500',
                    bgLight: 'bg-pink-50',
                    text: 'text-pink-600',
                    border: 'border-pink-500',
                    hover: 'hover:bg-pink-50'
                },
                maxPoints: 15,
                description: 'Social sustainability and inclusion',
                credits: [
                    {
                        id: 'inclusive-const',
                        name: 'Inclusive Construction Practices',
                        points: 4,
                        required: true,
                        description: 'Promoting diversity and inclusion in construction.',
                        aims: 'To promote diversity, inclusion, and safe working conditions in the construction industry.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Compliance with WHS requirements',
                                    'Basic equal opportunity policy in place'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Diversity and inclusion policy implemented on site',
                                    'Mental health support program for construction workers',
                                    'Anti-discrimination training for site supervisors',
                                    'Flexible working arrangements supported'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 4,
                                color: 'green',
                                requirements: [
                                    'Industry-leading diversity targets (gender, age, cultural)',
                                    'Comprehensive mental health program with EAP',
                                    'Apprenticeship and training opportunities provided',
                                    'Accessible site facilities for workers with disabilities',
                                    'Measurable diversity outcomes achieved and reported'
                                ]
                            }
                        ],
                        criteria: [
                            'Diversity Policy: A diversity and inclusion policy is implemented',
                            'Mental Health: Mental health support is provided for workers',
                            'Training: Diversity and inclusion training is provided',
                            'Outcomes: Measurable diversity outcomes are achieved'
                        ],
                        documentation: [
                            'Diversity and inclusion policy',
                            'Mental health program documentation',
                            'Training records',
                            'Diversity reporting and outcomes'
                        ],
                        tips: 'Partner with industry bodies like NAWIC for best practice guidance. Mental health programs benefit workers and productivity.',
                        projectPhases: ['Construction', 'Handover'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Diversity policy not included in contractor requirements',
                            'Mental health support not accessible to all workers',
                            'Training outcomes not tracked or reported'
                        ],
                        relatedCredits: ['first-nations', 'proc-workforce', 'resp-const']
                    },
                    {
                        id: 'first-nations',
                        name: 'First Nations Inclusion',
                        points: 4,
                        required: false,
                        description: 'Engaging with and supporting First Nations peoples.',
                        aims: 'To support meaningful engagement with and economic participation of First Nations peoples.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Acknowledgement of Country at project events',
                                    'Basic awareness of Traditional Owners for site location'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Meaningful consultation with Traditional Owners',
                                    'First Nations employment target of 3%+',
                                    'First Nations procurement target of 3%+',
                                    'Cultural awareness training for project team'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 4,
                                color: 'green',
                                requirements: [
                                    'Deep engagement with Traditional Owners from project inception',
                                    'First Nations employment of 5%+ of workforce hours',
                                    'First Nations procurement of 5%+ of contract value',
                                    'Ongoing partnership agreement with First Nations organisation',
                                    'Cultural design elements led by First Nations artists/designers'
                                ]
                            }
                        ],
                        criteria: [
                            'Engagement: Meaningful engagement with Traditional Owners',
                            'Employment: First Nations employment opportunities provided',
                            'Procurement: First Nations businesses are engaged',
                            'Culture: First Nations culture is respected and celebrated'
                        ],
                        documentation: [
                            'Traditional Owner engagement records',
                            'First Nations employment tracking',
                            'First Nations procurement records',
                            'Partnership agreements'
                        ],
                        tips: 'Engage with Traditional Owners early - relationships take time. Supply Nation can help identify First Nations businesses.',
                        projectPhases: ['Concept', 'Schematic', 'Construction'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Traditional Owner engagement treated as box-ticking',
                            'First Nations procurement requirements not in contracts',
                            'Insufficient time allowed for relationship building'
                        ],
                        relatedCredits: ['culture', 'proc-workforce', 'inclusive-const']
                    },
                    {
                        id: 'proc-workforce',
                        name: 'Procurement and Workforce Inclusion',
                        points: 4,
                        required: false,
                        description: 'Supporting social enterprises and diverse suppliers.',
                        aims: 'To support social enterprises, diverse suppliers, and create employment opportunities for disadvantaged groups.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Standard procurement processes followed',
                                    'Basic contractor prequalification'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Social procurement policy implemented',
                                    'At least 5% of contract value to social enterprises',
                                    'Employment opportunities for long-term unemployed',
                                    'Diverse supplier panel established'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 4,
                                color: 'green',
                                requirements: [
                                    'At least 10% of contract value to social enterprises',
                                    'Comprehensive social procurement strategy',
                                    'Training and mentoring for disadvantaged workers',
                                    'Long-term partnerships with social enterprises',
                                    'Measurable social outcomes tracked and reported'
                                ]
                            }
                        ],
                        criteria: [
                            'Social Procurement: Social enterprises are engaged',
                            'Diverse Suppliers: Small and diverse businesses supported',
                            'Employment: Opportunities for disadvantaged groups',
                            'Training: Skills development opportunities provided'
                        ],
                        documentation: [
                            'Social procurement policy',
                            'Social enterprise engagement records',
                            'Diverse supplier tracking',
                            'Employment and training records'
                        ],
                        calculatorRequired: true,
                        tips: 'Social Traders can help identify certified social enterprises. Include social procurement requirements in tender documents.',
                        projectPhases: ['Documentation', 'Construction'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Social procurement targets not included in contracts',
                            'Social enterprise capacity not verified before award',
                            'Tracking systems not set up from project start'
                        ],
                        relatedCredits: ['first-nations', 'inclusive-const', 'resp-proc']
                    },
                    {
                        id: 'design-equity',
                        name: 'Design for Equity',
                        points: 3,
                        required: false,
                        description: 'Designing for accessibility and diverse users.',
                        aims: 'To ensure buildings are designed to be accessible and inclusive for all users.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Building complies with BCA accessibility requirements',
                                    'DDA compliance achieved'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Accessibility consultant engaged from concept design',
                                    'Design exceeds BCA requirements in key areas',
                                    'Hearing loops and visual alarms provided',
                                    'Accessible wayfinding and signage'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'Universal design principles applied throughout',
                                    'Consultation with disability advocacy groups',
                                    'Sensory-inclusive design features',
                                    'Gender-neutral and family-friendly facilities',
                                    'Accessibility certification achieved (e.g., ABCB Premises Standard)'
                                ]
                            }
                        ],
                        criteria: [
                            'Universal Design: Design considers needs of all users',
                            'Accessibility: Building exceeds minimum accessibility requirements',
                            'Inclusion: Diverse user needs are accommodated',
                            'Consultation: Users with disabilities are consulted'
                        ],
                        documentation: [
                            'Accessibility consultant report',
                            'Universal design checklist',
                            'User consultation records',
                            'Accessibility certification'
                        ],
                        tips: 'Engage an accessibility consultant early. Consider the needs of neurodiverse users and families with young children.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Accessibility consultant engaged too late',
                            'Only designing to minimum code requirements',
                            'Not consulting with diverse user groups'
                        ],
                        relatedCredits: ['amenity', 'movement', 'enjoyable']
                    }
                ]
            },
            {
                id: 'nature',
                name: 'Nature',
                icon: 'ðŸŒ¿',
                faIcon: 'fa-solid fa-leaf',
                color: 'teal',
                colorClasses: {
                    bg: 'bg-teal-500',
                    bgLight: 'bg-teal-50',
                    text: 'text-teal-600',
                    border: 'border-teal-500',
                    hover: 'hover:bg-teal-50'
                },
                maxPoints: 20,
                description: 'Ecological impact and biodiversity',
                credits: [
                    {
                        id: 'impacts-nature',
                        name: 'Impacts to Nature',
                        points: 6,
                        required: true,
                        description: 'Minimizing negative impacts on ecological values.',
                        aims: 'To minimise negative impacts on ecological values and protect existing natural features.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Compliance with EPBC Act and state environmental regulations',
                                    'Basic environmental impact assessment completed'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 3,
                                color: 'blue',
                                requirements: [
                                    'Ecological assessment by qualified ecologist',
                                    'Protection of significant vegetation and habitat',
                                    'No clearing of endangered ecological communities',
                                    'Erosion and sediment control plan implemented',
                                    'Construction impacts minimised through careful site planning'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 6,
                                color: 'green',
                                requirements: [
                                    'Net positive biodiversity outcome demonstrated',
                                    'Rehabilitation of degraded areas on site',
                                    'Protection of all mature trees and significant vegetation',
                                    'Wildlife corridors maintained or enhanced',
                                    'Offsets provided for any unavoidable impacts'
                                ]
                            }
                        ],
                        criteria: [
                            'Ecological Assessment: Site ecology is assessed by a qualified ecologist',
                            'Protection: Significant ecological features are protected during construction',
                            'Avoidance: Impacts on ecological values are avoided where possible',
                            'Mitigation: Unavoidable impacts are minimised and mitigated'
                        ],
                        documentation: [
                            'Ecological assessment report',
                            'Vegetation protection plans',
                            'Erosion and sediment control plans',
                            'Construction environmental management plan'
                        ],
                        tips: 'Engage an ecologist early to identify ecological constraints and opportunities. Protect trees with root zones during construction.',
                        projectPhases: ['Concept', 'Schematic', 'Construction'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Ecological assessment done too late to influence design',
                            'Tree protection zones not maintained during construction',
                            'Environmental permits not obtained early enough'
                        ],
                        relatedCredits: ['biodiversity', 'nature-connectivity', 'waterway']
                    },
                    {
                        id: 'biodiversity',
                        name: 'Biodiversity Enhancement',
                        points: 6,
                        required: false,
                        description: 'Enhancing biodiversity on and around the site.',
                        aims: 'To enhance biodiversity on the site through habitat creation and ecological design.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Basic landscaping with some native species',
                                    'Compliance with council landscaping requirements'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 3,
                                color: 'blue',
                                requirements: [
                                    'At least 50% of landscaping uses native species',
                                    'Habitat features created (nesting boxes, insect hotels)',
                                    'Green roof or green wall installed (min 200mÂ²)',
                                    'Biodiversity enhancement plan developed with ecologist'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 6,
                                color: 'green',
                                requirements: [
                                    'At least 75% native species using local provenance',
                                    'Significant habitat creation (biodiverse green roof, wildlife garden)',
                                    'Net biodiversity gain demonstrated through calculator',
                                    'Habitat for specific target species created',
                                    'Ongoing biodiversity monitoring program committed'
                                ]
                            }
                        ],
                        criteria: [
                            'Native Planting: Landscaping uses predominantly native species',
                            'Habitat Creation: Habitat features are incorporated into design',
                            'Green Infrastructure: Green roofs, walls, or other green infrastructure',
                            'Biodiversity Gain: Net positive biodiversity outcome achieved'
                        ],
                        documentation: [
                            'Landscape design with species list',
                            'Biodiversity Enhancement Calculator outputs',
                            'Habitat feature specifications',
                            'Monitoring and maintenance plan'
                        ],
                        calculatorRequired: true,
                        tips: 'Use local native species suited to the site conditions. Green roofs can provide valuable habitat in urban areas.',
                        projectPhases: ['Schematic', 'Design Dev', 'Documentation'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Using non-local or invasive species in planting',
                            'Green roof not designed for biodiversity outcomes',
                            'Habitat features not maintained post-construction'
                        ],
                        relatedCredits: ['impacts-nature', 'nature-connectivity', 'heat-res']
                    },
                    {
                        id: 'nature-connectivity',
                        name: 'Nature Connectivity',
                        points: 3,
                        required: false,
                        description: 'Creating ecological corridors and connections.',
                        aims: 'To support ecological connectivity and create links between natural areas.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Site does not create barriers to wildlife movement',
                                    'Basic consideration of ecological connectivity'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Ecological connectivity assessment completed',
                                    'Wildlife-friendly fencing and barriers',
                                    'Stepping-stone habitats created on site',
                                    'Light pollution minimised to reduce impacts on fauna'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'Site contributes to identified regional wildlife corridor',
                                    'Linear habitat features connect to adjacent green spaces',
                                    'Wildlife crossing structures or fauna-friendly design',
                                    'Partnership with council or conservation group on connectivity',
                                    'Dark sky design or wildlife lighting standards achieved'
                                ]
                            }
                        ],
                        criteria: [
                            'Connectivity Assessment: Ecological connectivity is assessed',
                            'Corridor Contribution: Site supports wildlife movement',
                            'Barrier Removal: Barriers to fauna movement are minimised',
                            'Regional Context: Site connects to broader ecological network'
                        ],
                        documentation: [
                            'Ecological connectivity assessment',
                            'Landscape design showing connectivity features',
                            'Lighting design addressing light pollution',
                            'Partnership agreements with conservation groups'
                        ],
                        tips: 'Coordinate with council on regional wildlife corridors. Native planting strips can create valuable habitat links.',
                        projectPhases: ['Concept', 'Schematic', 'Design Dev'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Not coordinating with council on regional corridors',
                            'Lighting design creating barriers for nocturnal fauna',
                            'Fencing blocking wildlife movement paths'
                        ],
                        relatedCredits: ['biodiversity', 'impacts-nature', 'light-quality']
                    },
                    {
                        id: 'nature-steward',
                        name: 'Nature Stewardship',
                        points: 3,
                        required: false,
                        description: 'Long-term management of natural features.',
                        aims: 'To ensure long-term management and protection of natural features on the site.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Basic landscape maintenance plan in place',
                                    'Compliance with vegetation protection conditions'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'Long-term ecological management plan (minimum 5 years)',
                                    'Vegetation management by qualified bush regenerator',
                                    'Weed control program implemented',
                                    'Monitoring of habitat features and wildlife use'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'Long-term conservation commitment (minimum 10 years)',
                                    'Conservation covenant or similar legal protection',
                                    'Partnership with Landcare or conservation organisation',
                                    'Annual biodiversity monitoring and reporting',
                                    'Community engagement in nature stewardship'
                                ]
                            }
                        ],
                        criteria: [
                            'Management Plan: Long-term management plan is developed',
                            'Legal Protection: Natural features have ongoing protection',
                            'Monitoring: Ecological outcomes are monitored over time',
                            'Community: Community is engaged in stewardship activities'
                        ],
                        documentation: [
                            'Long-term ecological management plan',
                            'Conservation covenant or easement',
                            'Monitoring reports',
                            'Community engagement records'
                        ],
                        tips: 'Conservation covenants can provide permanent protection. Partner with local Landcare groups for ongoing management.',
                        projectPhases: ['Design Dev', 'Documentation', 'Handover'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'Long-term management not included in building operations budget',
                            'Conservation commitments not legally secured',
                            'Monitoring program not established before handover'
                        ],
                        relatedCredits: ['biodiversity', 'impacts-nature', 'comm-res']
                    },
                    {
                        id: 'waterway',
                        name: 'Waterway Protection',
                        points: 2,
                        required: false,
                        description: 'Protecting water quality and aquatic ecosystems.',
                        aims: 'To protect waterways and aquatic ecosystems from pollution and degradation.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Compliance with EPA stormwater requirements',
                                    'Basic erosion and sediment control during construction'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 1,
                                color: 'blue',
                                requirements: [
                                    'WSUD treatment train achieving best practice targets',
                                    'At least 80% reduction in stormwater pollutants (TSS, TP, TN)',
                                    'Riparian buffer zones maintained or created',
                                    'No direct stormwater discharge to waterways'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 2,
                                color: 'green',
                                requirements: [
                                    'At least 90% reduction in stormwater pollutants',
                                    'Stormwater harvesting and reuse system',
                                    'Riparian rehabilitation or enhancement',
                                    'Habitat creation in waterway corridor',
                                    'Third-party verification of water quality outcomes'
                                ]
                            }
                        ],
                        criteria: [
                            'Water Quality: Stormwater quality is improved before discharge',
                            'Riparian Protection: Riparian areas are protected and enhanced',
                            'Aquatic Habitat: Aquatic ecosystems are protected',
                            'WSUD: Water sensitive urban design is implemented'
                        ],
                        documentation: [
                            'Stormwater quality management plan',
                            'MUSIC modelling outputs',
                            'Riparian management plan',
                            'Water quality monitoring data'
                        ],
                        tips: 'WSUD treatment trains are effective for stormwater quality. Raingardens and wetlands can also provide habitat value.',
                        projectPhases: ['Schematic', 'Design Dev', 'Documentation'],
                        difficulty: 'Medium',
                        commonMistakes: [
                            'WSUD elements undersized for pollutant targets',
                            'Stormwater modelling not completed early enough',
                            'Riparian buffer zones compromised by building footprint'
                        ],
                        relatedCredits: ['water-use', 'biodiversity', 'impacts-nature']
                    }
                ]
            },
            {
                id: 'leadership',
                name: 'Leadership',
                icon: 'ðŸ†',
                faIcon: 'fa-solid fa-trophy',
                color: 'indigo',
                colorClasses: {
                    bg: 'bg-indigo-500',
                    bgLight: 'bg-indigo-50',
                    text: 'text-indigo-600',
                    border: 'border-indigo-500',
                    hover: 'hover:bg-indigo-50'
                },
                maxPoints: 5,
                description: 'Innovation and market leadership',
                credits: [
                    {
                        id: 'market-transform',
                        name: 'Market Transformation',
                        points: 2,
                        required: true,
                        description: 'Initiatives that transform the market and inspire others.',
                        aims: 'To recognise projects that demonstrate market leadership and inspire positive change in the industry.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Project follows standard industry practices',
                                    'No specific market transformation activities'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 1,
                                color: 'blue',
                                requirements: [
                                    'Project demonstrates innovative approach not standard in market',
                                    'Case study published to share learnings',
                                    'Industry event presentation or site tour hosted',
                                    'Demonstrated influence on other projects or policies'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 2,
                                color: 'green',
                                requirements: [
                                    'First-of-kind application in Australia or market segment',
                                    'Multiple case studies and industry presentations',
                                    'Measurable market impact (uptake by other projects)',
                                    'Industry partnership to scale the innovation',
                                    'Published research or technical guidance'
                                ]
                            }
                        ],
                        criteria: [
                            'Innovation: Project demonstrates genuine innovation beyond standard practice',
                            'Sharing: Learnings are shared with the broader industry',
                            'Impact: Initiative has measurable positive impact on the market',
                            'Scalability: Innovation can be replicated by other projects'
                        ],
                        documentation: [
                            'Innovation claim description',
                            'Evidence of market impact',
                            'Case study and presentation materials',
                            'Letters of support from industry partners'
                        ],
                        tips: 'Document innovations from early in the project. Partner with GBCA or industry bodies to share learnings.',
                        projectPhases: ['Concept', 'Schematic', 'Handover'],
                        difficulty: 'Hard',
                        commonMistakes: [
                            'Not documenting innovations as they happen',
                            'Failing to share learnings through case studies',
                            'Innovation claims not supported by evidence'
                        ],
                        relatedCredits: ['leadership-challenge', 'ind-dev', 'impacts-disc']
                    },
                    {
                        id: 'leadership-challenge',
                        name: 'Leadership Challenges',
                        points: 3,
                        required: false,
                        description: 'Addressing specific leadership challenges.',
                        aims: 'To address specific sustainability challenges that demonstrate exceptional leadership.',
                        performanceLevels: [
                            {
                                level: 'minimum',
                                name: 'Minimum Expectation',
                                points: 0,
                                color: 'gray',
                                requirements: [
                                    'Project meets standard Green Star requirements',
                                    'No specific leadership challenges addressed'
                                ]
                            },
                            {
                                level: 'credit',
                                name: 'Credit Achievement',
                                points: 2,
                                color: 'blue',
                                requirements: [
                                    'One Leadership Challenge addressed with demonstrated outcomes',
                                    'Challenge approved by GBCA prior to assessment',
                                    'Measurable outcomes documented and verified',
                                    'Approach goes significantly beyond standard practice'
                                ]
                            },
                            {
                                level: 'exceptional',
                                name: 'Exceptional Performance',
                                points: 3,
                                color: 'green',
                                requirements: [
                                    'Multiple Leadership Challenges successfully addressed',
                                    'World-leading performance in challenge area',
                                    'Third-party verification of outcomes',
                                    'Learnings shared through industry publication or event',
                                    'Approach adopted as new benchmark for future projects'
                                ]
                            }
                        ],
                        criteria: [
                            'Challenge Definition: A specific leadership challenge is identified and approved',
                            'Approach: An innovative approach addresses the challenge',
                            'Outcomes: Measurable outcomes are achieved and documented',
                            'Leadership: Project demonstrates genuine leadership in the challenge area'
                        ],
                        documentation: [
                            'Leadership Challenge application and approval',
                            'Challenge methodology and approach',
                            'Outcome measurement and verification',
                            'Industry sharing documentation'
                        ],
                        pathways: [
                            { name: 'Climate Positive', description: 'Achieving net zero or climate positive outcomes' },
                            { name: 'Circular Economy', description: 'Implementing circular economy principles at scale' },
                            { name: 'Social Value', description: 'Exceptional social outcomes and community benefit' },
                            { name: 'Nature Positive', description: 'Achieving net positive biodiversity outcomes' },
                            { name: 'Custom Challenge', description: 'Project-specific challenge approved by GBCA' }
                        ],
                        tips: 'Engage with GBCA early to discuss potential Leadership Challenges. Ensure robust measurement and verification.',
                        projectPhases: ['Concept', 'Schematic', 'Handover'],
                        difficulty: 'Hard',
                        commonMistakes: [
                            'Not engaging GBCA early enough for challenge approval',
                            'Challenge outcomes not robustly measured',
                            'Missing third-party verification of outcomes'
                        ],
                        relatedCredits: ['market-transform', 'impacts-disc', 'ind-dev']
                    }
                ]
            }
        ];

        // ============================================
        // DYNAMIC DATA LOADING FROM ADMIN PANEL
        // ============================================

        // Color classes mapping for categories
        const categoryColorClasses = {
            amber: { bg: 'bg-amber-500', bgLight: 'bg-amber-50', text: 'text-amber-600', border: 'border-amber-500', hover: 'hover:bg-amber-50' },
            green: { bg: 'bg-green-500', bgLight: 'bg-green-50', text: 'text-green-600', border: 'border-green-500', hover: 'hover:bg-green-50' },
            emerald: { bg: 'bg-emerald-500', bgLight: 'bg-emerald-50', text: 'text-emerald-600', border: 'border-emerald-500', hover: 'hover:bg-emerald-50' },
            blue: { bg: 'bg-blue-500', bgLight: 'bg-blue-50', text: 'text-blue-600', border: 'border-blue-500', hover: 'hover:bg-blue-50' },
            red: { bg: 'bg-red-500', bgLight: 'bg-red-50', text: 'text-red-600', border: 'border-red-500', hover: 'hover:bg-red-50' },
            purple: { bg: 'bg-purple-500', bgLight: 'bg-purple-50', text: 'text-purple-600', border: 'border-purple-500', hover: 'hover:bg-purple-50' },
            pink: { bg: 'bg-pink-500', bgLight: 'bg-pink-50', text: 'text-pink-600', border: 'border-pink-500', hover: 'hover:bg-pink-50' },
            indigo: { bg: 'bg-indigo-500', bgLight: 'bg-indigo-50', text: 'text-indigo-600', border: 'border-indigo-500', hover: 'hover:bg-indigo-50' },
            cyan: { bg: 'bg-cyan-500', bgLight: 'bg-cyan-50', text: 'text-cyan-600', border: 'border-cyan-500', hover: 'hover:bg-cyan-50' },
            teal: { bg: 'bg-teal-500', bgLight: 'bg-teal-50', text: 'text-teal-600', border: 'border-teal-500', hover: 'hover:bg-teal-50' },
        };

        // Category icons mapping
        const categoryIcons = {
            responsible: { icon: 'ðŸ”§', faIcon: 'fa-solid fa-gear' },
            healthy: { icon: 'ðŸ’š', faIcon: 'fa-solid fa-heart-pulse' },
            resilient: { icon: 'ðŸ›¡ï¸', faIcon: 'fa-solid fa-shield' },
            positive: { icon: 'âš¡', faIcon: 'fa-solid fa-bolt' },
            places: { icon: 'ðŸ™ï¸', faIcon: 'fa-solid fa-city' },
            people: { icon: 'ðŸ‘¥', faIcon: 'fa-solid fa-users' },
            nature: { icon: 'ðŸŒ¿', faIcon: 'fa-solid fa-leaf' },
            leadership: { icon: 'ðŸ†', faIcon: 'fa-solid fa-trophy' },
        };

        // Load categories data from admin panel or use defaults
        function loadCategoriesData() {
            try {
                const adminData = localStorage.getItem('greenstar_admin_data');
                if (!adminData) {
                    console.log('No admin data found, using default categories');
                    return defaultCategoriesData;
                }

                const parsed = JSON.parse(adminData);
                if (!parsed.categories || !parsed.credits) {
                    console.log('Admin data incomplete, using default categories');
                    return defaultCategoriesData;
                }

                console.log('Loading categories from admin data...');

                // Transform flat admin data to nested structure
                const transformedCategories = parsed.categories
                    .sort((a, b) => (a.order || 0) - (b.order || 0))
                    .map(cat => {
                        // Get credits for this category
                        const categoryCredits = (parsed.credits || [])
                            .filter(c => c.category === cat.id)
                            .sort((a, b) => (a.order || 0) - (b.order || 0))
                            .map(credit => {
                                // Get levels for this credit
                                const creditLevels = (parsed.levels || [])
                                    .filter(l => l.creditId === credit.id)
                                    .map(level => ({
                                        level: level.level,
                                        name: level.level === 'minimum' ? 'Minimum Expectation' :
                                              level.level === 'credit' ? 'Credit Achievement' : 'Exceptional Performance',
                                        points: level.points || 0,
                                        color: level.level === 'minimum' ? 'gray' :
                                               level.level === 'credit' ? 'blue' : 'green',
                                        requirements: level.description ? [level.description] : []
                                    }));

                                // Get criteria for this credit (group by level)
                                const creditCriteria = (parsed.criteria || [])
                                    .filter(c => c.creditId === credit.id)
                                    .map(c => c.text);

                                // Get documentation for this credit
                                const creditDocs = (parsed.documentation || [])
                                    .filter(d => d.creditId === credit.id)
                                    .map(d => d.name);

                                // Parse project phases
                                const phases = credit.projectPhases
                                    ? credit.projectPhases.split(',').map(p => p.trim()).filter(p => p)
                                    : [];

                                // Get related credits from synergies
                                const relatedCredits = (parsed.synergies || [])
                                    .filter(s => s.credit1 === credit.id || s.credit2 === credit.id)
                                    .map(s => s.credit1 === credit.id ? s.credit2 : s.credit1);

                                return {
                                    id: credit.id,
                                    name: credit.name,
                                    points: credit.maxPoints || 0,
                                    required: credit.required || false,
                                    description: credit.description || credit.shortDescription || '',
                                    aims: credit.aims || '',
                                    performanceLevels: creditLevels.length > 0 ? creditLevels : undefined,
                                    criteria: creditCriteria.length > 0 ? creditCriteria : undefined,
                                    documentation: creditDocs.length > 0 ? creditDocs : undefined,
                                    tips: credit.tips || '',
                                    projectPhases: phases.length > 0 ? phases : undefined,
                                    difficulty: credit.difficulty || 'Medium',
                                    commonMistakes: [],
                                    relatedCredits: relatedCredits.length > 0 ? relatedCredits : undefined
                                };
                            });

                        // Calculate max points for category
                        const maxPoints = categoryCredits.reduce((sum, c) => sum + (c.points || 0), 0);

                        // Get color classes
                        const colorClass = categoryColorClasses[cat.color] || categoryColorClasses.gray;
                        const icons = categoryIcons[cat.id] || { icon: 'ðŸ“‹', faIcon: 'fa-solid fa-clipboard' };

                        return {
                            id: cat.id,
                            name: cat.name,
                            icon: icons.icon,
                            faIcon: icons.faIcon,
                            color: cat.color || 'gray',
                            colorClasses: colorClass,
                            maxPoints: maxPoints,
                            description: cat.description || '',
                            credits: categoryCredits
                        };
                    });

                console.log(`Loaded ${transformedCategories.length} categories with ${transformedCategories.reduce((sum, c) => sum + c.credits.length, 0)} credits from admin data`);
                return transformedCategories;

            } catch (error) {
                console.error('Error loading admin data:', error);
                return defaultCategoriesData;
            }
        }

        // Load the categories data (from admin or defaults)
        const categoriesData = loadCategoriesData();

        // Load templates data from admin panel or use defaults
        function loadTemplatesData() {
            try {
                const adminData = localStorage.getItem('greenstar_admin_data');
                if (!adminData) {
                    console.log('No admin data found, using default templates');
                    return null; // Will use hardcoded defaults below
                }

                const parsed = JSON.parse(adminData);
                if (!parsed.templates || parsed.templates.length === 0) {
                    console.log('No templates in admin data, using defaults');
                    return null;
                }

                // Icon mapping based on type
                const typeIcons = {
                    'Office': 'fa-building',
                    'Residential': 'fa-house-chimney',
                    'Retail': 'fa-store',
                    'Education': 'fa-school',
                    'Healthcare': 'fa-hospital',
                    'Industrial': 'fa-warehouse',
                    'Mixed Use': 'fa-city',
                    'Other': 'fa-building-circle-check'
                };

                // Transform admin templates to app format
                const transformedTemplates = parsed.templates
                    .filter(t => t.active !== false) // Only active templates
                    .map(template => {
                        // Parse credits from comma-separated string to array
                        const suggestedCredits = template.credits
                            ? template.credits.split(',').map(c => c.trim()).filter(c => c)
                            : [];

                        // Parse target rating from string "5 Star" to number 5
                        const targetRating = template.targetRating
                            ? parseInt(template.targetRating.replace(/\D/g, '')) || 5
                            : 5;

                        return {
                            id: template.id,
                            name: template.name,
                            icon: typeIcons[template.type] || 'fa-building',
                            description: template.description || '',
                            suggestedCredits: suggestedCredits,
                            targetRating: targetRating
                        };
                    });

                console.log(`Loaded ${transformedTemplates.length} project templates from admin data`);
                return transformedTemplates;

            } catch (error) {
                console.error('Error loading templates from admin data:', error);
                return null;
            }
        }

        // Load calculators data from admin panel or use defaults
        function loadCalculatorsData() {
            try {
                const adminData = localStorage.getItem('greenstar_admin_data');
                if (!adminData) return null;

                const parsed = JSON.parse(adminData);
                if (!parsed.calculators || parsed.calculators.length === 0) return null;

                console.log(`Loaded ${parsed.calculators.length} calculators from admin data`);
                return parsed.calculators.filter(c => c.active !== false);
            } catch (error) {
                console.error('Error loading calculators from admin data:', error);
                return null;
            }
        }

        // Load common mistakes from admin panel
        function loadCommonMistakesData() {
            try {
                const adminData = localStorage.getItem('greenstar_admin_data');
                if (!adminData) return {};

                const parsed = JSON.parse(adminData);
                if (!parsed.commonMistakes || parsed.commonMistakes.length === 0) return {};

                // Group by credit ID
                const grouped = {};
                parsed.commonMistakes.forEach(m => {
                    if (!grouped[m.creditId]) grouped[m.creditId] = [];
                    grouped[m.creditId].push({
                        mistake: m.mistake,
                        impact: m.impact,
                        prevention: m.prevention
                    });
                });

                console.log(`Loaded common mistakes for ${Object.keys(grouped).length} credits from admin data`);
                return grouped;
            } catch (error) {
                console.error('Error loading common mistakes from admin data:', error);
                return {};
            }
        }

        // Get admin data timestamp
        function getAdminDataTimestamp() {
            try {
                const adminData = localStorage.getItem('greenstar_admin_data');
                if (!adminData) return null;
                const parsed = JSON.parse(adminData);
                return parsed.savedAt || null;
            } catch {
                return null;
            }
        }

        // Calculator data (default)
        const defaultCalculatorsData = [
            { id: 'responsible-products', name: 'Responsible Products Calculator', description: 'Calculate responsible products percentage', icon: 'fa-boxes-stacked', type: 'products' },
            { id: 'energy-reference', name: 'Energy Use - Reference Pathway', description: 'Calculate energy reduction vs reference', icon: 'fa-bolt', type: 'energy' },
            { id: 'upfront-carbon', name: 'Upfront Carbon Emissions', description: 'Calculate embodied carbon emissions', icon: 'fa-cloud', type: 'carbon' },
            { id: 'carbon-compensation', name: 'Upfront Carbon Compensation', description: 'Calculate carbon offset requirements', icon: 'fa-leaf', type: 'carbon' },
            { id: 'refrigerant', name: 'Refrigerant Systems GWP', description: 'Calculate refrigerant GWP impact', icon: 'fa-snowflake', type: 'energy' },
            { id: 'water', name: 'Water Use Calculator', description: 'Calculate water consumption reduction', icon: 'fa-droplet', type: 'water' },
            { id: 'movement', name: 'Movement and Place', description: 'Calculate transport impact score', icon: 'fa-person-walking', type: 'transport' },
            { id: 'procurement', name: 'Procurement and Workforce', description: 'Calculate social procurement spend', icon: 'fa-handshake', type: 'social' },
            { id: 'biodiversity', name: 'Biodiversity Enhancement', description: 'Calculate biodiversity net gain', icon: 'fa-tree', type: 'biodiversity' }
        ];

        // Load calculators (from admin or defaults)
        const calculatorsData = loadCalculatorsData() || defaultCalculatorsData;

        // Project Templates for different building types (defaults)
        const defaultProjectTemplates = [
            {
                id: 'office',
                name: 'Commercial Office',
                icon: 'fa-building',
                description: 'Standard office building with focus on occupant comfort and energy efficiency',
                suggestedCredits: [
                    'responsible-resp-const', 'responsible-verify-hand', 'responsible-resp-proc',
                    'healthy-clean-air', 'healthy-light-quality', 'healthy-acoustic', 'healthy-amenity',
                    'resilient-climate-res', 'resilient-ops-res',
                    'positive-energy-source', 'positive-energy-use', 'positive-upfront-carbon-red',
                    'places-movement', 'places-enjoyable',
                    'people-inclusive-const', 'people-design-equity',
                    'nature-impacts-nature',
                    'leadership-market-transform'
                ],
                targetRating: 5
            },
            {
                id: 'residential',
                name: 'Residential / Multi-Unit',
                icon: 'fa-house-chimney',
                description: 'Apartment buildings and residential complexes',
                suggestedCredits: [
                    'responsible-resp-const', 'responsible-verify-hand',
                    'healthy-clean-air', 'healthy-light-quality', 'healthy-amenity', 'healthy-nature-conn',
                    'resilient-climate-res', 'resilient-heat-res',
                    'positive-energy-source', 'positive-energy-use', 'positive-upfront-carbon-red', 'positive-water-use',
                    'places-movement', 'places-enjoyable', 'places-contribution',
                    'people-inclusive-const', 'people-design-equity',
                    'nature-impacts-nature', 'nature-biodiversity',
                    'leadership-market-transform'
                ],
                targetRating: 5
            },
            {
                id: 'retail',
                name: 'Retail / Shopping Centre',
                icon: 'fa-store',
                description: 'Shopping centres and retail spaces',
                suggestedCredits: [
                    'responsible-resp-const', 'responsible-verify-hand', 'responsible-resp-resource',
                    'healthy-clean-air', 'healthy-light-quality', 'healthy-amenity',
                    'resilient-climate-res', 'resilient-heat-res',
                    'positive-energy-source', 'positive-energy-use', 'positive-upfront-carbon-red', 'positive-refrigerant',
                    'places-movement', 'places-enjoyable', 'places-contribution',
                    'people-inclusive-const',
                    'nature-impacts-nature',
                    'leadership-market-transform'
                ],
                targetRating: 5
            },
            {
                id: 'education',
                name: 'Education Facility',
                icon: 'fa-school',
                description: 'Schools, universities, and training facilities',
                suggestedCredits: [
                    'responsible-resp-const', 'responsible-verify-hand', 'responsible-ind-dev',
                    'healthy-clean-air', 'healthy-light-quality', 'healthy-acoustic', 'healthy-amenity', 'healthy-nature-conn',
                    'resilient-climate-res', 'resilient-comm-res',
                    'positive-energy-source', 'positive-energy-use', 'positive-upfront-carbon-red',
                    'places-movement', 'places-enjoyable', 'places-culture',
                    'people-inclusive-const', 'people-first-nations', 'people-design-equity',
                    'nature-impacts-nature', 'nature-biodiversity',
                    'leadership-market-transform'
                ],
                targetRating: 5
            },
            {
                id: 'healthcare',
                name: 'Healthcare Facility',
                icon: 'fa-hospital',
                description: 'Hospitals, clinics, and medical centres',
                suggestedCredits: [
                    'responsible-resp-const', 'responsible-verify-hand', 'responsible-resp-proc',
                    'healthy-clean-air', 'healthy-light-quality', 'healthy-acoustic', 'healthy-toxins', 'healthy-amenity',
                    'resilient-climate-res', 'resilient-ops-res', 'resilient-grid-res',
                    'positive-energy-source', 'positive-energy-use', 'positive-upfront-carbon-red',
                    'places-movement', 'places-enjoyable',
                    'people-inclusive-const', 'people-design-equity',
                    'nature-impacts-nature', 'nature-nature-conn',
                    'leadership-market-transform'
                ],
                targetRating: 5
            },
            {
                id: 'industrial',
                name: 'Industrial / Warehouse',
                icon: 'fa-warehouse',
                description: 'Warehouses, factories, and industrial facilities',
                suggestedCredits: [
                    'responsible-resp-const', 'responsible-verify-hand', 'responsible-resp-resource',
                    'healthy-clean-air', 'healthy-toxins',
                    'resilient-climate-res', 'resilient-ops-res',
                    'positive-energy-source', 'positive-energy-use', 'positive-upfront-carbon-red', 'positive-low-emissions',
                    'places-movement',
                    'people-inclusive-const',
                    'nature-impacts-nature', 'nature-waterway',
                    'leadership-market-transform'
                ],
                targetRating: 4
            }
        ];

        // Load project templates (from admin or defaults)
        const projectTemplates = loadTemplatesData() || defaultProjectTemplates;

        // Credit Synergies - credits that work well together
        const creditSynergies = {
            'responsible-resp-const': {
                synergies: ['responsible-verify-hand', 'responsible-resp-resource', 'people-inclusive-const'],
                reason: 'Good construction practices support verification, resource management, and inclusive workplaces'
            },
            'responsible-verify-hand': {
                synergies: ['responsible-resp-const', 'resilient-ops-res'],
                reason: 'Verification ensures construction quality and supports operational resilience'
            },
            'healthy-clean-air': {
                synergies: ['healthy-toxins', 'healthy-amenity', 'responsible-resp-finishes'],
                reason: 'Air quality is improved by low-toxin materials and good ventilation design'
            },
            'healthy-light-quality': {
                synergies: ['healthy-amenity', 'healthy-nature-conn', 'positive-energy-use'],
                reason: 'Good lighting supports comfort and can reduce energy use with daylighting'
            },
            'healthy-nature-conn': {
                synergies: ['nature-biodiversity', 'healthy-amenity', 'places-enjoyable'],
                reason: 'Biophilic design supports biodiversity, amenity, and place quality'
            },
            'resilient-climate-res': {
                synergies: ['resilient-heat-res', 'resilient-ops-res', 'positive-energy-use'],
                reason: 'Climate adaptation supports heat resilience and efficient operations'
            },
            'positive-energy-source': {
                synergies: ['positive-energy-use', 'positive-upfront-carbon-red', 'resilient-grid-res'],
                reason: 'Renewable energy works best with efficiency measures and grid resilience'
            },
            'positive-energy-use': {
                synergies: ['positive-energy-source', 'healthy-light-quality', 'resilient-ops-res'],
                reason: 'Energy efficiency supports renewables and operational resilience'
            },
            'positive-upfront-carbon-red': {
                synergies: ['responsible-resp-struct', 'responsible-resp-envelope', 'positive-circularity'],
                reason: 'Embodied carbon reduction works with responsible materials and circularity'
            },
            'places-movement': {
                synergies: ['places-enjoyable', 'people-design-equity', 'positive-low-emissions'],
                reason: 'Sustainable transport supports walkability, equity, and emissions reduction'
            },
            'people-inclusive-const': {
                synergies: ['responsible-resp-const', 'people-proc-workforce', 'people-first-nations'],
                reason: 'Inclusive practices extend to procurement and First Nations engagement'
            },
            'nature-impacts-nature': {
                synergies: ['nature-biodiversity', 'nature-waterway', 'nature-nature-conn'],
                reason: 'Ecological protection supports biodiversity and water quality'
            },
            'nature-biodiversity': {
                synergies: ['nature-impacts-nature', 'healthy-nature-conn', 'places-enjoyable'],
                reason: 'Biodiversity enhancement supports ecological value and amenity'
            }
        };

        // Star rating calculation (based on Green Star Buildings v1.1)
        function calculateStarRating(totalPoints) {
            const cappedPoints = Math.min(totalPoints, 100);
            if (cappedPoints >= 70) return { stars: 6, name: '6 Star', description: 'World Leadership', color: 'text-yellow-500' };
            if (cappedPoints >= 35) return { stars: 5, name: '5 Star', description: 'Australian Excellence', color: 'text-emerald-500' };
            if (cappedPoints >= 15) return { stars: 4, name: '4 Star', description: 'Best Practice', color: 'text-blue-500' };
            return { stars: 0, name: 'No Rating', description: 'Need 15+ points', color: 'text-ink-3' };
        }

        // Get next rating target
        function getNextRatingTarget(totalPoints) {
            const cappedPoints = Math.min(totalPoints, 100);
            if (cappedPoints >= 70) return null;
            if (cappedPoints >= 35) return { target: 70, name: '6 Star', remaining: 70 - cappedPoints };
            if (cappedPoints >= 15) return { target: 35, name: '5 Star', remaining: 35 - cappedPoints };
            return { target: 15, name: '4 Star', remaining: 15 - cappedPoints };
        }

        // ============================================
        // COMPONENTS
        // ============================================

        // Circular Progress Component
        function CircularProgress({ current, max, size = 140, strokeWidth = 10 }) {
            const radius = (size - strokeWidth) / 2;
            const circumference = radius * 2 * Math.PI;
            const cappedCurrent = Math.min(current, max);
            const percentage = (cappedCurrent / max) * 100;
            const offset = circumference - (percentage / 100) * circumference;

            return (
                <div className="relative" style={{ width: size, height: size }}>
                    <svg className="transform -rotate-90" width={size} height={size}>
                        {/* Background circle */}
                        <circle
                            cx={size / 2}
                            cy={size / 2}
                            r={radius}
                            fill="none"
                            stroke="#E7E5E4"
                            strokeWidth={strokeWidth}
                        />
                        {/* Progress circle */}
                        <circle
                            cx={size / 2}
                            cy={size / 2}
                            r={radius}
                            fill="none"
                            stroke="#2E6B3F"
                            strokeWidth={strokeWidth}
                            strokeLinecap="round"
                            strokeDasharray={circumference}
                            strokeDashoffset={offset}
                            className="circular-progress"
                        />
                    </svg>
                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                        <span className="font-mono text-3xl font-bold text-ink">{current}</span>
                        <span className="text-sm text-ink-3">/ {max} pts</span>
                    </div>
                </div>
            );
        }

        // Rating Display - Text-based, no stars
        function RatingDisplay({ rating }) {
            const ratingStyles = {
                6: { bg: 'bg-emerald-50', border: 'border-emerald-600', text: 'text-emerald-700' },
                5: { bg: 'bg-teal-50', border: 'border-teal-600', text: 'text-teal-700' },
                4: { bg: 'bg-blue-50', border: 'border-blue-600', text: 'text-blue-700' },
                0: { bg: 'bg-surface-2', border: 'border-stone-400', text: 'text-ink-3' }
            };
            const style = ratingStyles[rating.stars] || ratingStyles[0];

            return (
                <div className="flex flex-col items-center">
                    <div className={`rating-badge ${style.bg} ${style.border} border px-4 py-2 rounded-lg`}>
                        <span className={`font-display font-semibold ${style.text}`}>
                            {rating.stars > 0 ? `${rating.stars} Star` : 'No Rating'}
                        </span>
                        <span className={`text-sm ml-2 ${style.text} opacity-80`}>
                            {rating.description}
                        </span>
                    </div>
                </div>
            );
        }

        // Score Dashboard Component
        function ScoreDashboard({ totalPoints, selectedCredits, categories }) {
            const rating = calculateStarRating(totalPoints);
            const nextTarget = getNextRatingTarget(totalPoints);
            const requiredCredits = ['positive-energy-source', 'positive-energy-use', 'positive-upfront-carbon-red'];
            const requiredMet = requiredCredits.filter(key => selectedCredits[key] > 0).length;

            return (
                <div className="glass-card rounded-2xl p-6 shadow-lg">
                    <div className="flex flex-wrap items-center justify-between gap-6">
                        <div className="flex items-center gap-6">
                            <CircularProgress current={totalPoints} max={100} />
                            <div>
                                <RatingDisplay rating={rating} />
                                {nextTarget && (
                                    <p className="text-sm text-ink-2 mt-2">
                                        <span className="font-semibold">{nextTarget.remaining}</span> more points for {nextTarget.name}
                                    </p>
                                )}
                            </div>
                        </div>

                        <div className="flex flex-col gap-2">
                            <div className="flex items-center gap-2 text-sm">
                                <i className={`fa-solid fa-check-circle ${requiredMet === 3 ? 'text-green-500' : 'text-ink-3 dark:text-gray-500'}`}></i>
                                <span className={requiredMet === 3 ? 'text-green-600 font-medium' : 'text-ink-2'}>
                                    Required Credits: {requiredMet}/3
                                </span>
                            </div>
                            <div className="text-xs text-ink-3">
                                Energy Source, Energy Use, Upfront Carbon
                            </div>
                        </div>

                        <div className="text-right">
                            <p className="text-sm text-ink-2">Credits Selected</p>
                            <p className="font-mono text-2xl font-bold text-ink">
                                {Object.values(selectedCredits).filter(v => v > 0).length}
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        // Category Badge Component
        function CategoryBadge({ category, isActive, onClick, selectedPoints }) {
            const { colorClasses } = category;
            const percentage = Math.round((selectedPoints / category.maxPoints) * 100);

            return (
                <button
                    onClick={onClick}
                    className={`category-badge flex flex-col items-center p-4 rounded-lg cursor-pointer min-w-[120px]
                        ${isActive ? `bg-surface-2 ${colorClasses.border} border` : 'bg-white border border-line'}
                        hover:bg-surface-2 transition-colors`}
                >
                    <div className={`mb-2 ${isActive ? colorClasses.text : 'text-ink-3'}`}>
                        <CategoryIcon category={category.id} size={28} />
                    </div>
                    <span className={`font-medium text-sm ${isActive ? colorClasses.text : 'text-ink'}`}>
                        {category.name}
                    </span>
                    <div className="flex items-center gap-1 mt-1">
                        <span className={`font-mono text-sm font-bold ${isActive ? colorClasses.text : 'text-ink-2'}`}>
                            {selectedPoints}
                        </span>
                        <span className="text-xs text-ink-3">/ {category.maxPoints}</span>
                    </div>
                    {/* Mini progress bar */}
                    <div className="w-full h-1 bg-stone-200 rounded-full mt-2 overflow-hidden">
                        <div
                            className={`h-full ${colorClasses.bg} transition-all duration-300`}
                            style={{ width: `${percentage}%` }}
                        />
                    </div>
                </button>
            );
        }

        // Credit Card Component with Performance Level Selection
        function CreditCard({ credit, categoryId, selectedLevel, onSelectLevel, onViewDetails, colorClasses }) {
            const hasLevels = credit.performanceLevels && credit.performanceLevels.length > 0;
            const currentPoints = selectedLevel ?
                (hasLevels ? credit.performanceLevels.find(l => l.level === selectedLevel)?.points || 0 : credit.points) : 0;

            const levelColors = {
                minimum: { bg: 'bg-gray-50', border: 'border-gray-300', text: 'text-ink-2' },
                credit: { bg: 'bg-blue-50', border: 'border-blue-400', text: 'text-blue-700' },
                exceptional: { bg: 'bg-[#1F4B2E]/5', border: 'border-[#1F4B2E]', text: 'text-[#1F4B2E]' }
            };

            const levelIcons = {
                minimum: 'fa-minus',
                credit: 'fa-check',
                exceptional: 'fa-award'
            };

            const levelFullNames = {
                minimum: 'Minimum Expectation',
                credit: 'Credit Achievement',
                exceptional: 'Exceptional Performance'
            };

            // Get colors based on selected level
            const currentLevelColors = selectedLevel ? levelColors[selectedLevel] : null;

            // Handle dropdown change
            const handleSelectChange = (e) => {
                const value = e.target.value;
                if (value === '') {
                    onSelectLevel(null, 0);
                } else {
                    const level = credit.performanceLevels.find(l => l.level === value);
                    if (level) {
                        onSelectLevel(level.level, level.points);
                    }
                }
            };

            return (
                <div
                    className={`credit-card rounded-lg border transition-all bg-white
                        ${selectedLevel
                            ? `${currentLevelColors.border} ${currentLevelColors.bg}`
                            : 'border-line'}`}
                >
                    {/* Clickable Header row */}
                    <div
                        className="flex items-center gap-4 p-4 pb-2 cursor-pointer hover:bg-surface-1 rounded-t-lg transition-colors"
                        onClick={onViewDetails}
                    >
                        <div className="flex-grow min-w-0">
                            <div className="flex items-center gap-2 flex-wrap">
                                <h3 className={`font-medium ${selectedLevel ? currentLevelColors.text : 'text-ink'}`}>
                                    {credit.name}
                                </h3>
                                {credit.required && (
                                    <span className="required-badge bg-red-50 text-red-600 px-2 py-0.5 rounded text-xs font-semibold uppercase">
                                        Required
                                    </span>
                                )}
                                {credit.difficulty && (
                                    <span className={`text-xs px-2 py-0.5 rounded ${
                                        credit.difficulty === 'Easy' ? 'bg-green-50 text-green-700' :
                                        credit.difficulty === 'Medium' ? 'bg-amber-50 text-amber-700' :
                                        'bg-red-50 text-red-700'
                                    }`}>
                                        {credit.difficulty}
                                    </span>
                                )}
                                {credit.calculatorRequired && (
                                    <span className="text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded">
                                        <i className="fa-solid fa-calculator mr-1"></i>
                                        Calc
                                    </span>
                                )}
                            </div>
                            {credit.description && (
                                <p className="text-sm text-ink-3 mt-1 line-clamp-2">{credit.description}</p>
                            )}
                        </div>

                        <div className="flex items-center gap-3 flex-shrink-0">
                            <div className={`font-mono text-lg font-bold min-w-[50px] text-right ${selectedLevel ? currentLevelColors.text : 'text-ink-3'}`}>
                                +{currentPoints}
                            </div>
                            <i className="fa-solid fa-chevron-right text-ink-3 text-sm"></i>
                        </div>
                    </div>

                    {/* Performance Level Dropdown Selector */}
                    {hasLevels ? (
                        <div className="px-4 pb-4 pt-2">
                            <div className="flex items-center gap-2">
                                <div className="flex items-center gap-1 text-xs text-ink-3">
                                    <i className="fa-solid fa-clipboard-check"></i>
                                    <span>Claim:</span>
                                </div>
                                <div className="flex-grow relative">
                                    <select
                                        value={selectedLevel || ''}
                                        onChange={handleSelectChange}
                                        onClick={(e) => e.stopPropagation()}
                                        className={`w-full py-2 px-3 pr-8 rounded-lg border transition-all text-sm font-medium appearance-none cursor-pointer
                                            ${selectedLevel
                                                ? `${levelColors[selectedLevel].bg} ${levelColors[selectedLevel].border} ${levelColors[selectedLevel].text}`
                                                : 'bg-white border-line text-ink-2 hover:border-[#2E6B3F]'
                                            }`}
                                    >
                                        <option value="">â€” Not Claimed â€”</option>
                                        {credit.performanceLevels.map((level) => (
                                            <option key={level.level} value={level.level}>
                                                {levelFullNames[level.level]} ({level.points} pts)
                                            </option>
                                        ))}
                                    </select>
                                    <div className="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none">
                                        <i className={`fa-solid ${selectedLevel ? levelIcons[selectedLevel] : 'fa-chevron-down'} text-sm ${selectedLevel ? levelColors[selectedLevel].text : 'text-ink-3'}`}></i>
                                    </div>
                                </div>
                            </div>
                            {selectedLevel && (
                                <div className="mt-2 text-xs text-ink-3 flex items-center gap-1">
                                    <i className="fa-solid fa-circle-info"></i>
                                    {selectedLevel === 'exceptional' && <span>Includes Credit Achievement + Minimum Expectation compliance</span>}
                                    {selectedLevel === 'credit' && <span>Includes Minimum Expectation compliance</span>}
                                    {selectedLevel === 'minimum' && <span>Meets Minimum Expectation requirements only</span>}
                                </div>
                            )}
                        </div>
                    ) : (
                        <div className="px-4 pb-4 pt-2">
                            <button
                                onClick={() => onSelectLevel(selectedLevel ? null : 'credit', credit.points)}
                                className={`w-full py-2 px-3 rounded-lg border transition-all text-sm font-medium
                                    ${selectedLevel
                                        ? 'bg-[#1F4B2E]/5 border-[#1F4B2E] text-[#1F4B2E]'
                                        : 'bg-white border-line text-ink-2 hover:border-[#2E6B3F] hover:bg-[#1F4B2E]/5'
                                    }`}
                            >
                                <div className="flex items-center justify-center gap-2">
                                    <i className={`fa-solid ${selectedLevel ? 'fa-check' : 'fa-plus'} text-sm`}></i>
                                    <span>{selectedLevel ? 'Selected' : 'Select Credit'}</span>
                                    <span className="font-mono">({credit.points} pts)</span>
                                </div>
                            </button>
                        </div>
                    )}
                </div>
            );
        }

        // Credit Detail Modal Component
        function CreditDetailModal({ isOpen, onClose, credit, category, selectedCredits, onSelectLevel, creditNotes, onNotesChange, creditDocs, onDocsChange, faqData, onOpenCalculator, calculatorsData }) {
            const [activeTab, setActiveTab] = useState('overview');
            const [expandedFaqs, setExpandedFaqs] = useState({});
            const [localNote, setLocalNote] = useState('');

            const creditKey = credit && category ? `${category.id}-${credit.id}` : '';
            const selection = selectedCredits?.[creditKey];
            const selectedLevel = selection?.level || null;
            const hasLevels = credit?.performanceLevels && credit.performanceLevels.length > 0;

            const levelColors = {
                minimum: { bg: 'bg-gray-100', border: 'border-gray-400', text: 'text-ink-2' },
                credit: { bg: 'bg-blue-100', border: 'border-blue-500', text: 'text-blue-700' },
                exceptional: { bg: 'bg-green-100', border: 'border-green-500', text: 'text-green-700' }
            };

            const levelFullNames = {
                minimum: 'Minimum Expectation',
                credit: 'Credit Achievement',
                exceptional: 'Exceptional Performance'
            };

            const levelIcons = {
                minimum: 'fa-minus',
                credit: 'fa-check',
                exceptional: 'fa-award'
            };

            useEffect(() => {
                if (isOpen && creditKey) {
                    setActiveTab('overview');
                    setLocalNote(creditNotes?.[creditKey] || '');
                }
            }, [isOpen, credit, creditNotes, creditKey]);

            if (!isOpen || !credit) return null;

            // Filter FAQs related to this credit
            const getRelatedFaqs = () => {
                if (!faqData || faqData.length === 0) return [];

                const creditName = credit.name.toLowerCase().trim();
                const categoryName = category?.name?.toLowerCase().trim() || '';

                return faqData.filter(faq => {
                    // Check if the FAQ's credits field contains this credit name
                    if (faq.credits) {
                        const faqCredits = faq.credits.toLowerCase();
                        if (faqCredits.includes(creditName)) return true;
                    }
                    // Also check category match as fallback
                    if (faq.categories) {
                        const faqCategories = faq.categories.toLowerCase();
                        if (faqCategories.includes(categoryName)) return true;
                    }
                    return false;
                });
            };

            const relatedFaqs = getRelatedFaqs();

            const tabs = [
                { id: 'overview', label: 'Overview', icon: 'fa-eye' },
                { id: 'levels', label: 'Levels', icon: 'fa-layer-group' },
                { id: 'checklist', label: 'Checklist', icon: 'fa-clipboard-check' },
                { id: 'notes', label: 'Notes', icon: 'fa-sticky-note' },
                { id: 'criteria', label: 'Criteria', icon: 'fa-list-check' }
            ];

            if (credit.pathways && credit.pathways.length > 0) {
                tabs.push({ id: 'pathways', label: 'Pathways', icon: 'fa-route' });
            }

            // Add FAQs tab if there are related FAQs
            if (relatedFaqs.length > 0) {
                tabs.push({ id: 'faqs', label: `FAQs (${relatedFaqs.length})`, icon: 'fa-circle-question' });
            }

            // Get completed docs for this credit
            const completedDocs = creditDocs?.[creditKey] || {};

            const handleDocToggle = (docIndex) => {
                const newDocs = { ...completedDocs, [docIndex]: !completedDocs[docIndex] };
                onDocsChange?.(creditKey, newDocs);
            };

            const handleNoteSave = () => {
                onNotesChange?.(creditKey, localNote);
            };

            const handleLevelChange = (e) => {
                const value = e.target.value;
                if (value === '') {
                    onSelectLevel(creditKey, null, 0);
                } else {
                    const level = credit.performanceLevels.find(l => l.level === value);
                    if (level) {
                        onSelectLevel(creditKey, level.level, level.points);
                    }
                }
            };

            const currentPoints = selectedLevel && hasLevels
                ? credit.performanceLevels.find(l => l.level === selectedLevel)?.points || 0
                : (selectedLevel ? credit.points : 0);

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" onClick={onClose}>
                    <div
                        className="modal-enter bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"
                        onClick={(e) => e.stopPropagation()}
                    >
                        {/* Header */}
                        <div className={`bg-surface-2 border-b border-line p-6 relative overflow-hidden`}>
                            <div className="absolute top-4 right-4 opacity-5">
                                <CategoryIcon category={category.id} size={180} className={category.colorClasses.text} />
                            </div>
                            <div className="relative z-10">
                                <div className="flex items-start justify-between mb-4">
                                    <div className="flex items-center gap-3">
                                        <div className={category.colorClasses.text}>
                                            <CategoryIcon category={category.id} size={40} />
                                        </div>
                                        <div>
                                            <p className={`text-sm font-medium ${category.colorClasses.text} uppercase tracking-wide`}>
                                                {category.name} Category
                                            </p>
                                            <h2 className="font-display text-2xl font-bold text-ink mt-1">
                                                {credit.name}
                                            </h2>
                                        </div>
                                    </div>
                                    <button
                                        onClick={onClose}
                                        className="w-10 h-10 rounded-full bg-white/80 hover:bg-white flex items-center justify-center transition-colors shadow-sm"
                                    >
                                        <i className="fa-solid fa-xmark text-ink-2"></i>
                                    </button>
                                </div>

                                <div className="flex items-center gap-4 flex-wrap">
                                    <div className={`px-4 py-2 rounded-lg flex items-center gap-2 ${selectedLevel ? (selectedLevel === 'exceptional' ? 'bg-emerald-600 text-white' : selectedLevel === 'credit' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-ink-2') : 'bg-gray-100 text-ink-2 dark:bg-gray-700 dark:text-gray-300'}`}>
                                        <span className="font-mono font-bold text-lg">{currentPoints}</span>
                                        <span className="text-sm opacity-90">points</span>
                                    </div>
                                    {credit.required && (
                                        <span className="bg-red-500 text-white px-3 py-1.5 rounded-lg text-sm font-semibold flex items-center gap-2">
                                            <i className="fa-solid fa-exclamation-circle"></i>
                                            Required
                                        </span>
                                    )}
                                    {credit.calculatorRequired && (
                                        <button
                                            onClick={() => credit.relatedCalculator && onOpenCalculator?.(credit.relatedCalculator)}
                                            className="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg text-sm font-semibold flex items-center gap-2 transition-colors cursor-pointer"
                                            title={credit.relatedCalculator ? `Open ${calculatorsData?.find(c => c.id === credit.relatedCalculator)?.name || 'Calculator'}` : 'Calculator required'}
                                        >
                                            <i className="fa-solid fa-calculator"></i>
                                            {credit.relatedCalculator ? 'Open Calculator' : 'Calculator Required'}
                                            {credit.relatedCalculator && <i className="fa-solid fa-arrow-right text-xs"></i>}
                                        </button>
                                    )}
                                </div>

                                {/* Level Selection Dropdown */}
                                {hasLevels ? (
                                    <div className="mt-4 flex items-center gap-3">
                                        <span className="text-sm font-medium text-ink">Claim Level:</span>
                                        <div className="flex-grow relative">
                                            <select
                                                value={selectedLevel || ''}
                                                onChange={handleLevelChange}
                                                className={`w-full py-2.5 px-4 pr-10 rounded-xl border-2 text-sm font-medium appearance-none cursor-pointer transition-all
                                                    ${selectedLevel
                                                        ? `${levelColors[selectedLevel].bg} ${levelColors[selectedLevel].border} ${levelColors[selectedLevel].text}`
                                                        : 'bg-white border-gray-300 text-ink-2 hover:border-gray-400'
                                                    }`}
                                            >
                                                <option value="">â€” Not Claimed â€”</option>
                                                {credit.performanceLevels.map((level) => (
                                                    <option key={level.level} value={level.level}>
                                                        {levelFullNames[level.level]} ({level.points} pts)
                                                    </option>
                                                ))}
                                            </select>
                                            <div className="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none">
                                                <i className={`fa-solid ${selectedLevel ? levelIcons[selectedLevel] : 'fa-chevron-down'} ${selectedLevel ? levelColors[selectedLevel].text : 'text-ink-3'}`}></i>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="mt-4">
                                        <button
                                            onClick={() => onSelectLevel(creditKey, selectedLevel ? null : 'credit', selectedLevel ? 0 : credit.points)}
                                            className={`w-full py-2.5 px-4 rounded-xl font-medium flex items-center justify-center gap-2 transition-all ${
                                                selectedLevel
                                                    ? 'bg-green-500 text-white hover:bg-green-600'
                                                    : 'bg-white text-ink hover:bg-surface-2 border-2 border-gray-300'
                                            }`}
                                        >
                                            <i className={`fa-solid ${selectedLevel ? 'fa-check' : 'fa-plus'}`}></i>
                                            {selectedLevel ? `Selected (${credit.points} pts)` : `Add Credit (${credit.points} pts)`}
                                        </button>
                                    </div>
                                )}

                                {selectedLevel && (
                                    <div className="mt-2 text-xs text-ink-2 flex items-center gap-1">
                                        <i className="fa-solid fa-circle-info"></i>
                                        {selectedLevel === 'exceptional' && <span>Includes Credit Achievement + Minimum Expectation compliance</span>}
                                        {selectedLevel === 'credit' && <span>Includes Minimum Expectation compliance</span>}
                                        {selectedLevel === 'minimum' && <span>Meets Minimum Expectation requirements only</span>}
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Tabs */}
                        <div className="flex gap-2 px-6 py-3 bg-surface-2 border-b border-line">
                            {tabs.map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`tab-button px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 ${
                                        activeTab === tab.id ? 'active' : 'text-ink-2 hover:bg-gray-100'
                                    }`}
                                >
                                    <i className={`fa-solid ${tab.icon}`}></i>
                                    {tab.label}
                                </button>
                            ))}
                        </div>

                        {/* Content */}
                        <div className="flex-1 overflow-y-auto p-6 scrollbar-thin">
                            {activeTab === 'overview' && (
                                <div className="space-y-6 fade-in">
                                    {/* Description */}
                                    <div className="section-card rounded-xl p-5">
                                        <h3 className="font-semibold text-ink mb-2 flex items-center gap-2">
                                            <i className="fa-solid fa-quote-left text-ink-3"></i>
                                            Description
                                        </h3>
                                        <p className="text-ink-2 leading-relaxed">{credit.description}</p>
                                    </div>

                                    {/* Aims */}
                                    {credit.aims && (
                                        <div className="section-card rounded-xl p-5">
                                            <h3 className="font-semibold text-ink mb-2 flex items-center gap-2">
                                                <i className="fa-solid fa-bullseye text-green-500"></i>
                                                Credit Aims
                                            </h3>
                                            <p className="text-ink-2 leading-relaxed">{credit.aims}</p>
                                        </div>
                                    )}

                                    {/* Tips */}
                                    {credit.tips && (
                                        <div className="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200 rounded-xl p-5">
                                            <h3 className="font-semibold text-amber-800 mb-2 flex items-center gap-2">
                                                <i className="fa-solid fa-lightbulb text-amber-500"></i>
                                                Pro Tips
                                            </h3>
                                            <p className="text-amber-700 leading-relaxed">{credit.tips}</p>
                                        </div>
                                    )}

                                    {/* Common Mistakes */}
                                    {credit.commonMistakes && credit.commonMistakes.length > 0 && (
                                        <div className="bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-xl p-5">
                                            <h3 className="font-semibold text-red-800 mb-3 flex items-center gap-2">
                                                <i className="fa-solid fa-triangle-exclamation text-red-500"></i>
                                                Common Mistakes to Avoid
                                            </h3>
                                            <ul className="space-y-2">
                                                {credit.commonMistakes.map((mistake, idx) => (
                                                    <li key={idx} className="flex items-start gap-2 text-red-700">
                                                        <i className="fa-solid fa-xmark text-red-400 mt-1 flex-shrink-0"></i>
                                                        <span>{mistake}</span>
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>
                                    )}

                                    {/* Project Phase & Difficulty */}
                                    {(credit.projectPhases || credit.difficulty) && (
                                        <div className="grid grid-cols-2 gap-4">
                                            {credit.projectPhases && (
                                                <div className="section-card rounded-xl p-4">
                                                    <h4 className="font-medium text-ink mb-2 flex items-center gap-2">
                                                        <i className="fa-solid fa-clock text-purple-500"></i>
                                                        Key Project Phases
                                                    </h4>
                                                    <div className="flex flex-wrap gap-2">
                                                        {credit.projectPhases.map((phase, idx) => (
                                                            <span key={idx} className="px-2 py-1 bg-purple-100 text-purple-700 rounded-lg text-sm">
                                                                {phase}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                            {credit.difficulty && (
                                                <div className="section-card rounded-xl p-4">
                                                    <h4 className="font-medium text-ink mb-2 flex items-center gap-2">
                                                        <i className="fa-solid fa-gauge text-blue-500"></i>
                                                        Difficulty
                                                    </h4>
                                                    <span className={`px-3 py-1 rounded-lg text-sm font-medium
                                                        ${credit.difficulty === 'Easy' ? 'bg-green-100 text-green-700' :
                                                          credit.difficulty === 'Medium' ? 'bg-yellow-100 text-yellow-700' :
                                                          'bg-red-100 text-red-700'}`}>
                                                        {credit.difficulty}
                                                    </span>
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    {/* Quick Stats */}
                                    <div className="grid grid-cols-3 gap-4">
                                        <div className="bg-surface-2 border border-line rounded-lg p-4 text-center">
                                            <p className="font-mono text-2xl font-bold text-ink">{credit.points}</p>
                                            <p className="text-sm text-ink-3">Points Available</p>
                                        </div>
                                        <div className="bg-surface-2 border border-line rounded-lg p-4 text-center">
                                            <p className="font-mono text-2xl font-bold text-ink">{credit.criteria?.length || 0}</p>
                                            <p className="text-sm text-ink-3">Criteria Items</p>
                                        </div>
                                        <div className="bg-surface-2 border border-line rounded-lg p-4 text-center">
                                            <p className="font-mono text-2xl font-bold text-ink">{credit.documentation?.length || 0}</p>
                                            <p className="text-sm text-ink-3">Documents Required</p>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'levels' && (
                                <div className="space-y-6 fade-in">
                                    <p className="text-ink-2 mb-4">
                                        Select a performance level to claim. Higher levels include all requirements from lower levels.
                                    </p>
                                    {credit.performanceLevels && credit.performanceLevels.length > 0 ? (
                                        <div className="space-y-4">
                                            {credit.performanceLevels.map((level, index) => {
                                                const isThisLevelSelected = selectedLevel === level.level;
                                                const isIncludedInSelection = selectedLevel && (
                                                    (selectedLevel === 'exceptional') ||
                                                    (selectedLevel === 'credit' && level.level !== 'exceptional') ||
                                                    (selectedLevel === 'minimum' && level.level === 'minimum')
                                                );
                                                const levelColors = {
                                                    minimum: {
                                                        bg: 'bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-800 dark:to-gray-800',
                                                        border: 'border-gray-300 dark:border-gray-600',
                                                        selectedBorder: 'border-gray-500 ring-2 ring-gray-300',
                                                        icon: 'bg-gray-200 dark:bg-gray-600',
                                                        iconText: 'text-ink-2 dark:text-white',
                                                        text: 'text-ink-2 dark:text-gray-300',
                                                        badge: 'bg-gray-100 text-ink-2 dark:bg-gray-700 dark:text-gray-300'
                                                    },
                                                    credit: {
                                                        bg: 'bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20',
                                                        border: 'border-blue-300 dark:border-blue-700',
                                                        selectedBorder: 'border-blue-500 ring-2 ring-blue-300',
                                                        icon: 'bg-gradient-to-br from-blue-500 to-indigo-500',
                                                        iconText: 'text-white',
                                                        text: 'text-blue-700 dark:text-blue-300',
                                                        badge: 'bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300'
                                                    },
                                                    exceptional: {
                                                        bg: 'bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20',
                                                        border: 'border-green-300 dark:border-green-700',
                                                        selectedBorder: 'border-green-500 ring-2 ring-green-300',
                                                        icon: 'bg-gradient-to-br from-green-500 to-emerald-500',
                                                        iconText: 'text-white',
                                                        text: 'text-green-700 dark:text-green-300',
                                                        badge: 'bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300'
                                                    }
                                                };
                                                const colors = levelColors[level.level] || levelColors.credit;
                                                const icons = {
                                                    minimum: 'fa-minus',
                                                    credit: 'fa-check',
                                                    exceptional: 'fa-award'
                                                };

                                                return (
                                                    <div
                                                        key={level.level}
                                                        onClick={() => {
                                                            if (isThisLevelSelected) {
                                                                onSelectLevel(creditKey, null, 0);
                                                            } else {
                                                                onSelectLevel(creditKey, level.level, level.points);
                                                            }
                                                        }}
                                                        className={`${colors.bg} ${isThisLevelSelected ? colors.selectedBorder : colors.border} border-2 rounded-xl p-5 fade-in transition-all cursor-pointer
                                                            ${isThisLevelSelected ? 'shadow-lg' : 'hover:shadow-md'}
                                                            ${isIncludedInSelection && !isThisLevelSelected ? 'opacity-75' : ''}`}
                                                        style={{ animationDelay: `${index * 100}ms` }}
                                                    >
                                                        <div className="flex items-start gap-4">
                                                            <div className={`w-12 h-12 ${colors.icon} rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg relative`}>
                                                                <i className={`fa-solid ${icons[level.level]} ${colors.iconText} text-lg`}></i>
                                                                {isThisLevelSelected && (
                                                                    <div className="absolute -top-1 -right-1 w-5 h-5 bg-white rounded-full flex items-center justify-center shadow">
                                                                        <i className="fa-solid fa-check text-green-500 text-xs"></i>
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <div className="flex-grow">
                                                                <div className="flex items-center justify-between mb-2">
                                                                    <div className="flex items-center gap-2">
                                                                        <h4 className={`font-semibold text-lg ${colors.text}`}>{level.name}</h4>
                                                                        {isThisLevelSelected && (
                                                                            <span className="text-xs bg-green-500 text-white px-2 py-0.5 rounded-full">CLAIMED</span>
                                                                        )}
                                                                        {isIncludedInSelection && !isThisLevelSelected && (
                                                                            <span className="text-xs bg-gray-200 text-ink-2 dark:bg-gray-600 dark:text-gray-300 px-2 py-0.5 rounded-full">INCLUDED</span>
                                                                        )}
                                                                    </div>
                                                                    <div className={`${colors.badge} px-3 py-1 rounded-full font-mono font-bold text-sm`}>
                                                                        {level.points} {level.points === 1 ? 'point' : 'points'}
                                                                    </div>
                                                                </div>
                                                                <p className="text-xs text-ink-2 dark:text-ink-3 mb-3">
                                                                    {level.level === 'minimum' && 'Baseline requirements - no points but may be required for rating'}
                                                                    {level.level === 'credit' && 'Standard credit achievement level'}
                                                                    {level.level === 'exceptional' && 'Highest level - includes all lower requirements'}
                                                                </p>
                                                                <div className="space-y-2">
                                                                    <p className="text-xs font-semibold text-ink-2 dark:text-ink-3 uppercase tracking-wide">Requirements:</p>
                                                                    {level.requirements && level.requirements.map((req, reqIndex) => (
                                                                        <div key={reqIndex} className="flex items-start gap-2">
                                                                            <i className={`fa-solid ${isIncludedInSelection ? 'fa-circle-check text-green-500' : 'fa-circle'} ${isIncludedInSelection ? '' : colors.text} mt-0.5 text-sm`}></i>
                                                                            <span className={`text-sm ${isIncludedInSelection ? 'text-ink dark:text-gray-300' : 'text-ink-2 dark:text-ink-3'}`}>{req}</span>
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    ) : (
                                        <div className="text-center py-8 text-ink-2">
                                            <i className="fa-solid fa-layer-group text-4xl mb-3 text-ink-3 dark:text-gray-500"></i>
                                            <p>Performance levels coming soon</p>
                                            <p className="text-sm mt-2">This credit awards up to {credit.points} points</p>
                                        </div>
                                    )}

                                    {/* Points Scale Visual */}
                                    <div className="mt-6 p-4 bg-surface-2 rounded-xl">
                                        <h4 className="font-medium text-ink mb-3 flex items-center gap-2">
                                            <i className="fa-solid fa-chart-simple text-ink-2"></i>
                                            Points Scale
                                        </h4>
                                        <div className="flex items-center gap-2">
                                            <div className="flex-grow h-3 bg-gray-200 rounded-full overflow-hidden flex">
                                                {credit.performanceLevels ? (
                                                    <>
                                                        <div className="h-full bg-gray-300 dark:bg-gray-500" style={{ width: '33%' }}></div>
                                                        <div className="h-full bg-blue-500" style={{ width: '33%' }}></div>
                                                        <div className="h-full bg-green-500" style={{ width: '34%' }}></div>
                                                    </>
                                                ) : (
                                                    <div className="h-full bg-gradient-to-r from-blue-400 to-green-500 w-full"></div>
                                                )}
                                            </div>
                                            <span className="font-mono font-bold text-ink w-16 text-right">{credit.points} pts</span>
                                        </div>
                                        {credit.performanceLevels && (
                                            <div className="flex justify-between text-xs text-ink-2 mt-2">
                                                <span>Minimum (0)</span>
                                                <span>Credit ({credit.performanceLevels[1]?.points || 0})</span>
                                                <span>Exceptional ({credit.points})</span>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {activeTab === 'checklist' && (
                                <div className="space-y-4 fade-in">
                                    <p className="text-ink-2 dark:text-ink-3 mb-4">
                                        <i className="fa-solid fa-clipboard-check mr-2"></i>
                                        Track your progress gathering required documentation:
                                    </p>
                                    {credit.documentation && credit.documentation.length > 0 ? (
                                        <div className="space-y-2">
                                            {credit.documentation.map((doc, index) => (
                                                <div
                                                    key={index}
                                                    onClick={() => handleDocToggle(index)}
                                                    className={`flex items-center gap-3 p-4 rounded-xl border cursor-pointer transition-all
                                                        ${completedDocs[index]
                                                            ? 'bg-green-50 border-green-300 dark:bg-green-900/30 dark:border-green-700'
                                                            : 'bg-surface-2 border-line hover:border-gray-300 dark:bg-gray-700 dark:border-gray-600'
                                                        }`}
                                                >
                                                    <div className={`w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all
                                                        ${completedDocs[index]
                                                            ? 'bg-green-500 border-green-500'
                                                            : 'border-gray-300 dark:border-gray-500'
                                                        }`}
                                                    >
                                                        {completedDocs[index] && <i className="fa-solid fa-check text-white text-xs"></i>}
                                                    </div>
                                                    <span className={`flex-grow ${completedDocs[index] ? 'text-green-700 dark:text-green-400' : 'text-ink dark:text-gray-300'}`}>
                                                        {doc}
                                                    </span>
                                                    {completedDocs[index] && (
                                                        <i className="fa-solid fa-circle-check text-green-500"></i>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="text-center py-8 text-ink-2">
                                            <i className="fa-solid fa-folder-open text-4xl mb-3 text-ink-3 dark:text-gray-500"></i>
                                            <p>No documentation requirements specified</p>
                                        </div>
                                    )}

                                    {/* Progress Summary */}
                                    {credit.documentation && credit.documentation.length > 0 && (
                                        <div className="mt-6 p-4 bg-surface-2 dark:bg-gray-700 rounded-xl">
                                            <div className="flex items-center justify-between mb-2">
                                                <span className="text-sm font-medium text-ink dark:text-gray-300">Documentation Progress</span>
                                                <span className="text-sm font-mono text-ink-2 dark:text-ink-3">
                                                    {Object.values(completedDocs).filter(Boolean).length} / {credit.documentation.length}
                                                </span>
                                            </div>
                                            <div className="w-full h-2 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden">
                                                <div
                                                    className="h-full bg-gradient-to-r from-green-400 to-green-600 transition-all"
                                                    style={{ width: `${(Object.values(completedDocs).filter(Boolean).length / credit.documentation.length) * 100}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeTab === 'notes' && (
                                <div className="space-y-4 fade-in">
                                    <p className="text-ink-2 dark:text-ink-3 mb-4">
                                        <i className="fa-solid fa-sticky-note mr-2"></i>
                                        Add project-specific notes for this credit:
                                    </p>
                                    <textarea
                                        value={localNote}
                                        onChange={(e) => setLocalNote(e.target.value)}
                                        onBlur={handleNoteSave}
                                        placeholder="Enter your notes here... (e.g., responsible team member, specific requirements, deadlines, etc.)"
                                        className="w-full h-48 p-4 border border-line dark:border-gray-600 rounded-xl resize-none focus:ring-2 focus:ring-green-200 focus:border-green-500 transition-all dark:bg-gray-700 dark:text-white"
                                    />
                                    <div className="flex justify-between items-center text-sm text-ink-2">
                                        <span>Auto-saves when you click outside</span>
                                        <button
                                            onClick={handleNoteSave}
                                            className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex items-center gap-2"
                                        >
                                            <i className="fa-solid fa-save"></i>
                                            Save Note
                                        </button>
                                    </div>

                                    {/* Related Credits */}
                                    {credit.relatedCredits && credit.relatedCredits.length > 0 && (
                                        <div className="mt-6 p-4 bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-xl">
                                            <h4 className="font-semibold text-blue-800 dark:text-blue-300 mb-2 flex items-center gap-2">
                                                <i className="fa-solid fa-link"></i>
                                                Related Credits (Synergies)
                                            </h4>
                                            <p className="text-sm text-blue-600 dark:text-blue-400 mb-3">
                                                These credits have connections that may help or be affected by this credit:
                                            </p>
                                            <div className="flex flex-wrap gap-2">
                                                {credit.relatedCredits.map((relatedId, idx) => (
                                                    <span key={idx} className="px-3 py-1 bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300 rounded-full text-sm">
                                                        {relatedId}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeTab === 'criteria' && (
                                <div className="space-y-6 fade-in">
                                    <p className="text-ink-2 dark:text-ink-3 mb-4">
                                        Requirements for each performance level. Higher levels include all requirements from lower levels.
                                    </p>

                                    {credit.performanceLevels && credit.performanceLevels.length > 0 ? (
                                        <div className="space-y-4">
                                            {credit.performanceLevels.map((level, levelIndex) => {
                                                const isThisLevelSelected = selectedLevel === level.level;
                                                const isIncludedInSelection = selectedLevel && (
                                                    (selectedLevel === 'exceptional') ||
                                                    (selectedLevel === 'credit' && level.level !== 'exceptional') ||
                                                    (selectedLevel === 'minimum' && level.level === 'minimum')
                                                );

                                                const levelStyles = {
                                                    minimum: {
                                                        header: 'bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600',
                                                        icon: 'bg-gray-200 dark:bg-gray-600',
                                                        iconText: 'text-ink-2 dark:text-white',
                                                        iconSymbol: 'fa-minus',
                                                        text: 'text-ink dark:text-gray-300'
                                                    },
                                                    credit: {
                                                        header: 'bg-blue-50 dark:bg-blue-900/30 border-blue-300 dark:border-blue-700',
                                                        icon: 'bg-blue-500',
                                                        iconText: 'text-white',
                                                        iconSymbol: 'fa-check',
                                                        text: 'text-blue-700 dark:text-blue-300'
                                                    },
                                                    exceptional: {
                                                        header: 'bg-green-50 dark:bg-green-900/30 border-green-300 dark:border-green-700',
                                                        icon: 'bg-green-500',
                                                        iconText: 'text-white',
                                                        iconSymbol: 'fa-award',
                                                        text: 'text-green-700 dark:text-green-300'
                                                    }
                                                };

                                                const style = levelStyles[level.level] || levelStyles.credit;

                                                return (
                                                    <div key={level.level} className={`rounded-xl border-2 overflow-hidden transition-all ${isThisLevelSelected ? 'ring-2 ring-offset-2 ring-green-500 dark:ring-offset-gray-800' : 'border-line dark:border-gray-700'}`}>
                                                        <div className={`${style.header} border-b px-4 py-3 flex items-center justify-between`}>
                                                            <div className="flex items-center gap-3">
                                                                <div className={`w-8 h-8 ${style.icon} rounded-lg flex items-center justify-center`}>
                                                                    <i className={`fa-solid ${style.iconSymbol} ${style.iconText} text-sm`}></i>
                                                                </div>
                                                                <div>
                                                                    <h4 className={`font-semibold ${style.text}`}>{level.name}</h4>
                                                                    <span className="text-xs text-ink-2 dark:text-ink-3">{level.points} points</span>
                                                                </div>
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                {isThisLevelSelected && (
                                                                    <span className="text-xs bg-green-500 text-white px-2 py-1 rounded-full font-medium">
                                                                        <i className="fa-solid fa-check mr-1"></i>CLAIMED
                                                                    </span>
                                                                )}
                                                                {isIncludedInSelection && !isThisLevelSelected && (
                                                                    <span className="text-xs bg-gray-200 text-ink-2 dark:bg-gray-600 dark:text-gray-300 px-2 py-1 rounded-full font-medium">
                                                                        <i className="fa-solid fa-check mr-1"></i>INCLUDED
                                                                    </span>
                                                                )}
                                                            </div>
                                                        </div>
                                                        <div className="bg-white dark:bg-gray-800 p-4">
                                                            {level.requirements && level.requirements.length > 0 ? (
                                                                <ul className="space-y-2">
                                                                    {level.requirements.map((req, reqIndex) => (
                                                                        <li key={reqIndex} className="flex items-start gap-3">
                                                                            <div className={`w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 ${
                                                                                isIncludedInSelection
                                                                                    ? 'bg-green-100 dark:bg-green-900/30'
                                                                                    : 'bg-gray-100 dark:bg-gray-700'
                                                                            }`}>
                                                                                <i className={`fa-solid text-xs ${
                                                                                    isIncludedInSelection
                                                                                        ? 'fa-check text-green-600 dark:text-green-400'
                                                                                        : 'fa-circle text-ink-3 dark:text-ink-2'
                                                                                }`}></i>
                                                                            </div>
                                                                            <span className={`text-sm ${
                                                                                isIncludedInSelection
                                                                                    ? 'text-ink dark:text-gray-200'
                                                                                    : 'text-ink-2 dark:text-ink-3'
                                                                            }`}>{req}</span>
                                                                        </li>
                                                                    ))}
                                                                </ul>
                                                            ) : (
                                                                <p className="text-sm text-ink-2 dark:text-ink-3 italic">No specific requirements at this level</p>
                                                            )}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    ) : credit.criteria && credit.criteria.length > 0 ? (
                                        /* Fallback to old criteria format if no performance levels */
                                        credit.criteria.map((criterion, index) => {
                                            const [title, ...descParts] = criterion.split(':');
                                            const desc = descParts.join(':').trim();
                                            return (
                                                <div key={index} className="section-card rounded-xl p-5 fade-in" style={{ animationDelay: `${index * 50}ms` }}>
                                                    <div className="flex items-start gap-4">
                                                        <div className="w-8 h-8 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center flex-shrink-0">
                                                            <span className="text-white font-bold text-sm">{index + 1}</span>
                                                        </div>
                                                        <div>
                                                            <h4 className="font-semibold text-ink dark:text-gray-200">{title}</h4>
                                                            {desc && <p className="text-ink-2 dark:text-ink-3 mt-1">{desc}</p>}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })
                                    ) : (
                                        <div className="text-center py-8 text-ink-2">
                                            <i className="fa-solid fa-clipboard-list text-4xl mb-3 text-ink-3 dark:text-gray-500"></i>
                                            <p>Detailed criteria coming soon</p>
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeTab === 'pathways' && credit.pathways && (
                                <div className="space-y-4 fade-in">
                                    <p className="text-ink-2 mb-4">
                                        Choose one of the following pathways to demonstrate compliance:
                                    </p>
                                    {credit.pathways.map((pathway, index) => (
                                        <div key={index} className="pathway-card rounded-xl p-5 fade-in" style={{ animationDelay: `${index * 100}ms` }}>
                                            <div className="flex items-start gap-4">
                                                <div className="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center flex-shrink-0">
                                                    <i className="fa-solid fa-route text-white"></i>
                                                </div>
                                                <div>
                                                    <h4 className="font-semibold text-ink">{pathway.name}</h4>
                                                    <p className="text-ink-2 mt-1">{pathway.description}</p>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {activeTab === 'documentation' && (
                                <div className="space-y-4 fade-in">
                                    <p className="text-ink-2 mb-4">
                                        The following documentation is required for submission:
                                    </p>
                                    {credit.documentation && credit.documentation.length > 0 ? (
                                        <div className="space-y-2">
                                            {credit.documentation.map((doc, index) => (
                                                <div key={index} className="doc-item flex items-center gap-3 p-4 rounded-xl bg-surface-2 border border-gray-100 fade-in" style={{ animationDelay: `${index * 50}ms` }}>
                                                    <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-purple-100 to-pink-100 flex items-center justify-center flex-shrink-0">
                                                        <i className="fa-solid fa-file-alt text-purple-600"></i>
                                                    </div>
                                                    <span className="text-ink">{doc}</span>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="text-center py-8 text-ink-2">
                                            <i className="fa-solid fa-folder-open text-4xl mb-3 text-ink-3 dark:text-gray-500"></i>
                                            <p>Documentation requirements coming soon</p>
                                        </div>
                                    )}

                                    {/* Calculator Link */}
                                    {credit.calculatorRequired && (
                                        <div className="mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-5">
                                            <div className="flex items-center gap-4">
                                                <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-500 flex items-center justify-center flex-shrink-0">
                                                    <i className="fa-solid fa-calculator text-white text-xl"></i>
                                                </div>
                                                <div className="flex-grow">
                                                    <h4 className="font-semibold text-blue-800">Calculator Required</h4>
                                                    <p className="text-blue-600 text-sm">Use the Green Star Calculator to determine compliance</p>
                                                </div>
                                                <button className="px-4 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors">
                                                    Open Calculator
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeTab === 'faqs' && (
                                <div className="space-y-4 fade-in">
                                    <p className="text-ink-2 dark:text-ink-3 mb-4">
                                        <i className="fa-solid fa-circle-question mr-2"></i>
                                        Frequently asked questions related to this credit from GBCA:
                                    </p>
                                    {relatedFaqs.length > 0 ? (
                                        <div className="space-y-3">
                                            {relatedFaqs.map((faq, index) => {
                                                const isExpanded = expandedFaqs[index];
                                                // Clean up HTML tags from description
                                                const cleanDescription = (faq.description || '')
                                                    .replace(/_x000D_/g, '\n')
                                                    .replace(/&amp;/g, '&')
                                                    .replace(/&lt;/g, '<')
                                                    .replace(/&gt;/g, '>')
                                                    .replace(/&rsquo;/g, "'")
                                                    .replace(/&ndash;/g, 'â€“')
                                                    .replace(/<[^>]*>/g, '')
                                                    .trim();

                                                return (
                                                    <div
                                                        key={faq.faqid || index}
                                                        className="bg-gradient-to-r from-teal-50 to-cyan-50 dark:from-teal-900/20 dark:to-cyan-900/20 border border-teal-200 dark:border-teal-700 rounded-xl overflow-hidden transition-all"
                                                    >
                                                        <button
                                                            onClick={() => setExpandedFaqs(prev => ({ ...prev, [index]: !prev[index] }))}
                                                            className="w-full p-4 text-left flex items-start gap-3 hover:bg-teal-100/50 dark:hover:bg-teal-800/30 transition-colors"
                                                        >
                                                            <div className="w-8 h-8 rounded-lg bg-teal-500 flex items-center justify-center flex-shrink-0 mt-0.5">
                                                                <i className="fa-solid fa-question text-white text-sm"></i>
                                                            </div>
                                                            <div className="flex-grow">
                                                                <h4 className="font-semibold text-teal-800 dark:text-teal-300 pr-8">
                                                                    {faq.title || 'FAQ'}
                                                                </h4>
                                                                {faq.credits && (
                                                                    <p className="text-xs text-teal-600 dark:text-teal-400 mt-1">
                                                                        <i className="fa-solid fa-tag mr-1"></i>
                                                                        {faq.credits}
                                                                    </p>
                                                                )}
                                                            </div>
                                                            <i className={`fa-solid ${isExpanded ? 'fa-chevron-up' : 'fa-chevron-down'} text-teal-500 flex-shrink-0 mt-1`}></i>
                                                        </button>
                                                        {isExpanded && (
                                                            <div className="px-4 pb-4 pt-0">
                                                                <div className="ml-11 pl-4 border-l-2 border-teal-300 dark:border-teal-600">
                                                                    <div className="text-sm text-ink dark:text-gray-300 whitespace-pre-wrap leading-relaxed">
                                                                        {cleanDescription}
                                                                    </div>
                                                                    {faq.tools && (
                                                                        <p className="text-xs text-ink-2 dark:text-ink-3 mt-3 pt-3 border-t border-teal-200 dark:border-teal-700">
                                                                            <i className="fa-solid fa-wrench mr-1"></i>
                                                                            Applies to: {faq.tools}
                                                                        </p>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    ) : (
                                        <div className="text-center py-8 text-ink-2">
                                            <i className="fa-solid fa-circle-question text-4xl mb-3 text-ink-3 dark:text-gray-500"></i>
                                            <p>No FAQs available for this credit</p>
                                        </div>
                                    )}

                                    {/* FAQ Source Note */}
                                    <div className="mt-6 p-4 bg-surface-2 dark:bg-gray-700 rounded-xl">
                                        <p className="text-xs text-ink-2 dark:text-ink-3 flex items-center gap-2">
                                            <i className="fa-solid fa-info-circle"></i>
                                            FAQs sourced from GBCA Green Star Buildings Technical Manual
                                        </p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Credits List Component
        function CreditsList({ categories, activeCategory, selectedCredits, onSelectCreditLevel, onViewCreditDetails, phaseFilter, searchQuery, showQuickWins, showRequired }) {
            // Filter function for credits
            const filterCredits = (credit) => {
                // Phase filter
                if (phaseFilter && phaseFilter !== 'all') {
                    if (!credit.projectPhases || !credit.projectPhases.includes(phaseFilter)) {
                        return false;
                    }
                }

                // Quick wins filter (Easy difficulty)
                if (showQuickWins) {
                    if (credit.difficulty !== 'Easy') {
                        return false;
                    }
                }

                // Minimum expectations filter (Required credits only)
                if (showRequired) {
                    if (!credit.required) {
                        return false;
                    }
                }

                // Search filter
                if (searchQuery && searchQuery.trim()) {
                    const query = searchQuery.toLowerCase();
                    const searchableText = [
                        credit.name,
                        credit.description,
                        credit.aims,
                        ...(credit.criteria || []),
                        ...(credit.tips ? [credit.tips] : []),
                        ...(credit.commonMistakes || [])
                    ].join(' ').toLowerCase();

                    if (!searchableText.includes(query)) {
                        return false;
                    }
                }

                return true;
            };

            // Get categories to display
            const categoriesToShow = activeCategory === 'all'
                ? categories
                : categories.filter(c => c.id === activeCategory);

            // Check if any credits match filters
            const hasAnyCredits = categoriesToShow.some(cat =>
                cat.credits.some(filterCredits)
            );

            if (!hasAnyCredits) {
                return (
                    <div className="bg-white rounded-lg p-6 border border-line">
                        <p className="text-center text-ink-3 py-12">
                            <i className="fa-solid fa-filter-circle-xmark text-4xl mb-3 block"></i>
                            No credits match your current filters
                            <br />
                            <span className="text-sm">Try adjusting your search or filter settings</span>
                        </p>
                    </div>
                );
            }

            return (
                <div className="space-y-6">
                    {categoriesToShow.map(category => {
                        const filteredCredits = category.credits.filter(filterCredits);

                        if (filteredCredits.length === 0) return null;

                        return (
                            <div key={category.id} className="bg-white rounded-lg p-5 border border-line">
                                <div className="flex items-center justify-between mb-4 pb-3 border-b border-line">
                                    <div className="flex items-center gap-3">
                                        <span className={category.colorClasses.text}><CategoryIcon category={category.id} size={28} /></span>
                                        <div>
                                            <h2 className="font-display text-lg font-bold text-ink">{category.name}</h2>
                                            <p className="text-sm text-ink-3">{category.description}</p>
                                        </div>
                                    </div>
                                    <div className="bg-surface-1 px-3 py-1.5 rounded-lg border border-line">
                                        <span className="font-mono font-bold text-ink">{filteredCredits.length}</span>
                                        <span className="text-sm text-ink-3 ml-1">credits</span>
                                    </div>
                                </div>

                                <div className="space-y-2">
                                    {filteredCredits.map((credit, index) => {
                                        const creditKey = `${category.id}-${credit.id}`;
                                        const selection = selectedCredits[creditKey];
                                        const selectedLevel = selection ? selection.level : null;

                                        return (
                                            <div key={credit.id} className="fade-in" style={{ animationDelay: `${index * 30}ms` }}>
                                                <CreditCard
                                                    credit={credit}
                                                    categoryId={category.id}
                                                    selectedLevel={selectedLevel}
                                                    onSelectLevel={(level, points) => onSelectCreditLevel(creditKey, level, points)}
                                                    onViewDetails={() => onViewCreditDetails(credit, category)}
                                                    colorClasses={category.colorClasses}
                                                />
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        }

        // Timeline View Component - Visual timeline of credits by project phase
        function TimelineView({ categories, selectedCredits, onViewCreditDetails, projectPhases }) {
            // Group all credits by their first project phase
            const creditsByPhase = {};
            projectPhases.forEach(phase => {
                creditsByPhase[phase.id] = [];
            });

            categories.forEach(category => {
                category.credits.forEach(credit => {
                    if (credit.projectPhases && credit.projectPhases.length > 0) {
                        const primaryPhase = credit.projectPhases[0];
                        if (creditsByPhase[primaryPhase]) {
                            creditsByPhase[primaryPhase].push({ credit, category });
                        }
                    }
                });
            });

            return (
                <div className="glass-card rounded-2xl p-6 shadow-lg dark:bg-gray-800/80">
                    <div className="flex items-center gap-3 mb-6">
                        <i className="fa-solid fa-timeline text-2xl text-purple-500"></i>
                        <div>
                            <h2 className="font-display text-xl font-bold text-ink dark:text-white">Project Timeline</h2>
                            <p className="text-sm text-ink-2 dark:text-ink-3">Credits organized by primary project phase</p>
                        </div>
                    </div>

                    <div className="overflow-x-auto">
                        <div className="flex gap-4 pb-4" style={{ minWidth: 'max-content' }}>
                            {projectPhases.map((phase, phaseIndex) => (
                                <div key={phase.id} className="timeline-phase w-64 flex-shrink-0">
                                    <div className="flex items-center gap-2 mb-3">
                                        <div className={`w-8 h-8 rounded-full bg-purple-${100 + phaseIndex * 100} flex items-center justify-center`}>
                                            <i className={`fa-solid ${phase.icon} text-purple-600 text-sm`}></i>
                                        </div>
                                        <div>
                                            <h3 className="font-semibold text-ink dark:text-white text-sm">{phase.name}</h3>
                                            <span className="text-xs text-ink-2">{creditsByPhase[phase.id].length} credits</span>
                                        </div>
                                    </div>

                                    <div className="relative pl-4 border-l-2 border-purple-200 dark:border-purple-800 space-y-2">
                                        {creditsByPhase[phase.id].map(({ credit, category }) => {
                                            const creditKey = `${category.id}-${credit.id}`;
                                            const isSelected = !!selectedCredits[creditKey];

                                            return (
                                                <div
                                                    key={credit.id}
                                                    onClick={() => onViewCreditDetails(credit, category)}
                                                    className={`timeline-credit p-3 rounded-lg border cursor-pointer
                                                        ${isSelected
                                                            ? 'bg-green-50 border-green-300 dark:bg-green-900/30 dark:border-green-700'
                                                            : 'bg-white border-line hover:border-purple-300 dark:bg-gray-700 dark:border-gray-600'
                                                        }`}
                                                >
                                                    <div className="flex items-center gap-2 mb-1">
                                                        <span className={category.colorClasses?.text || 'text-ink-3'}><CategoryIcon category={category.id} size={20} /></span>
                                                        <span className={`text-xs px-1.5 py-0.5 rounded ${
                                                            credit.difficulty === 'Easy' ? 'bg-green-100 text-green-600 dark:bg-green-900/50' :
                                                            credit.difficulty === 'Medium' ? 'bg-yellow-100 text-yellow-600 dark:bg-yellow-900/50' :
                                                            'bg-red-100 text-red-600 dark:bg-red-900/50'
                                                        }`}>
                                                            {credit.difficulty}
                                                        </span>
                                                    </div>
                                                    <h4 className="font-medium text-sm text-ink dark:text-white">{credit.name}</h4>
                                                    <div className="flex items-center justify-between mt-1">
                                                        <span className="text-xs text-ink-2">{credit.points} pts</span>
                                                        {isSelected && <i className="fa-solid fa-check text-green-500 text-xs"></i>}
                                                    </div>
                                                </div>
                                            );
                                        })}

                                        {creditsByPhase[phase.id].length === 0 && (
                                            <p className="text-xs text-ink-3 italic py-2">No credits in this phase</p>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Responsibility Matrix Component - Assign credits to team members
        function ResponsibilityMatrix({ categories, selectedCredits, creditAssignments, onAssignmentChange, onViewCreditDetails }) {
            const teamRoles = [
                { id: 'architect', name: 'Architect', icon: 'fa-compass-drafting', color: 'blue' },
                { id: 'services', name: 'Services Engineer', icon: 'fa-gears', color: 'orange' },
                { id: 'structural', name: 'Structural Engineer', icon: 'fa-building', color: 'purple' },
                { id: 'sustainability', name: 'Sustainability', icon: 'fa-leaf', color: 'green' },
                { id: 'contractor', name: 'Contractor', icon: 'fa-helmet-safety', color: 'yellow' },
                { id: 'client', name: 'Client', icon: 'fa-user-tie', color: 'gray' }
            ];

            // Get all selected credits
            const selectedCreditsList = [];
            categories.forEach(category => {
                category.credits.forEach(credit => {
                    const creditKey = `${category.id}-${credit.id}`;
                    if (selectedCredits[creditKey]) {
                        selectedCreditsList.push({ credit, category, creditKey });
                    }
                });
            });

            return (
                <div className="glass-card rounded-2xl p-6 shadow-lg dark:bg-gray-800/80">
                    <div className="flex items-center gap-3 mb-6">
                        <i className="fa-solid fa-table-cells text-2xl text-blue-500"></i>
                        <div>
                            <h2 className="font-display text-xl font-bold text-ink dark:text-white">Responsibility Matrix</h2>
                            <p className="text-sm text-ink-2 dark:text-ink-3">Assign team responsibilities for selected credits</p>
                        </div>
                    </div>

                    {selectedCreditsList.length === 0 ? (
                        <div className="text-center py-12">
                            <i className="fa-solid fa-clipboard-list text-4xl text-ink-3 dark:text-gray-500 mb-3"></i>
                            <p className="text-ink-2">No credits selected yet</p>
                            <p className="text-sm text-ink-3">Select credits from the Credits view to assign responsibilities</p>
                        </div>
                    ) : (
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead>
                                    <tr className="border-b border-line dark:border-gray-700">
                                        <th className="text-left py-3 px-4 font-semibold text-ink dark:text-gray-300">Credit</th>
                                        {teamRoles.map(role => (
                                            <th key={role.id} className="text-center py-3 px-2 font-semibold text-ink dark:text-gray-300">
                                                <div className="flex flex-col items-center gap-1">
                                                    <i className={`fa-solid ${role.icon} text-${role.color}-500`}></i>
                                                    <span className="text-xs">{role.name}</span>
                                                </div>
                                            </th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody>
                                    {selectedCreditsList.map(({ credit, category, creditKey }) => (
                                        <tr key={creditKey} className="border-b border-gray-100 dark:border-gray-700 hover:bg-surface-2 dark:hover:bg-gray-700/50">
                                            <td className="py-3 px-4">
                                                <button
                                                    onClick={() => onViewCreditDetails(credit, category)}
                                                    className="flex items-center gap-2 hover:text-green-600 transition-colors text-left"
                                                >
                                                    <span className={category.colorClasses?.text || 'text-ink-3'}><CategoryIcon category={category.id} size={20} /></span>
                                                    <div>
                                                        <div className="font-medium text-ink dark:text-white text-sm">{credit.name}</div>
                                                        <div className="text-xs text-ink-2">{category.name}</div>
                                                    </div>
                                                </button>
                                            </td>
                                            {teamRoles.map(role => {
                                                const assignment = creditAssignments[creditKey] || {};
                                                const isAssigned = assignment[role.id];

                                                return (
                                                    <td key={role.id} className="text-center py-3 px-2">
                                                        <button
                                                            onClick={() => {
                                                                const newAssignment = { ...assignment, [role.id]: !isAssigned };
                                                                onAssignmentChange(creditKey, newAssignment);
                                                            }}
                                                            className={`w-8 h-8 rounded-lg transition-all
                                                                ${isAssigned
                                                                    ? `bg-${role.color}-100 border-2 border-${role.color}-500 text-${role.color}-600`
                                                                    : 'bg-gray-100 border-2 border-transparent text-ink-3 hover:border-gray-300 dark:bg-gray-700 dark:text-gray-400'
                                                                }`}
                                                        >
                                                            <i className={`fa-solid ${isAssigned ? 'fa-check' : 'fa-plus'} text-sm`}></i>
                                                        </button>
                                                    </td>
                                                );
                                            })}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}

                    {/* Legend */}
                    <div className="mt-6 pt-4 border-t border-line dark:border-gray-700">
                        <p className="text-xs text-ink-2 mb-2">Team Roles:</p>
                        <div className="flex flex-wrap gap-3">
                            {teamRoles.map(role => (
                                <div key={role.id} className="flex items-center gap-1.5 text-xs text-ink-2 dark:text-ink-3">
                                    <i className={`fa-solid ${role.icon} text-${role.color}-500`}></i>
                                    <span>{role.name}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Documentation View Component - Shows required documentation for selected credits
        function DocumentationView({ categories, selectedCredits, creditDocs, onDocsChange, onViewCreditDetails }) {
            // Get all selected credits with their documentation
            const selectedCreditsList = [];
            categories.forEach(category => {
                category.credits.forEach(credit => {
                    const creditKey = `${category.id}-${credit.id}`;
                    if (selectedCredits[creditKey] && credit.documentation && credit.documentation.length > 0) {
                        selectedCreditsList.push({ credit, category, creditKey });
                    }
                });
            });

            // Calculate overall progress
            const totalDocs = selectedCreditsList.reduce((sum, { credit }) => sum + credit.documentation.length, 0);
            const completedDocs = selectedCreditsList.reduce((sum, { creditKey, credit }) => {
                const docs = creditDocs[creditKey] || {};
                return sum + credit.documentation.filter((_, idx) => docs[idx]).length;
            }, 0);

            const handleDocToggle = (creditKey, docIndex) => {
                const currentDocs = creditDocs[creditKey] || {};
                const newDocs = { ...currentDocs, [docIndex]: !currentDocs[docIndex] };
                onDocsChange(creditKey, newDocs);
            };

            return (
                <div className="glass-card rounded-2xl p-6 shadow-lg dark:bg-gray-800/80">
                    <div className="flex items-center justify-between mb-6">
                        <div className="flex items-center gap-3">
                            <i className="fa-solid fa-file-lines text-2xl text-purple-500"></i>
                            <div>
                                <h2 className="font-display text-xl font-bold text-ink dark:text-white">Documentation Checklist</h2>
                                <p className="text-sm text-ink-2 dark:text-ink-3">Track required documentation for your selected credits</p>
                            </div>
                        </div>
                        {totalDocs > 0 && (
                            <div className="text-right">
                                <div className="text-2xl font-bold text-purple-600 dark:text-purple-400">
                                    {Math.round((completedDocs / totalDocs) * 100)}%
                                </div>
                                <div className="text-xs text-ink-2">{completedDocs} of {totalDocs} complete</div>
                            </div>
                        )}
                    </div>

                    {/* Overall Progress Bar */}
                    {totalDocs > 0 && (
                        <div className="mb-6">
                            <div className="w-full h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                <div
                                    className="h-full bg-gradient-to-r from-purple-400 to-purple-600 transition-all duration-500"
                                    style={{ width: `${(completedDocs / totalDocs) * 100}%` }}
                                ></div>
                            </div>
                        </div>
                    )}

                    {selectedCreditsList.length === 0 ? (
                        <div className="text-center py-12">
                            <i className="fa-solid fa-folder-open text-4xl text-ink-3 dark:text-gray-500 mb-3"></i>
                            <p className="text-ink-2">No credits selected yet</p>
                            <p className="text-sm text-ink-3">Select credits from the Credits view to see required documentation</p>
                        </div>
                    ) : (
                        <div className="space-y-6">
                            {selectedCreditsList.map(({ credit, category, creditKey }) => {
                                const docs = creditDocs[creditKey] || {};
                                const creditCompleted = credit.documentation.filter((_, idx) => docs[idx]).length;
                                const creditTotal = credit.documentation.length;
                                const isComplete = creditCompleted === creditTotal;

                                return (
                                    <div key={creditKey} className={`rounded-xl border-2 overflow-hidden transition-all ${isComplete ? 'border-green-300 bg-green-50/50 dark:border-green-700 dark:bg-green-900/20' : 'border-line dark:border-gray-700'}`}>
                                        {/* Credit Header */}
                                        <div
                                            className={`p-4 cursor-pointer hover:bg-surface-2 dark:hover:bg-gray-700/50 transition-colors ${isComplete ? 'bg-green-50 dark:bg-green-900/30' : 'bg-surface-2 dark:bg-gray-800'}`}
                                            onClick={() => onViewCreditDetails(credit, category)}
                                        >
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center gap-3">
                                                    <span className={category.colorClasses?.text || 'text-ink-3'}><CategoryIcon category={category.id} size={24} /></span>
                                                    <div>
                                                        <h3 className="font-semibold text-ink dark:text-white">{credit.name}</h3>
                                                        <p className="text-xs text-ink-2">{category.name}</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className={`text-sm font-medium ${isComplete ? 'text-green-600 dark:text-green-400' : 'text-ink-2'}`}>
                                                        {creditCompleted}/{creditTotal}
                                                    </span>
                                                    {isComplete && <i className="fa-solid fa-circle-check text-green-500 text-xl"></i>}
                                                </div>
                                            </div>
                                            {/* Mini progress bar */}
                                            <div className="mt-2 w-full h-1.5 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden">
                                                <div
                                                    className={`h-full transition-all ${isComplete ? 'bg-green-500' : 'bg-purple-500'}`}
                                                    style={{ width: `${(creditCompleted / creditTotal) * 100}%` }}
                                                ></div>
                                            </div>
                                        </div>

                                        {/* Documentation Items */}
                                        <div className="p-4 pt-2 space-y-2">
                                            {credit.documentation.map((doc, idx) => {
                                                const isChecked = docs[idx];
                                                return (
                                                    <div
                                                        key={idx}
                                                        onClick={() => handleDocToggle(creditKey, idx)}
                                                        className={`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all
                                                            ${isChecked
                                                                ? 'bg-green-100 dark:bg-green-900/40'
                                                                : 'bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600'
                                                            }`}
                                                    >
                                                        <div className={`w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 transition-all
                                                            ${isChecked
                                                                ? 'bg-green-500 border-green-500'
                                                                : 'border-gray-300 dark:border-gray-500'
                                                            }`}
                                                        >
                                                            {isChecked && <i className="fa-solid fa-check text-white text-xs"></i>}
                                                        </div>
                                                        <span className={`text-sm ${isChecked ? 'text-green-700 dark:text-green-300 line-through' : 'text-ink dark:text-gray-300'}`}>
                                                            {doc}
                                                        </span>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}
                </div>
            );
        }

        // Individual Calculator Forms
        function ResponsibleProductsCalculator({ savedResult, onSave }) {
            const [products, setProducts] = useState(savedResult?.products || [
                { name: '', category: 'structure', hasEPD: false, isResponsible: false, value: 0 }
            ]);

            const addProduct = () => {
                setProducts([...products, { name: '', category: 'structure', hasEPD: false, isResponsible: false, value: 0 }]);
            };

            const updateProduct = (index, field, value) => {
                const newProducts = [...products];
                newProducts[index] = { ...newProducts[index], [field]: value };
                setProducts(newProducts);
            };

            const removeProduct = (index) => {
                setProducts(products.filter((_, i) => i !== index));
            };

            const totalValue = products.reduce((sum, p) => sum + (parseFloat(p.value) || 0), 0);
            const responsibleValue = products.filter(p => p.isResponsible).reduce((sum, p) => sum + (parseFloat(p.value) || 0), 0);
            const percentage = totalValue > 0 ? ((responsibleValue / totalValue) * 100).toFixed(1) : 0;

            const getLevel = () => {
                if (percentage >= 90) return { level: 'Exceptional', points: 3, color: 'text-green-600' };
                if (percentage >= 60) return { level: 'Credit', points: 2, color: 'text-blue-600' };
                if (percentage >= 30) return { level: 'Minimum', points: 0, color: 'text-gray-600' };
                return { level: 'Below Minimum', points: 0, color: 'text-red-600' };
            };

            const result = getLevel();

            return (
                <div className="space-y-4">
                    <div className="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-4 border border-green-200 dark:border-green-800">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm text-green-700 dark:text-green-300 font-medium">Responsible Products Percentage</p>
                                <p className="text-3xl font-bold text-green-600">{percentage}%</p>
                            </div>
                            <div className="text-right">
                                <p className={`font-semibold ${result.color}`}>{result.level}</p>
                                <p className="text-sm text-ink-2">{result.points} points achievable</p>
                            </div>
                        </div>
                        <div className="mt-3 h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div className="h-full bg-gradient-to-r from-green-500 to-emerald-500 transition-all" style={{ width: `${Math.min(percentage, 100)}%` }}></div>
                        </div>
                        <div className="flex justify-between text-xs text-ink-3 mt-1">
                            <span>0%</span>
                            <span>30% Min</span>
                            <span>60% Credit</span>
                            <span>90% Exceptional</span>
                        </div>
                    </div>

                    <div className="space-y-2">
                        <div className="flex items-center justify-between">
                            <h4 className="font-medium text-ink dark:text-white">Products List</h4>
                            <button onClick={addProduct} className="text-sm text-green-600 hover:text-green-700 font-medium flex items-center gap-1">
                                <i className="fa-solid fa-plus"></i> Add Product
                            </button>
                        </div>

                        {products.map((product, index) => (
                            <div key={index} className="bg-surface-1 dark:bg-gray-800 rounded-lg p-3 border border-line dark:border-gray-700">
                                <div className="grid grid-cols-12 gap-2 items-center">
                                    <input
                                        type="text"
                                        placeholder="Product name"
                                        value={product.name}
                                        onChange={(e) => updateProduct(index, 'name', e.target.value)}
                                        className="col-span-4 px-2 py-1.5 text-sm border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                                    />
                                    <select
                                        value={product.category}
                                        onChange={(e) => updateProduct(index, 'category', e.target.value)}
                                        className="col-span-2 px-2 py-1.5 text-sm border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                                    >
                                        <option value="structure">Structure</option>
                                        <option value="envelope">Envelope</option>
                                        <option value="systems">Systems</option>
                                        <option value="fitout">Fitout</option>
                                    </select>
                                    <input
                                        type="number"
                                        placeholder="Value ($)"
                                        value={product.value}
                                        onChange={(e) => updateProduct(index, 'value', e.target.value)}
                                        className="col-span-2 px-2 py-1.5 text-sm border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                                    />
                                    <label className="col-span-2 flex items-center gap-1 text-xs">
                                        <input
                                            type="checkbox"
                                            checked={product.isResponsible}
                                            onChange={(e) => updateProduct(index, 'isResponsible', e.target.checked)}
                                            className="rounded"
                                        />
                                        <span className="text-ink-2 dark:text-gray-400">Responsible</span>
                                    </label>
                                    <button onClick={() => removeProduct(index)} className="col-span-2 text-red-500 hover:text-red-600 text-sm">
                                        <i className="fa-solid fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className="flex justify-between items-center pt-4 border-t border-line dark:border-gray-700">
                        <div className="text-sm text-ink-2">
                            Total: ${totalValue.toLocaleString()} | Responsible: ${responsibleValue.toLocaleString()}
                        </div>
                        <button
                            onClick={() => onSave({ products, percentage, result })}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm"
                        >
                            <i className="fa-solid fa-save mr-2"></i>Save Results
                        </button>
                    </div>
                </div>
            );
        }

        function EnergyUseCalculator({ savedResult, onSave }) {
            const [referenceEnergy, setReferenceEnergy] = useState(savedResult?.referenceEnergy || 150);
            const [proposedEnergy, setProposedEnergy] = useState(savedResult?.proposedEnergy || 120);
            const [buildingArea, setBuildingArea] = useState(savedResult?.buildingArea || 5000);
            const [renewableEnergy, setRenewableEnergy] = useState(savedResult?.renewableEnergy || 20);

            const reduction = referenceEnergy > 0 ? (((referenceEnergy - proposedEnergy) / referenceEnergy) * 100).toFixed(1) : 0;
            const netEnergy = Math.max(0, proposedEnergy - renewableEnergy);
            const netReduction = referenceEnergy > 0 ? (((referenceEnergy - netEnergy) / referenceEnergy) * 100).toFixed(1) : 0;

            const getLevel = () => {
                const red = parseFloat(netReduction);
                if (red >= 60) return { level: 'Exceptional', points: 20, color: 'text-green-600' };
                if (red >= 40) return { level: 'Credit (High)', points: 15, color: 'text-blue-600' };
                if (red >= 20) return { level: 'Credit', points: 10, color: 'text-blue-500' };
                if (red >= 10) return { level: 'Minimum', points: 0, color: 'text-gray-600' };
                return { level: 'Below Minimum', points: 0, color: 'text-red-600' };
            };

            const result = getLevel();
            const annualSavings = (referenceEnergy - netEnergy) * buildingArea;

            return (
                <div className="space-y-4">
                    <div className="bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 rounded-xl p-4 border border-amber-200 dark:border-amber-800">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm text-amber-700 dark:text-amber-300 font-medium">Net Energy Reduction</p>
                                <p className="text-3xl font-bold text-amber-600">{netReduction}%</p>
                            </div>
                            <div className="text-right">
                                <p className={`font-semibold ${result.color}`}>{result.level}</p>
                                <p className="text-sm text-ink-2">{result.points} points achievable</p>
                            </div>
                        </div>
                        <div className="mt-3 grid grid-cols-2 gap-4 text-sm">
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Annual Savings</p>
                                <p className="font-bold text-ink dark:text-white">{annualSavings.toLocaleString()} kWh/year</p>
                            </div>
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Net Energy Use</p>
                                <p className="font-bold text-ink dark:text-white">{netEnergy} kWh/mÂ²/year</p>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Reference Building Energy (kWh/mÂ²/yr)</label>
                            <input
                                type="number"
                                value={referenceEnergy}
                                onChange={(e) => setReferenceEnergy(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Proposed Building Energy (kWh/mÂ²/yr)</label>
                            <input
                                type="number"
                                value={proposedEnergy}
                                onChange={(e) => setProposedEnergy(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Building Area (mÂ²)</label>
                            <input
                                type="number"
                                value={buildingArea}
                                onChange={(e) => setBuildingArea(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">On-site Renewables (kWh/mÂ²/yr)</label>
                            <input
                                type="number"
                                value={renewableEnergy}
                                onChange={(e) => setRenewableEnergy(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                    </div>

                    <div className="flex justify-end pt-4 border-t border-line dark:border-gray-700">
                        <button
                            onClick={() => onSave({ referenceEnergy, proposedEnergy, buildingArea, renewableEnergy, netReduction, result })}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm"
                        >
                            <i className="fa-solid fa-save mr-2"></i>Save Results
                        </button>
                    </div>
                </div>
            );
        }

        function UpfrontCarbonCalculator({ savedResult, onSave }) {
            const [buildingArea, setBuildingArea] = useState(savedResult?.buildingArea || 5000);
            const [structureCarbon, setStructureCarbon] = useState(savedResult?.structureCarbon || 400);
            const [envelopeCarbon, setEnvelopeCarbon] = useState(savedResult?.envelopeCarbon || 80);
            const [systemsCarbon, setSystemsCarbon] = useState(savedResult?.systemsCarbon || 50);
            const [fitoutCarbon, setFitoutCarbon] = useState(savedResult?.fitoutCarbon || 30);
            const [benchmark, setBenchmark] = useState(savedResult?.benchmark || 700);

            const totalCarbon = structureCarbon + envelopeCarbon + systemsCarbon + fitoutCarbon;
            const reduction = benchmark > 0 ? (((benchmark - totalCarbon) / benchmark) * 100).toFixed(1) : 0;
            const totalEmissions = totalCarbon * buildingArea;

            const getLevel = () => {
                const red = parseFloat(reduction);
                if (red >= 40) return { level: 'Exceptional', points: 3, color: 'text-green-600' };
                if (red >= 20) return { level: 'Credit', points: 2, color: 'text-blue-600' };
                if (red >= 10) return { level: 'Minimum', points: 0, color: 'text-gray-600' };
                return { level: 'Below Minimum', points: 0, color: 'text-red-600' };
            };

            const result = getLevel();

            return (
                <div className="space-y-4">
                    <div className="bg-gradient-to-r from-slate-50 to-gray-50 dark:from-slate-900/20 dark:to-gray-900/20 rounded-xl p-4 border border-slate-200 dark:border-slate-800">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm text-slate-700 dark:text-slate-300 font-medium">Carbon Reduction vs Benchmark</p>
                                <p className="text-3xl font-bold text-slate-600">{reduction}%</p>
                            </div>
                            <div className="text-right">
                                <p className={`font-semibold ${result.color}`}>{result.level}</p>
                                <p className="text-sm text-ink-2">{result.points} points achievable</p>
                            </div>
                        </div>
                        <div className="mt-3 grid grid-cols-2 gap-4 text-sm">
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Total Upfront Carbon</p>
                                <p className="font-bold text-ink dark:text-white">{totalCarbon} kgCOâ‚‚e/mÂ²</p>
                            </div>
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Total Emissions</p>
                                <p className="font-bold text-ink dark:text-white">{(totalEmissions / 1000).toFixed(0)} tCOâ‚‚e</p>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Building Area (mÂ²)</label>
                            <input
                                type="number"
                                value={buildingArea}
                                onChange={(e) => setBuildingArea(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Benchmark (kgCOâ‚‚e/mÂ²)</label>
                            <input
                                type="number"
                                value={benchmark}
                                onChange={(e) => setBenchmark(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                    </div>

                    <div className="space-y-3">
                        <h4 className="font-medium text-ink dark:text-white">Embodied Carbon by Category</h4>
                        {[
                            { label: 'Structure (A1-A3)', value: structureCarbon, setter: setStructureCarbon, color: 'bg-blue-500' },
                            { label: 'Envelope (A1-A3)', value: envelopeCarbon, setter: setEnvelopeCarbon, color: 'bg-green-500' },
                            { label: 'Systems (A1-A3)', value: systemsCarbon, setter: setSystemsCarbon, color: 'bg-amber-500' },
                            { label: 'Fitout (A1-A3)', value: fitoutCarbon, setter: setFitoutCarbon, color: 'bg-purple-500' }
                        ].map((item, idx) => (
                            <div key={idx} className="flex items-center gap-3">
                                <div className={`w-3 h-3 rounded-full ${item.color}`}></div>
                                <span className="text-sm text-ink dark:text-white w-32">{item.label}</span>
                                <input
                                    type="number"
                                    value={item.value}
                                    onChange={(e) => item.setter(parseFloat(e.target.value) || 0)}
                                    className="flex-grow px-3 py-1.5 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white text-sm"
                                />
                                <span className="text-sm text-ink-2 w-24">kgCOâ‚‚e/mÂ²</span>
                            </div>
                        ))}
                    </div>

                    <div className="flex justify-end pt-4 border-t border-line dark:border-gray-700">
                        <button
                            onClick={() => onSave({ buildingArea, structureCarbon, envelopeCarbon, systemsCarbon, fitoutCarbon, benchmark, totalCarbon, reduction, result })}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm"
                        >
                            <i className="fa-solid fa-save mr-2"></i>Save Results
                        </button>
                    </div>
                </div>
            );
        }

        function CarbonCompensationCalculator({ savedResult, onSave }) {
            const [totalEmissions, setTotalEmissions] = useState(savedResult?.totalEmissions || 2500);
            const [reductionAchieved, setReductionAchieved] = useState(savedResult?.reductionAchieved || 800);
            const [offsetPercentage, setOffsetPercentage] = useState(savedResult?.offsetPercentage || 100);

            const residualEmissions = Math.max(0, totalEmissions - reductionAchieved);
            const offsetRequired = (residualEmissions * offsetPercentage) / 100;
            const offsetCost = offsetRequired * 25; // Assume $25/tCO2e

            const getLevel = () => {
                if (offsetPercentage >= 100) return { level: 'Exceptional', points: 2, color: 'text-green-600' };
                if (offsetPercentage >= 50) return { level: 'Credit', points: 1, color: 'text-blue-600' };
                return { level: 'Below Minimum', points: 0, color: 'text-red-600' };
            };

            const result = getLevel();

            return (
                <div className="space-y-4">
                    <div className="bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-emerald-900/20 dark:to-teal-900/20 rounded-xl p-4 border border-emerald-200 dark:border-emerald-800">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm text-emerald-700 dark:text-emerald-300 font-medium">Offset Coverage</p>
                                <p className="text-3xl font-bold text-emerald-600">{offsetPercentage}%</p>
                            </div>
                            <div className="text-right">
                                <p className={`font-semibold ${result.color}`}>{result.level}</p>
                                <p className="text-sm text-ink-2">{result.points} points achievable</p>
                            </div>
                        </div>
                        <div className="mt-3 grid grid-cols-3 gap-4 text-sm">
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Residual Emissions</p>
                                <p className="font-bold text-ink dark:text-white">{residualEmissions.toLocaleString()} tCOâ‚‚e</p>
                            </div>
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Offsets Required</p>
                                <p className="font-bold text-ink dark:text-white">{offsetRequired.toLocaleString()} tCOâ‚‚e</p>
                            </div>
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Est. Cost (@$25/t)</p>
                                <p className="font-bold text-ink dark:text-white">${offsetCost.toLocaleString()}</p>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-3 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Total Upfront Emissions (tCOâ‚‚e)</label>
                            <input
                                type="number"
                                value={totalEmissions}
                                onChange={(e) => setTotalEmissions(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Reduction Achieved (tCOâ‚‚e)</label>
                            <input
                                type="number"
                                value={reductionAchieved}
                                onChange={(e) => setReductionAchieved(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Offset Percentage (%)</label>
                            <input
                                type="number"
                                value={offsetPercentage}
                                onChange={(e) => setOffsetPercentage(Math.min(100, Math.max(0, parseFloat(e.target.value) || 0)))}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                    </div>

                    <div className="flex justify-end pt-4 border-t border-line dark:border-gray-700">
                        <button
                            onClick={() => onSave({ totalEmissions, reductionAchieved, offsetPercentage, residualEmissions, offsetRequired, result })}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm"
                        >
                            <i className="fa-solid fa-save mr-2"></i>Save Results
                        </button>
                    </div>
                </div>
            );
        }

        function WaterUseCalculator({ savedResult, onSave }) {
            const [benchmarkWater, setBenchmarkWater] = useState(savedResult?.benchmarkWater || 12);
            const [proposedWater, setProposedWater] = useState(savedResult?.proposedWater || 8);
            const [rainwaterCapture, setRainwaterCapture] = useState(savedResult?.rainwaterCapture || 2);
            const [recycledWater, setRecycledWater] = useState(savedResult?.recycledWater || 1);
            const [occupants, setOccupants] = useState(savedResult?.occupants || 200);

            const netWater = Math.max(0, proposedWater - rainwaterCapture - recycledWater);
            const reduction = benchmarkWater > 0 ? (((benchmarkWater - netWater) / benchmarkWater) * 100).toFixed(1) : 0;
            const annualSavings = (benchmarkWater - netWater) * occupants * 260; // 260 working days

            const getLevel = () => {
                const red = parseFloat(reduction);
                if (red >= 50) return { level: 'Exceptional', points: 3, color: 'text-green-600' };
                if (red >= 30) return { level: 'Credit', points: 2, color: 'text-blue-600' };
                if (red >= 15) return { level: 'Minimum', points: 0, color: 'text-gray-600' };
                return { level: 'Below Minimum', points: 0, color: 'text-red-600' };
            };

            const result = getLevel();

            return (
                <div className="space-y-4">
                    <div className="bg-gradient-to-r from-cyan-50 to-blue-50 dark:from-cyan-900/20 dark:to-blue-900/20 rounded-xl p-4 border border-cyan-200 dark:border-cyan-800">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm text-cyan-700 dark:text-cyan-300 font-medium">Water Use Reduction</p>
                                <p className="text-3xl font-bold text-cyan-600">{reduction}%</p>
                            </div>
                            <div className="text-right">
                                <p className={`font-semibold ${result.color}`}>{result.level}</p>
                                <p className="text-sm text-ink-2">{result.points} points achievable</p>
                            </div>
                        </div>
                        <div className="mt-3 grid grid-cols-2 gap-4 text-sm">
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Net Water Use</p>
                                <p className="font-bold text-ink dark:text-white">{netWater.toFixed(1)} L/person/day</p>
                            </div>
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Annual Savings</p>
                                <p className="font-bold text-ink dark:text-white">{(annualSavings / 1000).toFixed(0)} kL/year</p>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Benchmark Water Use (L/person/day)</label>
                            <input
                                type="number"
                                value={benchmarkWater}
                                onChange={(e) => setBenchmarkWater(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Proposed Water Use (L/person/day)</label>
                            <input
                                type="number"
                                value={proposedWater}
                                onChange={(e) => setProposedWater(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Rainwater Capture (L/person/day)</label>
                            <input
                                type="number"
                                value={rainwaterCapture}
                                onChange={(e) => setRainwaterCapture(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Recycled Water (L/person/day)</label>
                            <input
                                type="number"
                                value={recycledWater}
                                onChange={(e) => setRecycledWater(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div className="col-span-2">
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Number of Occupants</label>
                            <input
                                type="number"
                                value={occupants}
                                onChange={(e) => setOccupants(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                    </div>

                    <div className="flex justify-end pt-4 border-t border-line dark:border-gray-700">
                        <button
                            onClick={() => onSave({ benchmarkWater, proposedWater, rainwaterCapture, recycledWater, occupants, netWater, reduction, result })}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm"
                        >
                            <i className="fa-solid fa-save mr-2"></i>Save Results
                        </button>
                    </div>
                </div>
            );
        }

        function RefrigerantCalculator({ savedResult, onSave }) {
            const [systems, setSystems] = useState(savedResult?.systems || [
                { name: 'Main HVAC', refrigerant: 'R-410A', charge: 50, gwp: 2088 }
            ]);

            const refrigerantOptions = [
                { name: 'R-410A', gwp: 2088 },
                { name: 'R-32', gwp: 675 },
                { name: 'R-1234yf', gwp: 4 },
                { name: 'R-1234ze', gwp: 7 },
                { name: 'R-290 (Propane)', gwp: 3 },
                { name: 'R-744 (CO2)', gwp: 1 },
                { name: 'R-717 (Ammonia)', gwp: 0 }
            ];

            const addSystem = () => {
                setSystems([...systems, { name: '', refrigerant: 'R-410A', charge: 0, gwp: 2088 }]);
            };

            const updateSystem = (index, field, value) => {
                const newSystems = [...systems];
                if (field === 'refrigerant') {
                    const ref = refrigerantOptions.find(r => r.name === value);
                    newSystems[index] = { ...newSystems[index], refrigerant: value, gwp: ref?.gwp || 0 };
                } else {
                    newSystems[index] = { ...newSystems[index], [field]: value };
                }
                setSystems(newSystems);
            };

            const removeSystem = (index) => {
                setSystems(systems.filter((_, i) => i !== index));
            };

            const totalCharge = systems.reduce((sum, s) => sum + (parseFloat(s.charge) || 0), 0);
            const weightedGWP = totalCharge > 0 ? systems.reduce((sum, s) => sum + ((parseFloat(s.charge) || 0) * s.gwp), 0) / totalCharge : 0;

            const getLevel = () => {
                if (weightedGWP <= 10) return { level: 'Exceptional', points: 1, color: 'text-green-600' };
                if (weightedGWP <= 750) return { level: 'Credit', points: 1, color: 'text-blue-600' };
                if (weightedGWP <= 1500) return { level: 'Minimum', points: 0, color: 'text-gray-600' };
                return { level: 'Below Minimum', points: 0, color: 'text-red-600' };
            };

            const result = getLevel();

            return (
                <div className="space-y-4">
                    <div className="bg-gradient-to-r from-sky-50 to-indigo-50 dark:from-sky-900/20 dark:to-indigo-900/20 rounded-xl p-4 border border-sky-200 dark:border-sky-800">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm text-sky-700 dark:text-sky-300 font-medium">Weighted Average GWP</p>
                                <p className="text-3xl font-bold text-sky-600">{weightedGWP.toFixed(0)}</p>
                            </div>
                            <div className="text-right">
                                <p className={`font-semibold ${result.color}`}>{result.level}</p>
                                <p className="text-sm text-ink-2">{result.points} points achievable</p>
                            </div>
                        </div>
                        <div className="mt-3 text-sm bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                            <p className="text-ink-3">Total Refrigerant Charge: <span className="font-bold text-ink dark:text-white">{totalCharge} kg</span></p>
                        </div>
                    </div>

                    <div className="space-y-2">
                        <div className="flex items-center justify-between">
                            <h4 className="font-medium text-ink dark:text-white">Refrigerant Systems</h4>
                            <button onClick={addSystem} className="text-sm text-green-600 hover:text-green-700 font-medium flex items-center gap-1">
                                <i className="fa-solid fa-plus"></i> Add System
                            </button>
                        </div>

                        {systems.map((system, index) => (
                            <div key={index} className="bg-surface-1 dark:bg-gray-800 rounded-lg p-3 border border-line dark:border-gray-700">
                                <div className="grid grid-cols-12 gap-2 items-center">
                                    <input
                                        type="text"
                                        placeholder="System name"
                                        value={system.name}
                                        onChange={(e) => updateSystem(index, 'name', e.target.value)}
                                        className="col-span-4 px-2 py-1.5 text-sm border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                                    />
                                    <select
                                        value={system.refrigerant}
                                        onChange={(e) => updateSystem(index, 'refrigerant', e.target.value)}
                                        className="col-span-3 px-2 py-1.5 text-sm border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                                    >
                                        {refrigerantOptions.map(r => (
                                            <option key={r.name} value={r.name}>{r.name} (GWP: {r.gwp})</option>
                                        ))}
                                    </select>
                                    <input
                                        type="number"
                                        placeholder="Charge (kg)"
                                        value={system.charge}
                                        onChange={(e) => updateSystem(index, 'charge', e.target.value)}
                                        className="col-span-2 px-2 py-1.5 text-sm border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                                    />
                                    <span className="col-span-2 text-sm text-ink-2 dark:text-gray-400">GWP: {system.gwp}</span>
                                    <button onClick={() => removeSystem(index)} className="col-span-1 text-red-500 hover:text-red-600 text-sm">
                                        <i className="fa-solid fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className="flex justify-end pt-4 border-t border-line dark:border-gray-700">
                        <button
                            onClick={() => onSave({ systems, totalCharge, weightedGWP, result })}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm"
                        >
                            <i className="fa-solid fa-save mr-2"></i>Save Results
                        </button>
                    </div>
                </div>
            );
        }

        function MovementPlaceCalculator({ savedResult, onSave }) {
            const [publicTransportScore, setPublicTransportScore] = useState(savedResult?.publicTransportScore || 7);
            const [cyclingScore, setCyclingScore] = useState(savedResult?.cyclingScore || 5);
            const [pedestrianScore, setPedestrianScore] = useState(savedResult?.pedestrianScore || 6);
            const [amenitiesScore, setAmenitiesScore] = useState(savedResult?.amenitiesScore || 8);
            const [evCharging, setEvCharging] = useState(savedResult?.evCharging || 10);
            const [bikeParking, setBikeParking] = useState(savedResult?.bikeParking || 5);

            const totalScore = ((publicTransportScore + cyclingScore + pedestrianScore + amenitiesScore) / 4 * 0.7 +
                              (evCharging / 100 * 10 + bikeParking / 100 * 10) / 2 * 0.3).toFixed(1);

            const getLevel = () => {
                const score = parseFloat(totalScore);
                if (score >= 8) return { level: 'Exceptional', points: 3, color: 'text-green-600' };
                if (score >= 6) return { level: 'Credit', points: 2, color: 'text-blue-600' };
                if (score >= 4) return { level: 'Minimum', points: 0, color: 'text-gray-600' };
                return { level: 'Below Minimum', points: 0, color: 'text-red-600' };
            };

            const result = getLevel();

            return (
                <div className="space-y-4">
                    <div className="bg-gradient-to-r from-violet-50 to-purple-50 dark:from-violet-900/20 dark:to-purple-900/20 rounded-xl p-4 border border-violet-200 dark:border-violet-800">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm text-violet-700 dark:text-violet-300 font-medium">Movement & Place Score</p>
                                <p className="text-3xl font-bold text-violet-600">{totalScore}/10</p>
                            </div>
                            <div className="text-right">
                                <p className={`font-semibold ${result.color}`}>{result.level}</p>
                                <p className="text-sm text-ink-2">{result.points} points achievable</p>
                            </div>
                        </div>
                    </div>

                    <div className="space-y-3">
                        <h4 className="font-medium text-ink dark:text-white">Location Accessibility (1-10 scale)</h4>
                        {[
                            { label: 'Public Transport Access', value: publicTransportScore, setter: setPublicTransportScore },
                            { label: 'Cycling Infrastructure', value: cyclingScore, setter: setCyclingScore },
                            { label: 'Pedestrian Connectivity', value: pedestrianScore, setter: setPedestrianScore },
                            { label: 'Local Amenities Access', value: amenitiesScore, setter: setAmenitiesScore }
                        ].map((item, idx) => (
                            <div key={idx} className="flex items-center gap-3">
                                <span className="text-sm text-ink dark:text-white w-40">{item.label}</span>
                                <input
                                    type="range"
                                    min="1"
                                    max="10"
                                    value={item.value}
                                    onChange={(e) => item.setter(parseInt(e.target.value))}
                                    className="flex-grow"
                                />
                                <span className="text-sm font-bold text-ink dark:text-white w-8">{item.value}</span>
                            </div>
                        ))}
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">EV Charging (% of parking)</label>
                            <input
                                type="number"
                                value={evCharging}
                                onChange={(e) => setEvCharging(Math.min(100, Math.max(0, parseFloat(e.target.value) || 0)))}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Bike Parking (% of occupants)</label>
                            <input
                                type="number"
                                value={bikeParking}
                                onChange={(e) => setBikeParking(Math.min(100, Math.max(0, parseFloat(e.target.value) || 0)))}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                    </div>

                    <div className="flex justify-end pt-4 border-t border-line dark:border-gray-700">
                        <button
                            onClick={() => onSave({ publicTransportScore, cyclingScore, pedestrianScore, amenitiesScore, evCharging, bikeParking, totalScore, result })}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm"
                        >
                            <i className="fa-solid fa-save mr-2"></i>Save Results
                        </button>
                    </div>
                </div>
            );
        }

        function ProcurementCalculator({ savedResult, onSave }) {
            const [totalProcurement, setTotalProcurement] = useState(savedResult?.totalProcurement || 5000000);
            const [socialEnterprise, setSocialEnterprise] = useState(savedResult?.socialEnterprise || 250000);
            const [indigenousBusiness, setIndigenousBusiness] = useState(savedResult?.indigenousBusiness || 150000);
            const [localContent, setLocalContent] = useState(savedResult?.localContent || 3000000);
            const [diverseSuppliers, setDiverseSuppliers] = useState(savedResult?.diverseSuppliers || 100000);

            const socialSpend = socialEnterprise + indigenousBusiness + diverseSuppliers;
            const socialPercentage = totalProcurement > 0 ? ((socialSpend / totalProcurement) * 100).toFixed(1) : 0;
            const localPercentage = totalProcurement > 0 ? ((localContent / totalProcurement) * 100).toFixed(1) : 0;

            const getLevel = () => {
                const sp = parseFloat(socialPercentage);
                if (sp >= 10) return { level: 'Exceptional', points: 2, color: 'text-green-600' };
                if (sp >= 5) return { level: 'Credit', points: 1, color: 'text-blue-600' };
                if (sp >= 2) return { level: 'Minimum', points: 0, color: 'text-gray-600' };
                return { level: 'Below Minimum', points: 0, color: 'text-red-600' };
            };

            const result = getLevel();

            return (
                <div className="space-y-4">
                    <div className="bg-gradient-to-r from-rose-50 to-pink-50 dark:from-rose-900/20 dark:to-pink-900/20 rounded-xl p-4 border border-rose-200 dark:border-rose-800">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm text-rose-700 dark:text-rose-300 font-medium">Social Procurement</p>
                                <p className="text-3xl font-bold text-rose-600">{socialPercentage}%</p>
                            </div>
                            <div className="text-right">
                                <p className={`font-semibold ${result.color}`}>{result.level}</p>
                                <p className="text-sm text-ink-2">{result.points} points achievable</p>
                            </div>
                        </div>
                        <div className="mt-3 grid grid-cols-2 gap-4 text-sm">
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Social Spend</p>
                                <p className="font-bold text-ink dark:text-white">${socialSpend.toLocaleString()}</p>
                            </div>
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Local Content</p>
                                <p className="font-bold text-ink dark:text-white">{localPercentage}%</p>
                            </div>
                        </div>
                    </div>

                    <div className="space-y-3">
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Total Procurement Value ($)</label>
                            <input
                                type="number"
                                value={totalProcurement}
                                onChange={(e) => setTotalProcurement(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-ink dark:text-white mb-1">Social Enterprise Spend ($)</label>
                                <input
                                    type="number"
                                    value={socialEnterprise}
                                    onChange={(e) => setSocialEnterprise(parseFloat(e.target.value) || 0)}
                                    className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-ink dark:text-white mb-1">Indigenous Business Spend ($)</label>
                                <input
                                    type="number"
                                    value={indigenousBusiness}
                                    onChange={(e) => setIndigenousBusiness(parseFloat(e.target.value) || 0)}
                                    className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-ink dark:text-white mb-1">Local Content Spend ($)</label>
                                <input
                                    type="number"
                                    value={localContent}
                                    onChange={(e) => setLocalContent(parseFloat(e.target.value) || 0)}
                                    className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-ink dark:text-white mb-1">Diverse Suppliers Spend ($)</label>
                                <input
                                    type="number"
                                    value={diverseSuppliers}
                                    onChange={(e) => setDiverseSuppliers(parseFloat(e.target.value) || 0)}
                                    className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                                />
                            </div>
                        </div>
                    </div>

                    <div className="flex justify-end pt-4 border-t border-line dark:border-gray-700">
                        <button
                            onClick={() => onSave({ totalProcurement, socialEnterprise, indigenousBusiness, localContent, diverseSuppliers, socialPercentage, localPercentage, result })}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm"
                        >
                            <i className="fa-solid fa-save mr-2"></i>Save Results
                        </button>
                    </div>
                </div>
            );
        }

        function BiodiversityCalculator({ savedResult, onSave }) {
            const [siteArea, setSiteArea] = useState(savedResult?.siteArea || 5000);
            const [existingBiodiversity, setExistingBiodiversity] = useState(savedResult?.existingBiodiversity || 2);
            const [proposedBiodiversity, setProposedBiodiversity] = useState(savedResult?.proposedBiodiversity || 3.5);
            const [nativeSpecies, setNativeSpecies] = useState(savedResult?.nativeSpecies || 80);
            const [habitatConnectivity, setHabitatConnectivity] = useState(savedResult?.habitatConnectivity || true);

            const netGain = ((proposedBiodiversity - existingBiodiversity) / existingBiodiversity * 100).toFixed(1);
            const absoluteGain = (proposedBiodiversity - existingBiodiversity).toFixed(2);

            const getLevel = () => {
                const ng = parseFloat(netGain);
                if (ng >= 20 && nativeSpecies >= 80) return { level: 'Exceptional', points: 2, color: 'text-green-600' };
                if (ng >= 10) return { level: 'Credit', points: 1, color: 'text-blue-600' };
                if (ng >= 0) return { level: 'Minimum', points: 0, color: 'text-gray-600' };
                return { level: 'Net Loss', points: 0, color: 'text-red-600' };
            };

            const result = getLevel();

            return (
                <div className="space-y-4">
                    <div className="bg-gradient-to-r from-lime-50 to-green-50 dark:from-lime-900/20 dark:to-green-900/20 rounded-xl p-4 border border-lime-200 dark:border-lime-800">
                        <div className="flex items-center justify-between">
                            <div>
                                <p className="text-sm text-lime-700 dark:text-lime-300 font-medium">Biodiversity Net Gain</p>
                                <p className="text-3xl font-bold text-lime-600">{netGain}%</p>
                            </div>
                            <div className="text-right">
                                <p className={`font-semibold ${result.color}`}>{result.level}</p>
                                <p className="text-sm text-ink-2">{result.points} points achievable</p>
                            </div>
                        </div>
                        <div className="mt-3 grid grid-cols-2 gap-4 text-sm">
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Biodiversity Units Gain</p>
                                <p className="font-bold text-ink dark:text-white">+{absoluteGain} units</p>
                            </div>
                            <div className="bg-white/50 dark:bg-gray-800/50 rounded-lg p-2">
                                <p className="text-ink-3">Native Species</p>
                                <p className="font-bold text-ink dark:text-white">{nativeSpecies}%</p>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Site Area (mÂ²)</label>
                            <input
                                type="number"
                                value={siteArea}
                                onChange={(e) => setSiteArea(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Native Species (%)</label>
                            <input
                                type="number"
                                value={nativeSpecies}
                                onChange={(e) => setNativeSpecies(Math.min(100, Math.max(0, parseFloat(e.target.value) || 0)))}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Existing Biodiversity Units</label>
                            <input
                                type="number"
                                step="0.1"
                                value={existingBiodiversity}
                                onChange={(e) => setExistingBiodiversity(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-ink dark:text-white mb-1">Proposed Biodiversity Units</label>
                            <input
                                type="number"
                                step="0.1"
                                value={proposedBiodiversity}
                                onChange={(e) => setProposedBiodiversity(parseFloat(e.target.value) || 0)}
                                className="w-full px-3 py-2 border border-line dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 dark:text-white"
                            />
                        </div>
                    </div>

                    <label className="flex items-center gap-2 p-3 bg-surface-1 dark:bg-gray-800 rounded-lg border border-line dark:border-gray-700">
                        <input
                            type="checkbox"
                            checked={habitatConnectivity}
                            onChange={(e) => setHabitatConnectivity(e.target.checked)}
                            className="rounded"
                        />
                        <span className="text-sm text-ink dark:text-white">Habitat connectivity with adjacent green spaces</span>
                    </label>

                    <div className="flex justify-end pt-4 border-t border-line dark:border-gray-700">
                        <button
                            onClick={() => onSave({ siteArea, existingBiodiversity, proposedBiodiversity, nativeSpecies, habitatConnectivity, netGain, result })}
                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium text-sm"
                        >
                            <i className="fa-solid fa-save mr-2"></i>Save Results
                        </button>
                    </div>
                </div>
            );
        }

        // Calculators Modal Component
        function CalculatorsModal({ isOpen, onClose, selectedCalculator, onSelectCalculator, calculatorResults, onSaveResult }) {
            if (!isOpen) return null;

            const selectedCalc = selectedCalculator ? calculatorsData.find(c => c.id === selectedCalculator) : null;

            const renderCalculatorForm = () => {
                if (!selectedCalculator) return null;

                const savedResult = calculatorResults[selectedCalculator];
                const handleSave = (result) => onSaveResult(selectedCalculator, result);

                switch (selectedCalculator) {
                    case 'responsible-products':
                        return <ResponsibleProductsCalculator savedResult={savedResult} onSave={handleSave} />;
                    case 'energy-reference':
                        return <EnergyUseCalculator savedResult={savedResult} onSave={handleSave} />;
                    case 'upfront-carbon':
                        return <UpfrontCarbonCalculator savedResult={savedResult} onSave={handleSave} />;
                    case 'carbon-compensation':
                        return <CarbonCompensationCalculator savedResult={savedResult} onSave={handleSave} />;
                    case 'refrigerant':
                        return <RefrigerantCalculator savedResult={savedResult} onSave={handleSave} />;
                    case 'water':
                        return <WaterUseCalculator savedResult={savedResult} onSave={handleSave} />;
                    case 'movement':
                        return <MovementPlaceCalculator savedResult={savedResult} onSave={handleSave} />;
                    case 'procurement':
                        return <ProcurementCalculator savedResult={savedResult} onSave={handleSave} />;
                    case 'biodiversity':
                        return <BiodiversityCalculator savedResult={savedResult} onSave={handleSave} />;
                    default:
                        return <p className="text-ink-2">Calculator not yet implemented</p>;
                }
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" onClick={onClose}>
                    <div
                        className="glass-card dark:bg-gray-800 rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col"
                        onClick={(e) => e.stopPropagation()}
                    >
                        <div className="flex items-center justify-between mb-6">
                            <div className="flex items-center gap-3">
                                {selectedCalculator && (
                                    <button
                                        onClick={() => onSelectCalculator(null)}
                                        className="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center transition-colors"
                                    >
                                        <i className="fa-solid fa-arrow-left text-ink-2 dark:text-gray-300"></i>
                                    </button>
                                )}
                                <div>
                                    <h2 className="font-display text-2xl font-bold text-ink dark:text-white">
                                        {selectedCalc ? selectedCalc.name : 'Green Star Calculators'}
                                    </h2>
                                    <p className="text-ink-2 dark:text-gray-400">
                                        {selectedCalc ? selectedCalc.description : 'Required calculators for specific credits'}
                                    </p>
                                </div>
                            </div>
                            <button
                                onClick={onClose}
                                className="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center transition-colors"
                            >
                                <i className="fa-solid fa-xmark text-ink-2 dark:text-gray-300"></i>
                            </button>
                        </div>

                        <div className="flex-1 overflow-y-auto">
                            {selectedCalculator ? (
                                renderCalculatorForm()
                            ) : (
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {calculatorsData.map((calc) => {
                                        const hasResult = calculatorResults[calc.id];
                                        return (
                                            <div
                                                key={calc.id}
                                                onClick={() => onSelectCalculator(calc.id)}
                                                className="bg-white dark:bg-gray-700 rounded-xl p-4 border border-line dark:border-gray-600 hover:border-green-300 dark:hover:border-green-600 hover:shadow-md transition-all cursor-pointer"
                                            >
                                                <div className="flex items-start justify-between mb-3">
                                                    <div className="w-12 h-12 rounded-lg bg-gradient-to-br from-green-100 to-blue-100 dark:from-green-900/30 dark:to-blue-900/30 flex items-center justify-center">
                                                        <i className={`fa-solid ${calc.icon} text-xl text-green-600 dark:text-green-400`}></i>
                                                    </div>
                                                    {hasResult && (
                                                        <span className="text-xs bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 px-2 py-1 rounded-full font-medium">
                                                            <i className="fa-solid fa-check mr-1"></i>Saved
                                                        </span>
                                                    )}
                                                </div>
                                                <h3 className="font-medium text-ink dark:text-white mb-1">{calc.name}</h3>
                                                <p className="text-sm text-ink-2 dark:text-gray-400 mb-3">{calc.description}</p>
                                                {hasResult && hasResult.result && (
                                                    <div className="text-xs text-ink-3 dark:text-gray-500 mb-2">
                                                        Last result: <span className={hasResult.result.color}>{hasResult.result.level}</span>
                                                    </div>
                                                )}
                                                <button className="text-sm text-green-600 dark:text-green-400 font-medium hover:text-green-700 dark:hover:text-green-300">
                                                    Open Calculator <i className="fa-solid fa-arrow-right ml-1"></i>
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Export Modal Component
        function ExportModal({ isOpen, onClose, projectData }) {
            if (!isOpen) return null;

            const rating = calculateStarRating(projectData.totalPoints);

            const handleExport = (format) => {
                const data = {
                    projectName: projectData.projectName,
                    exportDate: new Date().toISOString(),
                    totalPoints: projectData.totalPoints,
                    rating: rating,
                    selectedCredits: projectData.selectedCredits,
                    creditNotes: projectData.creditNotes || {},
                    creditDocs: projectData.creditDocs || {},
                    creditAssignments: projectData.creditAssignments || {},
                    categories: categoriesData.map(cat => ({
                        id: cat.id,
                        name: cat.name,
                        maxPoints: cat.maxPoints,
                        earnedPoints: cat.credits.reduce((sum, credit) => {
                            const key = `${cat.id}-${credit.id}`;
                            const selection = projectData.selectedCredits[key];
                            return sum + (selection ? selection.points || 0 : 0);
                        }, 0),
                        selectedCredits: cat.credits.filter(credit => {
                            const key = `${cat.id}-${credit.id}`;
                            return projectData.selectedCredits[key];
                        }).map(c => ({
                            id: c.id,
                            name: c.name,
                            points: projectData.selectedCredits[`${cat.id}-${c.id}`]?.points || 0,
                            level: projectData.selectedCredits[`${cat.id}-${c.id}`]?.level || 'credit'
                        }))
                    }))
                };

                if (format === 'json') {
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${projectData.projectName.replace(/\s+/g, '-').toLowerCase()}-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                    onClose();
                    return;
                }

                if (format === 'pdf') {
                    // Generate printable HTML that can be saved as PDF
                    const printWindow = window.open('', '_blank');
                    const selectedCreditsList = [];
                    categoriesData.forEach(cat => {
                        cat.credits.forEach(credit => {
                            const key = `${cat.id}-${credit.id}`;
                            if (projectData.selectedCredits[key]) {
                                selectedCreditsList.push({
                                    category: cat,
                                    credit,
                                    selection: projectData.selectedCredits[key],
                                    notes: projectData.creditNotes?.[key] || '',
                                    docs: projectData.creditDocs?.[key] || {},
                                    assignments: projectData.creditAssignments?.[key] || {}
                                });
                            }
                        });
                    });

                    const html = `
<!DOCTYPE html>
<html>
<head>
    <title>${projectData.projectName} - Green Star Submission Report</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; padding: 40px; color: #374151; line-height: 1.6; }
        .header { text-align: center; margin-bottom: 40px; border-bottom: 2px solid #2E6B3F; padding-bottom: 20px; }
        .header h1 { color: #2E6B3F; font-size: 28px; margin-bottom: 10px; }
        .header .rating { font-size: 20px; color: #2E6B3F; margin: 10px 0; font-weight: 500; }
        .header .meta { color: #6B7280; font-size: 14px; }
        .summary { display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap; }
        .summary-box { flex: 1; min-width: 150px; background: #FAFAF9; border: 1px solid #E7E5E4; border-radius: 8px; padding: 15px; text-align: center; }
        .summary-box h3 { color: #374151; font-size: 14px; margin-bottom: 5px; }
        .summary-box .value { font-size: 24px; font-weight: bold; color: #2E6B3F; }
        .category { margin-bottom: 30px; page-break-inside: avoid; }
        .category-header { background: #2E6B3F; color: white; padding: 12px 20px; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .category-header h2 { font-size: 18px; }
        .category-header .points { background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 14px; }
        .credit { border: 1px solid #E7E5E4; border-top: none; padding: 15px 20px; }
        .credit:last-child { border-radius: 0 0 8px 8px; }
        .credit-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .credit-name { font-weight: 600; color: #374151; }
        .credit-points { background: #F0FDF4; color: #2E6B3F; padding: 2px 10px; border-radius: 12px; font-size: 13px; font-weight: 500; }
        .credit-level { font-size: 12px; color: #6B7280; margin-top: 2px; }
        .credit-required { background: #FEF2F2; color: #DC2626; padding: 1px 6px; border-radius: 4px; font-size: 11px; margin-left: 8px; }
        .credit-notes { background: #FFFBEB; padding: 10px; border-radius: 6px; margin-top: 10px; font-size: 13px; }
        .credit-notes strong { color: #92400E; }
        .documentation { margin-top: 10px; font-size: 13px; }
        .documentation h4 { color: #4B5563; margin-bottom: 5px; }
        .doc-item { display: flex; align-items: center; gap: 8px; padding: 3px 0; }
        .doc-item .checkbox { width: 14px; height: 14px; border: 2px solid #D6D3D1; border-radius: 3px; display: inline-block; }
        .doc-item .checkbox.checked { background: #2E6B3F; border-color: #2E6B3F; }
        .no-credits { color: #9CA3AF; font-style: italic; padding: 15px 20px; border: 1px solid #E7E5E4; border-top: none; border-radius: 0 0 8px 8px; }
        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #E7E5E4; text-align: center; color: #9CA3AF; font-size: 12px; }
        @media print {
            body { padding: 20px; }
            .category { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>${projectData.projectName}</h1>
        <div class="rating">${rating.stars} Star ${rating.description}</div>
        <div class="meta">Generated on ${new Date().toLocaleDateString('en-AU', { dateStyle: 'full' })}</div>
    </div>

    <div class="summary">
        <div class="summary-box">
            <h3>Total Points</h3>
            <div class="value">${projectData.totalPoints}/170</div>
        </div>
        <div class="summary-box">
            <h3>Credits Selected</h3>
            <div class="value">${selectedCreditsList.length}</div>
        </div>
        <div class="summary-box">
            <h3>Star Rating</h3>
            <div class="value">${rating.stars} Star</div>
        </div>
    </div>

    ${categoriesData.map(cat => {
        const catCredits = selectedCreditsList.filter(c => c.category.id === cat.id);
        const catPoints = catCredits.reduce((sum, c) => sum + (c.selection.points || 0), 0);
        return `
        <div class="category">
            <div class="category-header" style="background: linear-gradient(135deg, ${cat.color === 'blue' ? '#3b82f6, #2563eb' : cat.color === 'red' ? '#ef4444, #dc2626' : cat.color === 'orange' ? '#f97316, #ea580c' : cat.color === 'green' ? '#22c55e, #16a34a' : cat.color === 'purple' ? '#a855f7, #9333ea' : cat.color === 'pink' ? '#ec4899, #db2777' : cat.color === 'emerald' ? '#10b981, #059669' : '#eab308, #ca8a04'});">
                <h2>${cat.icon} ${cat.name}</h2>
                <span class="points">${catPoints}/${cat.maxPoints} pts</span>
            </div>
            ${catCredits.length > 0 ? catCredits.map(({ credit, selection, notes, docs }) => `
                <div class="credit">
                    <div class="credit-header">
                        <div>
                            <span class="credit-name">${credit.name}</span>
                            ${credit.required ? '<span class="credit-required">REQUIRED</span>' : ''}
                            <div class="credit-level">Level: ${selection.level === 'minimum' ? 'Minimum Expectation' : selection.level === 'exceptional' ? 'Exceptional Performance' : 'Credit Achievement'}</div>
                        </div>
                        <span class="credit-points">${selection.points} pts</span>
                    </div>
                    ${notes ? `<div class="credit-notes"><strong>Notes:</strong> ${notes}</div>` : ''}
                    ${credit.documentation && credit.documentation.length > 0 ? `
                        <div class="documentation">
                            <h4>Required Documentation:</h4>
                            ${credit.documentation.map((doc, idx) => `
                                <div class="doc-item">
                                    <span class="checkbox ${docs[idx] ? 'checked' : ''}"></span>
                                    <span>${doc}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('') : '<div class="no-credits">No credits selected in this category</div>'}
        </div>
        `;
    }).join('')}

    <div class="footer">
        <p>Green Star Buildings v1.1 Submission Report</p>
        <p>Generated by Green Star Submission Assistant</p>
    </div>
</body>
</html>`;

                    printWindow.document.write(html);
                    printWindow.document.close();
                    printWindow.onload = () => {
                        printWindow.print();
                    };
                    onClose();
                    return;
                }

                if (format === 'excel') {
                    // Generate proper Excel file with multiple sheets
                    const wb = XLSX.utils.book_new();

                    // Summary sheet
                    const summaryData = [
                        ['Green Star Submission Progress Report'],
                        [],
                        ['Project Name', projectData.projectName],
                        ['Export Date', new Date().toLocaleDateString()],
                        ['Total Points', projectData.totalPoints],
                        ['Star Rating', `${rating.stars} Star - ${rating.name}`],
                        [],
                        ['Category Summary'],
                        ['Category', 'Selected Credits', 'Earned Points', 'Max Points', 'Completion %']
                    ];
                    categoriesData.forEach(cat => {
                        const catCredits = cat.credits.filter(credit => projectData.selectedCredits[`${cat.id}-${credit.id}`]);
                        const catPoints = catCredits.reduce((sum, c) => sum + (projectData.selectedCredits[`${cat.id}-${c.id}`]?.points || 0), 0);
                        summaryData.push([cat.name, catCredits.length, catPoints, cat.maxPoints, `${Math.round((catPoints/cat.maxPoints)*100)}%`]);
                    });
                    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(summaryData), 'Summary');

                    // Credits detail sheet
                    const creditsData = [['Category', 'Credit ID', 'Credit Name', 'Required', 'Level', 'Points', 'Assigned To', 'Due Date', 'Notes']];
                    categoriesData.forEach(cat => {
                        cat.credits.forEach(credit => {
                            const key = `${cat.id}-${credit.id}`;
                            const selection = projectData.selectedCredits[key];
                            if (selection) {
                                const assignment = projectData.creditAssignments?.[key] || {};
                                creditsData.push([
                                    cat.name,
                                    credit.id,
                                    credit.name,
                                    credit.required ? 'Yes' : 'No',
                                    selection.level === 'minimum' ? 'Minimum' : selection.level === 'exceptional' ? 'Exceptional' : 'Credit',
                                    selection.points,
                                    assignment.assignee || '',
                                    assignment.dueDate || '',
                                    projectData.creditNotes?.[key] || ''
                                ]);
                            }
                        });
                    });
                    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(creditsData), 'Selected Credits');

                    // Documentation checklist sheet
                    const docsData = [['Category', 'Credit', 'Document', 'Status', 'Notes']];
                    categoriesData.forEach(cat => {
                        cat.credits.forEach(credit => {
                            const key = `${cat.id}-${credit.id}`;
                            if (projectData.selectedCredits[key] && credit.documentation) {
                                credit.documentation.forEach((doc, idx) => {
                                    const isComplete = projectData.creditDocs?.[key]?.[idx] || false;
                                    docsData.push([
                                        cat.name,
                                        credit.name,
                                        doc,
                                        isComplete ? 'Complete' : 'Pending',
                                        ''
                                    ]);
                                });
                            }
                        });
                    });
                    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(docsData), 'Documentation Checklist');

                    // All credits sheet (for tracking which are not yet selected)
                    const allCreditsData = [['Category', 'Credit ID', 'Credit Name', 'Required', 'Max Points', 'Status', 'Difficulty']];
                    categoriesData.forEach(cat => {
                        cat.credits.forEach(credit => {
                            const key = `${cat.id}-${credit.id}`;
                            const isSelected = !!projectData.selectedCredits[key];
                            allCreditsData.push([
                                cat.name,
                                credit.id,
                                credit.name,
                                credit.required ? 'Yes' : 'No',
                                credit.points,
                                isSelected ? 'Selected' : 'Not Selected',
                                credit.difficulty || 'Medium'
                            ]);
                        });
                    });
                    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(allCreditsData), 'All Credits');

                    XLSX.writeFile(wb, `${projectData.projectName.replace(/\s+/g, '-').toLowerCase()}-progress-${new Date().toISOString().split('T')[0]}.xlsx`);
                    onClose();
                    return;
                }

                if (format === 'checklist') {
                    // Generate submission checklist document
                    const printWindow = window.open('', '_blank');
                    const checklistHtml = `
<!DOCTYPE html>
<html>
<head>
    <title>${projectData.projectName} - Submission Checklist</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; padding: 40px; color: #333; line-height: 1.4; font-size: 12px; }
        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #1B4D3E; padding-bottom: 15px; }
        .header h1 { color: #1B4D3E; font-size: 22px; margin-bottom: 5px; }
        .header .meta { color: #666; font-size: 11px; }
        .section { margin-bottom: 25px; page-break-inside: avoid; }
        .section-title { background: #1B4D3E; color: white; padding: 8px 15px; font-size: 13px; font-weight: bold; margin-bottom: 0; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f5f5f5; font-weight: 600; font-size: 11px; }
        td { font-size: 11px; }
        .checkbox { width: 20px; text-align: center; }
        .checkbox-box { width: 14px; height: 14px; border: 1.5px solid #999; display: inline-block; }
        .priority-high { color: #dc2626; font-weight: bold; }
        .priority-medium { color: #d97706; }
        .status-complete { color: #16a34a; }
        .notes-section { margin-top: 30px; }
        .notes-section h3 { margin-bottom: 10px; }
        .notes-lines { border-top: 1px solid #ddd; padding-top: 10px; }
        .notes-line { border-bottom: 1px dotted #ccc; height: 25px; margin-bottom: 5px; }
        @media print {
            body { padding: 20px; }
            .section { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Green Star Submission Checklist</h1>
        <div class="meta">${projectData.projectName} | Target: ${rating.stars} Star | ${new Date().toLocaleDateString()}</div>
    </div>

    <div class="section">
        <div class="section-title">Required Credits & Documentation</div>
        <table>
            <thead>
                <tr>
                    <th class="checkbox"></th>
                    <th style="width:25%">Credit</th>
                    <th style="width:40%">Required Documents</th>
                    <th style="width:15%">Responsible</th>
                    <th style="width:15%">Due Date</th>
                </tr>
            </thead>
            <tbody>
                ${categoriesData.flatMap(cat =>
                    cat.credits
                        .filter(c => projectData.selectedCredits[`${cat.id}-${c.id}`])
                        .map(credit => {
                            const key = `${cat.id}-${credit.id}`;
                            const assignment = projectData.creditAssignments?.[key] || {};
                            const docs = credit.documentation || [];
                            return `
                                <tr>
                                    <td class="checkbox"><span class="checkbox-box"></span></td>
                                    <td><strong>${credit.name}</strong><br><span style="color:#666;font-size:10px">${cat.name}</span></td>
                                    <td>${docs.length > 0 ? docs.map((d, i) => `<div><span class="checkbox-box" style="width:10px;height:10px;margin-right:5px"></span>${d}</div>`).join('') : '<em style="color:#999">No documents listed</em>'}</td>
                                    <td>${assignment.assignee || ''}</td>
                                    <td>${assignment.dueDate || ''}</td>
                                </tr>
                            `;
                        })
                ).join('')}
            </tbody>
        </table>
    </div>

    <div class="section">
        <div class="section-title">Submission Summary</div>
        <table>
            <tr><td style="width:200px"><strong>Total Credits Selected</strong></td><td>${Object.keys(projectData.selectedCredits).length}</td></tr>
            <tr><td><strong>Total Points</strong></td><td>${projectData.totalPoints} / 170</td></tr>
            <tr><td><strong>Target Rating</strong></td><td>${rating.stars} Star (${rating.name})</td></tr>
            <tr><td><strong>Submission Date</strong></td><td></td></tr>
            <tr><td><strong>Assessor</strong></td><td></td></tr>
        </table>
    </div>

    <div class="notes-section">
        <h3>Notes</h3>
        <div class="notes-lines">
            ${Array(8).fill('<div class="notes-line"></div>').join('')}
        </div>
    </div>

    <div style="margin-top:30px;text-align:center;color:#999;font-size:10px;">
        Generated by Green Star Submission Assistant
    </div>
</body>
</html>`;
                    printWindow.document.write(checklistHtml);
                    printWindow.document.close();
                    printWindow.onload = () => printWindow.print();
                    onClose();
                    return;
                }
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" onClick={onClose}>
                    <div
                        className="glass-card rounded-2xl p-6 max-w-md w-full"
                        onClick={(e) => e.stopPropagation()}
                    >
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="font-display text-xl font-bold text-ink">Export Submission</h2>
                            <button
                                onClick={onClose}
                                className="w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors"
                            >
                                <i className="fa-solid fa-xmark text-ink-2"></i>
                            </button>
                        </div>

                        <div className="space-y-3">
                            <button
                                onClick={() => handleExport('pdf')}
                                className="w-full flex items-center gap-4 p-4 rounded-xl border border-line hover:border-red-300 hover:bg-red-50 transition-all"
                            >
                                <div className="w-12 h-12 rounded-lg bg-red-100 flex items-center justify-center">
                                    <i className="fa-solid fa-file-pdf text-xl text-red-600"></i>
                                </div>
                                <div className="text-left">
                                    <p className="font-medium text-ink">PDF Checklist</p>
                                    <p className="text-sm text-ink-2">Printable submission checklist</p>
                                </div>
                            </button>

                            <button
                                onClick={() => handleExport('json')}
                                className="w-full flex items-center gap-4 p-4 rounded-xl border border-line hover:border-blue-300 hover:bg-blue-50 transition-all"
                            >
                                <div className="w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center">
                                    <i className="fa-solid fa-file-code text-xl text-blue-600"></i>
                                </div>
                                <div className="text-left">
                                    <p className="font-medium text-ink">JSON Data</p>
                                    <p className="text-sm text-ink-2">Machine-readable format</p>
                                </div>
                            </button>

                            <button
                                onClick={() => handleExport('excel')}
                                className="w-full flex items-center gap-4 p-4 rounded-xl border border-line hover:border-green-300 hover:bg-green-50 transition-all"
                            >
                                <div className="w-12 h-12 rounded-lg bg-green-100 flex items-center justify-center">
                                    <i className="fa-solid fa-file-excel text-xl text-green-600"></i>
                                </div>
                                <div className="text-left">
                                    <p className="font-medium text-ink">Excel Progress Report</p>
                                    <p className="text-sm text-ink-2">Multi-sheet workbook with full details</p>
                                </div>
                            </button>

                            <button
                                onClick={() => handleExport('checklist')}
                                className="w-full flex items-center gap-4 p-4 rounded-xl border border-line hover:border-purple-300 hover:bg-purple-50 transition-all"
                            >
                                <div className="w-12 h-12 rounded-lg bg-purple-100 flex items-center justify-center">
                                    <i className="fa-solid fa-clipboard-list text-xl text-purple-600"></i>
                                </div>
                                <div className="text-left">
                                    <p className="font-medium text-ink">Submission Checklist</p>
                                    <p className="text-sm text-ink-2">Print-ready document checklist</p>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Project Manager Modal Component
        function ProjectManagerModal({ isOpen, onClose, projects, activeProjectId, onCreateProject, onSwitchProject, onDeleteProject, onImport, onCloneProject }) {
            const [newProjectName, setNewProjectName] = useState('');

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" onClick={onClose}>
                    <div className="glass-card dark:bg-gray-800 rounded-2xl p-6 max-w-lg w-full max-h-[80vh] overflow-hidden flex flex-col" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="font-display text-xl font-bold text-ink dark:text-white">
                                <i className="fa-solid fa-folder-open text-blue-500 mr-2"></i>
                                Project Manager
                            </h2>
                            <button onClick={onClose} className="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center transition-colors">
                                <i className="fa-solid fa-xmark text-ink-2 dark:text-gray-300"></i>
                            </button>
                        </div>

                        {/* New Project */}
                        <div className="mb-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-xl border border-green-200 dark:border-green-800">
                            <h3 className="font-medium text-green-800 dark:text-green-300 mb-3">Create New Project</h3>
                            <div className="flex gap-2">
                                <input
                                    type="text"
                                    value={newProjectName}
                                    onChange={(e) => setNewProjectName(e.target.value)}
                                    placeholder="Project name..."
                                    className="flex-1 px-3 py-2 border border-green-300 dark:border-green-700 rounded-lg text-sm dark:bg-gray-700 dark:text-white"
                                />
                                <button
                                    onClick={() => {
                                        onCreateProject(newProjectName || 'New Project');
                                        setNewProjectName('');
                                    }}
                                    className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm font-medium"
                                >
                                    <i className="fa-solid fa-plus mr-1"></i> Create
                                </button>
                            </div>
                        </div>

                        {/* Import */}
                        <div className="mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
                            <h3 className="font-medium text-blue-800 dark:text-blue-300 mb-3">Import Project</h3>
                            <label className="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium cursor-pointer w-fit">
                                <i className="fa-solid fa-upload"></i>
                                <span>Import JSON File</span>
                                <input type="file" accept=".json" onChange={onImport} className="hidden" />
                            </label>
                        </div>

                        {/* Projects List */}
                        <div className="flex-1 overflow-y-auto">
                            <h3 className="font-medium text-ink dark:text-gray-300 mb-3">Your Projects ({projects.length})</h3>
                            <div className="space-y-2">
                                {projects.length === 0 ? (
                                    <p className="text-ink-2 text-sm italic">No projects yet. Create your first project above.</p>
                                ) : (
                                    projects.map(project => (
                                        <div
                                            key={project.id}
                                            className={`p-3 rounded-xl border-2 transition-all cursor-pointer ${
                                                project.id === activeProjectId
                                                    ? 'border-green-500 bg-green-50 dark:bg-green-900/30'
                                                    : 'border-line dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'
                                            }`}
                                            onClick={() => onSwitchProject(project.id)}
                                        >
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <p className="font-medium text-ink dark:text-white">{project.name}</p>
                                                    <p className="text-xs text-ink-2 dark:text-ink-3">
                                                        Created: {new Date(project.createdAt).toLocaleDateString()}
                                                        {project.imported && ' (Imported)'}
                                                        {project.isScenario && ' (Scenario)'}
                                                    </p>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    {project.id === activeProjectId && (
                                                        <span className="text-xs bg-green-500 text-white px-2 py-1 rounded-full">Active</span>
                                                    )}
                                                    {project.isScenario && (
                                                        <span className="text-xs bg-purple-500 text-white px-2 py-1 rounded-full">Scenario</span>
                                                    )}
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            const scenarioName = prompt('Enter scenario name:', `${project.name} (Scenario)`);
                                                            if (scenarioName) {
                                                                onCloneProject(project.id, scenarioName);
                                                            }
                                                        }}
                                                        className="w-8 h-8 rounded-full hover:bg-purple-100 dark:hover:bg-purple-900/30 flex items-center justify-center text-purple-500"
                                                        title="Clone as Scenario"
                                                    >
                                                        <i className="fa-solid fa-clone text-sm"></i>
                                                    </button>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            if (confirm('Delete this project?')) {
                                                                onDeleteProject(project.id);
                                                            }
                                                        }}
                                                        className="w-8 h-8 rounded-full hover:bg-red-100 dark:hover:bg-red-900/30 flex items-center justify-center text-red-500"
                                                    >
                                                        <i className="fa-solid fa-trash text-sm"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Templates Modal Component
        function TemplatesModal({ isOpen, onClose, onApplyTemplate, onCreateWithTemplate }) {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" onClick={onClose}>
                    <div className="glass-card dark:bg-gray-800 rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="font-display text-xl font-bold text-ink dark:text-white">
                                <i className="fa-solid fa-wand-magic-sparkles text-purple-500 mr-2"></i>
                                Project Templates
                            </h2>
                            <button onClick={onClose} className="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center transition-colors">
                                <i className="fa-solid fa-xmark text-ink-2 dark:text-gray-300"></i>
                            </button>
                        </div>

                        <p className="text-ink-2 dark:text-ink-3 mb-4">Choose a template to pre-populate credits suitable for your building type.</p>

                        <div className="flex-1 overflow-y-auto">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {projectTemplates.map(template => (
                                    <div key={template.id} className="p-4 rounded-xl border-2 border-line dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-700 transition-all">
                                        <div className="flex items-center gap-3 mb-2">
                                            <div className="w-12 h-12 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center">
                                                <i className={`fa-solid ${template.icon} text-xl text-purple-600 dark:text-purple-400`}></i>
                                            </div>
                                            <div>
                                                <h3 className="font-bold text-ink dark:text-white">{template.name}</h3>
                                                <p className="text-xs text-ink-2">Target: {template.targetRating} Star</p>
                                            </div>
                                        </div>
                                        <p className="text-sm text-ink-2 dark:text-ink-3 mb-3">{template.description}</p>
                                        <p className="text-xs text-ink-2 mb-3">{template.suggestedCredits.length} credits pre-selected</p>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => onApplyTemplate(template.id)}
                                                className="flex-1 px-3 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm font-medium"
                                            >
                                                Apply to Current
                                            </button>
                                            <button
                                                onClick={() => onCreateWithTemplate(template.name + ' Project', template.id)}
                                                className="flex-1 px-3 py-2 border border-purple-500 text-purple-600 dark:text-purple-400 rounded-lg hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-colors text-sm font-medium"
                                            >
                                                New Project
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Gap Analysis Modal Component
        function GapAnalysisModal({ isOpen, onClose, gapAnalysis, onSelectCredit, onViewCredit }) {
            if (!isOpen || !gapAnalysis) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" onClick={onClose}>
                    <div className="glass-card dark:bg-gray-800 rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="font-display text-xl font-bold text-ink dark:text-white">
                                <i className="fa-solid fa-chart-line text-amber-500 mr-2"></i>
                                Gap Analysis
                            </h2>
                            <button onClick={onClose} className="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center transition-colors">
                                <i className="fa-solid fa-xmark text-ink-2 dark:text-gray-300"></i>
                            </button>
                        </div>

                        {/* Target Summary */}
                        <div className="mb-6 p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 rounded-xl border border-amber-200 dark:border-amber-800">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-amber-800 dark:text-amber-300 font-medium">Current: {gapAnalysis.currentPoints} points</p>
                                    <p className="text-2xl font-bold text-amber-600 dark:text-amber-400">
                                        {gapAnalysis.remaining} more points needed for {gapAnalysis.name}
                                    </p>
                                </div>
                                <div className="text-4xl">ðŸŽ¯</div>
                            </div>
                        </div>

                        {/* Recommended Credits */}
                        <div className="mb-4">
                            <h3 className="font-bold text-ink dark:text-white mb-3 flex items-center gap-2">
                                <i className="fa-solid fa-lightbulb text-yellow-500"></i>
                                Recommended Path ({gapAnalysis.recommended.length} credits)
                            </h3>
                            <div className="space-y-2 max-h-40 overflow-y-auto">
                                {gapAnalysis.recommended.map(({ key, credit, category, points, difficulty }) => (
                                    <div key={key} className="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                        <div className="flex items-center gap-3">
                                            <span className={category.colorClasses?.text || 'text-ink-3'}><CategoryIcon category={category.id} size={20} /></span>
                                            <div>
                                                <p className="font-medium text-ink dark:text-white text-sm">{credit.name}</p>
                                                <p className="text-xs text-ink-2">{category.name} â€¢ {difficulty}</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <span className="text-green-600 font-bold">+{points}</span>
                                            <button
                                                onClick={() => onSelectCredit(key, 'credit', points)}
                                                className="px-3 py-1 bg-green-500 text-white rounded-full text-xs font-medium hover:bg-green-600"
                                            >
                                                Add
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Other Suggestions */}
                        <div className="flex-1 overflow-y-auto">
                            <h3 className="font-bold text-ink dark:text-white mb-3">All Suggestions (sorted by value)</h3>
                            <div className="space-y-2">
                                {gapAnalysis.suggestions.map(({ key, credit, category, points, difficulty, required }) => (
                                    <div
                                        key={key}
                                        className="flex items-center justify-between p-3 bg-surface-2 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors cursor-pointer"
                                        onClick={() => onViewCredit(credit, category)}
                                    >
                                        <div className="flex items-center gap-3">
                                            <span className={category.colorClasses?.text || 'text-ink-3'}><CategoryIcon category={category.id} size={20} /></span>
                                            <div>
                                                <p className="font-medium text-ink dark:text-white text-sm">
                                                    {credit.name}
                                                    {required && <span className="ml-2 text-xs bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-2 py-0.5 rounded">Required</span>}
                                                </p>
                                                <p className="text-xs text-ink-2">{category.name}</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <span className={`text-xs px-2 py-1 rounded-full ${
                                                difficulty === 'Easy' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400' :
                                                difficulty === 'Medium' ? 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400' :
                                                'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400'
                                            }`}>{difficulty}</span>
                                            <span className="font-bold text-ink dark:text-gray-300">+{points}</span>
                                            <button
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    onSelectCredit(key, 'credit', points);
                                                }}
                                                className="px-3 py-1 bg-blue-500 text-white rounded-full text-xs font-medium hover:bg-blue-600"
                                            >
                                                Add
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Synergies Modal Component
        function SynergiesModal({ isOpen, onClose, synergies, onSelectCredit, onViewCredit }) {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" onClick={onClose}>
                    <div className="glass-card dark:bg-gray-800 rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="font-display text-xl font-bold text-ink dark:text-white">
                                <i className="fa-solid fa-link text-cyan-500 mr-2"></i>
                                Credit Synergies
                            </h2>
                            <button onClick={onClose} className="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center transition-colors">
                                <i className="fa-solid fa-xmark text-ink-2 dark:text-gray-300"></i>
                            </button>
                        </div>

                        <p className="text-ink-2 dark:text-ink-3 mb-4">
                            These credits complement your current selections and may be easier to achieve together.
                        </p>

                        {synergies.length === 0 ? (
                            <div className="flex-1 flex flex-col items-center justify-center text-center py-12">
                                <i className="fa-solid fa-puzzle-piece text-4xl text-ink-3 dark:text-gray-500 mb-4"></i>
                                <p className="text-ink-2 dark:text-ink-3">No synergies found for your current selection.</p>
                                <p className="text-sm text-ink-3 dark:text-ink-2">Select more credits to discover synergies.</p>
                            </div>
                        ) : (
                            <div className="flex-1 overflow-y-auto space-y-3">
                                {synergies.map(({ toKey, credit, category, reason }) => (
                                    <div
                                        key={toKey}
                                        className="p-4 bg-cyan-50 dark:bg-cyan-900/20 rounded-xl border border-cyan-200 dark:border-cyan-800 hover:border-cyan-400 dark:hover:border-cyan-600 transition-colors cursor-pointer"
                                        onClick={() => onViewCredit(credit, category)}
                                    >
                                        <div className="flex items-center justify-between mb-2">
                                            <div className="flex items-center gap-3">
                                                <span className={category.colorClasses?.text || 'text-ink-3'}><CategoryIcon category={category.id} size={22} /></span>
                                                <div>
                                                    <p className="font-bold text-ink dark:text-white">{credit.name}</p>
                                                    <p className="text-xs text-ink-2 dark:text-ink-3">{category.name}</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    const points = credit.performanceLevels?.[1]?.points || credit.points;
                                                    onSelectCredit(toKey, 'credit', points);
                                                }}
                                                className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm font-medium hover:bg-cyan-600 transition-colors"
                                            >
                                                <i className="fa-solid fa-plus mr-1"></i> Add Credit
                                            </button>
                                        </div>
                                        <p className="text-sm text-cyan-700 dark:text-cyan-300 flex items-start gap-2">
                                            <i className="fa-solid fa-lightbulb text-cyan-500 mt-0.5"></i>
                                            {reason}
                                        </p>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Scenario Comparison Modal Component
        function ScenarioComparisonModal({ isOpen, onClose, projects, activeProjectId, categoriesData, selectedCredits }) {
            const [selectedProjects, setSelectedProjects] = useState([]);

            if (!isOpen) return null;

            // Get project data for comparison
            const getProjectCredits = (project) => {
                if (project.id === activeProjectId) {
                    return selectedCredits;
                }
                return project.data?.selectedCredits || {};
            };

            const getProjectPoints = (project) => {
                const credits = getProjectCredits(project);
                return Object.values(credits).reduce((sum, c) => sum + (c.points || 0), 0);
            };

            const getProjectCategoryPoints = (project, categoryId) => {
                const credits = getProjectCredits(project);
                let points = 0;
                Object.entries(credits).forEach(([key, data]) => {
                    if (key.startsWith(categoryId + '-')) {
                        points += data.points || 0;
                    }
                });
                return points;
            };

            const toggleProjectSelection = (projectId) => {
                setSelectedProjects(prev => {
                    if (prev.includes(projectId)) {
                        return prev.filter(id => id !== projectId);
                    }
                    if (prev.length < 3) {
                        return [...prev, projectId];
                    }
                    return prev;
                });
            };

            const comparisonProjects = projects.filter(p => selectedProjects.includes(p.id));

            // Get all unique credit keys across selected projects
            const getAllCreditKeys = () => {
                const keys = new Set();
                comparisonProjects.forEach(project => {
                    Object.keys(getProjectCredits(project)).forEach(key => keys.add(key));
                });
                return Array.from(keys).sort();
            };

            const getCreditInfo = (creditKey) => {
                for (const cat of categoriesData) {
                    for (const credit of cat.credits) {
                        if (`${cat.id}-${credit.id}` === creditKey) {
                            return { credit, category: cat };
                        }
                    }
                }
                return null;
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" onClick={onClose}>
                    <div className="glass-card dark:bg-gray-800 rounded-2xl p-6 max-w-5xl w-full max-h-[85vh] overflow-hidden flex flex-col" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="font-display text-xl font-bold text-ink dark:text-white">
                                <i className="fa-solid fa-code-compare text-indigo-500 mr-2"></i>
                                Compare Projects & Scenarios
                            </h2>
                            <button onClick={onClose} className="w-10 h-10 rounded-full bg-surface-2 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center transition-colors">
                                <i className="fa-solid fa-xmark text-ink-2 dark:text-gray-300"></i>
                            </button>
                        </div>

                        {/* Project Selection */}
                        <div className="mb-4 p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-xl border border-indigo-200 dark:border-indigo-800">
                            <h3 className="font-medium text-indigo-800 dark:text-indigo-300 mb-3">
                                Select up to 3 projects to compare
                            </h3>
                            <div className="flex flex-wrap gap-2">
                                {projects.map(project => (
                                    <button
                                        key={project.id}
                                        onClick={() => toggleProjectSelection(project.id)}
                                        className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                                            selectedProjects.includes(project.id)
                                                ? 'bg-indigo-500 text-white'
                                                : 'bg-white dark:bg-gray-700 border border-line dark:border-gray-600 text-ink-2 dark:text-gray-300 hover:border-indigo-400'
                                        }`}
                                    >
                                        {project.id === activeProjectId && <i className="fa-solid fa-circle text-xs mr-2 text-green-400"></i>}
                                        {project.name}
                                        <span className="ml-2 opacity-70">({getProjectPoints(project)} pts)</span>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Comparison View */}
                        {comparisonProjects.length >= 2 ? (
                            <div className="flex-1 overflow-auto">
                                {/* Summary Row */}
                                <div className="mb-4 grid gap-4" style={{ gridTemplateColumns: `200px repeat(${comparisonProjects.length}, 1fr)` }}>
                                    <div className="font-bold text-ink dark:text-white p-3">Total Points</div>
                                    {comparisonProjects.map(project => (
                                        <div key={project.id} className="p-3 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg text-center">
                                            <span className="text-2xl font-bold text-green-600 dark:text-green-400">{getProjectPoints(project)}</span>
                                            <p className="text-sm text-ink-2 dark:text-ink-3">{project.name}</p>
                                        </div>
                                    ))}
                                </div>

                                {/* Category Breakdown */}
                                <table className="w-full border-collapse">
                                    <thead>
                                        <tr className="border-b-2 border-line dark:border-gray-700">
                                            <th className="text-left p-3 font-bold text-ink dark:text-white">Category</th>
                                            {comparisonProjects.map(project => (
                                                <th key={project.id} className="text-center p-3 font-bold text-ink dark:text-white">
                                                    {project.name}
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {categoriesData.map(category => {
                                            const points = comparisonProjects.map(p => getProjectCategoryPoints(p, category.id));
                                            const maxPoints = Math.max(...points);
                                            return (
                                                <tr key={category.id} className="border-b border-line dark:border-gray-700 hover:bg-surface-1 dark:hover:bg-gray-700/50">
                                                    <td className="p-3">
                                                        <div className="flex items-center gap-2">
                                                            <span className={category.colorClasses?.text}><CategoryIcon category={category.id} size={18} /></span>
                                                            <span className="font-medium text-ink dark:text-gray-200">{category.name}</span>
                                                        </div>
                                                    </td>
                                                    {comparisonProjects.map((project, idx) => (
                                                        <td key={project.id} className="p-3 text-center">
                                                            <span className={`font-bold ${points[idx] === maxPoints && points[idx] > 0 ? 'text-green-600 dark:text-green-400' : 'text-ink dark:text-gray-300'}`}>
                                                                {points[idx]}
                                                            </span>
                                                        </td>
                                                    ))}
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>

                                {/* Credit Differences */}
                                <div className="mt-6">
                                    <h3 className="font-bold text-ink dark:text-white mb-3 flex items-center gap-2">
                                        <i className="fa-solid fa-not-equal text-amber-500"></i>
                                        Credit Differences
                                    </h3>
                                    <div className="space-y-2 max-h-60 overflow-y-auto">
                                        {getAllCreditKeys().map(creditKey => {
                                            const info = getCreditInfo(creditKey);
                                            if (!info) return null;

                                            const levels = comparisonProjects.map(p => getProjectCredits(p)[creditKey]?.level || null);
                                            const hasDifference = new Set(levels).size > 1;

                                            if (!hasDifference) return null;

                                            return (
                                                <div key={creditKey} className="p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800">
                                                    <div className="flex items-center justify-between">
                                                        <div className="flex items-center gap-2">
                                                            <span className={info.category.colorClasses?.text}><CategoryIcon category={info.category.id} size={16} /></span>
                                                            <span className="font-medium text-ink dark:text-gray-200">{info.credit.name}</span>
                                                        </div>
                                                        <div className="flex gap-4">
                                                            {comparisonProjects.map((project, idx) => (
                                                                <span key={project.id} className={`text-sm px-2 py-1 rounded ${
                                                                    levels[idx] ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300' : 'bg-gray-100 text-gray-500 dark:bg-gray-700 dark:text-gray-400'
                                                                }`}>
                                                                    {levels[idx] || 'Not selected'}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="flex-1 flex flex-col items-center justify-center text-center py-12">
                                <i className="fa-solid fa-code-compare text-5xl text-ink-3 dark:text-gray-500 mb-4"></i>
                                <p className="text-ink-2 dark:text-ink-3 text-lg">Select at least 2 projects to compare</p>
                                <p className="text-sm text-ink-3 dark:text-ink-2 mt-2">Click on the project buttons above to add them to the comparison</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Quick Analysis Panel Component
        function QuickAnalysisPanel({ isOpen, onClose, categoriesData, selectedCredits, onSelectCredit, onDeselectCredit }) {
            const [analysisMode, setAnalysisMode] = useState('whatif'); // 'whatif' | 'optimize' | 'category'
            const [whatIfCredits, setWhatIfCredits] = useState({});
            const [selectedCategory, setSelectedCategory] = useState(null);

            if (!isOpen) return null;

            // Calculate current points
            const currentPoints = Object.values(selectedCredits).reduce((sum, c) => sum + (c.points || 0), 0);

            // Calculate what-if points
            const whatIfPoints = Object.values(whatIfCredits).reduce((sum, c) => sum + (c.points || 0), 0);
            const totalWithWhatIf = currentPoints + whatIfPoints;

            // Get all available credits not yet selected
            const getAvailableCredits = () => {
                const available = [];
                categoriesData.forEach(cat => {
                    cat.credits.forEach(credit => {
                        const key = `${cat.id}-${credit.id}`;
                        if (!selectedCredits[key] && !whatIfCredits[key]) {
                            available.push({ key, credit, category: cat });
                        }
                    });
                });
                return available;
            };

            // Add credit to what-if analysis
            const addToWhatIf = (key, credit) => {
                const points = credit.performanceLevels?.[1]?.points || credit.points || 0;
                setWhatIfCredits(prev => ({ ...prev, [key]: { level: 'credit', points } }));
            };

            // Remove from what-if
            const removeFromWhatIf = (key) => {
                setWhatIfCredits(prev => {
                    const next = { ...prev };
                    delete next[key];
                    return next;
                });
            };

            // Apply what-if selections to actual project
            const applyWhatIf = () => {
                Object.entries(whatIfCredits).forEach(([key, data]) => {
                    onSelectCredit(key, data.level, data.points);
                });
                setWhatIfCredits({});
            };

            // Quick add actions
            const addAllEasyCredits = () => {
                categoriesData.forEach(cat => {
                    cat.credits.forEach(credit => {
                        const key = `${cat.id}-${credit.id}`;
                        if (!selectedCredits[key] && !whatIfCredits[key] && credit.difficulty === 'Easy') {
                            const points = credit.performanceLevels?.[1]?.points || credit.points || 0;
                            setWhatIfCredits(prev => ({ ...prev, [key]: { level: 'credit', points } }));
                        }
                    });
                });
            };

            const addCategoryCredits = (categoryId) => {
                const cat = categoriesData.find(c => c.id === categoryId);
                if (!cat) return;
                cat.credits.forEach(credit => {
                    const key = `${cat.id}-${credit.id}`;
                    if (!selectedCredits[key] && !whatIfCredits[key]) {
                        const points = credit.performanceLevels?.[1]?.points || credit.points || 0;
                        setWhatIfCredits(prev => ({ ...prev, [key]: { level: 'credit', points } }));
                    }
                });
            };

            const clearWhatIf = () => setWhatIfCredits({});

            // Calculate points for star ratings
            const getStarInfo = (points) => {
                if (points >= 100) return { stars: 6, name: 'World Leadership', color: 'text-purple-600' };
                if (points >= 85) return { stars: 5, name: 'Australian Excellence', color: 'text-green-600' };
                if (points >= 60) return { stars: 4, name: 'Best Practice', color: 'text-blue-600' };
                if (points >= 45) return { stars: 3, name: 'Good Practice', color: 'text-yellow-600' };
                return { stars: 0, name: 'Not Certified', color: 'text-gray-500' };
            };

            const currentStar = getStarInfo(currentPoints);
            const projectedStar = getStarInfo(totalWithWhatIf);

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" onClick={onClose}>
                    <div className="glass-card dark:bg-gray-800 rounded-2xl p-6 max-w-4xl w-full max-h-[85vh] overflow-hidden flex flex-col" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="font-display text-xl font-bold text-ink dark:text-white">
                                <i className="fa-solid fa-flask text-purple-500 mr-2"></i>
                                Quick Analysis & What-If
                            </h2>
                            <button onClick={onClose} className="w-10 h-10 rounded-full bg-surface-2 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center transition-colors">
                                <i className="fa-solid fa-xmark text-ink-2 dark:text-gray-300"></i>
                            </button>
                        </div>

                        {/* Impact Summary */}
                        <div className="mb-4 p-4 bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 rounded-xl border border-purple-200 dark:border-purple-800">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-purple-800 dark:text-purple-300">Current</p>
                                    <p className="text-2xl font-bold text-purple-600 dark:text-purple-400">{currentPoints} pts</p>
                                    <p className={`text-sm font-medium ${currentStar.color}`}>{currentStar.name}</p>
                                </div>
                                {Object.keys(whatIfCredits).length > 0 && (
                                    <>
                                        <div className="text-3xl text-purple-400">â†’</div>
                                        <div className="text-center">
                                            <p className="text-sm text-purple-800 dark:text-purple-300">Projected</p>
                                            <p className="text-2xl font-bold text-green-600 dark:text-green-400">{totalWithWhatIf} pts</p>
                                            <p className={`text-sm font-medium ${projectedStar.color}`}>{projectedStar.name}</p>
                                        </div>
                                        <div className="text-right">
                                            <p className="text-sm text-purple-800 dark:text-purple-300">Impact</p>
                                            <p className="text-2xl font-bold text-amber-600 dark:text-amber-400">+{whatIfPoints} pts</p>
                                            <p className="text-sm text-ink-2">{Object.keys(whatIfCredits).length} credits</p>
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>

                        {/* Quick Actions */}
                        <div className="mb-4 flex flex-wrap gap-2">
                            <button
                                onClick={addAllEasyCredits}
                                className="px-4 py-2 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-lg text-sm font-medium hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors"
                            >
                                <i className="fa-solid fa-bolt mr-2"></i>Add All Easy Credits
                            </button>
                            <div className="relative group">
                                <button className="px-4 py-2 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg text-sm font-medium hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors">
                                    <i className="fa-solid fa-layer-group mr-2"></i>Add Category <i className="fa-solid fa-chevron-down ml-1 text-xs"></i>
                                </button>
                                <div className="absolute top-full left-0 mt-1 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-line dark:border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10 min-w-48">
                                    {categoriesData.map(cat => (
                                        <button
                                            key={cat.id}
                                            onClick={() => addCategoryCredits(cat.id)}
                                            className="w-full px-4 py-2 text-left text-sm hover:bg-surface-1 dark:hover:bg-gray-700 flex items-center gap-2"
                                        >
                                            <span className={cat.colorClasses?.text}><CategoryIcon category={cat.id} size={16} /></span>
                                            {cat.name}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            {Object.keys(whatIfCredits).length > 0 && (
                                <>
                                    <button
                                        onClick={clearWhatIf}
                                        className="px-4 py-2 bg-gray-100 dark:bg-gray-700 text-ink-2 dark:text-gray-300 rounded-lg text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                                    >
                                        <i className="fa-solid fa-eraser mr-2"></i>Clear All
                                    </button>
                                    <button
                                        onClick={applyWhatIf}
                                        className="px-4 py-2 bg-green-500 text-white rounded-lg text-sm font-medium hover:bg-green-600 transition-colors"
                                    >
                                        <i className="fa-solid fa-check mr-2"></i>Apply to Project
                                    </button>
                                </>
                            )}
                        </div>

                        {/* What-If Credits List */}
                        <div className="flex-1 overflow-y-auto grid grid-cols-1 lg:grid-cols-2 gap-4">
                            {/* What-If Selection */}
                            <div>
                                <h3 className="font-bold text-ink dark:text-white mb-3 flex items-center gap-2 sticky top-0 bg-white dark:bg-gray-800 py-2">
                                    <i className="fa-solid fa-plus-circle text-green-500"></i>
                                    What-If Selection ({Object.keys(whatIfCredits).length})
                                </h3>
                                {Object.keys(whatIfCredits).length === 0 ? (
                                    <p className="text-ink-3 dark:text-ink-2 text-sm italic">Click on credits below to add them to your what-if analysis</p>
                                ) : (
                                    <div className="space-y-2">
                                        {Object.entries(whatIfCredits).map(([key, data]) => {
                                            let creditInfo = null;
                                            categoriesData.forEach(cat => {
                                                cat.credits.forEach(credit => {
                                                    if (`${cat.id}-${credit.id}` === key) {
                                                        creditInfo = { credit, category: cat };
                                                    }
                                                });
                                            });
                                            if (!creditInfo) return null;
                                            return (
                                                <div key={key} className="p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800 flex items-center justify-between">
                                                    <div className="flex items-center gap-2">
                                                        <span className={creditInfo.category.colorClasses?.text}><CategoryIcon category={creditInfo.category.id} size={16} /></span>
                                                        <span className="font-medium text-ink dark:text-gray-200 text-sm">{creditInfo.credit.name}</span>
                                                        <span className="text-green-600 dark:text-green-400 text-sm font-bold">+{data.points}</span>
                                                    </div>
                                                    <button onClick={() => removeFromWhatIf(key)} className="text-red-500 hover:text-red-600">
                                                        <i className="fa-solid fa-times"></i>
                                                    </button>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>

                            {/* Available Credits */}
                            <div>
                                <h3 className="font-bold text-ink dark:text-white mb-3 flex items-center gap-2 sticky top-0 bg-white dark:bg-gray-800 py-2">
                                    <i className="fa-solid fa-list text-blue-500"></i>
                                    Available Credits
                                </h3>
                                <div className="space-y-2 max-h-96 overflow-y-auto">
                                    {getAvailableCredits().slice(0, 30).map(({ key, credit, category }) => (
                                        <div
                                            key={key}
                                            onClick={() => addToWhatIf(key, credit)}
                                            className="p-3 bg-surface-1 dark:bg-gray-700/50 rounded-lg border border-line dark:border-gray-600 hover:border-green-400 dark:hover:border-green-600 cursor-pointer transition-colors flex items-center justify-between"
                                        >
                                            <div className="flex items-center gap-2">
                                                <span className={category.colorClasses?.text}><CategoryIcon category={category.id} size={16} /></span>
                                                <span className="font-medium text-ink dark:text-gray-200 text-sm">{credit.name}</span>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <span className={`text-xs px-2 py-0.5 rounded ${
                                                    credit.difficulty === 'Easy' ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300' :
                                                    credit.difficulty === 'Medium' ? 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300' :
                                                    'bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300'
                                                }`}>
                                                    {credit.difficulty}
                                                </span>
                                                <span className="text-ink-2 dark:text-ink-3 text-sm">+{credit.performanceLevels?.[1]?.points || credit.points || 0}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Onboarding Tour Component
        function OnboardingTour({ isOpen, onClose, onComplete }) {
            const [currentStep, setCurrentStep] = useState(0);
            const [tooltipPosition, setTooltipPosition] = useState({ top: 0, left: 0 });

            const tourSteps = [
                {
                    title: "Welcome to Green Star! ðŸ‘‹",
                    content: "This assistant helps you track and manage your Green Star Buildings certification. Let's take a quick tour of the key features.",
                    target: null, // Welcome screen, no specific target
                    position: "center"
                },
                {
                    title: "Project Selector",
                    content: "Click here to switch between projects, create new ones, or clone scenarios for what-if analysis. You can manage multiple projects at once.",
                    target: "[data-tour='project-selector']",
                    position: "right"
                },
                {
                    title: "Your Score",
                    content: "Track your current points and star rating in real-time. The progress bar shows how close you are to your target rating.",
                    target: "[data-tour='score-display']",
                    position: "right"
                },
                {
                    title: "Target Rating",
                    content: "Set your target star rating (4, 5, or 6 stars) to see how many points you still need and get tailored recommendations.",
                    target: "[data-tour='target-rating']",
                    position: "right"
                },
                {
                    title: "Credit Categories",
                    content: "Browse credits by category. Each category has color-coded icons. Click a category to filter, or click 'All' to see everything.",
                    target: "[data-tour='categories']",
                    position: "right"
                },
                {
                    title: "Analysis Tools",
                    content: "Use these powerful tools: Templates for quick setup, Gap Analysis for recommendations, Synergies for related credits, and What-If for scenario testing.",
                    target: "[data-tour='tools']",
                    position: "right"
                },
                {
                    title: "Compare & What-If",
                    content: "Compare multiple projects side-by-side, or use What-If to test adding credits before committing. Great for exploring strategies!",
                    target: "[data-tour='scenario-tools']",
                    position: "right"
                },
                {
                    title: "Credit Cards",
                    content: "Each card shows a credit with its points, difficulty, and status. Click to expand and see full details, documentation requirements, and FAQs.",
                    target: "[data-tour='credit-cards']",
                    position: "left"
                },
                {
                    title: "You're Ready! ðŸŽ‰",
                    content: "That's the basics! Start by selecting credits that match your project goals. Use the search bar to find specific credits quickly. Good luck with your certification!",
                    target: null,
                    position: "center"
                }
            ];

            const step = tourSteps[currentStep];
            const isFirstStep = currentStep === 0;
            const isLastStep = currentStep === tourSteps.length - 1;
            const isCenterStep = step.position === "center";

            // Calculate tooltip position when step changes
            useEffect(() => {
                if (!isOpen || !step.target) return;

                const targetEl = document.querySelector(step.target);
                if (!targetEl) return;

                const rect = targetEl.getBoundingClientRect();
                const tooltipWidth = 320; // max-w-sm is roughly 320px
                const tooltipHeight = 200; // approximate height
                const padding = 16;

                let top, left;

                if (step.position === 'right') {
                    // Position to the right of the element
                    left = rect.right + padding;
                    top = rect.top + (rect.height / 2) - (tooltipHeight / 2);
                    // Make sure it doesn't go off screen
                    if (left + tooltipWidth > window.innerWidth) {
                        left = rect.left - tooltipWidth - padding;
                    }
                } else if (step.position === 'left') {
                    // Position to the left of the element
                    left = rect.left - tooltipWidth - padding;
                    top = rect.top;
                    // Make sure it doesn't go off screen
                    if (left < 0) {
                        left = rect.right + padding;
                    }
                } else if (step.position === 'bottom') {
                    // Position below the element
                    left = rect.left + (rect.width / 2) - (tooltipWidth / 2);
                    top = rect.bottom + padding;
                } else if (step.position === 'top') {
                    // Position above the element
                    left = rect.left + (rect.width / 2) - (tooltipWidth / 2);
                    top = rect.top - tooltipHeight - padding;
                }

                // Constrain to viewport
                top = Math.max(padding, Math.min(top, window.innerHeight - tooltipHeight - padding));
                left = Math.max(padding, Math.min(left, window.innerWidth - tooltipWidth - padding));

                setTooltipPosition({ top, left });
            }, [currentStep, isOpen, step.target, step.position]);

            if (!isOpen) return null;

            const handleNext = () => {
                if (isLastStep) {
                    onComplete();
                } else {
                    setCurrentStep(prev => prev + 1);
                }
            };

            const handlePrev = () => {
                if (currentStep > 0) {
                    setCurrentStep(prev => prev - 1);
                }
            };

            const handleSkip = () => {
                onComplete();
            };

            // For center positioned steps (welcome/finish), show a modal
            if (isCenterStep) {
                return (
                    <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
                        <div className="bg-white dark:bg-gray-800 rounded-2xl p-8 max-w-md w-full shadow-2xl animate-fade-in">
                            <div className="text-center mb-6">
                                <div className="w-16 h-16 bg-gradient-to-br from-[#1F4B2E] to-[#2E6B3F] rounded-2xl flex items-center justify-center mx-auto mb-4">
                                    <i className="fa-solid fa-leaf text-white text-2xl"></i>
                                </div>
                                <h2 className="font-display text-2xl font-bold text-ink dark:text-white mb-2">{step.title}</h2>
                                <p className="text-ink-2 dark:text-gray-300">{step.content}</p>
                            </div>

                            <div className="flex items-center justify-between">
                                <button
                                    onClick={handleSkip}
                                    className="text-ink-3 hover:text-ink text-sm"
                                >
                                    Skip Tour
                                </button>
                                <div className="flex items-center gap-2">
                                    {!isFirstStep && (
                                        <button
                                            onClick={handlePrev}
                                            className="px-4 py-2 text-ink-2 hover:text-ink"
                                        >
                                            Back
                                        </button>
                                    )}
                                    <button
                                        onClick={handleNext}
                                        className="px-6 py-2 bg-[#1F4B2E] text-white rounded-lg font-medium hover:bg-[#2E6B3F] transition-colors"
                                    >
                                        {isLastStep ? "Get Started" : "Start Tour"}
                                    </button>
                                </div>
                            </div>

                            {/* Progress dots */}
                            <div className="flex justify-center gap-1.5 mt-6">
                                {tourSteps.map((_, idx) => (
                                    <div
                                        key={idx}
                                        className={`w-2 h-2 rounded-full transition-colors ${
                                            idx === currentStep ? 'bg-[#1F4B2E]' : 'bg-gray-200 dark:bg-gray-600'
                                        }`}
                                    />
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            // For targeted steps, show a tooltip near the target element
            return (
                <div className="fixed inset-0 z-[100]">
                    {/* Backdrop with hole for target */}
                    <div className="absolute inset-0 bg-black/40" onClick={handleSkip} />

                    {/* Highlight overlay on target */}
                    <style>{`
                        [data-tour='${step.target?.replace(/[\[\]']/g, '').split('=')[1]}'] {
                            position: relative;
                            z-index: 101;
                            box-shadow: 0 0 0 4px rgba(46, 107, 63, 0.5), 0 0 0 8px rgba(46, 107, 63, 0.2);
                            border-radius: 12px;
                        }
                    `}</style>

                    {/* Tooltip */}
                    <div
                        className="fixed z-[102] bg-white dark:bg-gray-800 rounded-xl p-5 shadow-2xl max-w-sm animate-fade-in"
                        style={{
                            top: tooltipPosition.top,
                            left: tooltipPosition.left
                        }}
                    >
                        <div className="flex items-start gap-3 mb-3">
                            <div className="w-8 h-8 bg-[#1F4B2E] rounded-lg flex items-center justify-center flex-shrink-0">
                                <span className="text-white font-bold text-sm">{currentStep}</span>
                            </div>
                            <div>
                                <h3 className="font-display font-bold text-ink dark:text-white">{step.title}</h3>
                            </div>
                        </div>
                        <p className="text-ink-2 dark:text-gray-300 text-sm mb-4 ml-11">{step.content}</p>

                        <div className="flex items-center justify-between ml-11">
                            <button
                                onClick={handleSkip}
                                className="text-ink-3 hover:text-ink text-xs"
                            >
                                Skip
                            </button>
                            <div className="flex items-center gap-2">
                                <button
                                    onClick={handlePrev}
                                    className="px-3 py-1.5 text-ink-2 hover:text-ink text-sm"
                                    disabled={isFirstStep}
                                >
                                    Back
                                </button>
                                <button
                                    onClick={handleNext}
                                    className="px-4 py-1.5 bg-[#1F4B2E] text-white rounded-lg text-sm font-medium hover:bg-[#2E6B3F] transition-colors"
                                >
                                    {isLastStep ? "Finish" : "Next"}
                                </button>
                            </div>
                        </div>

                        {/* Progress */}
                        <div className="flex justify-center gap-1 mt-4">
                            {tourSteps.map((_, idx) => (
                                <div
                                    key={idx}
                                    className={`w-1.5 h-1.5 rounded-full ${
                                        idx === currentStep ? 'bg-[#1F4B2E]' : 'bg-gray-200 dark:bg-gray-600'
                                    }`}
                                />
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Admin Import Modal Component
        function AdminImportModal({ isOpen, onClose, onImportData }) {
            const [importStatus, setImportStatus] = useState(null);
            const [importPreview, setImportPreview] = useState(null);
            const [isProcessing, setIsProcessing] = useState(false);
            const fileInputRef = React.useRef(null);

            if (!isOpen) return null;

            const handleFileUpload = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                setIsProcessing(true);
                setImportStatus({ type: 'info', message: 'Reading file...' });

                try {
                    const data = await file.arrayBuffer();
                    const workbook = XLSX.read(data, { type: 'array' });

                    // Parse each sheet
                    const sheets = {};
                    const sheetNames = ['Categories', 'Credits', 'Levels', 'Criteria', 'Documentation', 'Templates', 'Synergies'];

                    sheetNames.forEach(name => {
                        if (workbook.SheetNames.includes(name)) {
                            sheets[name] = XLSX.utils.sheet_to_json(workbook.Sheets[name]);
                        }
                    });

                    // Validate and preview
                    const preview = {
                        categories: sheets.Categories?.length || 0,
                        credits: sheets.Credits?.length || 0,
                        levels: sheets.Levels?.length || 0,
                        criteria: sheets.Criteria?.length || 0,
                        documentation: sheets.Documentation?.length || 0,
                        templates: sheets.Templates?.length || 0,
                        synergies: sheets.Synergies?.length || 0,
                        rawData: sheets
                    };

                    setImportPreview(preview);
                    setImportStatus({ type: 'success', message: 'File parsed successfully! Review the data below.' });
                } catch (error) {
                    setImportStatus({ type: 'error', message: `Error reading file: ${error.message}` });
                } finally {
                    setIsProcessing(false);
                }
            };

            const handleApplyImport = () => {
                if (!importPreview?.rawData) return;

                setIsProcessing(true);
                setImportStatus({ type: 'info', message: 'Applying data...' });

                try {
                    // Transform spreadsheet data to app format
                    const transformedData = transformSpreadsheetData(importPreview.rawData);

                    // Save to localStorage for persistence
                    localStorage.setItem('greenstar_admin_data', JSON.stringify(transformedData));

                    // Notify parent to reload data
                    onImportData(transformedData);

                    setImportStatus({ type: 'success', message: 'Data imported successfully! The page will reload to apply changes.' });

                    // Reload after a short delay
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } catch (error) {
                    setImportStatus({ type: 'error', message: `Error applying data: ${error.message}` });
                    setIsProcessing(false);
                }
            };

            const transformSpreadsheetData = (sheets) => {
                const { Categories, Credits, Levels, Criteria, Documentation, Templates, Synergies } = sheets;

                // Build categories lookup
                const categoriesMap = {};
                Categories?.forEach(cat => {
                    categoriesMap[cat['Category ID']] = {
                        id: cat['Category ID'],
                        name: cat['Category Name'],
                        description: cat['Description'],
                        icon: cat['Icon (FontAwesome)'],
                        color: cat['Color Theme'],
                        order: cat['Display Order']
                    };
                });

                // Build credits with their levels and criteria
                const creditsData = [];
                Credits?.forEach(credit => {
                    const creditId = credit['Credit ID'];
                    const categoryId = credit['Category'];

                    // Get levels for this credit
                    const creditLevels = Levels?.filter(l => l['Credit ID'] === creditId) || [];
                    const performanceLevels = creditLevels.map(level => {
                        const levelType = level['Level Type'];
                        const levelKey = levelType === 'Minimum Expectation' ? 'minimum' :
                                        levelType === 'Credit Achievement' ? 'credit' : 'exceptional';

                        // Get criteria for this level
                        const levelCriteria = Criteria?.filter(c =>
                            c['Credit ID'] === creditId && c['Level Type'] === levelType
                        ) || [];

                        return {
                            level: levelKey,
                            points: level['Points'],
                            summary: level['Summary'],
                            description: level['Description'],
                            criteria: levelCriteria.map(c => c['Criteria Text'])
                        };
                    });

                    // Get documentation for this credit
                    const creditDocs = Documentation?.filter(d => d['Credit ID'] === creditId) || [];

                    creditsData.push({
                        id: creditId,
                        name: credit['Credit Name'],
                        category: categoryId,
                        shortDescription: credit['Short Description'],
                        description: credit['Full Description'],
                        required: credit['Is Required?'] === 'Yes',
                        maxPoints: credit['Max Points'],
                        order: credit['Display Order'],
                        performanceLevels,
                        documentation: creditDocs.map(d => ({
                            name: d['Document Name'],
                            type: d['Document Type'],
                            description: d['Description'],
                            templateAvailable: d['Template Available?'] === 'Yes',
                            templateLink: d['Template Link']
                        }))
                    });
                });

                // Transform templates
                const templatesData = Templates?.map(t => ({
                    id: t['Template ID'],
                    name: t['Template Name'],
                    type: t['Building Type'],
                    description: t['Description'],
                    targetRating: t['Target Star Rating'],
                    recommendedCredits: t['Recommended Credits (comma-separated)']?.split(',').map(s => s.trim()) || [],
                    active: t['Is Active?'] === 'Yes'
                })) || [];

                // Transform synergies
                const synergiesData = Synergies?.map(s => ({
                    id: s['Synergy ID'],
                    credit1: s['Credit 1'],
                    credit2: s['Credit 2'],
                    type: s['Synergy Type'],
                    description: s['Description'],
                    recommendation: s['Recommendation']
                })) || [];

                return {
                    categories: categoriesMap,
                    credits: creditsData,
                    templates: templatesData,
                    synergies: synergiesData,
                    importedAt: new Date().toISOString()
                };
            };

            const handleDownloadTemplate = () => {
                // Create download link for the template
                setImportStatus({ type: 'info', message: 'Download the GreenStar_Admin_Data.xlsx file from the project folder.' });
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop" onClick={onClose}>
                    <div className="glass-card dark:bg-gray-800 rounded-2xl p-6 max-w-2xl w-full max-h-[85vh] overflow-hidden flex flex-col" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="font-display text-xl font-bold text-ink dark:text-white">
                                <i className="fa-solid fa-file-import text-indigo-500 mr-2"></i>
                                Admin Data Import
                            </h2>
                            <button onClick={onClose} className="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center transition-colors">
                                <i className="fa-solid fa-xmark text-ink-2 dark:text-gray-300"></i>
                            </button>
                        </div>

                        <div className="mb-6 p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-xl border border-indigo-200 dark:border-indigo-800">
                            <p className="text-indigo-800 dark:text-indigo-300 text-sm mb-2">
                                <i className="fa-solid fa-shield-halved mr-2"></i>
                                <strong>Admin Only:</strong> Import credit data from the admin spreadsheet.
                            </p>
                            <p className="text-indigo-600 dark:text-indigo-400 text-xs">
                                Use the <code className="bg-indigo-100 dark:bg-indigo-900 px-1 rounded">GreenStar_Admin_Data.xlsx</code> spreadsheet to manage all credit definitions, criteria, templates, and synergies.
                            </p>
                        </div>

                        {/* File Upload */}
                        <div className="mb-6">
                            <input
                                ref={fileInputRef}
                                type="file"
                                accept=".xlsx,.xls"
                                onChange={handleFileUpload}
                                className="hidden"
                            />
                            <button
                                onClick={() => fileInputRef.current?.click()}
                                disabled={isProcessing}
                                className="w-full py-4 border-2 border-dashed border-indigo-300 dark:border-indigo-600 rounded-xl hover:border-indigo-500 dark:hover:border-indigo-400 transition-colors flex flex-col items-center gap-2 text-indigo-600 dark:text-indigo-400 hover:text-indigo-700 dark:hover:text-indigo-300"
                            >
                                <i className={`fa-solid ${isProcessing ? 'fa-spinner fa-spin' : 'fa-cloud-arrow-up'} text-3xl`}></i>
                                <span className="font-medium">{isProcessing ? 'Processing...' : 'Click to upload Excel file'}</span>
                                <span className="text-xs text-ink-2">.xlsx or .xls files only</span>
                            </button>
                        </div>

                        {/* Status Message */}
                        {importStatus && (
                            <div className={`mb-4 p-3 rounded-lg text-sm ${
                                importStatus.type === 'success' ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 border border-green-300 dark:border-green-700' :
                                importStatus.type === 'error' ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 border border-red-300 dark:border-red-700' :
                                'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-blue-300 dark:border-blue-700'
                            }`}>
                                <i className={`fa-solid ${
                                    importStatus.type === 'success' ? 'fa-check-circle' :
                                    importStatus.type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'
                                } mr-2`}></i>
                                {importStatus.message}
                            </div>
                        )}

                        {/* Preview */}
                        {importPreview && (
                            <div className="flex-1 overflow-y-auto mb-4">
                                <h3 className="font-bold text-ink dark:text-white mb-3">Import Preview</h3>
                                <div className="grid grid-cols-2 gap-3">
                                    {[
                                        { name: 'Categories', count: importPreview.categories, icon: 'fa-folder', color: 'blue' },
                                        { name: 'Credits', count: importPreview.credits, icon: 'fa-clipboard-check', color: 'green' },
                                        { name: 'Levels', count: importPreview.levels, icon: 'fa-layer-group', color: 'purple' },
                                        { name: 'Criteria', count: importPreview.criteria, icon: 'fa-list-check', color: 'amber' },
                                        { name: 'Documentation', count: importPreview.documentation, icon: 'fa-file-lines', color: 'cyan' },
                                        { name: 'Templates', count: importPreview.templates, icon: 'fa-copy', color: 'pink' },
                                        { name: 'Synergies', count: importPreview.synergies, icon: 'fa-link', color: 'teal' },
                                    ].map(item => (
                                        <div key={item.name} className={`p-3 bg-${item.color}-50 dark:bg-${item.color}-900/20 rounded-lg border border-${item.color}-200 dark:border-${item.color}-800`}>
                                            <div className="flex items-center gap-2">
                                                <i className={`fa-solid ${item.icon} text-${item.color}-500`}></i>
                                                <span className="text-sm font-medium text-ink dark:text-gray-300">{item.name}</span>
                                                <span className={`ml-auto font-bold text-${item.color}-600 dark:text-${item.color}-400`}>{item.count}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Actions */}
                        <div className="flex gap-3 pt-4 border-t border-line dark:border-gray-700">
                            <button
                                onClick={handleDownloadTemplate}
                                className="flex-1 py-2 px-4 bg-gray-100 dark:bg-gray-700 text-ink dark:text-gray-300 rounded-lg font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                            >
                                <i className="fa-solid fa-download mr-2"></i>
                                Get Template
                            </button>
                            <button
                                onClick={handleApplyImport}
                                disabled={!importPreview || isProcessing}
                                className="flex-1 py-2 px-4 bg-indigo-500 text-white rounded-lg font-medium hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            >
                                <i className="fa-solid fa-check mr-2"></i>
                                Apply Import
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Header Component
        function Header({ projectName, onProjectNameChange }) {
            const [isEditing, setIsEditing] = useState(false);
            const [tempName, setTempName] = useState(projectName);

            const handleSave = () => {
                onProjectNameChange(tempName);
                setIsEditing(false);
            };

            return (
                <header className="gbca-header rounded-2xl p-5 shadow-lg mb-6">
                    <div className="flex items-center justify-between">
                        <div className="flex items-center gap-4">
                            {/* Green Star Logo */}
                            <div className="flex items-center gap-1">
                                <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M24 4L28.5 17.5H42L31 26.5L35.5 40L24 31L12.5 40L17 26.5L6 17.5H19.5L24 4Z" fill="white" opacity="0.9"/>
                                    <circle cx="24" cy="24" r="8" fill="white" opacity="0.3"/>
                                </svg>
                            </div>
                            <div>
                                <h1 className="font-display text-xl font-bold text-white tracking-tight">Green Star Buildings</h1>
                                <p className="text-sm text-white/70">Submission Assistant v1.1</p>
                            </div>
                        </div>

                        <div className="flex items-center gap-3">
                            {isEditing ? (
                                <div className="flex items-center gap-2">
                                    <input
                                        type="text"
                                        value={tempName}
                                        onChange={(e) => setTempName(e.target.value)}
                                        className="px-3 py-2 bg-white/20 border border-white/30 rounded-lg text-sm text-white placeholder-white/50 focus:outline-none focus:border-white/60"
                                        autoFocus
                                    />
                                    <button
                                        onClick={handleSave}
                                        className="px-4 py-2 bg-white text-gbca-green rounded-lg text-sm font-semibold hover:bg-white/90 transition-colors"
                                    >
                                        Save
                                    </button>
                                </div>
                            ) : (
                                <button
                                    onClick={() => setIsEditing(true)}
                                    className="flex items-center gap-2 px-4 py-2 bg-white/10 border border-white/20 rounded-lg hover:bg-white/20 transition-colors"
                                >
                                    <i className="fa-solid fa-building text-white/80"></i>
                                    <span className="font-medium text-white">{projectName}</span>
                                    <i className="fa-solid fa-pen text-xs text-white/50"></i>
                                </button>
                            )}
                        </div>
                    </div>
                </header>
            );
        }

        // Quick Actions Component
        function QuickActions({ onOpenCalculators, onOpenExport }) {
            return (
                <div className="flex gap-3 mb-6">
                    <button
                        onClick={onOpenCalculators}
                        className="flex items-center gap-2 px-4 py-2 bg-white border border-line rounded-xl hover:border-green-300 hover:bg-green-50 transition-all"
                    >
                        <i className="fa-solid fa-calculator text-green-600"></i>
                        <span className="font-medium text-ink">Calculators</span>
                    </button>

                    <button
                        onClick={onOpenExport}
                        className="flex items-center gap-2 px-4 py-2 bg-white border border-line rounded-xl hover:border-blue-300 hover:bg-blue-50 transition-all"
                    >
                        <i className="fa-solid fa-download text-blue-600"></i>
                        <span className="font-medium text-ink">Export</span>
                    </button>

                    <button
                        className="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-xl hover:shadow-lg transition-all opacity-60 cursor-not-allowed"
                        disabled
                    >
                        <i className="fa-solid fa-robot"></i>
                        <span className="font-medium">AI Assistant</span>
                        <span className="text-xs bg-white/20 px-2 py-0.5 rounded">Soon</span>
                    </button>
                </div>
            );
        }

        // Main App Component
        function App() {
            const [projectName, setProjectName] = useState('My Green Star Project');
            const [activeCategory, setActiveCategory] = useState('all'); // 'all' shows all categories
            const [selectedCredits, setSelectedCredits] = useState({});
            const [showCalculators, setShowCalculators] = useState(false);
            const [selectedCalculator, setSelectedCalculator] = useState(null);
            const [calculatorResults, setCalculatorResults] = useState({});
            const [showExport, setShowExport] = useState(false);
            const [creditDetailModal, setCreditDetailModal] = useState({ isOpen: false, credit: null, category: null });
            const [phaseFilter, setPhaseFilter] = useState('all');
            const [searchQuery, setSearchQuery] = useState('');
            const [darkMode, setDarkMode] = useState(false);
            const [showQuickWins, setShowQuickWins] = useState(false);
            const [showRequired, setShowRequired] = useState(false); // Minimum expectations filter
            const [creditNotes, setCreditNotes] = useState({});
            const [creditDocs, setCreditDocs] = useState({});
            const [creditAssignments, setCreditAssignments] = useState({});
            const [activeView, setActiveView] = useState('credits'); // 'credits' | 'timeline' | 'matrix'
            const [sidebarOpen, setSidebarOpen] = useState(true);

            // Multi-project support
            const [projects, setProjects] = useState([]);
            const [activeProjectId, setActiveProjectId] = useState(null);
            const [showProjectManager, setShowProjectManager] = useState(false);
            const [showProjectDropdown, setShowProjectDropdown] = useState(false);

            // Templates and analysis
            const [showTemplates, setShowTemplates] = useState(false);
            const [showGapAnalysis, setShowGapAnalysis] = useState(false);
            const [showSynergies, setShowSynergies] = useState(false);
            const [showAdminImport, setShowAdminImport] = useState(false);
            const [targetStarRating, setTargetStarRating] = useState(5); // Target: 4, 5, or 6 stars

            // Scenario analysis
            const [showComparison, setShowComparison] = useState(false);
            const [showQuickAnalysis, setShowQuickAnalysis] = useState(false);

            // Onboarding tour
            const [showTour, setShowTour] = useState(false);

            // Check if first visit and show tour
            React.useEffect(() => {
                const hasSeenTour = localStorage.getItem('greenstar-tour-completed');
                if (!hasSeenTour) {
                    // Delay tour start slightly to let UI render
                    setTimeout(() => setShowTour(true), 500);
                }
            }, []);

            const completeTour = () => {
                setShowTour(false);
                localStorage.setItem('greenstar-tour-completed', 'true');
            };

            const restartTour = () => {
                setShowTour(true);
            };

            // FAQ data
            const [faqData, setFaqData] = useState([]);

            // Admin data sync state
            const [adminDataTimestamp, setAdminDataTimestamp] = useState(() => getAdminDataTimestamp());
            const [showDataUpdateBanner, setShowDataUpdateBanner] = useState(false);
            const [commonMistakesData, setCommonMistakesData] = useState(() => loadCommonMistakesData());
            const [dataVersion, setDataVersion] = useState(0); // Used to trigger re-render after reload

            // Check for admin data updates periodically
            useEffect(() => {
                const checkForUpdates = () => {
                    const currentTimestamp = getAdminDataTimestamp();
                    if (currentTimestamp && currentTimestamp !== adminDataTimestamp) {
                        setShowDataUpdateBanner(true);
                    }
                };

                // Check every 5 seconds for updates (useful when admin panel is open in another tab)
                const interval = setInterval(checkForUpdates, 5000);
                return () => clearInterval(interval);
            }, [adminDataTimestamp]);

            // Reload all data from admin panel
            const reloadAdminData = () => {
                // Force reload by refreshing the page with the new data
                const newTimestamp = getAdminDataTimestamp();
                setAdminDataTimestamp(newTimestamp);
                setCommonMistakesData(loadCommonMistakesData());
                setShowDataUpdateBanner(false);
                setDataVersion(v => v + 1);

                // Force full page reload to get updated categories, templates, etc.
                window.location.reload();
            };

            // BroadcastChannel for syncing between browser tabs
            const syncChannel = React.useRef(null);

            useEffect(() => {
                // Create broadcast channel for cross-tab sync
                if ('BroadcastChannel' in window) {
                    syncChannel.current = new BroadcastChannel('greenstar-sync');

                    // Listen for updates from other tabs
                    syncChannel.current.onmessage = (event) => {
                        if (event.data.type === 'PROJECT_UPDATE') {
                            const data = event.data.payload;
                            setProjectName(data.projectName || 'My Green Star Project');
                            setSelectedCredits(data.selectedCredits || {});
                            setCreditNotes(data.creditNotes || {});
                            setCreditDocs(data.creditDocs || {});
                            setCreditAssignments(data.creditAssignments || {});
                            console.log('Synced project data from another tab');
                        }
                    };
                }

                return () => {
                    if (syncChannel.current) {
                        syncChannel.current.close();
                    }
                };
            }, []);

            // Broadcast changes to other tabs
            const broadcastUpdate = React.useCallback((data) => {
                if (syncChannel.current) {
                    syncChannel.current.postMessage({
                        type: 'PROJECT_UPDATE',
                        payload: data,
                        timestamp: Date.now()
                    });
                }
            }, []);

            // Project phases for filtering
            const projectPhases = [
                { id: 'all', name: 'All Phases', icon: 'fa-layer-group' },
                { id: 'Concept', name: 'Concept', icon: 'fa-lightbulb' },
                { id: 'Schematic', name: 'Schematic Design', icon: 'fa-pencil-ruler' },
                { id: 'Design Dev', name: 'Design Development', icon: 'fa-drafting-compass' },
                { id: 'Documentation', name: 'Documentation', icon: 'fa-file-lines' },
                { id: 'Construction', name: 'Construction', icon: 'fa-hammer' },
                { id: 'Handover', name: 'Handover', icon: 'fa-handshake' }
            ];

            // Helper to normalize credit format
            const normalizeCredits = (credits) => {
                const normalized = {};
                Object.entries(credits || {}).forEach(([key, value]) => {
                    if (typeof value === 'number') {
                        normalized[key] = { level: 'credit', points: value };
                    } else {
                        normalized[key] = value;
                    }
                });
                return normalized;
            };

            // Load from localStorage on mount
            useEffect(() => {
                // Load projects list
                const savedProjects = localStorage.getItem('greenstar-projects');
                if (savedProjects) {
                    try {
                        const projectsList = JSON.parse(savedProjects);
                        setProjects(projectsList);
                    } catch (e) {
                        console.error('Failed to load projects list:', e);
                    }
                }

                // Load current project
                const saved = localStorage.getItem('greenstar-project');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        setProjectName(data.projectName || 'My Green Star Project');
                        setSelectedCredits(normalizeCredits(data.selectedCredits));
                        setCreditNotes(data.creditNotes || {});
                        setCreditDocs(data.creditDocs || {});
                        setCreditAssignments(data.creditAssignments || {});
                        // Don't load darkMode from localStorage - default to light theme like GBCA website
                        // setDarkMode(data.darkMode || false);
                        if (data.projectId) setActiveProjectId(data.projectId);
                    } catch (e) {
                        console.error('Failed to load saved project:', e);
                    }
                }
            }, []);

            // Load FAQ data from Excel file on mount
            useEffect(() => {
                const loadFAQs = async () => {
                    try {
                        // Try to load FAQ Excel file
                        const response = await fetch('FAQs for Green Star Buildings copy.xlsx');
                        if (!response.ok) {
                            console.log('FAQ file not found, FAQs will not be available');
                            return;
                        }
                        const arrayBuffer = await response.arrayBuffer();
                        const workbook = XLSX.read(arrayBuffer, { type: 'array' });

                        // Get the first sheet
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];

                        // Convert to JSON
                        const data = XLSX.utils.sheet_to_json(worksheet);

                        // Filter valid FAQs (with title and description)
                        const validFaqs = data.filter(row => row.title && row.description);

                        console.log(`Loaded ${validFaqs.length} FAQs from Excel file`);
                        setFaqData(validFaqs);
                    } catch (error) {
                        console.log('Could not load FAQ file:', error.message);
                    }
                };

                loadFAQs();
            }, []);

            // Save to localStorage on change and broadcast to other tabs
            useEffect(() => {
                const data = { projectName, selectedCredits, creditNotes, creditDocs, creditAssignments, darkMode, projectId: activeProjectId };
                localStorage.setItem('greenstar-project', JSON.stringify(data));

                // Broadcast to other tabs for sync
                broadcastUpdate(data);
            }, [projectName, selectedCredits, creditNotes, creditDocs, creditAssignments, darkMode, activeProjectId, broadcastUpdate]);

            // Save projects list
            useEffect(() => {
                if (projects.length > 0) {
                    localStorage.setItem('greenstar-projects', JSON.stringify(projects));
                }
            }, [projects]);

            // Multi-project handlers
            const createNewProject = (name, templateId = null) => {
                const newProject = {
                    id: Date.now().toString(),
                    name: name || 'New Project',
                    createdAt: new Date().toISOString(),
                    templateId
                };

                // If template selected, apply it
                let initialCredits = {};
                if (templateId) {
                    const template = projectTemplates.find(t => t.id === templateId);
                    if (template) {
                        template.suggestedCredits.forEach(creditKey => {
                            const [catId, credId] = creditKey.split('-').slice(0, 2);
                            const fullKey = creditKey.includes('-') ? creditKey : `${catId}-${credId}`;
                            // Find the credit to get its points
                            categoriesData.forEach(cat => {
                                cat.credits.forEach(credit => {
                                    if (`${cat.id}-${credit.id}` === fullKey) {
                                        initialCredits[fullKey] = { level: 'credit', points: credit.performanceLevels?.[1]?.points || credit.points };
                                    }
                                });
                            });
                        });
                    }
                }

                // Save current project to projects list before switching
                if (activeProjectId) {
                    setProjects(prev => prev.map(p =>
                        p.id === activeProjectId
                            ? { ...p, data: { projectName, selectedCredits, creditNotes, creditDocs, creditAssignments } }
                            : p
                    ));
                }

                setProjects(prev => [...prev, newProject]);
                setActiveProjectId(newProject.id);
                setProjectName(newProject.name);
                setSelectedCredits(initialCredits);
                setCreditNotes({});
                setCreditDocs({});
                setCreditAssignments({});
                setShowProjectManager(false);
                setShowTemplates(false);
            };

            const switchProject = (projectId) => {
                // Save current project
                if (activeProjectId) {
                    setProjects(prev => prev.map(p =>
                        p.id === activeProjectId
                            ? { ...p, data: { projectName, selectedCredits, creditNotes, creditDocs, creditAssignments } }
                            : p
                    ));
                }

                // Load selected project
                const project = projects.find(p => p.id === projectId);
                if (project && project.data) {
                    setProjectName(project.data.projectName || project.name);
                    setSelectedCredits(normalizeCredits(project.data.selectedCredits));
                    setCreditNotes(project.data.creditNotes || {});
                    setCreditDocs(project.data.creditDocs || {});
                    setCreditAssignments(project.data.creditAssignments || {});
                }
                setActiveProjectId(projectId);
                setShowProjectManager(false);
            };

            const deleteProject = (projectId) => {
                if (projects.length <= 1) {
                    alert('Cannot delete the only project');
                    return;
                }
                setProjects(prev => prev.filter(p => p.id !== projectId));
                if (activeProjectId === projectId) {
                    const remaining = projects.filter(p => p.id !== projectId);
                    if (remaining.length > 0) {
                        switchProject(remaining[0].id);
                    }
                }
            };

            // Clone project as a scenario/variant
            const cloneProjectAsScenario = (projectId, newName) => {
                const sourceProject = projects.find(p => p.id === projectId);
                if (!sourceProject) return;

                // Get source project's data
                let sourceData;
                if (projectId === activeProjectId) {
                    sourceData = { projectName, selectedCredits, creditNotes, creditDocs, creditAssignments };
                } else {
                    sourceData = sourceProject.data || {};
                }

                const clonedProject = {
                    id: Date.now().toString(),
                    name: newName || `${sourceProject.name} (Scenario)`,
                    createdAt: new Date().toISOString(),
                    parentId: projectId, // Track which project it was cloned from
                    isScenario: true,
                    data: {
                        projectName: newName || `${sourceData.projectName || sourceProject.name} (Scenario)`,
                        selectedCredits: { ...sourceData.selectedCredits },
                        creditNotes: { ...sourceData.creditNotes },
                        creditDocs: { ...sourceData.creditDocs },
                        creditAssignments: { ...sourceData.creditAssignments }
                    }
                };

                setProjects(prev => [...prev, clonedProject]);
                // Optionally switch to the new scenario
                switchProject(clonedProject.id);
            };

            // Import project from JSON file
            const handleImportProject = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        // Validate the data has expected structure
                        if (data.projectName || data.selectedCredits) {
                            setProjectName(data.projectName || 'Imported Project');
                            setSelectedCredits(normalizeCredits(data.selectedCredits));
                            setCreditNotes(data.creditNotes || {});
                            setCreditDocs(data.creditDocs || {});
                            setCreditAssignments(data.creditAssignments || {});

                            // Add to projects list
                            const importedProject = {
                                id: Date.now().toString(),
                                name: data.projectName || 'Imported Project',
                                createdAt: new Date().toISOString(),
                                imported: true
                            };
                            setProjects(prev => [...prev, importedProject]);
                            setActiveProjectId(importedProject.id);

                            alert('Project imported successfully!');
                        } else {
                            alert('Invalid project file format');
                        }
                    } catch (err) {
                        alert('Failed to parse project file: ' + err.message);
                    }
                };
                reader.readAsText(file);
                event.target.value = ''; // Reset input
            };

            // Backup all data to a single file
            const handleBackupData = () => {
                const backup = {
                    version: '1.0',
                    createdAt: new Date().toISOString(),
                    // Current project
                    currentProject: {
                        projectName,
                        selectedCredits,
                        creditNotes,
                        creditDocs,
                        creditAssignments,
                        activeProjectId
                    },
                    // All projects
                    projects,
                    // Admin data (if available)
                    adminData: localStorage.getItem('greenstar_admin_data')
                        ? JSON.parse(localStorage.getItem('greenstar_admin_data'))
                        : null,
                    // Settings
                    settings: {
                        darkMode,
                        targetStarRating
                    }
                };

                const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `greenstar-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            // Restore data from backup file
            const handleRestoreBackup = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const backup = JSON.parse(e.target.result);

                        if (!backup.version || !backup.createdAt) {
                            alert('Invalid backup file format');
                            return;
                        }

                        if (!confirm(`Restore backup from ${new Date(backup.createdAt).toLocaleString()}?\n\nThis will replace all current data.`)) {
                            return;
                        }

                        // Restore current project
                        if (backup.currentProject) {
                            setProjectName(backup.currentProject.projectName || 'My Green Star Project');
                            setSelectedCredits(normalizeCredits(backup.currentProject.selectedCredits || {}));
                            setCreditNotes(backup.currentProject.creditNotes || {});
                            setCreditDocs(backup.currentProject.creditDocs || {});
                            setCreditAssignments(backup.currentProject.creditAssignments || {});
                            if (backup.currentProject.activeProjectId) {
                                setActiveProjectId(backup.currentProject.activeProjectId);
                            }
                        }

                        // Restore projects list
                        if (backup.projects && backup.projects.length > 0) {
                            setProjects(backup.projects);
                        }

                        // Restore admin data
                        if (backup.adminData) {
                            localStorage.setItem('greenstar_admin_data', JSON.stringify(backup.adminData));
                        }

                        // Restore settings
                        if (backup.settings) {
                            // Don't restore darkMode - keep light theme
                            // setDarkMode(backup.settings.darkMode || false);
                            setTargetStarRating(backup.settings.targetStarRating || 5);
                        }

                        alert('Backup restored successfully! The page will reload to apply changes.');
                        setTimeout(() => window.location.reload(), 500);
                    } catch (err) {
                        alert('Failed to restore backup: ' + err.message);
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            // Apply template to current project
            const applyTemplate = (templateId) => {
                const template = projectTemplates.find(t => t.id === templateId);
                if (!template) return;

                if (Object.keys(selectedCredits).length > 0) {
                    if (!confirm('This will replace your current credit selections. Continue?')) {
                        return;
                    }
                }

                const newCredits = {};
                template.suggestedCredits.forEach(creditKey => {
                    categoriesData.forEach(cat => {
                        cat.credits.forEach(credit => {
                            if (`${cat.id}-${credit.id}` === creditKey) {
                                newCredits[creditKey] = {
                                    level: 'credit',
                                    points: credit.performanceLevels?.[1]?.points || credit.points
                                };
                            }
                        });
                    });
                });

                setSelectedCredits(newCredits);
                setShowTemplates(false);
            };

            // Get synergies for selected credits
            const getActiveSynergies = useMemo(() => {
                const synergies = [];
                const selectedKeys = Object.keys(selectedCredits);

                selectedKeys.forEach(key => {
                    if (creditSynergies[key]) {
                        const syn = creditSynergies[key];
                        syn.synergies.forEach(synergyKey => {
                            // Find the synergy credit info
                            categoriesData.forEach(cat => {
                                cat.credits.forEach(credit => {
                                    if (`${cat.id}-${credit.id}` === synergyKey) {
                                        const isSelected = selectedCredits[synergyKey];
                                        synergies.push({
                                            fromKey: key,
                                            toKey: synergyKey,
                                            credit,
                                            category: cat,
                                            isSelected,
                                            reason: syn.reason
                                        });
                                    }
                                });
                            });
                        });
                    }
                });

                // Remove duplicates and filter to unselected
                const uniqueSynergies = [];
                const seen = new Set();
                synergies.forEach(s => {
                    if (!seen.has(s.toKey) && !s.isSelected) {
                        seen.add(s.toKey);
                        uniqueSynergies.push(s);
                    }
                });

                return uniqueSynergies;
            }, [selectedCredits]);

            // Gap analysis - credits to reach next rating
            const gapAnalysis = useMemo(() => {
                const nextTarget = getNextRatingTarget(totalPoints);
                if (!nextTarget) return null;

                // Find unselected credits sorted by points/difficulty
                const suggestions = [];
                categoriesData.forEach(cat => {
                    cat.credits.forEach(credit => {
                        const key = `${cat.id}-${credit.id}`;
                        if (!selectedCredits[key]) {
                            const points = credit.performanceLevels?.[1]?.points || credit.points;
                            suggestions.push({
                                key,
                                credit,
                                category: cat,
                                points,
                                difficulty: credit.difficulty,
                                required: credit.required,
                                score: points * (credit.difficulty === 'Easy' ? 3 : credit.difficulty === 'Medium' ? 2 : 1)
                            });
                        }
                    });
                });

                // Sort by score (easy high-point credits first)
                suggestions.sort((a, b) => b.score - a.score);

                // Find minimum set to reach target
                let remaining = nextTarget.remaining;
                const recommended = [];
                for (const s of suggestions) {
                    if (remaining <= 0) break;
                    recommended.push(s);
                    remaining -= s.points;
                }

                return {
                    ...nextTarget,
                    currentPoints: totalPoints,
                    suggestions: suggestions.slice(0, 10),
                    recommended,
                    allUnselected: suggestions
                };
            }, [totalPoints, selectedCredits]);

            // Apply dark mode to body - force light mode on initial load
            useEffect(() => {
                // Ensure light mode on first load (remove any cached dark mode class)
                document.body.classList.remove('dark-mode');
            }, []);

            useEffect(() => {
                document.body.classList.toggle('dark-mode', darkMode);
            }, [darkMode]);

            // Calculate totals
            const totalPoints = useMemo(() => {
                return Object.values(selectedCredits).reduce((sum, selection) => {
                    return sum + (selection.points || 0);
                }, 0);
            }, [selectedCredits]);

            const getCategoryPoints = (categoryId) => {
                const category = categoriesData.find(c => c.id === categoryId);
                return category.credits.reduce((sum, credit) => {
                    const key = `${categoryId}-${credit.id}`;
                    const selection = selectedCredits[key];
                    return sum + (selection ? selection.points : 0);
                }, 0);
            };

            const handleSelectCreditLevel = (creditKey, level, points) => {
                setSelectedCredits(prev => {
                    if (level === null) {
                        const { [creditKey]: _, ...rest } = prev;
                        return rest;
                    }
                    return { ...prev, [creditKey]: { level, points } };
                });
            };

            const handleToggleCredit = (creditKey, points) => {
                setSelectedCredits(prev => {
                    if (prev[creditKey]) {
                        const { [creditKey]: _, ...rest } = prev;
                        return rest;
                    }
                    return { ...prev, [creditKey]: { level: 'credit', points } };
                });
            };

            const handleViewCreditDetails = (credit, category) => {
                setCreditDetailModal({ isOpen: true, credit, category });
            };

            const handleCloseCreditDetail = () => {
                setCreditDetailModal({ isOpen: false, credit: null, category: null });
            };

            const handleOpenCalculator = (calculatorId) => {
                setSelectedCalculator(calculatorId);
                setShowCalculators(true);
                setCreditDetailModal({ isOpen: false, credit: null, category: null });
            };

            const handleSaveCalculatorResult = (calculatorId, result) => {
                setCalculatorResults(prev => ({
                    ...prev,
                    [calculatorId]: { ...result, savedAt: new Date().toISOString() }
                }));
            };

            // Get star rating
            const getStarRating = (points) => {
                if (points >= 100) return { stars: 6, label: 'World Leadership' };
                if (points >= 85) return { stars: 5, label: 'Australian Excellence' };
                if (points >= 60) return { stars: 4, label: 'Best Practice' };
                if (points >= 45) return { stars: 3, label: 'Good Practice' };
                if (points >= 30) return { stars: 2, label: 'Average Practice' };
                if (points >= 15) return { stars: 1, label: 'Minimum Practice' };
                return { stars: 0, label: 'Not Certified' };
            };

            const currentRating = getStarRating(totalPoints);

            return (
                <div className={`${darkMode ? 'dark' : ''}`}>
                    {/* Admin Data Update Notification Banner */}
                    {showDataUpdateBanner && (
                        <div className="fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-[#1B4D3E] to-[#0D9488] text-white py-3 px-4 flex items-center justify-between shadow-lg">
                            <div className="flex items-center gap-3">
                                <i className="fa-solid fa-sync-alt"></i>
                                <span className="text-sm font-medium">Admin panel data has been updated. Reload to see changes.</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <button
                                    onClick={reloadAdminData}
                                    className="px-4 py-1.5 bg-white text-[#1B4D3E] rounded-lg text-sm font-semibold hover:bg-gray-100 transition-colors"
                                >
                                    Reload Now
                                </button>
                                <button
                                    onClick={() => setShowDataUpdateBanner(false)}
                                    className="p-1.5 hover:bg-white/20 rounded-lg transition-colors"
                                >
                                    <i className="fa-solid fa-times"></i>
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Mobile Overlay */}
                    <div
                        className={`sidebar-overlay ${sidebarOpen ? 'visible' : ''}`}
                        onClick={() => setSidebarOpen(false)}
                    />

                    {/* Sidebar Toggle Button */}
                    <button
                        onClick={() => setSidebarOpen(!sidebarOpen)}
                        className={`sidebar-toggle ${!sidebarOpen ? 'collapsed' : ''}`}
                    >
                        <i className={`fa-solid ${sidebarOpen ? 'fa-chevron-left' : 'fa-chevron-right'} text-ink-2 text-sm`}></i>
                    </button>

                    {/* Collapsible Sidebar */}
                    <aside className={`sidebar ${!sidebarOpen ? 'collapsed' : ''}`}>
                        <div className="p-4">
                            {/* GBCA Branded Header - Official Green Star logo */}
                            <div className="mb-6 -mx-4 -mt-4 px-4 py-4 bg-white border-b border-line">
                                <div className="flex flex-col gap-2">
                                    <img
                                        src="green star logo full.png"
                                        alt="Green Star"
                                        className="h-8 object-contain object-left"
                                    />
                                    <p className="text-xs text-ink-3 font-medium">Submission Assistant</p>
                                </div>
                            </div>

                            {/* Project Selector Dropdown */}
                            <div className="mb-4 relative" data-tour="project-selector">
                                <div
                                    className="p-3 bg-white rounded-lg border border-line shadow-sm cursor-pointer hover:border-[#2E6B3F] transition-colors"
                                    onClick={() => setShowProjectDropdown(!showProjectDropdown)}
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="flex-grow min-w-0">
                                            <label className="text-xs font-medium text-ink-3 uppercase tracking-wider mb-1 block">Project</label>
                                            <p className="text-sm font-semibold text-ink truncate">{projectName || 'Select Project...'}</p>
                                        </div>
                                        <i className={`fa-solid fa-chevron-down text-ink-3 text-xs transition-transform ${showProjectDropdown ? 'rotate-180' : ''}`}></i>
                                    </div>
                                </div>

                                {/* Dropdown Menu */}
                                {showProjectDropdown && (
                                    <div className="absolute top-full left-0 right-0 mt-1 bg-white rounded-lg border border-line shadow-lg z-50 max-h-80 overflow-hidden flex flex-col">
                                        {/* Edit Current Project Name */}
                                        <div className="p-3 border-b border-line bg-surface-1">
                                            <label className="text-xs font-medium text-ink-3 mb-1 block">Rename Current Project</label>
                                            <input
                                                type="text"
                                                value={projectName}
                                                onChange={(e) => setProjectName(e.target.value)}
                                                onClick={(e) => e.stopPropagation()}
                                                className="w-full text-sm font-medium text-ink bg-white border border-line rounded-md px-2 py-1.5 focus:border-[#2E6B3F] focus:ring-1 focus:ring-[#2E6B3F]/20"
                                                placeholder="Enter project name..."
                                            />
                                        </div>

                                        {/* Projects List */}
                                        <div className="flex-1 overflow-y-auto max-h-40">
                                            {projects.map(project => (
                                                <div
                                                    key={project.id}
                                                    className={`px-3 py-2 flex items-center justify-between hover:bg-surface-1 cursor-pointer border-b border-line/50 last:border-0 ${
                                                        project.id === activeProjectId ? 'bg-[#1F4B2E]/5' : ''
                                                    }`}
                                                    onClick={() => {
                                                        switchProject(project.id);
                                                        setShowProjectDropdown(false);
                                                    }}
                                                >
                                                    <div className="flex-grow min-w-0">
                                                        <p className={`text-sm font-medium truncate ${project.id === activeProjectId ? 'text-[#1F4B2E]' : 'text-ink'}`}>
                                                            {project.name}
                                                        </p>
                                                        <p className="text-xs text-ink-3">
                                                            {new Date(project.createdAt).toLocaleDateString()}
                                                            {project.isScenario && ' â€¢ Scenario'}
                                                        </p>
                                                    </div>
                                                    <div className="flex items-center gap-1 ml-2">
                                                        {project.id === activeProjectId && (
                                                            <i className="fa-solid fa-check text-[#1F4B2E] text-xs"></i>
                                                        )}
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                const name = prompt('Scenario name:', `${project.name} (Scenario)`);
                                                                if (name) cloneProjectAsScenario(project.id, name);
                                                            }}
                                                            className="w-6 h-6 rounded hover:bg-purple-100 flex items-center justify-center text-purple-500"
                                                            title="Clone as Scenario"
                                                        >
                                                            <i className="fa-solid fa-clone text-xs"></i>
                                                        </button>
                                                        {projects.length > 1 && (
                                                            <button
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    if (confirm('Delete this project?')) deleteProject(project.id);
                                                                }}
                                                                className="w-6 h-6 rounded hover:bg-red-100 flex items-center justify-center text-red-500"
                                                                title="Delete"
                                                            >
                                                                <i className="fa-solid fa-trash text-xs"></i>
                                                            </button>
                                                        )}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        {/* Actions */}
                                        <div className="p-2 border-t border-line bg-surface-1 flex gap-2">
                                            <button
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    const name = prompt('New project name:', 'New Project');
                                                    if (name) {
                                                        createNewProject(name);
                                                        setShowProjectDropdown(false);
                                                    }
                                                }}
                                                className="flex-1 py-2 px-3 bg-[#1F4B2E] text-white rounded-md text-xs font-medium hover:bg-[#2E6B3F] transition-colors flex items-center justify-center gap-1"
                                            >
                                                <i className="fa-solid fa-plus"></i> New Project
                                            </button>
                                            <label className="flex-1 py-2 px-3 bg-white border border-line text-ink-2 rounded-md text-xs font-medium hover:bg-surface-1 transition-colors flex items-center justify-center gap-1 cursor-pointer">
                                                <i className="fa-solid fa-upload"></i> Import
                                                <input type="file" accept=".json" onChange={(e) => { handleImportProject(e); setShowProjectDropdown(false); }} className="hidden" />
                                            </label>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Score Display - Clean GBCA Style */}
                            <div className="bg-white rounded-lg p-4 mb-4 border border-line" data-tour="score-display">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-xs font-semibold text-ink-3 uppercase tracking-wider">Current Score</span>
                                    <span className="text-xs font-semibold text-[#1F4B2E] bg-[#1F4B2E]/10 px-2 py-0.5 rounded">{currentRating.label}</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <span className="text-3xl font-bold text-[#1F4B2E]">{totalPoints}</span>
                                    <span className="text-sm font-medium text-ink-3">points</span>
                                </div>
                                <div className="mt-3 h-1.5 bg-gray-100 rounded-full overflow-hidden">
                                    <div className="h-full bg-[#1F4B2E] transition-all rounded-full" style={{ width: `${Math.min(100, (totalPoints / 100) * 100)}%` }}></div>
                                </div>
                            </div>

                            {/* Target Rating Selector */}
                            <div className="mb-4 p-3 bg-white rounded-lg border border-line" data-tour="target-rating">
                                <div className="mb-2">
                                    <span className="text-xs font-medium text-ink-3">Target Rating</span>
                                </div>
                                <div className="relative">
                                    <select
                                        value={targetStarRating}
                                        onChange={(e) => setTargetStarRating(Number(e.target.value))}
                                        className="w-full py-2 px-3 pr-8 rounded-lg border border-line bg-white text-ink text-sm font-medium appearance-none cursor-pointer hover:border-[#2E6B3F] transition-colors focus:ring-1 focus:ring-[#2E6B3F]/20 focus:border-[#2E6B3F]"
                                    >
                                        <option value={4}>4 Star Best Practice (15+ pts)</option>
                                        <option value={5}>5 Star Australian Excellence (35+ pts)</option>
                                        <option value={6}>6 Star World Leadership (70+ pts)</option>
                                    </select>
                                    <i className="fa-solid fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-ink-3 text-xs pointer-events-none"></i>
                                </div>
                                {(() => {
                                    const targetPoints = targetStarRating === 4 ? 15 : targetStarRating === 5 ? 35 : 70;
                                    const remaining = targetPoints - totalPoints;
                                    const progress = Math.min(100, (totalPoints / targetPoints) * 100);
                                    return (
                                        <div className="mt-3">
                                            <div className="flex justify-between text-xs mb-1">
                                                <span className="text-ink-3">{totalPoints} / {targetPoints} pts</span>
                                                <span className={remaining <= 0 ? 'text-[#1F4B2E] font-semibold' : 'text-ink-3'}>
                                                    {remaining <= 0 ? 'Target Achieved!' : `${remaining} pts needed`}
                                                </span>
                                            </div>
                                            <div className="h-1.5 bg-gray-100 rounded-full overflow-hidden">
                                                <div
                                                    className="h-full transition-all rounded-full bg-[#1F4B2E]"
                                                    style={{ width: `${progress}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    );
                                })()}
                            </div>

                            {/* Search */}
                            <div className="relative mb-4">
                                <i className="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-ink-3 text-sm"></i>
                                <input
                                    type="text"
                                    placeholder="Search credits..."
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    className="w-full pl-9 pr-8 py-2 text-sm rounded-lg border border-line bg-white focus:border-[#2E6B3F] focus:ring-1 focus:ring-[#2E6B3F]/20"
                                />
                                {searchQuery && (
                                    <button onClick={() => setSearchQuery('')} className="absolute right-3 top-1/2 -translate-y-1/2 text-ink-3 hover:text-ink">
                                        <i className="fa-solid fa-xmark text-sm"></i>
                                    </button>
                                )}
                            </div>

                            {/* View Toggle */}
                            <div className="mb-4">
                                <label className="text-xs font-medium text-ink-3 mb-2 block">View</label>
                                <div className="grid grid-cols-4 gap-1 bg-surface-1 rounded-lg p-1">
                                    {[
                                        { id: 'credits', icon: 'fa-grip', label: 'Cards' },
                                        { id: 'timeline', icon: 'fa-timeline', label: 'Timeline' },
                                        { id: 'matrix', icon: 'fa-table-cells', label: 'Matrix' },
                                        { id: 'docs', icon: 'fa-file-lines', label: 'Docs' }
                                    ].map(view => (
                                        <button
                                            key={view.id}
                                            onClick={() => setActiveView(view.id)}
                                            className={`py-2 px-2 rounded-md text-xs font-medium transition-all flex flex-col items-center gap-1
                                                ${activeView === view.id ? 'bg-white shadow-sm text-[#1F4B2E]' : 'text-ink-3 hover:text-ink'}`}
                                        >
                                            <i className={`fa-solid ${view.icon}`}></i>
                                            <span>{view.label}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Filters */}
                            <div className="mb-4">
                                <label className="text-xs font-medium text-ink-3 mb-2 block">Filters</label>
                                <div className="space-y-1.5">
                                    <button
                                        onClick={() => setShowQuickWins(!showQuickWins)}
                                        className={`w-full py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center gap-2
                                            ${showQuickWins
                                                ? 'bg-[#1F4B2E] text-white'
                                                : 'bg-white border border-line text-ink-2 hover:border-[#2E6B3F]'
                                            }`}
                                    >
                                        <i className="fa-solid fa-bolt text-xs"></i>
                                        <span>Quick Wins</span>
                                        {showQuickWins && <i className="fa-solid fa-check ml-auto text-xs"></i>}
                                    </button>
                                    <button
                                        onClick={() => setShowRequired(!showRequired)}
                                        className={`w-full py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center gap-2
                                            ${showRequired
                                                ? 'bg-[#1F4B2E] text-white'
                                                : 'bg-white border border-line text-ink-2 hover:border-[#2E6B3F]'
                                            }`}
                                    >
                                        <i className="fa-solid fa-clipboard-list text-xs"></i>
                                        <span>Minimum Expectations</span>
                                        {showRequired && <i className="fa-solid fa-check ml-auto text-xs"></i>}
                                    </button>
                                </div>
                            </div>

                            {/* Categories */}
                            <div className="mb-4" data-tour="categories">
                                <label className="text-xs font-medium text-ink-3 mb-2 block">Categories</label>
                                <div className="space-y-1">
                                    <button
                                        onClick={() => setActiveCategory('all')}
                                        className={`w-full py-2 px-3 rounded-lg text-sm font-medium transition-colors flex items-center gap-2
                                            ${activeCategory === 'all'
                                                ? 'bg-[#1F4B2E] text-white'
                                                : 'bg-white border border-line text-ink-2 hover:border-[#2E6B3F]'
                                            }`}
                                    >
                                        <i className="fa-solid fa-layer-group text-xs"></i>
                                        <span className="flex-grow text-left">All Credits</span>
                                        <span className="text-xs font-mono opacity-70">{totalPoints}/170</span>
                                    </button>
                                    {categoriesData.map(category => (
                                        <button
                                            key={category.id}
                                            onClick={() => setActiveCategory(category.id)}
                                            className={`w-full py-2 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-2
                                                ${activeCategory === category.id
                                                    ? 'bg-[#1F4B2E] text-white'
                                                    : 'bg-white border border-line text-ink-2 hover:border-[#2E6B3F]'
                                                }`}
                                        >
                                            <span className={activeCategory === category.id ? 'text-white' : (category.colorClasses?.text || 'text-ink-3')}><CategoryIcon category={category.id} size={18} /></span>
                                            <span className="flex-grow text-left truncate">{category.name}</span>
                                            <span className="text-xs font-mono opacity-70">{getCategoryPoints(category.id)}/{category.maxPoints}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Project Phase Filter */}
                            <div className="mb-4">
                                <label className="text-xs font-medium text-ink-3 mb-2 block">Project Phase</label>
                                <div className="space-y-1">
                                    {projectPhases.map(phase => (
                                        <button
                                            key={phase.id}
                                            onClick={() => setPhaseFilter(phase.id)}
                                            className={`w-full py-2 px-3 rounded-lg text-sm font-medium transition-all flex items-center gap-2 text-left
                                                ${phaseFilter === phase.id
                                                    ? 'bg-[#1F4B2E] text-white'
                                                    : 'bg-white border border-line text-ink-2 hover:border-[#2E6B3F]'
                                                }`}
                                        >
                                            <i className={`fa-solid ${phase.icon} text-xs w-4`}></i>
                                            <span className="truncate">{phase.name}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Tools & Analysis */}
                            <div className="border-t border-line pt-4 mt-4" data-tour="tools">
                                <label className="text-xs font-medium text-ink-3 mb-2 block">Tools & Analysis</label>
                                <div className="grid grid-cols-2 gap-1.5 mb-1.5">
                                    <button
                                        onClick={() => setShowTemplates(true)}
                                        className="py-2 px-3 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:border-[#2E6B3F] transition-all flex items-center justify-center gap-2"
                                    >
                                        <i className="fa-solid fa-wand-magic-sparkles text-[#2E6B3F] text-xs"></i>
                                        <span>Templates</span>
                                    </button>
                                    <button
                                        onClick={() => setShowGapAnalysis(true)}
                                        className="py-2 px-3 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:border-[#2E6B3F] transition-all flex items-center justify-center gap-2"
                                        disabled={!gapAnalysis}
                                        style={{ opacity: gapAnalysis ? 1 : 0.5 }}
                                    >
                                        <i className="fa-solid fa-chart-line text-[#2E6B3F] text-xs"></i>
                                        <span>Gap</span>
                                    </button>
                                </div>
                                <div className="grid grid-cols-2 gap-1.5 mb-1.5">
                                    <button
                                        onClick={() => setShowSynergies(true)}
                                        className="py-2 px-3 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:border-[#2E6B3F] transition-all flex items-center justify-center gap-2 relative"
                                    >
                                        <i className="fa-solid fa-link text-[#2E6B3F] text-xs"></i>
                                        <span>Synergies</span>
                                        {getActiveSynergies.length > 0 && (
                                            <span className="absolute -top-1 -right-1 w-4 h-4 bg-[#1F4B2E] text-white text-[10px] rounded-full flex items-center justify-center">{getActiveSynergies.length}</span>
                                        )}
                                    </button>
                                    <button
                                        onClick={() => setShowCalculators(true)}
                                        className="py-2 px-3 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:border-[#2E6B3F] transition-all flex items-center justify-center gap-2"
                                    >
                                        <i className="fa-solid fa-calculator text-[#2E6B3F] text-xs"></i>
                                        <span>Calcs</span>
                                    </button>
                                </div>
                                <button
                                    onClick={() => setShowExport(true)}
                                    className="w-full py-2 px-3 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:border-[#2E6B3F] transition-all flex items-center justify-center gap-2"
                                >
                                    <i className="fa-solid fa-download text-[#2E6B3F] text-xs"></i>
                                    <span>Export Project</span>
                                </button>

                                {/* Scenario Analysis */}
                                <div className="grid grid-cols-2 gap-1.5 mt-1.5" data-tour="scenario-tools">
                                    <button
                                        onClick={() => setShowQuickAnalysis(true)}
                                        className="py-2 px-3 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:border-[#2E6B3F] transition-all flex items-center justify-center gap-2"
                                    >
                                        <i className="fa-solid fa-flask text-[#2E6B3F] text-xs"></i>
                                        <span>What-If</span>
                                    </button>
                                    <button
                                        onClick={() => setShowComparison(true)}
                                        className="py-2 px-3 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:border-[#2E6B3F] transition-all flex items-center justify-center gap-2"
                                        disabled={projects.length < 2}
                                        style={{ opacity: projects.length >= 2 ? 1 : 0.5 }}
                                    >
                                        <i className="fa-solid fa-code-compare text-[#2E6B3F] text-xs"></i>
                                        <span>Compare</span>
                                    </button>
                                </div>

                                {/* Admin Section */}
                                <div className="mt-3 pt-3 border-t border-line space-y-1.5">
                                    <a
                                        href="admin.html"
                                        className="w-full py-2 px-3 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:border-[#2E6B3F] transition-all flex items-center justify-center gap-2"
                                    >
                                        <i className="fa-solid fa-cog text-ink-3 text-xs"></i>
                                        <span>Admin Panel</span>
                                    </a>
                                    <button
                                        onClick={reloadAdminData}
                                        className="w-full py-2 px-3 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:border-[#2E6B3F] transition-all flex items-center justify-center gap-2"
                                    >
                                        <i className="fa-solid fa-sync-alt text-ink-3 text-xs"></i>
                                        <span>Reload Data</span>
                                    </button>
                                    <div className="grid grid-cols-2 gap-1.5">
                                        <button
                                            onClick={handleBackupData}
                                            className="py-2 px-3 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:border-[#2E6B3F] transition-all flex items-center justify-center gap-1"
                                        >
                                            <i className="fa-solid fa-cloud-arrow-up text-ink-3 text-xs"></i>
                                            <span>Backup</span>
                                        </button>
                                        <label className="py-2 px-3 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:border-[#2E6B3F] transition-all flex items-center justify-center gap-1 cursor-pointer">
                                            <i className="fa-solid fa-cloud-arrow-down text-ink-3 text-xs"></i>
                                            <span>Restore</span>
                                            <input type="file" accept=".json" onChange={handleRestoreBackup} className="hidden" />
                                        </label>
                                    </div>
                                    <button
                                        onClick={restartTour}
                                        className="w-full py-2 px-3 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:border-[#2E6B3F] transition-all flex items-center justify-center gap-2"
                                    >
                                        <i className="fa-solid fa-question-circle text-ink-3 text-xs"></i>
                                        <span>Take a Tour</span>
                                    </button>
                                </div>
                            </div>

                            {/* Dark Mode Toggle - Hidden to match GBCA light-only design */}
                            {/* Users can still access dark mode via browser dev tools if needed */}
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className={`main-content ${!sidebarOpen ? 'sidebar-collapsed' : ''}`}>
                        <div className="p-4 md:p-6 lg:p-8">
                            <div className="max-w-5xl mx-auto" data-tour="credit-cards">
                                {/* Main Content Area - Credits, Timeline, or Matrix */}
                                {activeView === 'credits' && (
                                    <CreditsList
                                        categories={categoriesData}
                                        activeCategory={activeCategory}
                                        selectedCredits={selectedCredits}
                                        onSelectCreditLevel={handleSelectCreditLevel}
                                        onViewCreditDetails={handleViewCreditDetails}
                                        phaseFilter={phaseFilter}
                                        searchQuery={searchQuery}
                                        showQuickWins={showQuickWins}
                                        showRequired={showRequired}
                                    />
                                )}

                                {activeView === 'timeline' && (
                                    <TimelineView
                                        categories={categoriesData}
                                        selectedCredits={selectedCredits}
                                        onViewCreditDetails={handleViewCreditDetails}
                                        projectPhases={projectPhases.filter(p => p.id !== 'all')}
                                    />
                                )}

                                {activeView === 'matrix' && (
                                    <ResponsibilityMatrix
                                        categories={categoriesData}
                                        selectedCredits={selectedCredits}
                                        creditAssignments={creditAssignments}
                                        onAssignmentChange={(creditKey, assignment) => {
                                            setCreditAssignments(prev => ({ ...prev, [creditKey]: assignment }));
                                        }}
                                        onViewCreditDetails={handleViewCreditDetails}
                                    />
                                )}

                                {activeView === 'docs' && (
                                    <DocumentationView
                                        categories={categoriesData}
                                        selectedCredits={selectedCredits}
                                        creditDocs={creditDocs}
                                        onDocsChange={(key, docs) => setCreditDocs(prev => ({ ...prev, [key]: docs }))}
                                        onViewCreditDetails={handleViewCreditDetails}
                                    />
                                )}

                                {/* Footer */}
                                <footer className="mt-8 text-center text-sm text-ink-3">
                                    <p>Green Star Buildings v1.1 Submission Assistant</p>
                                    <p className="mt-1">Based on GBCA Green Star Buildings Submission Guidelines</p>
                                </footer>
                            </div>
                        </div>
                    </main>

                    {/* Modals */}
                    <CalculatorsModal
                        isOpen={showCalculators}
                        onClose={() => { setShowCalculators(false); setSelectedCalculator(null); }}
                        selectedCalculator={selectedCalculator}
                        onSelectCalculator={setSelectedCalculator}
                        calculatorResults={calculatorResults}
                        onSaveResult={handleSaveCalculatorResult}
                    />
                    <ExportModal
                        isOpen={showExport}
                        onClose={() => setShowExport(false)}
                        projectData={{ projectName, totalPoints, selectedCredits, creditNotes, creditDocs, creditAssignments }}
                    />
                    <ProjectManagerModal
                        isOpen={showProjectManager}
                        onClose={() => setShowProjectManager(false)}
                        projects={projects}
                        activeProjectId={activeProjectId}
                        onCreateProject={createNewProject}
                        onSwitchProject={switchProject}
                        onDeleteProject={deleteProject}
                        onImport={handleImportProject}
                        onCloneProject={cloneProjectAsScenario}
                    />
                    <TemplatesModal
                        isOpen={showTemplates}
                        onClose={() => setShowTemplates(false)}
                        onApplyTemplate={applyTemplate}
                        onCreateWithTemplate={createNewProject}
                    />
                    <GapAnalysisModal
                        isOpen={showGapAnalysis}
                        onClose={() => setShowGapAnalysis(false)}
                        gapAnalysis={gapAnalysis}
                        onSelectCredit={handleSelectCreditLevel}
                        onViewCredit={handleViewCreditDetails}
                    />
                    <SynergiesModal
                        isOpen={showSynergies}
                        onClose={() => setShowSynergies(false)}
                        synergies={getActiveSynergies}
                        onSelectCredit={handleSelectCreditLevel}
                        onViewCredit={handleViewCreditDetails}
                    />
                    <AdminImportModal
                        isOpen={showAdminImport}
                        onClose={() => setShowAdminImport(false)}
                        onImportData={(data) => console.log('Imported data:', data)}
                    />
                    <ScenarioComparisonModal
                        isOpen={showComparison}
                        onClose={() => setShowComparison(false)}
                        projects={projects}
                        activeProjectId={activeProjectId}
                        categoriesData={categoriesData}
                        selectedCredits={selectedCredits}
                    />
                    <QuickAnalysisPanel
                        isOpen={showQuickAnalysis}
                        onClose={() => setShowQuickAnalysis(false)}
                        categoriesData={categoriesData}
                        selectedCredits={selectedCredits}
                        onSelectCredit={handleSelectCreditLevel}
                        onDeselectCredit={(key) => handleSelectCreditLevel(key, null, 0)}
                    />
                    <OnboardingTour
                        isOpen={showTour}
                        onClose={() => setShowTour(false)}
                        onComplete={completeTour}
                    />
                    <CreditDetailModal
                        isOpen={creditDetailModal.isOpen}
                        onClose={handleCloseCreditDetail}
                        credit={creditDetailModal.credit}
                        category={creditDetailModal.category}
                        selectedCredits={selectedCredits}
                        onSelectLevel={handleSelectCreditLevel}
                        creditNotes={creditNotes}
                        onNotesChange={(key, note) => setCreditNotes(prev => ({ ...prev, [key]: note }))}
                        creditDocs={creditDocs}
                        onDocsChange={(key, docs) => setCreditDocs(prev => ({ ...prev, [key]: docs }))}
                        faqData={faqData}
                        onOpenCalculator={handleOpenCalculator}
                        calculatorsData={calculatorsData}
                    />
                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <!-- Service Worker Registration for PWA/Offline Mode -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker registered:', registration.scope);

                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New content available, show update notification
                                    if (confirm('New version available! Reload to update?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
