<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Star Admin Panel</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- SheetJS for Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['ui-sans-serif', 'system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                        'display': ['Outfit', 'ui-sans-serif', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        'green': {
                            '900': '#1F4B2E',
                            '700': '#2E6B3F',
                            '500': '#4F8A55',
                            '300': '#9CCB8A',
                            '200': '#CDE6C3',
                            '100': '#EAF4E6',
                        },
                        'ink': {
                            DEFAULT: '#1C2320',
                            '2': '#34403A',
                            '3': '#5A6A62',
                        },
                        'surface': {
                            '0': '#FFFFFF',
                            '1': '#F6F8F6',
                            '2': '#EFF3EF',
                        },
                        'line': '#D7DED8',
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --color-green-900: #1F4B2E;
            --color-green-700: #2E6B3F;
            --color-green-500: #4F8A55;
            --color-green-300: #9CCB8A;
            --color-green-100: #EAF4E6;
            --color-ink: #1C2320;
            --color-ink-2: #34403A;
            --color-ink-3: #5A6A62;
            --color-surface-0: #FFFFFF;
            --color-surface-1: #F6F8F6;
            --color-surface-2: #EFF3EF;
            --color-line: #D7DED8;
            --heading-color: var(--color-green-900);
            --ease-standard: cubic-bezier(0.2, 0.0, 0.0, 1);
            --dur-fast: 120ms;
            --dur-med: 200ms;
            --focus-ring: 0 0 0 3px rgba(124,203,139,0.35);
        }
        body { font-family: ui-sans-serif, system-ui, -apple-system, sans-serif; background: var(--color-surface-1); color: var(--color-ink); line-height: 1.55; }
        .font-display { font-family: 'Outfit', sans-serif; }
        h1, h2, h3, h4, h5, h6 { color: var(--heading-color); line-height: 1.3; }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--color-surface-2); border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: var(--color-line); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-ink-3); }

        /* Table styles */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th {
            background: var(--color-surface-2);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-ink-2);
            border-bottom: 1px solid var(--color-line);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--color-surface-2);
            vertical-align: top;
            color: var(--color-ink);
        }
        .data-table tr:hover { background: var(--color-surface-1); }
        .data-table input, .data-table select, .data-table textarea {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid var(--color-line);
            border-radius: 6px;
            font-size: 14px;
            transition: border-color var(--dur-fast) var(--ease-standard);
            background: var(--color-surface-0);
            color: var(--color-ink);
        }
        .data-table input:focus, .data-table select:focus, .data-table textarea:focus {
            outline: none;
            border-color: var(--color-green-700);
            box-shadow: var(--focus-ring);
        }
        .data-table textarea { resize: vertical; min-height: 60px; }

        /* Animation */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.25s ease-out; }

        /* Print styles */
        @media print {
            body { background: white; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // ============================================================
        // AUTHENTICATION
        // ============================================================

        // Simple hash function for password (SHA-256)
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // Default password hash - change this!
        // Default password is: "greenstar2024"
        // To generate a new hash, run in console: hashPassword("yourpassword").then(console.log)
        const ADMIN_PASSWORD_HASH = "a]b9f4c7d8e2a1b3c5d7e9f0a2b4c6d8e0f1a3b5c7d9e1f3a5b7c9d1e3f5a7b9";

        // Session duration (24 hours in milliseconds)
        const SESSION_DURATION = 24 * 60 * 60 * 1000;

        // Check if session is valid
        function isSessionValid() {
            const session = localStorage.getItem('admin_session');
            if (!session) return false;

            try {
                const { token, expiry } = JSON.parse(session);
                if (Date.now() > expiry) {
                    localStorage.removeItem('admin_session');
                    return false;
                }
                return token === 'authenticated';
            } catch (e) {
                return false;
            }
        }

        // Create session
        function createSession() {
            const session = {
                token: 'authenticated',
                expiry: Date.now() + SESSION_DURATION
            };
            localStorage.setItem('admin_session', JSON.stringify(session));
        }

        // End session
        function endSession() {
            localStorage.removeItem('admin_session');
        }

        // Login Screen Component
        function LoginScreen({ onLogin }) {
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                setError('');

                try {
                    const hash = await hashPassword(password);
                    // For demo, accept the default password "greenstar2024" or check hash
                    if (password === 'greenstar2024' || hash === ADMIN_PASSWORD_HASH) {
                        createSession();
                        onLogin();
                    } else {
                        setError('Incorrect password. Please try again.');
                    }
                } catch (err) {
                    setError('An error occurred. Please try again.');
                }

                setIsLoading(false);
            };

            return (
                <div className="min-h-screen bg-[#FAFAF9] flex items-center justify-center p-4">
                    <div className="bg-white rounded-xl border border-line p-8 w-full max-w-md animate-fade-in">
                        {/* Logo */}
                        <div className="text-center mb-8">
                            <div className="w-16 h-16 rounded-xl bg-[#2D5A47] flex items-center justify-center mx-auto mb-4">
                                <i className="fa-solid fa-leaf text-white text-2xl"></i>
                            </div>
                            <h1 className="font-display text-2xl font-bold text-ink">Admin Access</h1>
                            <p className="text-ink-3 mt-2">Green Star Content Manager</p>
                        </div>

                        {/* Security Notice */}
                        <div className="mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                            <div className="flex items-start gap-3">
                                <i className="fa-solid fa-shield-halved text-amber-600 mt-0.5"></i>
                                <div className="text-sm">
                                    <p className="font-medium text-amber-800">Authorized Personnel Only</p>
                                    <p className="text-amber-700 mt-1">This area is for administrators to manage Green Star credit data.</p>
                                </div>
                            </div>
                        </div>

                        {/* Login Form */}
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-ink-2 mb-2">
                                    Admin Password
                                </label>
                                <div className="relative">
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        placeholder="Enter admin password"
                                        className="w-full px-4 py-3 border border-line rounded-lg focus:ring-2 focus:ring-[#2D5A47]/20 focus:border-[#2D5A47] transition-colors"
                                        autoFocus
                                        required
                                    />
                                    <i className="fa-solid fa-lock absolute right-4 top-1/2 -translate-y-1/2 text-ink-3"></i>
                                </div>
                            </div>

                            {error && (
                                <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm flex items-center gap-2">
                                    <i className="fa-solid fa-circle-exclamation"></i>
                                    {error}
                                </div>
                            )}

                            <button
                                type="submit"
                                disabled={isLoading}
                                className="w-full py-3 bg-[#2D5A47] text-white font-medium rounded-lg hover:bg-[#234538] transition-colors flex items-center justify-center gap-2 disabled:opacity-50"
                            >
                                {isLoading ? (
                                    <>
                                        <i className="fa-solid fa-spinner fa-spin"></i>
                                        Verifying...
                                    </>
                                ) : (
                                    <>
                                        <i className="fa-solid fa-right-to-bracket"></i>
                                        Sign In
                                    </>
                                )}
                            </button>
                        </form>

                        {/* Back Link */}
                        <div className="mt-6 text-center">
                            <a
                                href="index.html"
                                className="text-sm text-ink-3 hover:text-ink-2 flex items-center justify-center gap-2"
                            >
                                <i className="fa-solid fa-arrow-left"></i>
                                Back to Green Star App
                            </a>
                        </div>
                    </div>
                </div>
            );
        }

        // ============================================================
        // DEFAULT DATA STRUCTURE
        // ============================================================
        const defaultCategories = [
            { id: "responsible", name: "Responsible", description: "Responsible practices in construction and development", icon: "fa-shield-halved", color: "amber", order: 1 },
            { id: "healthy", name: "Healthy", description: "Creating healthy indoor environments", icon: "fa-heart-pulse", color: "green", order: 2 },
            { id: "resilient", name: "Resilient", description: "Building resilience to climate change", icon: "fa-shield", color: "blue", order: 3 },
            { id: "positive", name: "Positive", description: "Positive environmental outcomes", icon: "fa-bolt", color: "red", order: 4 },
            { id: "places", name: "Places", description: "Creating great places for communities", icon: "fa-map-location-dot", color: "purple", order: 5 },
            { id: "people", name: "People", description: "Supporting people and communities", icon: "fa-users", color: "pink", order: 6 },
            { id: "nature", name: "Nature", description: "Protecting and enhancing nature", icon: "fa-leaf", color: "emerald", order: 7 },
            { id: "leadership", name: "Leadership", description: "Demonstrating industry leadership", icon: "fa-trophy", color: "indigo", order: 8 },
        ];

        const defaultCredits = [
            // Responsible Category (10 credits)
            { id: "ind-dev", name: "Industry Development", category: "responsible", shortDescription: "Supporting green building industry", description: "Supporting the development of the green building industry through training, research, and knowledge sharing.", aims: "To encourage and recognise projects that support the development of the green building industry and sustainability skills within the project team.", tips: "Start early - professional development can be completed throughout the project. Consider hosting site tours for industry groups.", required: false, maxPoints: 2, difficulty: "Easy", projectPhases: "Concept, Schematic, Design Dev", order: 1 },
            { id: "resp-const", name: "Responsible Construction", category: "responsible", shortDescription: "Environmental management during construction", description: "Implementing environmental management practices during construction.", aims: "To encourage and recognise construction practices that minimise environmental impacts and promote responsible site management.", tips: "Implement robust systems from day one. Regular site inspections and photographic evidence are essential.", required: true, maxPoints: 5, difficulty: "Medium", projectPhases: "Construction, Handover", order: 2 },
            { id: "verify-hand", name: "Verification and Handover", category: "responsible", shortDescription: "Commissioning and handover", description: "Ensuring building systems work as designed through commissioning and handover processes.", aims: "To ensure that building systems are properly commissioned, tuned, and handed over to enable optimal performance.", tips: "Engage a commissioning agent early. Building tuning commitment should be included in contracts.", required: false, maxPoints: 3, difficulty: "Medium", projectPhases: "Documentation, Construction, Handover", order: 3 },
            { id: "resp-resource", name: "Responsible Resource Management", category: "responsible", shortDescription: "Waste management and resources", description: "Managing construction waste and materials responsibly.", aims: "To encourage practices that reduce construction waste and promote material reuse and recycling.", tips: "Set up clear waste streams on site from day one. Work with recyclers early to understand what they can accept.", required: false, maxPoints: 3, difficulty: "Medium", projectPhases: "Construction, Handover", order: 4 },
            { id: "resp-proc", name: "Responsible Procurement", category: "responsible", shortDescription: "Sustainable procurement", description: "Sourcing products and materials with verified sustainability credentials.", aims: "To encourage the specification and procurement of products with third-party verified sustainability credentials.", tips: "Engage with suppliers early about certification requirements. EPDs are increasingly available for common products.", required: false, maxPoints: 2, difficulty: "Medium", projectPhases: "Design Dev, Documentation, Construction", order: 5 },
            { id: "resp-struct", name: "Responsible Structure", category: "responsible", shortDescription: "Sustainable structural materials", description: "Using responsible structural materials with lower environmental impacts.", aims: "To encourage the use of structural materials with reduced environmental impacts and verified sustainability credentials.", tips: "Work with structural engineers early to optimise material quantities. Low-carbon concrete is increasingly available.", required: false, maxPoints: 5, difficulty: "Hard", projectPhases: "Schematic, Design Dev, Documentation", order: 6, calculatorRequired: true },
            { id: "resp-envelope", name: "Responsible Envelope", category: "responsible", shortDescription: "Sustainable building envelope", description: "Using responsible envelope materials and systems.", aims: "To encourage the use of building envelope materials with reduced environmental impacts.", tips: "Consider the whole envelope system including framing, insulation, and finishes.", required: false, maxPoints: 5, difficulty: "Hard", projectPhases: "Schematic, Design Dev, Documentation", order: 7, calculatorRequired: true },
            { id: "resp-systems", name: "Responsible Systems", category: "responsible", shortDescription: "Sustainable building systems", description: "Using responsible building systems and services.", aims: "To encourage the use of building services and systems with reduced environmental impacts.", tips: "Engage MEP consultants early on responsible product requirements.", required: false, maxPoints: 5, difficulty: "Hard", projectPhases: "Design Dev, Documentation, Construction", order: 8, calculatorRequired: true },
            { id: "resp-finishes", name: "Responsible Finishes", category: "responsible", shortDescription: "Sustainable interior finishes", description: "Using responsible interior finishes and materials.", aims: "To encourage the use of interior finishes with reduced environmental impacts and health benefits.", tips: "Coordinate with interior designers early. Many finish products now have sustainability certifications.", required: false, maxPoints: 3, difficulty: "Medium", projectPhases: "Design Dev, Documentation, Construction", order: 9, calculatorRequired: true },
            { id: "impacts-disc", name: "Impacts Disclosure", category: "responsible", shortDescription: "Environmental impact reporting", description: "Disclosing environmental impacts of the building.", aims: "To encourage transparency about the environmental impacts of the building through public disclosure.", tips: "Use LCA early in design to inform material selection decisions. Consider publishing an environmental disclosure report.", required: false, maxPoints: 2, difficulty: "Hard", projectPhases: "Documentation, Handover", order: 10 },
            // Healthy Category (6 credits)
            { id: "clean-air", name: "Clean Air", category: "healthy", shortDescription: "Indoor air quality", description: "Ensuring high indoor air quality through ventilation and low-emission materials.", aims: "To ensure good indoor air quality that supports occupant health and wellbeing.", tips: "Consider demand-controlled ventilation based on CO2 levels. Low-VOC specifications should be included in contracts.", required: true, maxPoints: 6, difficulty: "Medium", projectPhases: "Schematic, Design Dev, Documentation", order: 1 },
            { id: "light-quality", name: "Light Quality", category: "healthy", shortDescription: "Daylight and lighting", description: "Providing adequate natural and artificial lighting for occupant comfort.", aims: "To provide high-quality lighting that supports visual comfort, health, and productivity.", tips: "Use daylight modelling early in design. Consider automated blind systems for glare control.", required: false, maxPoints: 5, difficulty: "Medium", projectPhases: "Concept, Schematic, Design Dev", order: 2 },
            { id: "acoustic", name: "Acoustic Comfort", category: "healthy", shortDescription: "Acoustic environment", description: "Managing noise levels and acoustic conditions within the building.", aims: "To provide acoustic conditions that support concentration, communication, and comfort.", tips: "Engage an acoustic consultant early. Consider noise from all sources including HVAC, lifts, and external traffic.", required: false, maxPoints: 5, difficulty: "Medium", projectPhases: "Schematic, Design Dev, Documentation", order: 3 },
            { id: "toxins", name: "Exposure to Toxins", category: "healthy", shortDescription: "Reducing toxic materials", description: "Minimizing occupant exposure to harmful chemicals and materials.", aims: "To reduce occupant exposure to harmful substances through careful material selection.", tips: "Use Declare labels and Health Product Declarations to verify product contents. Create a project Red List.", required: false, maxPoints: 4, difficulty: "Hard", projectPhases: "Design Dev, Documentation, Construction", order: 4 },
            { id: "amenity", name: "Amenity and Comfort", category: "healthy", shortDescription: "Occupant amenities", description: "Providing comfortable thermal conditions and amenities.", aims: "To provide comfortable conditions and amenities that support occupant wellbeing.", tips: "Consider operable windows where appropriate. Quality end-of-trip facilities encourage active transport.", required: false, maxPoints: 3, difficulty: "Medium", projectPhases: "Schematic, Design Dev, Documentation", order: 5 },
            { id: "nature-conn", name: "Connection to Nature", category: "healthy", shortDescription: "Biophilic design", description: "Creating visual and physical connections to natural elements.", aims: "To provide connections to nature that support occupant health and wellbeing (biophilic design).", tips: "Biophilic design can be cost-effective. Even small interventions like indoor plants can make a difference.", required: false, maxPoints: 2, difficulty: "Easy", projectPhases: "Concept, Schematic, Design Dev", order: 6 },
            // Resilient Category (5 credits)
            { id: "climate-res", name: "Climate Resilience", category: "resilient", shortDescription: "Climate adaptation", description: "Building resilience to climate change impacts.", aims: "To ensure buildings are designed and constructed to be resilient to current and future climate conditions.", tips: "Use climate projections for the building's lifespan (50+ years). Consider multiple climate scenarios.", required: true, maxPoints: 4, difficulty: "Hard", projectPhases: "Concept, Schematic", order: 1 },
            { id: "ops-res", name: "Operations Resilience", category: "resilient", shortDescription: "Operational continuity", description: "Ensuring operational resilience and continuity.", aims: "To ensure buildings can maintain critical operations during disruptions and emergencies.", tips: "Consider backup power, water storage, and safe areas. Coordinate with tenant operations requirements.", required: false, maxPoints: 3, difficulty: "Hard", projectPhases: "Schematic, Design Dev, Documentation", order: 2 },
            { id: "comm-res", name: "Community Resilience", category: "resilient", shortDescription: "Community support", description: "Supporting community resilience during emergencies.", aims: "To enable buildings to support the broader community during extreme weather events and emergencies.", tips: "Consider how the building can serve as a community refuge. Coordinate with local emergency management.", required: false, maxPoints: 3, difficulty: "Medium", projectPhases: "Concept, Schematic, Design Dev", order: 3 },
            { id: "heat-res", name: "Heat Resilience", category: "resilient", shortDescription: "Heat stress mitigation", description: "Mitigating heat stress for occupants.", aims: "To ensure buildings protect occupants during extreme heat events and reduce heat island effects.", tips: "Consider passive survivability - buildings should remain habitable during power outages in heat waves.", required: false, maxPoints: 3, difficulty: "Medium", projectPhases: "Concept, Schematic, Design Dev", order: 4 },
            { id: "grid-res", name: "Grid Resilience", category: "resilient", shortDescription: "Energy independence", description: "Building energy independence and grid resilience.", aims: "To enable buildings to operate independently of the grid during disruptions.", tips: "Consider battery storage and on-site generation. Prioritise critical loads for backup systems.", required: false, maxPoints: 2, difficulty: "Hard", projectPhases: "Design Dev, Documentation, Construction", order: 5 },
            // Positive Category (8 credits)
            { id: "energy-source", name: "Energy Source", category: "positive", shortDescription: "Renewable energy", description: "Using renewable and low-carbon energy sources.", aims: "To encourage the use of renewable and low-carbon energy sources for building operations.", tips: "Consider on-site solar PV first. Evaluate Power Purchase Agreements for off-site renewables.", required: true, maxPoints: 6, difficulty: "Medium", projectPhases: "Schematic, Design Dev, Documentation", order: 1 },
            { id: "energy-use", name: "Energy Use", category: "positive", shortDescription: "Energy efficiency", description: "Reducing operational energy consumption.", aims: "To reduce greenhouse gas emissions by minimising operational energy consumption.", tips: "Energy modelling should start early and iterate with design. Target net zero carbon ready design.", required: true, maxPoints: 10, difficulty: "Hard", projectPhases: "Concept, Schematic, Design Dev, Documentation", order: 2 },
            { id: "upfront-carbon-red", name: "Upfront Carbon Reduction", category: "positive", shortDescription: "Embodied carbon", description: "Reducing embodied carbon in construction.", aims: "To reduce the embodied carbon of construction materials and processes.", tips: "Focus on structure first - concrete and steel typically dominate embodied carbon. Get early LCA input.", required: true, maxPoints: 10, difficulty: "Hard", projectPhases: "Concept, Schematic, Design Dev", order: 3 },
            { id: "upfront-carbon-comp", name: "Upfront Carbon Compensation", category: "positive", shortDescription: "Carbon offsets", description: "Compensating for upfront carbon emissions.", aims: "To compensate for unavoidable upfront carbon emissions through verified carbon offsets.", tips: "Offsets should be a last resort after reduction efforts. Use high-quality verified offsets.", required: false, maxPoints: 3, difficulty: "Easy", projectPhases: "Documentation, Construction, Handover", order: 4 },
            { id: "refrigerant", name: "Refrigerant Systems Impacts", category: "positive", shortDescription: "Low-GWP refrigerants", description: "Using low global warming potential refrigerants.", aims: "To minimise the climate impact of refrigerants used in building systems.", tips: "Specify low-GWP refrigerants early. Consider natural refrigerants like CO2 or ammonia for large systems.", required: false, maxPoints: 3, difficulty: "Medium", projectPhases: "Design Dev, Documentation", order: 5 },
            { id: "low-emissions", name: "Low-Emissions Transport", category: "positive", shortDescription: "EV charging infrastructure", description: "Supporting low-emissions transport.", aims: "To support the transition to electric vehicles through charging infrastructure.", tips: "Plan for future EV charging capacity. Consider smart charging to manage peak loads.", required: false, maxPoints: 3, difficulty: "Easy", projectPhases: "Schematic, Design Dev, Documentation", order: 6 },
            { id: "circularity", name: "Design for Circularity", category: "positive", shortDescription: "Circular economy", description: "Designing for material reuse and circularity.", aims: "To encourage design that enables future material recovery and reuse.", tips: "Design for disassembly. Create material passports documenting products for future recovery.", required: false, maxPoints: 2, difficulty: "Medium", projectPhases: "Concept, Schematic, Design Dev", order: 7 },
            { id: "water-use", name: "Water Use", category: "positive", shortDescription: "Water efficiency", description: "Reducing potable water consumption.", aims: "To reduce potable water consumption through efficiency and alternative water sources.", tips: "Consider rainwater harvesting early - tank size affects building layout. Specify high WELS-rated fixtures.", required: false, maxPoints: 3, difficulty: "Medium", projectPhases: "Schematic, Design Dev, Documentation", order: 8 },
            // Places Category (4 credits)
            { id: "movement", name: "Movement and Place", category: "places", shortDescription: "Sustainable transport", description: "Encouraging sustainable transport modes.", aims: "To encourage and facilitate the use of sustainable transport modes.", tips: "Secure bike parking and quality end-of-trip facilities are essential. Consider EV charging infrastructure.", required: true, maxPoints: 5, difficulty: "Medium", projectPhases: "Concept, Schematic", order: 1 },
            { id: "enjoyable", name: "Enjoyable Places", category: "places", shortDescription: "Quality public spaces", description: "Creating high-quality public and shared spaces.", aims: "To create enjoyable places that enhance the quality of the public realm.", tips: "Consider pedestrian comfort including shade, seating, and weather protection. Activate edges.", required: false, maxPoints: 4, difficulty: "Medium", projectPhases: "Concept, Schematic, Design Dev", order: 2 },
            { id: "contribution", name: "Contribution to Place", category: "places", shortDescription: "Community contribution", description: "Contributing positively to the local community.", aims: "To encourage projects that contribute positively to local communities.", tips: "Engage with community groups early. Consider legacy programs and ongoing community partnerships.", required: false, maxPoints: 3, difficulty: "Easy", projectPhases: "Concept, Schematic, Design Dev", order: 3 },
            { id: "culture", name: "Culture, Heritage and Identity", category: "places", shortDescription: "Cultural recognition", description: "Respecting and celebrating cultural heritage.", aims: "To recognise and respect the cultural values of the place and community.", tips: "Engage with Traditional Owners early. Consider Acknowledgement of Country and cultural interpretation.", required: false, maxPoints: 3, difficulty: "Medium", projectPhases: "Concept, Schematic, Design Dev", order: 4 },
            // People Category (4 credits)
            { id: "inclusive-const", name: "Inclusive Construction Practices", category: "people", shortDescription: "Safe and inclusive sites", description: "Promoting diversity and inclusion in construction.", aims: "To promote diversity, inclusion, and fair treatment in the construction workforce.", tips: "Set workforce diversity targets in contracts. Partner with social enterprises and training providers.", required: true, maxPoints: 4, difficulty: "Medium", projectPhases: "Construction, Handover", order: 1 },
            { id: "first-nations", name: "First Nations Inclusion", category: "people", shortDescription: "Indigenous engagement", description: "Meaningful engagement with First Nations peoples.", aims: "To promote meaningful engagement with and opportunities for First Nations peoples.", tips: "Engage early and authentically. Consider procurement from Indigenous businesses.", required: false, maxPoints: 4, difficulty: "Medium", projectPhases: "Concept, Schematic, Construction", order: 2 },
            { id: "proc-workforce", name: "Procurement and Workforce Inclusion", category: "people", shortDescription: "Social procurement", description: "Inclusive procurement and workforce practices.", aims: "To promote social procurement and workforce development opportunities.", tips: "Set social procurement targets. Partner with social enterprises and training providers.", required: false, maxPoints: 4, difficulty: "Medium", projectPhases: "Documentation, Construction", order: 3 },
            { id: "design-equity", name: "Design for Equity", category: "people", shortDescription: "Accessible design", description: "Designing for accessibility and equity.", aims: "To create buildings that are accessible and equitable for all users.", tips: "Go beyond minimum accessibility requirements. Consider sensory impairments and neurodiversity.", required: false, maxPoints: 3, difficulty: "Medium", projectPhases: "Concept, Schematic, Design Dev", order: 4 },
            // Nature Category (5 credits)
            { id: "impacts-nature", name: "Impacts to Nature", category: "nature", shortDescription: "Minimising ecological impact", description: "Minimising negative impacts on natural ecosystems.", aims: "To minimise negative impacts on natural ecosystems and biodiversity.", tips: "Conduct ecology surveys early. Protect existing vegetation during construction.", required: true, maxPoints: 6, difficulty: "Medium", projectPhases: "Concept, Schematic, Construction", order: 1 },
            { id: "biodiversity", name: "Biodiversity Enhancement", category: "nature", shortDescription: "Ecological restoration", description: "Creating and enhancing habitat for native species.", aims: "To enhance biodiversity through habitat creation and restoration.", tips: "Use local native species. Consider green roofs and walls for urban biodiversity.", required: false, maxPoints: 6, difficulty: "Medium", projectPhases: "Schematic, Design Dev, Documentation", order: 2 },
            { id: "nature-connectivity", name: "Nature Connectivity", category: "nature", shortDescription: "Green corridors", description: "Creating connections between natural areas.", aims: "To create connections between natural areas that support wildlife movement.", tips: "Plan landscape to connect with broader ecological networks. Consider wildlife corridors.", required: false, maxPoints: 3, difficulty: "Medium", projectPhases: "Concept, Schematic, Design Dev", order: 3 },
            { id: "nature-steward", name: "Nature Stewardship", category: "nature", shortDescription: "Long-term nature care", description: "Long-term stewardship of natural areas.", aims: "To ensure ongoing management and stewardship of ecological areas.", tips: "Plan for long-term maintenance funding. Consider community involvement in stewardship.", required: false, maxPoints: 3, difficulty: "Medium", projectPhases: "Design Dev, Documentation, Handover", order: 4 },
            { id: "waterway", name: "Waterway Protection", category: "nature", shortDescription: "Stormwater management", description: "Managing stormwater to reduce flooding and improve water quality.", aims: "To reduce stormwater runoff and improve the quality of water leaving the site.", tips: "Integrate rainwater harvesting with landscape irrigation. Consider permeable paving for carparks.", required: false, maxPoints: 2, difficulty: "Medium", projectPhases: "Schematic, Design Dev, Documentation", order: 5 },
            // Leadership Category (2 credits)
            { id: "market-transform", name: "Market Transformation", category: "leadership", shortDescription: "Industry innovation", description: "Demonstrating market leadership and innovation.", aims: "To recognise projects that demonstrate market leadership and drive industry transformation.", tips: "Document innovations carefully. Consider sharing learnings through industry publications and events.", required: true, maxPoints: 2, difficulty: "Hard", projectPhases: "Concept, Schematic, Handover", order: 1 },
            { id: "leadership-challenge", name: "Leadership Challenges", category: "leadership", shortDescription: "Going beyond requirements", description: "Taking on ambitious sustainability challenges.", aims: "To recognise projects that take on ambitious sustainability challenges beyond standard practice.", tips: "Set ambitious targets early. Document baseline and track progress throughout project.", required: false, maxPoints: 3, difficulty: "Hard", projectPhases: "Concept, Schematic, Handover", order: 2 },
        ];

        const defaultLevels = [
            // Industry Development
            { creditId: "ind-dev", level: "minimum", points: 0, summary: "No specific requirements", description: "No minimum expectation for this credit" },
            { creditId: "ind-dev", level: "credit", points: 1, summary: "Training and events", description: "At least 2 team members complete Green Star training; participate in one industry event" },
            { creditId: "ind-dev", level: "exceptional", points: 2, summary: "Leadership", description: "At least 4 team members trained; multiple events; contribute to research or innovation" },
            // Responsible Construction
            { creditId: "resp-const", level: "minimum", points: 0, summary: "Basic EMP", description: "Basic Environmental Management Plan in place; compliance with regulations" },
            { creditId: "resp-const", level: "credit", points: 3, summary: "80% waste diversion", description: "Comprehensive EMP with monitoring; air, noise, stormwater controls; 80% waste diversion" },
            { creditId: "resp-const", level: "exceptional", points: 5, summary: "95% waste diversion", description: "Third-party certified EMP (ISO 14001); real-time monitoring; 95% waste diversion; zero non-conformances" },
            // Verification and Handover
            { creditId: "verify-hand", level: "minimum", points: 0, summary: "Basic commissioning", description: "Basic commissioning of major systems; standard handover documentation" },
            { creditId: "verify-hand", level: "credit", points: 2, summary: "Independent commissioning", description: "Independent Commissioning Agent; all systems tested; comprehensive O&M manuals; operator training" },
            { creditId: "verify-hand", level: "exceptional", points: 3, summary: "Enhanced commissioning", description: "Seasonal testing; 12-month building tuning; digital building logbook; ongoing monitoring system" },
            // Responsible Resource Management
            { creditId: "resp-resource", level: "minimum", points: 0, summary: "Basic waste management", description: "Basic waste management plan; waste streams separated on site" },
            { creditId: "resp-resource", level: "credit", points: 2, summary: "80% diversion", description: "At least 80% construction waste diverted; tracking system; dedicated sorting bins" },
            { creditId: "resp-resource", level: "exceptional", points: 3, summary: "95% diversion", description: "95% diversion; salvaged materials incorporated (5% by cost); closed-loop recycling partnerships" },
            // Responsible Procurement
            { creditId: "resp-proc", level: "minimum", points: 0, summary: "Basic procurement", description: "Basic procurement documentation; awareness of sustainable options" },
            { creditId: "resp-proc", level: "credit", points: 1, summary: "50% certified products", description: "Sustainable procurement policy; 50% products with certifications; supply chain tracking" },
            { creditId: "resp-proc", level: "exceptional", points: 2, summary: "80% certified products", description: "Comprehensive policy with review; 80% third-party verified products; full supply chain transparency" },
            // Responsible Structure
            { creditId: "resp-struct", level: "minimum", points: 0, summary: "Code compliance", description: "Materials comply with code; basic specifications documented" },
            { creditId: "resp-struct", level: "credit", points: 3, summary: "50% responsible materials", description: "50% concrete uses SCMs/low-carbon cement; ResponsibleSteel certified; FSC/PEFC timber; 50% EPDs" },
            { creditId: "resp-struct", level: "exceptional", points: 5, summary: "80% responsible materials", description: "80% low-carbon concrete; 100% certified steel; certified timber with chain of custody; 90% EPDs; material passports" },
            // Responsible Envelope
            { creditId: "resp-envelope", level: "minimum", points: 0, summary: "Thermal compliance", description: "Envelope meets minimum thermal performance; basic documentation" },
            { creditId: "resp-envelope", level: "credit", points: 3, summary: "50% certified products", description: "50% facade materials certified; insulation free from harmful substances; 50% EPDs; certified glazing" },
            { creditId: "resp-envelope", level: "exceptional", points: 5, summary: "80% certified products", description: "80% third-party certified; all insulation with EPDs and Red List free; 90% EPDs; whole-envelope LCA showing 20% reduction" },
            // Responsible Systems
            { creditId: "resp-systems", level: "minimum", points: 0, summary: "Code compliance", description: "Building systems meet code; basic equipment schedules documented" },
            { creditId: "resp-systems", level: "credit", points: 3, summary: "50% certified systems", description: "50% HVAC equipment certified; electrical with certifications; WELS-rated plumbing; 50% EPDs" },
            { creditId: "resp-systems", level: "exceptional", points: 5, summary: "80% certified systems", description: "80% systems certified; low-GWP refrigerants (GWP<750); 90% EPDs; whole-systems LCA; end-of-life recovery design" },
            // Responsible Finishes
            { creditId: "resp-finishes", level: "minimum", points: 0, summary: "Code compliance", description: "Interior finishes comply with code; basic schedules documented" },
            { creditId: "resp-finishes", level: "credit", points: 2, summary: "50% certified finishes", description: "50% flooring certified; certified ceilings; all paints GECA low-VOC; 50% EPDs" },
            { creditId: "resp-finishes", level: "exceptional", points: 3, summary: "80% certified finishes", description: "80% finishes certified; all Declare labelled or HPD compliant; zero Red List; 90% EPDs; bio-based/recycled content" },
            // Impacts Disclosure
            { creditId: "impacts-disc", level: "minimum", points: 0, summary: "Basic data collection", description: "Basic environmental data collected; internal reporting" },
            { creditId: "impacts-disc", level: "credit", points: 1, summary: "Public disclosure", description: "Whole-building LCA (EN 15978); public disclosure of GWP, water use, waste" },
            { creditId: "impacts-disc", level: "exceptional", points: 2, summary: "Third-party verified", description: "Third-party verified LCA; comprehensive public disclosure; ongoing reporting commitment; industry benchmarking" },
            // Clean Air
            { creditId: "clean-air", level: "minimum", points: 0, summary: "Code compliance", description: "Ventilation complies with AS 1668.2; basic exhaust for toilets and kitchens" },
            { creditId: "clean-air", level: "credit", points: 4, summary: "50% above code", description: "Ventilation 50% above code; MERV 13 filtration; CO2 sensors in all spaces; GECA paints; direct exhaust" },
            { creditId: "clean-air", level: "exceptional", points: 6, summary: "100% above code", description: "Ventilation 100% above code; MERV 16 with activated carbon; real-time IAQ monitoring displayed; WELL Air materials; pre-occupancy flush-out" },
            // Light Quality
            { creditId: "light-quality", level: "minimum", points: 0, summary: "Code compliance", description: "Lighting meets AS/NZS 1680; basic daylight to perimeter" },
            { creditId: "light-quality", level: "credit", points: 3, summary: "60% daylight", description: "60% NLA achieves 2% daylight factor; glare control; 100m² lighting zones with dimming; CRI 80+" },
            { creditId: "light-quality", level: "exceptional", points: 5, summary: "80% daylight", description: "80% NLA with 2%+ daylight; 2+ hours direct sunlight; circadian lighting (2700K-6500K); 75% views to outdoors; SDA>55%" },
            // Acoustic Comfort
            { creditId: "acoustic", level: "minimum", points: 0, summary: "BCA compliance", description: "Building meets BCA acoustic requirements; basic tenancy separation" },
            { creditId: "acoustic", level: "credit", points: 3, summary: "Enhanced acoustics", description: "HVAC noise <40dB(A) open/<35dB(A) enclosed; RT<0.8s; Rw≥45 between spaces; 50% ceiling treatment" },
            { creditId: "acoustic", level: "exceptional", points: 5, summary: "Premium acoustics", description: "HVAC <35dB(A) all spaces; STC≥50 speech privacy; dedicated quiet zones; external noise <40dB(A); post-occupancy testing" },
            // Exposure to Toxins
            { creditId: "toxins", level: "minimum", points: 0, summary: "Regulatory compliance", description: "Compliance with hazardous materials regulations; no asbestos" },
            { creditId: "toxins", level: "credit", points: 2, summary: "HPDs for 20 products", description: "HPDs for 20+ products; GECA furniture; no lead paint; no halogenated flame retardants" },
            { creditId: "toxins", level: "exceptional", points: 4, summary: "Red List free", description: "Red List free interiors; Declare labels/HPDs for 50+ products; PVC-free finishes; no PFAS; third-party verification" },
            // Amenity and Comfort
            { creditId: "amenity", level: "minimum", points: 0, summary: "BCA compliance", description: "Meets BCA thermal comfort; basic amenities provided" },
            { creditId: "amenity", level: "credit", points: 2, summary: "Enhanced comfort", description: "PMV -1 to +1 for 95% hours; thermostats per 100m²; end-of-trip (1 locker/10 occupants); breakout spaces" },
            { creditId: "amenity", level: "exceptional", points: 3, summary: "Premium comfort", description: "PMV -0.5 to +0.5; operable windows/personal fans; premium end-of-trip with repair station; outdoor access for 25%; wellness rooms" },
            // Connection to Nature
            { creditId: "nature-conn", level: "minimum", points: 0, summary: "Basic views", description: "Basic exterior views; some natural elements in finishes" },
            { creditId: "nature-conn", level: "credit", points: 1, summary: "Biophilic design", description: "50% spaces with vegetation views; indoor plants in commons; 25% natural materials; documented biophilic strategy" },
            { creditId: "nature-conn", level: "exceptional", points: 2, summary: "Extensive biophilia", description: "75% quality nature views; living walls or 1 plant/10m²; water features; natural patterns; direct nature access" },
            // Climate Resilience
            { creditId: "climate-res", level: "minimum", points: 0, summary: "Code compliance", description: "Building complies with current codes; basic climate consideration" },
            { creditId: "climate-res", level: "credit", points: 2, summary: "Climate risk assessment", description: "Climate risk assessment for building lifespan; adaptation measures identified and implemented" },
            { creditId: "climate-res", level: "exceptional", points: 4, summary: "Comprehensive resilience", description: "Multiple climate scenarios modelled; passive survivability demonstrated; adaptive capacity built in" },
            // Operations Resilience
            { creditId: "ops-res", level: "minimum", points: 0, summary: "Basic emergency planning", description: "Basic emergency procedures; standard evacuation plans" },
            { creditId: "ops-res", level: "credit", points: 2, summary: "Business continuity", description: "Business continuity plan; backup power for critical systems; emergency water storage" },
            { creditId: "ops-res", level: "exceptional", points: 3, summary: "Extended independence", description: "72+ hours self-sufficiency; on-site generation; comprehensive supplies; community refuge capability" },
            // Community Resilience
            { creditId: "comm-res", level: "minimum", points: 0, summary: "Basic planning", description: "Awareness of community emergency needs; basic coordination" },
            { creditId: "comm-res", level: "credit", points: 2, summary: "Community support", description: "Building can serve as cooling/heating refuge; emergency supplies for community; coordination with emergency services" },
            { creditId: "comm-res", level: "exceptional", points: 3, summary: "Community hub", description: "Designated community resilience hub; full emergency facilities; trained staff; integrated with local emergency plans" },
            // Heat Resilience
            { creditId: "heat-res", level: "minimum", points: 0, summary: "Code compliance", description: "Meets thermal comfort requirements during normal conditions" },
            { creditId: "heat-res", level: "credit", points: 2, summary: "Passive cooling", description: "Passive cooling strategies; building habitable during power outage in heat wave" },
            { creditId: "heat-res", level: "exceptional", points: 3, summary: "Cool refuge", description: "Building serves as cool refuge; significant heat island reduction; outdoor comfort strategies" },
            // Grid Resilience
            { creditId: "grid-res", level: "minimum", points: 0, summary: "Grid connected", description: "Standard grid connection; basic backup for life safety" },
            { creditId: "grid-res", level: "credit", points: 1, summary: "Partial independence", description: "Battery storage for critical loads; load management capability" },
            { creditId: "grid-res", level: "exceptional", points: 2, summary: "Grid independence", description: "Full islanding capability; on-site generation; vehicle-to-building capability; grid services provision" },
            // Energy Source
            { creditId: "energy-source", level: "minimum", points: 0, summary: "Grid connection", description: "Standard grid electricity connection" },
            { creditId: "energy-source", level: "credit", points: 4, summary: "50% renewable", description: "50% energy from renewable sources (on-site or PPA)" },
            { creditId: "energy-source", level: "exceptional", points: 6, summary: "100% renewable", description: "100% renewable energy; on-site generation priority; renewable gas or electrification" },
            // Energy Use
            { creditId: "energy-use", level: "minimum", points: 0, summary: "Code compliance", description: "Meet NCC Section J requirements" },
            { creditId: "energy-use", level: "credit", points: 6, summary: "30% improvement", description: "30% improvement on reference building; all cost-effective measures implemented" },
            { creditId: "energy-use", level: "exceptional", points: 10, summary: "Net zero ready", description: "50%+ improvement; net zero carbon ready; innovative efficiency measures" },
            // Upfront Carbon Reduction
            { creditId: "upfront-carbon-red", level: "minimum", points: 0, summary: "LCA completed", description: "Life Cycle Assessment completed" },
            { creditId: "upfront-carbon-red", level: "credit", points: 6, summary: "20% reduction", description: "20% reduction in upfront carbon vs benchmark" },
            { creditId: "upfront-carbon-red", level: "exceptional", points: 10, summary: "40%+ reduction", description: "40%+ reduction in upfront carbon; innovative low-carbon solutions" },
            // Upfront Carbon Compensation
            { creditId: "upfront-carbon-comp", level: "minimum", points: 0, summary: "Offset awareness", description: "Understanding of carbon offset options" },
            { creditId: "upfront-carbon-comp", level: "credit", points: 2, summary: "Partial offset", description: "50% of residual upfront carbon offset with verified credits" },
            { creditId: "upfront-carbon-comp", level: "exceptional", points: 3, summary: "Full offset", description: "100% of upfront carbon offset; high-quality verified offsets; long-term sequestration" },
            // Refrigerant Systems Impacts
            { creditId: "refrigerant", level: "minimum", points: 0, summary: "Code compliance", description: "Refrigerants comply with phase-down requirements" },
            { creditId: "refrigerant", level: "credit", points: 2, summary: "Low GWP", description: "All refrigerants GWP < 750; leak detection systems" },
            { creditId: "refrigerant", level: "exceptional", points: 3, summary: "Ultra-low GWP", description: "Natural refrigerants (CO2, ammonia) or GWP < 150; full lifecycle refrigerant management" },
            // Low-Emissions Transport
            { creditId: "low-emissions", level: "minimum", points: 0, summary: "EV ready", description: "Electrical infrastructure allows future EV charging" },
            { creditId: "low-emissions", level: "credit", points: 2, summary: "EV charging", description: "EV charging for 10% of parking spaces; smart charging capability" },
            { creditId: "low-emissions", level: "exceptional", points: 3, summary: "Comprehensive EV", description: "EV charging for 25%+ spaces; vehicle-to-building capability; e-bike charging" },
            // Design for Circularity
            { creditId: "circularity", level: "minimum", points: 0, summary: "Waste planning", description: "Construction waste minimisation considered" },
            { creditId: "circularity", level: "credit", points: 1, summary: "Design for disassembly", description: "Design for disassembly principles applied; material passports for key elements" },
            { creditId: "circularity", level: "exceptional", points: 2, summary: "Full circularity", description: "Comprehensive circular design; reused materials incorporated; take-back schemes for products" },
            // Water Use
            { creditId: "water-use", level: "minimum", points: 0, summary: "Code compliance", description: "Fixtures comply with WELS minimum requirements" },
            { creditId: "water-use", level: "credit", points: 2, summary: "30% reduction", description: "30% potable water reduction; high WELS-rated fixtures; water-efficient landscaping" },
            { creditId: "water-use", level: "exceptional", points: 3, summary: "50% reduction", description: "50% potable water reduction; rainwater/greywater systems; water monitoring" },
            // Movement and Place
            { creditId: "movement", level: "minimum", points: 0, summary: "Basic access", description: "Site accessible by public transport; basic bike parking" },
            { creditId: "movement", level: "credit", points: 3, summary: "Enhanced access", description: "Within 400m of quality public transport; secure bike parking; end-of-trip facilities" },
            { creditId: "movement", level: "exceptional", points: 5, summary: "Premium access", description: "Multiple transport options; car share; comprehensive cycling; reduced parking provision" },
            // Enjoyable Places
            { creditId: "enjoyable", level: "minimum", points: 0, summary: "Basic amenity", description: "Basic outdoor areas; minimal public realm contribution" },
            { creditId: "enjoyable", level: "credit", points: 2, summary: "Quality public space", description: "Quality public spaces; pedestrian comfort; seating and shade; active edges" },
            { creditId: "enjoyable", level: "exceptional", points: 4, summary: "Exceptional places", description: "Award-quality public realm; extensive greening; public art; community programming" },
            // Contribution to Place
            { creditId: "contribution", level: "minimum", points: 0, summary: "Basic compliance", description: "Development complies with local requirements" },
            { creditId: "contribution", level: "credit", points: 2, summary: "Positive contribution", description: "Positive contribution to local area; community consultation; local partnerships" },
            { creditId: "contribution", level: "exceptional", points: 3, summary: "Significant benefit", description: "Significant community benefit; legacy programs; ongoing community partnerships" },
            // Culture, Heritage and Identity
            { creditId: "culture", level: "minimum", points: 0, summary: "Heritage compliance", description: "Compliance with heritage requirements; basic cultural consideration" },
            { creditId: "culture", level: "credit", points: 2, summary: "Cultural recognition", description: "Traditional Owner engagement; cultural interpretation; heritage conservation" },
            { creditId: "culture", level: "exceptional", points: 3, summary: "Cultural celebration", description: "Deep cultural engagement; collaborative design with Traditional Owners; ongoing cultural programs" },
            // Inclusive Construction Practices
            { creditId: "inclusive-const", level: "minimum", points: 0, summary: "Legal compliance", description: "Compliance with WHS and anti-discrimination requirements" },
            { creditId: "inclusive-const", level: "credit", points: 2, summary: "Inclusive practices", description: "Diversity targets in workforce; mental health support; inclusive facilities on site" },
            { creditId: "inclusive-const", level: "exceptional", points: 4, summary: "Industry leading", description: "Industry-leading diversity; comprehensive wellbeing programs; training and development pathways" },
            // First Nations Inclusion
            { creditId: "first-nations", level: "minimum", points: 0, summary: "Basic engagement", description: "Acknowledgement of Country; awareness of Traditional Owners" },
            { creditId: "first-nations", level: "credit", points: 2, summary: "Meaningful engagement", description: "Ongoing Traditional Owner engagement; Indigenous employment targets; Indigenous procurement" },
            { creditId: "first-nations", level: "exceptional", points: 4, summary: "Partnership", description: "Genuine partnership with Traditional Owners; significant Indigenous employment; cultural legacy" },
            // Procurement and Workforce Inclusion
            { creditId: "proc-workforce", level: "minimum", points: 0, summary: "Basic compliance", description: "Compliance with employment requirements" },
            { creditId: "proc-workforce", level: "credit", points: 2, summary: "Social procurement", description: "Social procurement targets; trainee/apprentice employment; local employment" },
            { creditId: "proc-workforce", level: "exceptional", points: 4, summary: "Significant impact", description: "Significant social enterprise spend; comprehensive training programs; community employment" },
            // Design for Equity
            { creditId: "design-equity", level: "minimum", points: 0, summary: "DDA compliance", description: "Compliance with Disability Discrimination Act; basic accessibility" },
            { creditId: "design-equity", level: "credit", points: 2, summary: "Enhanced accessibility", description: "Beyond minimum accessibility; Changing Places toilet; sensory considerations" },
            { creditId: "design-equity", level: "exceptional", points: 3, summary: "Universal design", description: "Universal design throughout; neurodiversity considered; co-design with disability community" },
            // Impacts to Nature
            { creditId: "impacts-nature", level: "minimum", points: 0, summary: "Regulatory compliance", description: "Compliance with environmental regulations; basic site assessment" },
            { creditId: "impacts-nature", level: "credit", points: 3, summary: "Minimised impacts", description: "Ecology assessment; protection of existing habitat; no net loss of ecological value" },
            { creditId: "impacts-nature", level: "exceptional", points: 6, summary: "Net positive", description: "Net positive biodiversity; habitat restoration; threatened species protection; certified ecological management" },
            // Biodiversity Enhancement
            { creditId: "biodiversity", level: "minimum", points: 0, summary: "Basic landscaping", description: "Standard landscaping; minimal ecological consideration" },
            { creditId: "biodiversity", level: "credit", points: 3, summary: "Habitat creation", description: "Native plantings; habitat features; green roof/walls; documented biodiversity plan" },
            { creditId: "biodiversity", level: "exceptional", points: 6, summary: "Significant enhancement", description: "Significant habitat creation; species recovery support; ongoing ecological monitoring; certified net gain" },
            // Nature Connectivity
            { creditId: "nature-connectivity", level: "minimum", points: 0, summary: "Basic greening", description: "Standard landscape design; isolated green spaces" },
            { creditId: "nature-connectivity", level: "credit", points: 2, summary: "Ecological corridors", description: "Landscape connects to broader ecological networks; wildlife corridors; canopy connectivity" },
            { creditId: "nature-connectivity", level: "exceptional", points: 3, summary: "Network contribution", description: "Significant contribution to regional ecological network; fauna crossing features; documented connectivity improvement" },
            // Nature Stewardship
            { creditId: "nature-steward", level: "minimum", points: 0, summary: "Basic maintenance", description: "Standard landscape maintenance provisions" },
            { creditId: "nature-steward", level: "credit", points: 2, summary: "Long-term management", description: "Funded ecological management plan; regular monitoring; adaptive management" },
            { creditId: "nature-steward", level: "exceptional", points: 3, summary: "Conservation commitment", description: "Long-term conservation covenant; community involvement; citizen science programs" },
            // Waterway Protection
            { creditId: "waterway", level: "minimum", points: 0, summary: "Basic controls", description: "Basic erosion and sediment control; compliance with stormwater requirements" },
            { creditId: "waterway", level: "credit", points: 1, summary: "Water quality treatment", description: "Stormwater treatment to best practice; pollutant reduction; flow management" },
            { creditId: "waterway", level: "exceptional", points: 2, summary: "Waterway enhancement", description: "Stormwater harvesting; waterway restoration; water sensitive urban design throughout" },
            // Market Transformation
            { creditId: "market-transform", level: "minimum", points: 0, summary: "Standard practice", description: "Following current industry practice" },
            { creditId: "market-transform", level: "credit", points: 1, summary: "Industry contribution", description: "Documented industry contribution; case study publication; knowledge sharing" },
            { creditId: "market-transform", level: "exceptional", points: 2, summary: "Market leadership", description: "Significant innovation; industry-first achievements; transformational influence on practice" },
            // Leadership Challenges
            { creditId: "leadership-challenge", level: "minimum", points: 0, summary: "Standard targets", description: "Meeting standard Green Star requirements" },
            { creditId: "leadership-challenge", level: "credit", points: 2, summary: "Ambitious targets", description: "Targets significantly exceed credit requirements in chosen challenge area" },
            { creditId: "leadership-challenge", level: "exceptional", points: 3, summary: "Exceptional achievement", description: "Exceptional performance in leadership challenge; documented transformational outcomes" },
        ];

        const defaultCriteria = [
            // Industry Development
            { creditId: "ind-dev", level: "credit", criteriaNum: 1, text: "At least 2 project team members complete Green Star accreditation or equivalent training", mandatory: true, evidenceType: "Certificate" },
            { creditId: "ind-dev", level: "credit", criteriaNum: 2, text: "Project participates in one industry event (presentation, case study, or site tour)", mandatory: true, evidenceType: "Document" },
            { creditId: "ind-dev", level: "exceptional", criteriaNum: 1, text: "At least 4 project team members complete Green Star accreditation", mandatory: true, evidenceType: "Certificate" },
            { creditId: "ind-dev", level: "exceptional", criteriaNum: 2, text: "Project participates in multiple industry events", mandatory: true, evidenceType: "Document" },
            { creditId: "ind-dev", level: "exceptional", criteriaNum: 3, text: "Project contributes to sustainability research or innovation initiatives", mandatory: false, evidenceType: "Report" },
            // Responsible Construction
            { creditId: "resp-const", level: "minimum", criteriaNum: 1, text: "Complete an Environmental Management Plan (EMP)", mandatory: true, evidenceType: "Document" },
            { creditId: "resp-const", level: "minimum", criteriaNum: 2, text: "Comply with local environmental regulations", mandatory: true, evidenceType: "Document" },
            { creditId: "resp-const", level: "credit", criteriaNum: 1, text: "Implement comprehensive EMP with regular monitoring and reporting", mandatory: true, evidenceType: "Report" },
            { creditId: "resp-const", level: "credit", criteriaNum: 2, text: "Implement air quality, noise, and stormwater management controls", mandatory: true, evidenceType: "Report" },
            { creditId: "resp-const", level: "credit", criteriaNum: 3, text: "Achieve at least 80% waste diversion from landfill", mandatory: true, evidenceType: "Report" },
            { creditId: "resp-const", level: "exceptional", criteriaNum: 1, text: "Implement third-party certified EMP (ISO 14001 or equivalent)", mandatory: true, evidenceType: "Certificate" },
            { creditId: "resp-const", level: "exceptional", criteriaNum: 2, text: "Install real-time environmental monitoring systems", mandatory: true, evidenceType: "Report" },
            { creditId: "resp-const", level: "exceptional", criteriaNum: 3, text: "Achieve at least 95% waste diversion from landfill", mandatory: true, evidenceType: "Report" },
            { creditId: "resp-const", level: "exceptional", criteriaNum: 4, text: "Achieve zero environmental non-conformances", mandatory: true, evidenceType: "Report" },
            // Verification and Handover
            { creditId: "verify-hand", level: "credit", criteriaNum: 1, text: "Engage Independent Commissioning Agent", mandatory: true, evidenceType: "Contract" },
            { creditId: "verify-hand", level: "credit", criteriaNum: 2, text: "Commission and test all building systems", mandatory: true, evidenceType: "Report" },
            { creditId: "verify-hand", level: "credit", criteriaNum: 3, text: "Provide comprehensive O&M manuals", mandatory: true, evidenceType: "Document" },
            { creditId: "verify-hand", level: "credit", criteriaNum: 4, text: "Complete building operator training", mandatory: true, evidenceType: "Report" },
            { creditId: "verify-hand", level: "exceptional", criteriaNum: 1, text: "Complete enhanced commissioning with seasonal testing", mandatory: true, evidenceType: "Report" },
            { creditId: "verify-hand", level: "exceptional", criteriaNum: 2, text: "Commit to 12-month building tuning period", mandatory: true, evidenceType: "Contract" },
            { creditId: "verify-hand", level: "exceptional", criteriaNum: 3, text: "Implement digital building logbook or BIM-based O&M", mandatory: true, evidenceType: "Document" },
            // Clean Air
            { creditId: "clean-air", level: "minimum", criteriaNum: 1, text: "Ventilation complies with AS 1668.2 minimum requirements", mandatory: true, evidenceType: "Calculation" },
            { creditId: "clean-air", level: "minimum", criteriaNum: 2, text: "Basic exhaust systems for toilets and kitchens", mandatory: true, evidenceType: "Drawing" },
            { creditId: "clean-air", level: "credit", criteriaNum: 1, text: "Ventilation rates exceed code by at least 50%", mandatory: true, evidenceType: "Calculation" },
            { creditId: "clean-air", level: "credit", criteriaNum: 2, text: "MERV 13 (or equivalent) filtration on outdoor air", mandatory: true, evidenceType: "Specification" },
            { creditId: "clean-air", level: "credit", criteriaNum: 3, text: "CO2 sensors in all occupied spaces connected to BMS", mandatory: true, evidenceType: "Drawing" },
            { creditId: "clean-air", level: "credit", criteriaNum: 4, text: "All interior paints and adhesives meet GECA standards", mandatory: true, evidenceType: "Certificate" },
            { creditId: "clean-air", level: "exceptional", criteriaNum: 1, text: "Ventilation rates exceed code by at least 100%", mandatory: true, evidenceType: "Calculation" },
            { creditId: "clean-air", level: "exceptional", criteriaNum: 2, text: "MERV 16 filtration or better with activated carbon", mandatory: true, evidenceType: "Specification" },
            { creditId: "clean-air", level: "exceptional", criteriaNum: 3, text: "Real-time IAQ monitoring (CO2, PM2.5, VOCs) publicly displayed", mandatory: true, evidenceType: "Report" },
            { creditId: "clean-air", level: "exceptional", criteriaNum: 4, text: "Pre-occupancy flush-out completed and documented", mandatory: true, evidenceType: "Report" },
            // Light Quality
            { creditId: "light-quality", level: "credit", criteriaNum: 1, text: "At least 60% of NLA achieves daylight factor of 2% or higher", mandatory: true, evidenceType: "Calculation" },
            { creditId: "light-quality", level: "credit", criteriaNum: 2, text: "Glare controlled with automated blinds or fixed shading", mandatory: true, evidenceType: "Drawing" },
            { creditId: "light-quality", level: "credit", criteriaNum: 3, text: "Lighting zones of max 100m² with individual dimming control", mandatory: true, evidenceType: "Drawing" },
            { creditId: "light-quality", level: "exceptional", criteriaNum: 1, text: "At least 80% of NLA achieves daylight factor of 2% or higher", mandatory: true, evidenceType: "Calculation" },
            { creditId: "light-quality", level: "exceptional", criteriaNum: 2, text: "Circadian lighting with tunable white (2700K-6500K)", mandatory: true, evidenceType: "Specification" },
            { creditId: "light-quality", level: "exceptional", criteriaNum: 3, text: "Views to outdoors from at least 75% of regularly occupied spaces", mandatory: true, evidenceType: "Calculation" },
            // Acoustic Comfort
            { creditId: "acoustic", level: "credit", criteriaNum: 1, text: "Background noise from HVAC < 40 dB(A) in open offices, < 35 dB(A) in enclosed offices", mandatory: true, evidenceType: "Calculation" },
            { creditId: "acoustic", level: "credit", criteriaNum: 2, text: "Reverberation time < 0.8 seconds in open plan areas", mandatory: true, evidenceType: "Calculation" },
            { creditId: "acoustic", level: "credit", criteriaNum: 3, text: "Sound insulation Rw ≥ 45 between enclosed spaces", mandatory: true, evidenceType: "Specification" },
            { creditId: "acoustic", level: "exceptional", criteriaNum: 1, text: "Background noise from HVAC < 35 dB(A) in all occupied spaces", mandatory: true, evidenceType: "Report" },
            { creditId: "acoustic", level: "exceptional", criteriaNum: 2, text: "Speech privacy achieved with Sound Transmission Class (STC) ≥ 50", mandatory: true, evidenceType: "Report" },
            { creditId: "acoustic", level: "exceptional", criteriaNum: 3, text: "Post-occupancy acoustic verification testing completed", mandatory: true, evidenceType: "Report" },
            // Energy Source
            { creditId: "energy-source", level: "credit", criteriaNum: 1, text: "50% of energy from renewable sources (on-site or PPA)", mandatory: true, evidenceType: "Report" },
            { creditId: "energy-source", level: "exceptional", criteriaNum: 1, text: "100% of energy from renewable sources", mandatory: true, evidenceType: "Report" },
            { creditId: "energy-source", level: "exceptional", criteriaNum: 2, text: "On-site renewable generation prioritised", mandatory: false, evidenceType: "Calculation" },
            // Energy Use
            { creditId: "energy-use", level: "minimum", criteriaNum: 1, text: "Meet NCC Section J requirements", mandatory: true, evidenceType: "Calculation" },
            { creditId: "energy-use", level: "credit", criteriaNum: 1, text: "Achieve 30% improvement on reference building", mandatory: true, evidenceType: "Calculation" },
            { creditId: "energy-use", level: "exceptional", criteriaNum: 1, text: "Achieve 50%+ improvement on reference building", mandatory: true, evidenceType: "Calculation" },
            { creditId: "energy-use", level: "exceptional", criteriaNum: 2, text: "Building is net zero carbon ready", mandatory: true, evidenceType: "Report" },
            // Upfront Carbon Reduction
            { creditId: "upfront-carbon-red", level: "minimum", criteriaNum: 1, text: "Complete whole-building Life Cycle Assessment", mandatory: true, evidenceType: "Calculation" },
            { creditId: "upfront-carbon-red", level: "credit", criteriaNum: 1, text: "Achieve 20% reduction in upfront carbon vs benchmark", mandatory: true, evidenceType: "Calculation" },
            { creditId: "upfront-carbon-red", level: "exceptional", criteriaNum: 1, text: "Achieve 40%+ reduction in upfront carbon", mandatory: true, evidenceType: "Calculation" },
            // Water Use
            { creditId: "water-use", level: "credit", criteriaNum: 1, text: "Achieve 30% potable water reduction", mandatory: true, evidenceType: "Calculation" },
            { creditId: "water-use", level: "credit", criteriaNum: 2, text: "Install high WELS-rated fixtures throughout", mandatory: true, evidenceType: "Specification" },
            { creditId: "water-use", level: "exceptional", criteriaNum: 1, text: "Achieve 50% potable water reduction", mandatory: true, evidenceType: "Calculation" },
            { creditId: "water-use", level: "exceptional", criteriaNum: 2, text: "Implement rainwater or greywater systems", mandatory: true, evidenceType: "Drawing" },
            // Movement and Place
            { creditId: "movement", level: "credit", criteriaNum: 1, text: "Site within 400m of quality public transport", mandatory: true, evidenceType: "Drawing" },
            { creditId: "movement", level: "credit", criteriaNum: 2, text: "Secure bike parking provided", mandatory: true, evidenceType: "Drawing" },
            { creditId: "movement", level: "credit", criteriaNum: 3, text: "End-of-trip facilities with showers and lockers", mandatory: true, evidenceType: "Drawing" },
            { creditId: "movement", level: "exceptional", criteriaNum: 1, text: "Multiple sustainable transport options available", mandatory: true, evidenceType: "Report" },
            { creditId: "movement", level: "exceptional", criteriaNum: 2, text: "Reduced parking provision below local requirements", mandatory: true, evidenceType: "Report" },
            // Climate Resilience
            { creditId: "climate-res", level: "credit", criteriaNum: 1, text: "Climate risk assessment completed for building lifespan", mandatory: true, evidenceType: "Report" },
            { creditId: "climate-res", level: "credit", criteriaNum: 2, text: "Adaptation measures identified and implemented", mandatory: true, evidenceType: "Report" },
            { creditId: "climate-res", level: "exceptional", criteriaNum: 1, text: "Multiple climate scenarios modelled (RCP 4.5 and 8.5)", mandatory: true, evidenceType: "Report" },
            { creditId: "climate-res", level: "exceptional", criteriaNum: 2, text: "Passive survivability demonstrated", mandatory: true, evidenceType: "Calculation" },
            // Biodiversity Enhancement
            { creditId: "biodiversity", level: "credit", criteriaNum: 1, text: "Native plantings incorporated in landscape design", mandatory: true, evidenceType: "Drawing" },
            { creditId: "biodiversity", level: "credit", criteriaNum: 2, text: "Habitat features provided (nesting boxes, insect hotels)", mandatory: true, evidenceType: "Drawing" },
            { creditId: "biodiversity", level: "exceptional", criteriaNum: 1, text: "Significant habitat creation demonstrated", mandatory: true, evidenceType: "Report" },
            { creditId: "biodiversity", level: "exceptional", criteriaNum: 2, text: "Ongoing ecological monitoring program established", mandatory: true, evidenceType: "Contract" },
            // Design for Equity
            { creditId: "design-equity", level: "credit", criteriaNum: 1, text: "Accessibility exceeds minimum DDA requirements", mandatory: true, evidenceType: "Report" },
            { creditId: "design-equity", level: "credit", criteriaNum: 2, text: "Changing Places toilet provided", mandatory: false, evidenceType: "Drawing" },
            { creditId: "design-equity", level: "exceptional", criteriaNum: 1, text: "Universal design principles applied throughout", mandatory: true, evidenceType: "Report" },
            { creditId: "design-equity", level: "exceptional", criteriaNum: 2, text: "Co-design undertaken with disability community", mandatory: true, evidenceType: "Report" },
            // Market Transformation
            { creditId: "market-transform", level: "credit", criteriaNum: 1, text: "Documented industry contribution (case study, publication)", mandatory: true, evidenceType: "Document" },
            { creditId: "market-transform", level: "exceptional", criteriaNum: 1, text: "Industry-first achievement demonstrated", mandatory: true, evidenceType: "Report" },
            { creditId: "market-transform", level: "exceptional", criteriaNum: 2, text: "Transformational influence on industry practice documented", mandatory: true, evidenceType: "Report" },
        ];

        const defaultDocumentation = [
            // Industry Development
            { creditId: "ind-dev", level: "all", name: "Training Certificates", type: "Certificate", description: "Evidence of Green Star accreditation or equivalent training completion", templateAvailable: false, templateLink: "" },
            { creditId: "ind-dev", level: "all", name: "Industry Event Evidence", type: "Document", description: "Presentation materials, attendance records, or case study publications", templateAvailable: false, templateLink: "" },
            // Responsible Construction
            { creditId: "resp-const", level: "all", name: "Environmental Management Plan", type: "Report", description: "Comprehensive EMP covering construction phase", templateAvailable: true, templateLink: "templates/EMP_template.docx" },
            { creditId: "resp-const", level: "all", name: "Waste Management Report", type: "Report", description: "Monthly waste tracking and diversion rates", templateAvailable: true, templateLink: "templates/waste_report.xlsx" },
            { creditId: "resp-const", level: "all", name: "Site Inspection Reports", type: "Report", description: "Regular environmental inspection reports with photos", templateAvailable: true, templateLink: "templates/inspection_report.docx" },
            { creditId: "resp-const", level: "exceptional", name: "ISO 14001 Certificate", type: "Certificate", description: "Third-party EMS certification", templateAvailable: false, templateLink: "" },
            // Verification and Handover
            { creditId: "verify-hand", level: "all", name: "Commissioning Plan", type: "Report", description: "Comprehensive commissioning plan for all systems", templateAvailable: true, templateLink: "templates/cx_plan.docx" },
            { creditId: "verify-hand", level: "all", name: "Commissioning Reports", type: "Report", description: "Test certificates and commissioning results", templateAvailable: false, templateLink: "" },
            { creditId: "verify-hand", level: "all", name: "O&M Manuals", type: "Document", description: "Operation and maintenance documentation", templateAvailable: false, templateLink: "" },
            { creditId: "verify-hand", level: "all", name: "Training Records", type: "Report", description: "Building operator training attendance and materials", templateAvailable: false, templateLink: "" },
            // Responsible Procurement
            { creditId: "resp-proc", level: "all", name: "Sustainable Procurement Policy", type: "Document", description: "Project sustainable procurement policy", templateAvailable: true, templateLink: "templates/procurement_policy.docx" },
            { creditId: "resp-proc", level: "all", name: "Product Certifications", type: "Certificate", description: "EPDs and sustainability certifications for products", templateAvailable: false, templateLink: "" },
            // Responsible Structure
            { creditId: "resp-struct", level: "all", name: "Material Specifications", type: "Document", description: "Structural material specifications and quantities", templateAvailable: false, templateLink: "" },
            { creditId: "resp-struct", level: "all", name: "Structural EPDs", type: "Certificate", description: "Environmental Product Declarations for structural materials", templateAvailable: false, templateLink: "" },
            { creditId: "resp-struct", level: "all", name: "Responsible Products Calculator", type: "Calculation", description: "Calculator outputs demonstrating compliance", templateAvailable: true, templateLink: "calculators/responsible_products.xlsx" },
            // Responsible Envelope
            { creditId: "resp-envelope", level: "all", name: "Envelope Material Schedule", type: "Document", description: "Specifications for facade, insulation, and glazing", templateAvailable: false, templateLink: "" },
            { creditId: "resp-envelope", level: "all", name: "Envelope EPDs", type: "Certificate", description: "EPDs for envelope products", templateAvailable: false, templateLink: "" },
            // Clean Air
            { creditId: "clean-air", level: "all", name: "Ventilation Calculations", type: "Calculation", description: "Fresh air rates per AS 1668.2", templateAvailable: true, templateLink: "templates/ventilation_calc.xlsx" },
            { creditId: "clean-air", level: "all", name: "Air Filtration Specifications", type: "Specification", description: "Filter ratings and specifications", templateAvailable: false, templateLink: "" },
            { creditId: "clean-air", level: "all", name: "VOC Test Reports", type: "Report", description: "TVOC testing or product certifications", templateAvailable: false, templateLink: "" },
            { creditId: "clean-air", level: "all", name: "CO2 Sensor Drawings", type: "Drawing", description: "Locations and BMS integration details", templateAvailable: false, templateLink: "" },
            // Light Quality
            { creditId: "light-quality", level: "all", name: "Daylight Modelling Report", type: "Calculation", description: "Daylight factor analysis and results", templateAvailable: false, templateLink: "" },
            { creditId: "light-quality", level: "all", name: "Glare Analysis", type: "Calculation", description: "UGR calculations and glare control strategy", templateAvailable: false, templateLink: "" },
            { creditId: "light-quality", level: "all", name: "Lighting Design Documentation", type: "Drawing", description: "Lighting layouts and control zones", templateAvailable: false, templateLink: "" },
            // Acoustic Comfort
            { creditId: "acoustic", level: "all", name: "Acoustic Consultant Report", type: "Report", description: "Acoustic design and compliance report", templateAvailable: false, templateLink: "" },
            { creditId: "acoustic", level: "all", name: "Background Noise Calculations", type: "Calculation", description: "HVAC noise level predictions", templateAvailable: false, templateLink: "" },
            { creditId: "acoustic", level: "exceptional", name: "Post-Occupancy Testing", type: "Report", description: "Acoustic verification test results", templateAvailable: false, templateLink: "" },
            // Exposure to Toxins
            { creditId: "toxins", level: "all", name: "Material Declarations", type: "Certificate", description: "Declare labels and Health Product Declarations", templateAvailable: false, templateLink: "" },
            { creditId: "toxins", level: "all", name: "Red List Compliance", type: "Report", description: "Red List free product verification", templateAvailable: false, templateLink: "" },
            // Energy Source
            { creditId: "energy-source", level: "all", name: "Energy Source Report", type: "Report", description: "Documentation of renewable energy systems and PPAs", templateAvailable: false, templateLink: "" },
            { creditId: "energy-source", level: "all", name: "PPA Documentation", type: "Contract", description: "Power Purchase Agreement details", templateAvailable: false, templateLink: "" },
            // Energy Use
            { creditId: "energy-use", level: "all", name: "Energy Model Report", type: "Calculation", description: "Building energy modelling results and methodology", templateAvailable: false, templateLink: "" },
            { creditId: "energy-use", level: "all", name: "NCC Section J Compliance", type: "Calculation", description: "JV3 modelling or DTS compliance", templateAvailable: false, templateLink: "" },
            // Upfront Carbon Reduction
            { creditId: "upfront-carbon-red", level: "all", name: "Life Cycle Assessment", type: "Calculation", description: "Whole building LCA report per EN 15978", templateAvailable: false, templateLink: "" },
            { creditId: "upfront-carbon-red", level: "all", name: "LCA Tool Outputs", type: "Calculation", description: "Detailed LCA calculator outputs", templateAvailable: false, templateLink: "" },
            // Water Use
            { creditId: "water-use", level: "all", name: "Water Balance Calculation", type: "Calculation", description: "Potable water reduction calculations", templateAvailable: true, templateLink: "templates/water_balance.xlsx" },
            { creditId: "water-use", level: "all", name: "Fixture Schedule", type: "Specification", description: "WELS ratings for all fixtures", templateAvailable: false, templateLink: "" },
            // Movement and Place
            { creditId: "movement", level: "all", name: "Transport Assessment", type: "Report", description: "Site accessibility and transport analysis", templateAvailable: false, templateLink: "" },
            { creditId: "movement", level: "all", name: "End-of-Trip Drawings", type: "Drawing", description: "Bike parking and EOT facility layouts", templateAvailable: false, templateLink: "" },
            // Climate Resilience
            { creditId: "climate-res", level: "all", name: "Climate Risk Assessment", type: "Report", description: "Climate hazard identification and risk analysis", templateAvailable: true, templateLink: "templates/climate_risk.docx" },
            { creditId: "climate-res", level: "all", name: "Adaptation Strategy", type: "Report", description: "Climate adaptation measures and implementation", templateAvailable: false, templateLink: "" },
            // Biodiversity
            { creditId: "biodiversity", level: "all", name: "Ecology Assessment", type: "Report", description: "Site ecology survey and assessment", templateAvailable: false, templateLink: "" },
            { creditId: "biodiversity", level: "all", name: "Landscape Plan", type: "Drawing", description: "Native planting and habitat feature designs", templateAvailable: false, templateLink: "" },
            // Design for Equity
            { creditId: "design-equity", level: "all", name: "Accessibility Report", type: "Report", description: "DDA compliance and beyond-minimum features", templateAvailable: false, templateLink: "" },
            // Market Transformation
            { creditId: "market-transform", level: "all", name: "Innovation Documentation", type: "Report", description: "Evidence of industry-first achievements or innovations", templateAvailable: false, templateLink: "" },
            { creditId: "market-transform", level: "all", name: "Case Study", type: "Document", description: "Published case study or presentation materials", templateAvailable: false, templateLink: "" },
        ];

        const defaultTemplates = [
            { id: "tpl-office-5", name: "Commercial Office - 5 Star", type: "Office", description: "Standard commercial office targeting 5 Star rating", targetRating: "5 Star", credits: "ind-dev,resp-const,clean-air,light-quality,energy-source,energy-use,upfront-carbon-red,movement,market-transform", active: true },
            { id: "tpl-office-6", name: "Premium Office - 6 Star", type: "Office", description: "Premium office development targeting 6 Star", targetRating: "6 Star", credits: "ind-dev,resp-const,verify-hand,resp-struct,clean-air,light-quality,acoustic,climate-res,energy-source,energy-use,upfront-carbon-red,movement,enjoyable,inclusive-const,impacts-nature,market-transform,leadership-challenge", active: true },
            { id: "tpl-resi-5", name: "Residential - 5 Star", type: "Residential", description: "Multi-residential building targeting 5 Star", targetRating: "5 Star", credits: "resp-const,clean-air,light-quality,amenity,nature-conn,energy-source,energy-use,upfront-carbon-red,water-use,enjoyable,design-equity", active: true },
            { id: "tpl-education-5", name: "Education - 5 Star", type: "Education", description: "School or university building targeting 5 Star", targetRating: "5 Star", credits: "resp-const,clean-air,light-quality,acoustic,amenity,nature-conn,energy-source,energy-use,movement,enjoyable,contribution,design-equity", active: true },
            { id: "tpl-healthcare-5", name: "Healthcare - 5 Star", type: "Healthcare", description: "Hospital or healthcare facility targeting 5 Star", targetRating: "5 Star", credits: "resp-const,verify-hand,clean-air,light-quality,acoustic,toxins,climate-res,ops-res,energy-source,energy-use,water-use,design-equity", active: true },
        ];

        const defaultSynergies = [
            { id: "syn-001", credit1: "energy-source", credit2: "energy-use", type: "Strong", description: "Energy source and energy use are directly related", recommendation: "Pursuing both credits together maximizes energy strategy effectiveness" },
            { id: "syn-002", credit1: "energy-use", credit2: "upfront-carbon-red", type: "Strong", description: "Energy efficiency reduces both operational and embodied carbon", recommendation: "Consider holistic carbon strategy addressing both credits" },
            { id: "syn-003", credit1: "clean-air", credit2: "light-quality", type: "Moderate", description: "Ventilation strategy affects both air quality and lighting comfort", recommendation: "Coordinate HVAC and lighting design" },
            { id: "syn-004", credit1: "resp-struct", credit2: "upfront-carbon-red", type: "Strong", description: "Structural materials have major impact on embodied carbon", recommendation: "Select low-carbon structural systems early in design" },
            { id: "syn-005", credit1: "climate-res", credit2: "heat-res", type: "Strong", description: "Climate and heat resilience share adaptation strategies", recommendation: "Develop integrated climate adaptation plan" },
            { id: "syn-006", credit1: "biodiversity", credit2: "nature-connectivity", type: "Strong", description: "Biodiversity enhancement supports nature connectivity", recommendation: "Plan landscape for both biodiversity and connectivity" },
            { id: "syn-007", credit1: "ind-dev", credit2: "market-transform", type: "Moderate", description: "Industry development contributes to market transformation", recommendation: "Document industry contributions for both credits" },
            { id: "syn-008", credit1: "movement", credit2: "low-emissions", type: "Strong", description: "Sustainable transport and EV charging are complementary", recommendation: "Develop integrated transport strategy" },
        ];

        const defaultCalculators = [
            { id: "responsible-products", name: "Responsible Products Calculator", description: "Calculate responsible products percentage", icon: "fa-boxes-stacked", type: "products", active: true },
            { id: "energy-reference", name: "Energy Use - Reference Pathway", description: "Calculate energy reduction vs reference", icon: "fa-bolt", type: "energy", active: true },
            { id: "upfront-carbon", name: "Upfront Carbon Emissions", description: "Calculate embodied carbon emissions", icon: "fa-cloud", type: "carbon", active: true },
            { id: "carbon-compensation", name: "Upfront Carbon Compensation", description: "Calculate carbon offset requirements", icon: "fa-leaf", type: "carbon", active: true },
            { id: "refrigerant", name: "Refrigerant Systems GWP", description: "Calculate refrigerant GWP impact", icon: "fa-snowflake", type: "energy", active: true },
            { id: "water", name: "Water Use Calculator", description: "Calculate water consumption reduction", icon: "fa-droplet", type: "water", active: true },
            { id: "movement", name: "Movement and Place", description: "Calculate transport impact score", icon: "fa-person-walking", type: "transport", active: true },
            { id: "procurement", name: "Procurement and Workforce", description: "Calculate social procurement spend", icon: "fa-handshake", type: "social", active: true },
            { id: "biodiversity", name: "Biodiversity Enhancement", description: "Calculate biodiversity net gain", icon: "fa-tree", type: "biodiversity", active: true },
        ];

        const defaultCommonMistakes = [
            { id: "cm-001", creditId: "energy-use", mistake: "Not engaging energy modeler early enough", impact: "High", prevention: "Engage NatHERS/Section J assessor at concept design" },
            { id: "cm-002", creditId: "upfront-carbon-red", mistake: "Missing LCA consultant in early design", impact: "High", prevention: "Appoint LCA consultant before schematic design" },
            { id: "cm-003", creditId: "clean-air", mistake: "Inadequate outdoor air rates in mechanical design", impact: "Medium", prevention: "Specify minimum outdoor air rates in brief" },
            { id: "cm-004", creditId: "resp-const", mistake: "Late engagement with contractor on EMP", impact: "Medium", prevention: "Include EMP requirements in tender documents" },
            { id: "cm-005", creditId: "movement", mistake: "Not completing transport assessment early", impact: "High", prevention: "Commission transport assessment at site selection" },
            { id: "cm-006", creditId: "light-quality", mistake: "Insufficient daylight modeling", impact: "Medium", prevention: "Model daylight at concept stage before fixing facades" },
            { id: "cm-007", creditId: "water-use", mistake: "Not considering rainwater harvesting potential", impact: "Medium", prevention: "Assess rainwater potential early in hydraulic design" },
            { id: "cm-008", creditId: "climate-res", mistake: "Incomplete climate risk assessment", impact: "High", prevention: "Commission climate risk study in early design" },
        ];

        // ============================================================
        // COMPONENTS
        // ============================================================

        // Sidebar Navigation
        function Sidebar({ activeTab, setActiveTab, dataStats, onLogout, onStartTour }) {
            const navItems = [
                { id: 'dashboard', icon: 'fa-chart-pie', label: 'Dashboard' },
                { id: 'categories', icon: 'fa-folder', label: 'Categories', count: dataStats.categories },
                { id: 'credits', icon: 'fa-star', label: 'Credits', count: dataStats.credits },
                { id: 'levels', icon: 'fa-layer-group', label: 'Levels', count: dataStats.levels },
                { id: 'criteria', icon: 'fa-list-check', label: 'Criteria', count: dataStats.criteria },
                { id: 'documentation', icon: 'fa-file-lines', label: 'Documentation', count: dataStats.documentation },
                { id: 'templates', icon: 'fa-copy', label: 'Templates', count: dataStats.templates },
                { id: 'synergies', icon: 'fa-link', label: 'Synergies', count: dataStats.synergies },
                { id: 'calculators', icon: 'fa-calculator', label: 'Calculators', count: dataStats.calculators },
                { id: 'mistakes', icon: 'fa-triangle-exclamation', label: 'Common Mistakes', count: dataStats.mistakes },
            ];

            return (
                <aside className="w-64 bg-white border-r border-line min-h-screen flex flex-col">
                    {/* GBCA Branded Header */}
                    <div className="bg-white border-b border-line p-4">
                        <div className="flex flex-col gap-2">
                            <img
                                src="green star logo full.png"
                                alt="Green Star"
                                className="h-7 object-contain object-left"
                            />
                            <p className="text-xs text-ink-3 font-medium">Admin Panel</p>
                        </div>
                    </div>

                    {/* Navigation */}
                    <nav className="flex-1 p-4">
                        <ul className="space-y-1">
                            {navItems.map(item => (
                                <li key={item.id}>
                                    <button
                                        onClick={() => setActiveTab(item.id)}
                                        className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors
                                            ${activeTab === item.id
                                                ? 'bg-surface-2 text-[#2D5A47] border-l-4 border-[#2D5A47]'
                                                : 'text-ink-2 hover:bg-surface-1 hover:text-ink'
                                            }`}
                                    >
                                        <i className={`fa-solid ${item.icon} w-5`}></i>
                                        <span className="flex-1 text-left">{item.label}</span>
                                        {item.count !== undefined && (
                                            <span className={`px-2 py-0.5 rounded-full text-xs ${
                                                activeTab === item.id ? 'bg-green-200 text-green-800' : 'bg-surface-2 text-ink-2'
                                            }`}>
                                                {item.count}
                                            </span>
                                        )}
                                    </button>
                                </li>
                            ))}
                        </ul>
                    </nav>

                    {/* Footer */}
                    <div className="p-4 border-t border-line space-y-2">
                        <button
                            onClick={onStartTour}
                            className="w-full flex items-center gap-2 px-4 py-3 rounded-lg text-sm font-medium text-ink-2 hover:bg-surface-1 hover:text-ink transition-all"
                        >
                            <i className="fa-solid fa-circle-question w-5"></i>
                            Take a Tour
                        </button>
                        <a
                            href="index.html"
                            className="flex items-center gap-2 px-4 py-3 rounded-lg text-sm font-medium text-ink-2 hover:bg-surface-1 hover:text-ink transition-all"
                        >
                            <i className="fa-solid fa-arrow-left w-5"></i>
                            Back to App
                        </a>
                        <button
                            onClick={onLogout}
                            className="w-full flex items-center gap-2 px-4 py-3 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50 transition-all"
                        >
                            <i className="fa-solid fa-right-from-bracket w-5"></i>
                            Sign Out
                        </button>
                    </div>
                </aside>
            );
        }

        // Header with actions
        function Header({ title, subtitle, onImport, onExport, onSave, onUndo, onRedo, canUndo, canRedo }) {
            return (
                <header className="bg-white border-b border-line px-8 py-6">
                    <div className="flex items-center justify-between">
                        <div>
                            <h1 className="font-display text-2xl font-bold text-ink">{title}</h1>
                            {subtitle && <p className="text-ink-3 mt-1">{subtitle}</p>}
                        </div>
                        <div className="flex items-center gap-3">
                            {/* Undo/Redo buttons */}
                            <div className="flex items-center gap-1 mr-2 border-r border-line pr-4">
                                <button
                                    onClick={onUndo}
                                    disabled={!canUndo}
                                    className={`p-2 rounded-lg transition-all flex items-center gap-1 ${canUndo ? 'text-ink-2 hover:bg-surface-2' : 'text-green-300 cursor-not-allowed'}`}
                                    title="Undo (Ctrl+Z)"
                                >
                                    <i className="fa-solid fa-undo"></i>
                                </button>
                                <button
                                    onClick={onRedo}
                                    disabled={!canRedo}
                                    className={`p-2 rounded-lg transition-all flex items-center gap-1 ${canRedo ? 'text-ink-2 hover:bg-surface-2' : 'text-green-300 cursor-not-allowed'}`}
                                    title="Redo (Ctrl+Y)"
                                >
                                    <i className="fa-solid fa-redo"></i>
                                </button>
                            </div>
                            <button
                                onClick={onImport}
                                className="px-4 py-2 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:bg-surface-1 transition-all flex items-center gap-2"
                            >
                                <i className="fa-solid fa-upload"></i>
                                Import Excel
                            </button>
                            <button
                                onClick={onExport}
                                className="px-4 py-2 bg-white border border-line rounded-lg text-sm font-medium text-ink-2 hover:bg-surface-1 transition-all flex items-center gap-2"
                            >
                                <i className="fa-solid fa-download"></i>
                                Export Excel
                            </button>
                            <button
                                onClick={onSave}
                                className="px-4 py-2 bg-[#2D5A47] rounded-lg text-sm font-medium text-white hover:bg-[#234538] transition-all flex items-center gap-2"
                            >
                                <i className="fa-solid fa-save"></i>
                                Save Changes
                            </button>
                        </div>
                    </div>
                </header>
            );
        }

        // Dashboard
        function Dashboard({ stats, onNavigate }) {
            const cards = [
                { id: 'categories', label: 'Categories', count: stats.categories, icon: 'fa-folder', color: 'blue', description: 'Main category groups' },
                { id: 'credits', label: 'Credits', count: stats.credits, icon: 'fa-star', color: 'green', description: 'Individual credits' },
                { id: 'levels', label: 'Performance Levels', count: stats.levels, icon: 'fa-layer-group', color: 'purple', description: 'Minimum/Credit/Exceptional' },
                { id: 'criteria', label: 'Criteria', count: stats.criteria, icon: 'fa-list-check', color: 'amber', description: 'Requirements per level' },
                { id: 'documentation', label: 'Documentation', count: stats.documentation, icon: 'fa-file-lines', color: 'cyan', description: 'Required documents' },
                { id: 'templates', label: 'Templates', count: stats.templates, icon: 'fa-copy', color: 'pink', description: 'Project templates' },
                { id: 'synergies', label: 'Synergies', count: stats.synergies, icon: 'fa-link', color: 'teal', description: 'Credit relationships' },
            ];

            const colorClasses = {
                blue: 'bg-blue-50 text-blue-600 border-blue-200',
                green: 'bg-green-50 text-[#2D5A47] border-green-200',
                purple: 'bg-purple-50 text-purple-600 border-purple-200',
                amber: 'bg-amber-50 text-amber-600 border-amber-200',
                cyan: 'bg-cyan-50 text-cyan-600 border-cyan-200',
                pink: 'bg-pink-50 text-pink-600 border-pink-200',
                teal: 'bg-teal-50 text-teal-600 border-teal-200',
            };

            return (
                <div className="p-8">
                    <div className="mb-8">
                        <h2 className="font-display text-xl font-bold text-ink mb-2">Welcome to the Admin Panel</h2>
                        <p className="text-ink-3">Manage all Green Star credit data from one place. Click on any card to edit that section.</p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        {cards.map(card => (
                            <button
                                key={card.id}
                                onClick={() => onNavigate(card.id)}
                                className={`p-6 rounded-lg border ${colorClasses[card.color]} hover:border-line transition-colors text-left group`}
                            >
                                <div className="flex items-start justify-between mb-4">
                                    <i className={`fa-solid ${card.icon} text-2xl`}></i>
                                    <span className="text-3xl font-bold">{card.count}</span>
                                </div>
                                <h3 className="font-semibold text-ink mb-1">{card.label}</h3>
                                <p className="text-sm text-ink-3">{card.description}</p>
                                <div className="mt-4 flex items-center text-sm font-medium group-hover:translate-x-1 transition-transform">
                                    Edit <i className="fa-solid fa-arrow-right ml-2"></i>
                                </div>
                            </button>
                        ))}
                    </div>

                    {/* Quick Tips */}
                    <div className="mt-8 p-6 bg-surface-1 rounded-lg border border-line">
                        <h3 className="font-semibold text-[#2D5A47] mb-3 flex items-center gap-2">
                            <i className="fa-solid fa-lightbulb"></i>
                            Quick Tips
                        </h3>
                        <ul className="text-sm text-ink-2 space-y-2">
                            <li><i className="fa-solid fa-check mr-2 text-[#2D5A47]"></i>Changes are saved to your browser's local storage automatically</li>
                            <li><i className="fa-solid fa-check mr-2 text-[#2D5A47]"></i>Use "Export Excel" to download a spreadsheet backup</li>
                            <li><i className="fa-solid fa-check mr-2 text-[#2D5A47]"></i>Use "Save Changes" to push updates to the main app</li>
                            <li><i className="fa-solid fa-check mr-2 text-[#2D5A47]"></i>Credit IDs link data across tables - don't change existing IDs</li>
                        </ul>
                    </div>
                </div>
            );
        }

        // Generic Table Editor with Search and Bulk Edit
        function TableEditor({ data, columns, onUpdate, onAdd, onDelete, emptyRow }) {
            const [editingId, setEditingId] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedRows, setSelectedRows] = useState(new Set());
            const [showBulkEdit, setShowBulkEdit] = useState(false);
            const [bulkEditField, setBulkEditField] = useState('');
            const [bulkEditValue, setBulkEditValue] = useState('');

            // Filter data based on search query
            const filteredData = data.filter(row => {
                if (!searchQuery.trim()) return true;
                const query = searchQuery.toLowerCase();
                return columns.some(col => {
                    const value = row[col.key];
                    if (value === null || value === undefined) return false;
                    return String(value).toLowerCase().includes(query);
                });
            });

            // Get original indices for filtered data
            const filteredIndices = data.map((row, i) => ({ row, index: i }))
                .filter(({ row }) => {
                    if (!searchQuery.trim()) return true;
                    const query = searchQuery.toLowerCase();
                    return columns.some(col => {
                        const value = row[col.key];
                        if (value === null || value === undefined) return false;
                        return String(value).toLowerCase().includes(query);
                    });
                })
                .map(({ index }) => index);

            const handleChange = (index, field, value) => {
                const newData = [...data];
                newData[index] = { ...newData[index], [field]: value };
                onUpdate(newData);
            };

            const handleAdd = () => {
                onUpdate([...data, { ...emptyRow, _id: Date.now() }]);
            };

            const handleDelete = (index) => {
                if (confirm('Are you sure you want to delete this row?')) {
                    const newData = data.filter((_, i) => i !== index);
                    onUpdate(newData);
                }
            };

            const toggleRowSelection = (index) => {
                const newSelected = new Set(selectedRows);
                if (newSelected.has(index)) {
                    newSelected.delete(index);
                } else {
                    newSelected.add(index);
                }
                setSelectedRows(newSelected);
            };

            const selectAll = () => {
                if (selectedRows.size === filteredIndices.length) {
                    setSelectedRows(new Set());
                } else {
                    setSelectedRows(new Set(filteredIndices));
                }
            };

            const handleBulkEdit = () => {
                if (!bulkEditField || selectedRows.size === 0) return;
                const newData = [...data];
                selectedRows.forEach(index => {
                    const col = columns.find(c => c.key === bulkEditField);
                    let value = bulkEditValue;
                    if (col?.type === 'checkbox') {
                        value = bulkEditValue === 'true';
                    } else if (col?.type === 'number') {
                        value = parseInt(bulkEditValue) || 0;
                    }
                    newData[index] = { ...newData[index], [bulkEditField]: value };
                });
                onUpdate(newData);
                setShowBulkEdit(false);
                setBulkEditField('');
                setBulkEditValue('');
                setSelectedRows(new Set());
            };

            const handleBulkDelete = () => {
                if (selectedRows.size === 0) return;
                if (confirm(`Are you sure you want to delete ${selectedRows.size} rows?`)) {
                    const newData = data.filter((_, i) => !selectedRows.has(i));
                    onUpdate(newData);
                    setSelectedRows(new Set());
                }
            };

            return (
                <div className="bg-white rounded-xl border border-line overflow-hidden">
                    {/* Search and Bulk Actions Bar */}
                    <div className="p-4 border-b border-line bg-surface-1 flex flex-wrap items-center gap-3">
                        <div className="flex-1 min-w-[200px]">
                            <div className="relative">
                                <i className="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-ink-3"></i>
                                <input
                                    type="text"
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    placeholder="Search in table..."
                                    className="w-full pl-10 pr-4 py-2 border border-line rounded-lg text-sm focus:ring-2 focus:ring-[#2D5A47]/20 focus:border-[#2D5A47]"
                                />
                                {searchQuery && (
                                    <button
                                        onClick={() => setSearchQuery('')}
                                        className="absolute right-3 top-1/2 -translate-y-1/2 text-ink-3 hover:text-ink-2"
                                    >
                                        <i className="fa-solid fa-times"></i>
                                    </button>
                                )}
                            </div>
                        </div>
                        <div className="text-sm text-ink-3">
                            {searchQuery ? `${filteredData.length} of ${data.length} rows` : `${data.length} rows`}
                        </div>
                        {selectedRows.size > 0 && (
                            <div className="flex items-center gap-2">
                                <span className="text-sm text-[#2D5A47] font-medium">{selectedRows.size} selected</span>
                                <button
                                    onClick={() => setShowBulkEdit(!showBulkEdit)}
                                    className="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200 transition-colors"
                                >
                                    <i className="fa-solid fa-edit mr-1"></i> Bulk Edit
                                </button>
                                <button
                                    onClick={handleBulkDelete}
                                    className="px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-sm font-medium hover:bg-red-200 transition-colors"
                                >
                                    <i className="fa-solid fa-trash mr-1"></i> Delete
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Bulk Edit Panel */}
                    {showBulkEdit && selectedRows.size > 0 && (
                        <div className="p-4 border-b border-line bg-blue-50 flex items-center gap-3">
                            <span className="text-sm font-medium text-ink-2">Bulk edit {selectedRows.size} rows:</span>
                            <select
                                value={bulkEditField}
                                onChange={(e) => setBulkEditField(e.target.value)}
                                className="px-3 py-1.5 border border-line rounded-lg text-sm"
                            >
                                <option value="">Select field...</option>
                                {columns.filter(c => c.type !== 'textarea').map(col => (
                                    <option key={col.key} value={col.key}>{col.label}</option>
                                ))}
                            </select>
                            {bulkEditField && (
                                <input
                                    type="text"
                                    value={bulkEditValue}
                                    onChange={(e) => setBulkEditValue(e.target.value)}
                                    className="px-3 py-1.5 border border-line rounded-lg text-sm"
                                    placeholder="New value"
                                />
                            )}
                            <button
                                onClick={handleBulkEdit}
                                disabled={!bulkEditField || !bulkEditValue}
                                className="px-4 py-1.5 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                Apply
                            </button>
                            <button
                                onClick={() => { setShowBulkEdit(false); setBulkEditField(''); setBulkEditValue(''); }}
                                className="px-3 py-1.5 text-ink-2 hover:text-ink"
                            >
                                Cancel
                            </button>
                        </div>
                    )}

                    <div className="overflow-x-auto max-h-[calc(100vh-380px)] overflow-y-auto">
                        <table className="data-table">
                            <thead>
                                <tr>
                                    <th style={{ width: '40px' }}>
                                        <input
                                            type="checkbox"
                                            checked={selectedRows.size === filteredIndices.length && filteredIndices.length > 0}
                                            onChange={selectAll}
                                            className="w-4 h-4 rounded border-line text-[#2D5A47] focus:ring-[#2D5A47]/20"
                                        />
                                    </th>
                                    {columns.map(col => (
                                        <th key={col.key} style={{ width: col.width }}>{col.label}</th>
                                    ))}
                                    <th style={{ width: '80px' }}>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredIndices.map((originalIndex) => {
                                    const row = data[originalIndex];

                                    return (
                                        <tr
                                            key={row._id || row.id || originalIndex}
                                            className={`animate-fade-in ${selectedRows.has(originalIndex) ? 'bg-green-50' : ''}`}
                                        >
                                            <td>
                                                <input
                                                    type="checkbox"
                                                    checked={selectedRows.has(originalIndex)}
                                                    onChange={() => toggleRowSelection(originalIndex)}
                                                    className="w-4 h-4 rounded border-line text-[#2D5A47] focus:ring-[#2D5A47]/20"
                                                />
                                            </td>

                                            {columns.map((col) => (
                                                <td key={col.key}>
                                                    {col.type === 'select' ? (
                                                        <select
                                                            value={row[col.key] || ''}
                                                            onChange={(e) => handleChange(originalIndex, col.key, e.target.value)}
                                                        >
                                                            <option value="">Select...</option>
                                                            {col.options.map((opt) => (
                                                                <option key={opt.value || opt} value={opt.value || opt}>
                                                                    {opt.label || opt}
                                                                </option>
                                                            ))}
                                                        </select>
                                                    ) : col.type === 'checkbox' ? (
                                                        <input
                                                            type="checkbox"
                                                            checked={row[col.key] || false}
                                                            onChange={(e) => handleChange(originalIndex, col.key, e.target.checked)}
                                                            className="w-5 h-5 rounded border-line text-[#2D5A47] focus:ring-[#2D5A47]/20"
                                                        />
                                                    ) : col.type === 'textarea' ? (
                                                        <textarea
                                                            value={row[col.key] || ''}
                                                            onChange={(e) => handleChange(originalIndex, col.key, e.target.value)}
                                                            rows={2}
                                                        />
                                                    ) : col.type === 'number' ? (
                                                        <input
                                                            type="number"
                                                            value={row[col.key] || ''}
                                                            onChange={(e) => handleChange(originalIndex, col.key, parseInt(e.target.value) || 0)}
                                                            min={col.min || 0}
                                                            max={col.max}
                                                        />
                                                    ) : (
                                                        <input
                                                            type="text"
                                                            value={row[col.key] || ''}
                                                            onChange={(e) => handleChange(originalIndex, col.key, e.target.value)}
                                                            placeholder={col.placeholder}
                                                        />
                                                    )}
                                                </td>
                                            ))}

                                            <td>
                                                <button
                                                    onClick={() => handleDelete(originalIndex)}
                                                    className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                                                    title="Delete row"
                                                >
                                                    <i className="fa-solid fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                    <div className="p-4 border-t border-line bg-surface-1">
                        <button
                            onClick={handleAdd}
                            className="px-4 py-2 bg-[#2D5A47] text-white rounded-lg text-sm font-medium hover:bg-[#234538] transition-all flex items-center gap-2"
                        >
                            <i className="fa-solid fa-plus"></i>
                            Add New Row
                        </button>
                    </div>
                </div>
            );
        }

        // Categories Editor
        function CategoriesEditor({ data, onUpdate }) {
            const columns = [
                { key: 'id', label: 'ID', width: '120px', placeholder: 'e.g., responsible' },
                { key: 'name', label: 'Name', width: '150px', placeholder: 'e.g., Responsible' },
                { key: 'description', label: 'Description', type: 'textarea', width: '300px' },
                { key: 'icon', label: 'Icon', width: '150px', placeholder: 'fa-shield-halved' },
                { key: 'color', label: 'Color', type: 'select', width: '120px', options: ['amber', 'green', 'blue', 'red', 'purple', 'pink', 'emerald', 'indigo', 'cyan', 'teal'] },
                { key: 'order', label: 'Order', type: 'number', width: '80px', min: 1 },
            ];

            const emptyRow = { id: '', name: '', description: '', icon: 'fa-folder', color: 'gray', order: data.length + 1 };

            return (
                <div className="p-8">
                    <div className="mb-6">
                        <h2 className="font-display text-xl font-bold text-ink mb-2">Categories</h2>
                        <p className="text-ink-3">Manage the 8 main category groups. Icon names are from Font Awesome (fa-xxx).</p>
                    </div>
                    <TableEditor data={data} columns={columns} onUpdate={onUpdate} emptyRow={emptyRow} />
                </div>
            );
        }

        // Credits Editor
        function CreditsEditor({ data, onUpdate, categories }) {
            const categoryOptions = categories.map(c => ({ value: c.id, label: c.name }));
            const difficultyOptions = ['Easy', 'Medium', 'Hard'];
            const phaseOptions = ['Concept', 'Schematic', 'Design Dev', 'Documentation', 'Construction', 'Handover'];

            const columns = [
                { key: 'id', label: 'Credit ID', width: '100px', placeholder: 'e.g., resp-01' },
                { key: 'name', label: 'Credit Name', width: '180px' },
                { key: 'category', label: 'Category', type: 'select', width: '120px', options: categoryOptions },
                { key: 'shortDescription', label: 'Short Desc', width: '180px' },
                { key: 'description', label: 'Full Description', type: 'textarea', width: '250px' },
                { key: 'aims', label: 'Credit Aims', type: 'textarea', width: '200px' },
                { key: 'tips', label: 'Tips', type: 'textarea', width: '200px' },
                { key: 'required', label: 'Required?', type: 'checkbox', width: '70px' },
                { key: 'maxPoints', label: 'Max Pts', type: 'number', width: '70px', min: 0, max: 10 },
                { key: 'difficulty', label: 'Difficulty', type: 'select', width: '100px', options: difficultyOptions },
                { key: 'projectPhases', label: 'Project Phases', width: '180px', placeholder: 'Concept, Design Dev' },
                { key: 'order', label: 'Order', type: 'number', width: '60px', min: 1 },
            ];

            const emptyRow = { id: '', name: '', category: '', shortDescription: '', description: '', aims: '', tips: '', required: false, maxPoints: 2, difficulty: 'Medium', projectPhases: '', order: 1 };

            return (
                <div className="p-8">
                    <div className="mb-6">
                        <h2 className="font-display text-xl font-bold text-ink mb-2">Credits</h2>
                        <p className="text-ink-3">Manage individual credits. Set difficulty to "Easy" for Quick Wins. Project phases are comma-separated.</p>
                    </div>
                    <TableEditor data={data} columns={columns} onUpdate={onUpdate} emptyRow={emptyRow} />
                </div>
            );
        }

        // Levels Editor
        function LevelsEditor({ data, onUpdate, credits }) {
            const creditOptions = credits.map(c => ({ value: c.id, label: `${c.id} - ${c.name}` }));
            const levelOptions = [
                { value: 'minimum', label: 'Minimum Expectation' },
                { value: 'credit', label: 'Credit Achievement' },
                { value: 'exceptional', label: 'Exceptional Performance' },
            ];

            const columns = [
                { key: 'creditId', label: 'Credit ID', type: 'select', width: '200px', options: creditOptions },
                { key: 'level', label: 'Level', type: 'select', width: '180px', options: levelOptions },
                { key: 'points', label: 'Points', type: 'number', width: '80px', min: 0, max: 10 },
                { key: 'summary', label: 'Summary', width: '200px' },
                { key: 'description', label: 'Description', type: 'textarea', width: '300px' },
            ];

            const emptyRow = { creditId: '', level: 'minimum', points: 0, summary: '', description: '' };

            return (
                <div className="p-8">
                    <div className="mb-6">
                        <h2 className="font-display text-xl font-bold text-ink mb-2">Performance Levels</h2>
                        <p className="text-ink-3">Define Minimum, Credit, and Exceptional levels for each credit.</p>
                    </div>
                    <TableEditor data={data} columns={columns} onUpdate={onUpdate} emptyRow={emptyRow} />
                </div>
            );
        }

        // Criteria Editor
        function CriteriaEditor({ data, onUpdate, credits }) {
            const creditOptions = credits.map(c => ({ value: c.id, label: `${c.id} - ${c.name}` }));
            const levelOptions = [
                { value: 'minimum', label: 'Minimum Expectation' },
                { value: 'credit', label: 'Credit Achievement' },
                { value: 'exceptional', label: 'Exceptional Performance' },
            ];
            const evidenceOptions = ['Document', 'Calculation', 'Drawing', 'Report', 'Certificate', 'Photo', 'Declaration', 'Other'];

            const columns = [
                { key: 'creditId', label: 'Credit ID', type: 'select', width: '180px', options: creditOptions },
                { key: 'level', label: 'Level', type: 'select', width: '160px', options: levelOptions },
                { key: 'criteriaNum', label: '#', type: 'number', width: '60px', min: 1 },
                { key: 'text', label: 'Criteria Text', type: 'textarea', width: '350px' },
                { key: 'mandatory', label: 'Mandatory?', type: 'checkbox', width: '90px' },
                { key: 'evidenceType', label: 'Evidence', type: 'select', width: '120px', options: evidenceOptions },
            ];

            const emptyRow = { creditId: '', level: 'minimum', criteriaNum: 1, text: '', mandatory: true, evidenceType: 'Document' };

            return (
                <div className="p-8">
                    <div className="mb-6">
                        <h2 className="font-display text-xl font-bold text-ink mb-2">Criteria</h2>
                        <p className="text-ink-3">Define requirements for each performance level. These appear in the Criteria tab.</p>
                    </div>
                    <TableEditor data={data} columns={columns} onUpdate={onUpdate} emptyRow={emptyRow} />
                </div>
            );
        }

        // Documentation Editor
        function DocumentationEditor({ data, onUpdate, credits }) {
            const creditOptions = credits.map(c => ({ value: c.id, label: `${c.id} - ${c.name}` }));
            const levelOptions = [
                { value: 'all', label: 'All Levels' },
                { value: 'minimum', label: 'Minimum Expectation' },
                { value: 'credit', label: 'Credit Achievement' },
                { value: 'exceptional', label: 'Exceptional Performance' },
            ];
            const docTypeOptions = ['Report', 'Calculation', 'Drawing', 'Certificate', 'Declaration', 'Photo Evidence', 'Specification', 'Contract', 'Other'];

            const columns = [
                { key: 'creditId', label: 'Credit ID', type: 'select', width: '180px', options: creditOptions },
                { key: 'level', label: 'Level', type: 'select', width: '150px', options: levelOptions },
                { key: 'name', label: 'Document Name', width: '200px' },
                { key: 'type', label: 'Type', type: 'select', width: '130px', options: docTypeOptions },
                { key: 'description', label: 'Description', type: 'textarea', width: '250px' },
                { key: 'templateAvailable', label: 'Template?', type: 'checkbox', width: '80px' },
                { key: 'templateLink', label: 'Template Link', width: '200px' },
            ];

            const emptyRow = { creditId: '', level: 'all', name: '', type: 'Document', description: '', templateAvailable: false, templateLink: '' };

            return (
                <div className="p-8">
                    <div className="mb-6">
                        <h2 className="font-display text-xl font-bold text-ink mb-2">Documentation</h2>
                        <p className="text-ink-3">Define required documents for each credit. Optionally provide template links.</p>
                    </div>
                    <TableEditor data={data} columns={columns} onUpdate={onUpdate} emptyRow={emptyRow} />
                </div>
            );
        }

        // Templates Editor
        function TemplatesEditor({ data, onUpdate }) {
            const typeOptions = ['Office', 'Residential', 'Retail', 'Education', 'Healthcare', 'Industrial', 'Mixed Use', 'Other'];
            const ratingOptions = ['4 Star', '5 Star', '6 Star'];

            const columns = [
                { key: 'id', label: 'Template ID', width: '130px', placeholder: 'tpl-xxx' },
                { key: 'name', label: 'Template Name', width: '200px' },
                { key: 'type', label: 'Building Type', type: 'select', width: '130px', options: typeOptions },
                { key: 'description', label: 'Description', type: 'textarea', width: '250px' },
                { key: 'targetRating', label: 'Target', type: 'select', width: '100px', options: ratingOptions },
                { key: 'credits', label: 'Credits (comma-separated)', type: 'textarea', width: '250px' },
                { key: 'active', label: 'Active?', type: 'checkbox', width: '70px' },
            ];

            const emptyRow = { id: '', name: '', type: 'Office', description: '', targetRating: '5 Star', credits: '', active: true };

            return (
                <div className="p-8">
                    <div className="mb-6">
                        <h2 className="font-display text-xl font-bold text-ink mb-2">Project Templates</h2>
                        <p className="text-ink-3">Pre-configured credit selections for different building types. List credit IDs separated by commas.</p>
                    </div>
                    <TableEditor data={data} columns={columns} onUpdate={onUpdate} emptyRow={emptyRow} />
                </div>
            );
        }

        // Synergies Editor
        function SynergiesEditor({ data, onUpdate, credits }) {
            const creditOptions = credits.map(c => ({ value: c.id, label: `${c.id} - ${c.name}` }));
            const typeOptions = ['Strong', 'Moderate', 'Documentation'];

            const columns = [
                { key: 'id', label: 'Synergy ID', width: '120px', placeholder: 'syn-xxx' },
                { key: 'credit1', label: 'Credit 1', type: 'select', width: '180px', options: creditOptions },
                { key: 'credit2', label: 'Credit 2', type: 'select', width: '180px', options: creditOptions },
                { key: 'type', label: 'Type', type: 'select', width: '120px', options: typeOptions },
                { key: 'description', label: 'Description', type: 'textarea', width: '250px' },
                { key: 'recommendation', label: 'Recommendation', type: 'textarea', width: '250px' },
            ];

            const emptyRow = { id: '', credit1: '', credit2: '', type: 'Moderate', description: '', recommendation: '' };

            return (
                <div className="p-8">
                    <div className="mb-6">
                        <h2 className="font-display text-xl font-bold text-ink mb-2">Credit Synergies</h2>
                        <p className="text-ink-3">Define relationships between credits. Strong synergies are highlighted in the app.</p>
                    </div>
                    <TableEditor data={data} columns={columns} onUpdate={onUpdate} emptyRow={emptyRow} />
                </div>
            );
        }

        // Calculators Editor
        function CalculatorsEditor({ data, onUpdate }) {
            const typeOptions = ['products', 'energy', 'carbon', 'water', 'transport', 'social', 'biodiversity', 'other'];

            const columns = [
                { key: 'id', label: 'Calculator ID', width: '150px', placeholder: 'calculator-id' },
                { key: 'name', label: 'Calculator Name', width: '200px' },
                { key: 'description', label: 'Description', type: 'textarea', width: '250px' },
                { key: 'icon', label: 'Icon (FA)', width: '130px', placeholder: 'fa-calculator' },
                { key: 'type', label: 'Type', type: 'select', width: '120px', options: typeOptions },
                { key: 'active', label: 'Active?', type: 'checkbox', width: '70px' },
            ];

            const emptyRow = { id: '', name: '', description: '', icon: 'fa-calculator', type: 'other', active: true };

            return (
                <div className="p-8">
                    <div className="mb-6">
                        <h2 className="font-display text-xl font-bold text-ink mb-2">Calculators</h2>
                        <p className="text-ink-3">Manage the calculators available in the main app. Use FontAwesome icon class names.</p>
                    </div>
                    <TableEditor data={data} columns={columns} onUpdate={onUpdate} emptyRow={emptyRow} />
                </div>
            );
        }

        // Common Mistakes Editor
        function CommonMistakesEditor({ data, onUpdate, credits }) {
            const creditOptions = credits.map(c => ({ value: c.id, label: `${c.id} - ${c.name}` }));
            const impactOptions = ['High', 'Medium', 'Low'];

            const columns = [
                { key: 'id', label: 'ID', width: '100px', placeholder: 'cm-xxx' },
                { key: 'creditId', label: 'Credit', type: 'select', width: '180px', options: creditOptions },
                { key: 'mistake', label: 'Common Mistake', type: 'textarea', width: '250px' },
                { key: 'impact', label: 'Impact', type: 'select', width: '100px', options: impactOptions },
                { key: 'prevention', label: 'Prevention Tip', type: 'textarea', width: '250px' },
            ];

            const emptyRow = { id: '', creditId: '', mistake: '', impact: 'Medium', prevention: '' };

            return (
                <div className="p-8">
                    <div className="mb-6">
                        <h2 className="font-display text-xl font-bold text-ink mb-2">Common Mistakes</h2>
                        <p className="text-ink-3">Define common mistakes for each credit to help users avoid pitfalls during submission.</p>
                    </div>
                    <TableEditor data={data} columns={columns} onUpdate={onUpdate} emptyRow={emptyRow} />
                </div>
            );
        }

        // Import Modal
        function ImportModal({ isOpen, onClose, onImport }) {
            const [status, setStatus] = useState(null);
            const fileInputRef = React.useRef(null);

            if (!isOpen) return null;

            const handleFileUpload = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                setStatus({ type: 'info', message: 'Reading file...' });

                try {
                    const data = await file.arrayBuffer();
                    const workbook = XLSX.read(data, { type: 'array' });

                    const imported = {};

                    // Parse Categories
                    if (workbook.SheetNames.includes('Categories')) {
                        imported.categories = XLSX.utils.sheet_to_json(workbook.Sheets['Categories']).map(row => ({
                            id: row['Category ID'],
                            name: row['Category Name'],
                            description: row['Description'],
                            icon: row['Icon (FontAwesome)'],
                            color: row['Color Theme'],
                            order: row['Display Order'],
                        }));
                    }

                    // Parse Credits
                    if (workbook.SheetNames.includes('Credits')) {
                        imported.credits = XLSX.utils.sheet_to_json(workbook.Sheets['Credits']).map(row => ({
                            id: row['Credit ID'],
                            name: row['Credit Name'],
                            category: row['Category']?.toLowerCase(),
                            shortDescription: row['Short Description'],
                            description: row['Full Description'],
                            aims: row['Credit Aims'] || '',
                            tips: row['Tips'] || '',
                            required: row['Is Required?'] === 'Yes',
                            maxPoints: row['Max Points'],
                            difficulty: row['Difficulty (Easy/Medium/Hard)'] || 'Medium',
                            projectPhases: row['Project Phases'] || '',
                            order: row['Display Order'],
                        }));
                    }

                    // Parse Levels
                    if (workbook.SheetNames.includes('Levels')) {
                        imported.levels = XLSX.utils.sheet_to_json(workbook.Sheets['Levels']).map(row => ({
                            creditId: row['Credit ID'],
                            level: row['Level Type'] === 'Minimum Expectation' ? 'minimum' :
                                   row['Level Type'] === 'Credit Achievement' ? 'credit' : 'exceptional',
                            points: row['Points'],
                            summary: row['Summary'],
                            description: row['Description'],
                        }));
                    }

                    // Parse Criteria
                    if (workbook.SheetNames.includes('Criteria')) {
                        imported.criteria = XLSX.utils.sheet_to_json(workbook.Sheets['Criteria']).map(row => ({
                            creditId: row['Credit ID'],
                            level: row['Level Type'] === 'Minimum Expectation' ? 'minimum' :
                                   row['Level Type'] === 'Credit Achievement' ? 'credit' : 'exceptional',
                            criteriaNum: row['Criteria #'],
                            text: row['Criteria Text'],
                            mandatory: row['Is Mandatory?'] === 'Yes',
                            evidenceType: row['Evidence Type'],
                        }));
                    }

                    // Parse Documentation
                    if (workbook.SheetNames.includes('Documentation')) {
                        imported.documentation = XLSX.utils.sheet_to_json(workbook.Sheets['Documentation']).map(row => ({
                            creditId: row['Credit ID'],
                            level: row['Level Type'] === 'All Levels' ? 'all' :
                                   row['Level Type'] === 'Minimum Expectation' ? 'minimum' :
                                   row['Level Type'] === 'Credit Achievement' ? 'credit' : 'exceptional',
                            name: row['Document Name'],
                            type: row['Document Type'],
                            description: row['Description'],
                            templateAvailable: row['Template Available?'] === 'Yes',
                            templateLink: row['Template Link'],
                        }));
                    }

                    // Parse Templates
                    if (workbook.SheetNames.includes('Templates')) {
                        imported.templates = XLSX.utils.sheet_to_json(workbook.Sheets['Templates']).map(row => ({
                            id: row['Template ID'],
                            name: row['Template Name'],
                            type: row['Building Type'],
                            description: row['Description'],
                            targetRating: row['Target Star Rating'],
                            credits: row['Recommended Credits (comma-separated)'],
                            active: row['Is Active?'] === 'Yes',
                        }));
                    }

                    // Parse Synergies
                    if (workbook.SheetNames.includes('Synergies')) {
                        imported.synergies = XLSX.utils.sheet_to_json(workbook.Sheets['Synergies']).map(row => ({
                            id: row['Synergy ID'],
                            credit1: row['Credit 1'],
                            credit2: row['Credit 2'],
                            type: row['Synergy Type'],
                            description: row['Description'],
                            recommendation: row['Recommendation'],
                        }));
                    }

                    // Parse Calculators
                    if (workbook.SheetNames.includes('Calculators')) {
                        imported.calculators = XLSX.utils.sheet_to_json(workbook.Sheets['Calculators']).map(row => ({
                            id: row['Calculator ID'],
                            name: row['Calculator Name'],
                            description: row['Description'],
                            icon: row['Icon (FontAwesome)'],
                            type: row['Type'],
                            active: row['Is Active?'] === 'Yes',
                        }));
                    }

                    // Parse Common Mistakes
                    if (workbook.SheetNames.includes('CommonMistakes')) {
                        imported.commonMistakes = XLSX.utils.sheet_to_json(workbook.Sheets['CommonMistakes']).map(row => ({
                            id: row['Mistake ID'],
                            creditId: row['Credit ID'],
                            mistake: row['Common Mistake'],
                            impact: row['Impact Level'],
                            prevention: row['Prevention Tip'],
                        }));
                    }

                    onImport(imported);
                    setStatus({ type: 'success', message: 'Import successful!' });
                    setTimeout(() => onClose(), 1000);
                } catch (error) {
                    setStatus({ type: 'error', message: `Error: ${error.message}` });
                }
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50" onClick={onClose}>
                    <div className="bg-white rounded-2xl p-6 max-w-md w-full" onClick={e => e.stopPropagation()}>
                        <h2 className="font-display text-xl font-bold text-ink mb-4">Import from Excel</h2>
                        <p className="text-ink-2 mb-6">Upload an Excel file to import data. This will replace existing data.</p>

                        <input
                            ref={fileInputRef}
                            type="file"
                            accept=".xlsx,.xls"
                            onChange={handleFileUpload}
                            className="hidden"
                        />

                        <button
                            onClick={() => fileInputRef.current?.click()}
                            className="w-full py-4 border-2 border-dashed border-line rounded-xl hover:border-[#2D5A47] transition-colors flex flex-col items-center gap-2 text-ink-3 hover:text-[#2D5A47]"
                        >
                            <i className="fa-solid fa-cloud-arrow-up text-3xl"></i>
                            <span>Click to upload Excel file</span>
                        </button>

                        {status && (
                            <div className={`mt-4 p-3 rounded-lg text-sm ${
                                status.type === 'success' ? 'bg-green-100 text-green-700' :
                                status.type === 'error' ? 'bg-red-100 text-red-700' :
                                'bg-blue-100 text-blue-700'
                            }`}>
                                {status.message}
                            </div>
                        )}

                        <button
                            onClick={onClose}
                            className="w-full mt-4 py-2 text-ink-2 hover:text-ink"
                        >
                            Cancel
                        </button>
                    </div>
                </div>
            );
        }

        // Toast notification
        function Toast({ message, type, onClose }) {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, []);

            return (
                <div className={`fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white animate-fade-in ${
                    type === 'success' ? 'bg-[#2D5A47]' : type === 'error' ? 'bg-red-600' : 'bg-blue-600'
                }`}>
                    <div className="flex items-center gap-3">
                        <i className={`fa-solid ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}`}></i>
                        {message}
                    </div>
                </div>
            );
        }

        // ============================================================
        // ADMIN ONBOARDING TOUR
        // ============================================================
        function AdminOnboardingTour({ isOpen, onComplete }) {
            const [currentStep, setCurrentStep] = useState(0);

            const tourSteps = [
                {
                    title: "Welcome to Admin Panel! 🛠️",
                    content: "This panel lets you manage all the data for the Green Star Submission Assistant. Let's walk through the key features.",
                    position: "center"
                },
                {
                    title: "Navigation Menu",
                    content: "Use the sidebar to switch between different data sections: Categories, Credits, Levels, Criteria, Documentation, Templates, Synergies, and more.",
                    position: "center"
                },
                {
                    title: "Dashboard Overview",
                    content: "The Dashboard shows a summary of all your data: how many credits, levels, and templates you have. Great for a quick overview.",
                    position: "center"
                },
                {
                    title: "Editing Data",
                    content: "Click on any section to edit its data. You can add new rows, edit existing ones, or delete items. Changes auto-save as you work.",
                    position: "center"
                },
                {
                    title: "Import & Export",
                    content: "Use the Import button to load data from Excel, or Export to download your current data. Great for backups or bulk editing.",
                    position: "center"
                },
                {
                    title: "Save to Main App",
                    content: "When you're happy with your changes, click 'Save Changes' to update the main Green Star app. Users will see your updates immediately.",
                    position: "center"
                },
                {
                    title: "Undo & Redo",
                    content: "Made a mistake? Use Ctrl+Z to undo or Ctrl+Y to redo. The Undo/Redo buttons in the header work too.",
                    position: "center"
                },
                {
                    title: "You're Ready! ✅",
                    content: "You now know the basics of the Admin Panel. Start by exploring the Dashboard, then dive into the sections you need to update. Happy editing!",
                    position: "center"
                }
            ];

            if (!isOpen) return null;

            const step = tourSteps[currentStep];
            const isFirstStep = currentStep === 0;
            const isLastStep = currentStep === tourSteps.length - 1;

            const handleNext = () => {
                if (isLastStep) {
                    onComplete();
                } else {
                    setCurrentStep(prev => prev + 1);
                }
            };

            const handlePrev = () => {
                if (currentStep > 0) {
                    setCurrentStep(prev => prev - 1);
                }
            };

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
                    <div className="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl">
                        <div className="text-center mb-6">
                            <div className="w-16 h-16 bg-gradient-to-br from-[#1F4B2E] to-[#2E6B3F] rounded-2xl flex items-center justify-center mx-auto mb-4">
                                <i className="fa-solid fa-cog text-white text-2xl"></i>
                            </div>
                            <h2 className="font-display text-2xl font-bold text-ink mb-2">{step.title}</h2>
                            <p className="text-ink-2">{step.content}</p>
                        </div>

                        <div className="flex items-center justify-between">
                            <button
                                onClick={onComplete}
                                className="text-ink-3 hover:text-ink text-sm"
                            >
                                Skip Tour
                            </button>
                            <div className="flex items-center gap-2">
                                {!isFirstStep && (
                                    <button
                                        onClick={handlePrev}
                                        className="px-4 py-2 text-ink-2 hover:text-ink"
                                    >
                                        Back
                                    </button>
                                )}
                                <button
                                    onClick={handleNext}
                                    className="px-6 py-2 bg-[#1F4B2E] text-white rounded-lg font-medium hover:bg-[#2E6B3F] transition-colors"
                                >
                                    {isLastStep ? "Get Started" : isFirstStep ? "Start Tour" : "Next"}
                                </button>
                            </div>
                        </div>

                        {/* Progress dots */}
                        <div className="flex justify-center gap-1.5 mt-6">
                            {tourSteps.map((_, idx) => (
                                <div
                                    key={idx}
                                    className={`w-2 h-2 rounded-full transition-colors ${
                                        idx === currentStep ? 'bg-[#1F4B2E]' : 'bg-gray-200'
                                    }`}
                                />
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // ============================================================
        // MAIN APP
        // ============================================================
        function App() {
            // ALL HOOKS MUST BE AT THE TOP - before any conditional returns
            const [isAuthenticated, setIsAuthenticated] = useState(() => isSessionValid());
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showImportModal, setShowImportModal] = useState(false);
            const [toast, setToast] = useState(null);
            const [showTour, setShowTour] = useState(false);

            // Data state - moved to top to comply with Rules of Hooks
            const [categories, setCategories] = useState(() => {
                const saved = localStorage.getItem('admin_categories');
                return saved ? JSON.parse(saved) : defaultCategories;
            });
            const [credits, setCredits] = useState(() => {
                const saved = localStorage.getItem('admin_credits');
                return saved ? JSON.parse(saved) : defaultCredits;
            });
            const [levels, setLevels] = useState(() => {
                const saved = localStorage.getItem('admin_levels');
                return saved ? JSON.parse(saved) : defaultLevels;
            });
            const [criteria, setCriteria] = useState(() => {
                const saved = localStorage.getItem('admin_criteria');
                return saved ? JSON.parse(saved) : defaultCriteria;
            });
            const [documentation, setDocumentation] = useState(() => {
                const saved = localStorage.getItem('admin_documentation');
                return saved ? JSON.parse(saved) : defaultDocumentation;
            });
            const [templates, setTemplates] = useState(() => {
                const saved = localStorage.getItem('admin_templates');
                return saved ? JSON.parse(saved) : defaultTemplates;
            });
            const [synergies, setSynergies] = useState(() => {
                const saved = localStorage.getItem('admin_synergies');
                return saved ? JSON.parse(saved) : defaultSynergies;
            });
            const [calculators, setCalculators] = useState(() => {
                const saved = localStorage.getItem('admin_calculators');
                return saved ? JSON.parse(saved) : defaultCalculators;
            });
            const [commonMistakes, setCommonMistakes] = useState(() => {
                const saved = localStorage.getItem('admin_mistakes');
                return saved ? JSON.parse(saved) : defaultCommonMistakes;
            });

            // Undo/Redo history
            const [history, setHistory] = useState([]);
            const [historyIndex, setHistoryIndex] = useState(-1);
            const isUndoRedo = React.useRef(false);
            const historyTimeout = React.useRef(null);

            // Check if first visit and show tour
            React.useEffect(() => {
                if (!isAuthenticated) return;
                const hasSeenTour = localStorage.getItem('greenstar-admin-tour-completed');
                if (!hasSeenTour) {
                    setTimeout(() => setShowTour(true), 500);
                }
            }, [isAuthenticated]);

            // Get current state snapshot
            const getSnapshot = () => ({
                categories, credits, levels, criteria, documentation, templates, synergies, calculators, commonMistakes
            });

            // Record history (debounced to avoid too many entries)
            const recordHistory = React.useCallback(() => {
                if (isUndoRedo.current) return;

                setHistory(prev => {
                    const newHistory = prev.slice(0, historyIndex + 1);
                    newHistory.push(getSnapshot());
                    // Keep max 50 history entries
                    if (newHistory.length > 50) newHistory.shift();
                    return newHistory;
                });
                setHistoryIndex(prev => Math.min(prev + 1, 49));
            }, [categories, credits, levels, criteria, documentation, templates, synergies, calculators, commonMistakes, historyIndex]);

            // Track changes and record history with debounce
            useEffect(() => {
                if (!isAuthenticated) return;
                if (isUndoRedo.current) {
                    isUndoRedo.current = false;
                    return;
                }

                if (historyTimeout.current) clearTimeout(historyTimeout.current);
                historyTimeout.current = setTimeout(recordHistory, 500);

                return () => {
                    if (historyTimeout.current) clearTimeout(historyTimeout.current);
                };
            }, [isAuthenticated, categories, credits, levels, criteria, documentation, templates, synergies, calculators, commonMistakes]);

            // Undo function
            const handleUndo = () => {
                if (historyIndex <= 0) return;

                const prevState = history[historyIndex - 1];
                if (!prevState) return;

                isUndoRedo.current = true;
                setCategories(prevState.categories);
                setCredits(prevState.credits);
                setLevels(prevState.levels);
                setCriteria(prevState.criteria);
                setDocumentation(prevState.documentation);
                setTemplates(prevState.templates);
                setSynergies(prevState.synergies);
                setCalculators(prevState.calculators);
                setCommonMistakes(prevState.commonMistakes);
                setHistoryIndex(historyIndex - 1);
                setToast({ message: 'Undone', type: 'info' });
            };

            // Redo function
            const handleRedo = () => {
                if (historyIndex >= history.length - 1) return;

                const nextState = history[historyIndex + 1];
                if (!nextState) return;

                isUndoRedo.current = true;
                setCategories(nextState.categories);
                setCredits(nextState.credits);
                setLevels(nextState.levels);
                setCriteria(nextState.criteria);
                setDocumentation(nextState.documentation);
                setTemplates(nextState.templates);
                setSynergies(nextState.synergies);
                setCalculators(nextState.calculators);
                setCommonMistakes(nextState.commonMistakes);
                setHistoryIndex(historyIndex + 1);
                setToast({ message: 'Redone', type: 'info' });
            };

            // Keyboard shortcuts for undo/redo
            useEffect(() => {
                if (!isAuthenticated) return;
                const handleKeyDown = (e) => {
                    if ((e.ctrlKey || e.metaKey) && e.key === 'z') {
                        e.preventDefault();
                        if (e.shiftKey) {
                            handleRedo();
                        } else {
                            handleUndo();
                        }
                    }
                    if ((e.ctrlKey || e.metaKey) && e.key === 'y') {
                        e.preventDefault();
                        handleRedo();
                    }
                };

                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [isAuthenticated, historyIndex, history]);

            const canUndo = historyIndex > 0;
            const canRedo = historyIndex < history.length - 1;

            // Auto-save to localStorage
            useEffect(() => {
                if (!isAuthenticated) return;
                localStorage.setItem('admin_categories', JSON.stringify(categories));
            }, [isAuthenticated, categories]);
            useEffect(() => {
                if (!isAuthenticated) return;
                localStorage.setItem('admin_credits', JSON.stringify(credits));
            }, [isAuthenticated, credits]);
            useEffect(() => {
                if (!isAuthenticated) return;
                localStorage.setItem('admin_levels', JSON.stringify(levels));
            }, [isAuthenticated, levels]);
            useEffect(() => {
                if (!isAuthenticated) return;
                localStorage.setItem('admin_criteria', JSON.stringify(criteria));
            }, [isAuthenticated, criteria]);
            useEffect(() => {
                if (!isAuthenticated) return;
                localStorage.setItem('admin_documentation', JSON.stringify(documentation));
            }, [isAuthenticated, documentation]);
            useEffect(() => {
                if (!isAuthenticated) return;
                localStorage.setItem('admin_templates', JSON.stringify(templates));
            }, [isAuthenticated, templates]);
            useEffect(() => {
                if (!isAuthenticated) return;
                localStorage.setItem('admin_synergies', JSON.stringify(synergies));
            }, [isAuthenticated, synergies]);
            useEffect(() => {
                if (!isAuthenticated) return;
                localStorage.setItem('admin_calculators', JSON.stringify(calculators));
            }, [isAuthenticated, calculators]);
            useEffect(() => {
                if (!isAuthenticated) return;
                localStorage.setItem('admin_mistakes', JSON.stringify(commonMistakes));
            }, [isAuthenticated, commonMistakes]);

            const completeTour = () => {
                setShowTour(false);
                localStorage.setItem('greenstar-admin-tour-completed', 'true');
            };

            // Handle logout
            const handleLogout = () => {
                endSession();
                setIsAuthenticated(false);
            };

            // Show login screen if not authenticated - AFTER all hooks
            if (!isAuthenticated) {
                return <LoginScreen onLogin={() => setIsAuthenticated(true)} />;
            }

            const dataStats = {
                categories: categories.length,
                credits: credits.length,
                levels: levels.length,
                criteria: criteria.length,
                documentation: documentation.length,
                templates: templates.length,
                synergies: synergies.length,
                calculators: calculators.length,
                mistakes: commonMistakes.length,
            };

            const handleImport = (imported) => {
                if (imported.categories) setCategories(imported.categories);
                if (imported.credits) setCredits(imported.credits);
                if (imported.levels) setLevels(imported.levels);
                if (imported.criteria) setCriteria(imported.criteria);
                if (imported.documentation) setDocumentation(imported.documentation);
                if (imported.templates) setTemplates(imported.templates);
                if (imported.synergies) setSynergies(imported.synergies);
                if (imported.calculators) setCalculators(imported.calculators);
                if (imported.commonMistakes) setCommonMistakes(imported.commonMistakes);
                setToast({ message: 'Data imported successfully!', type: 'success' });
            };

            const handleExport = () => {
                const wb = XLSX.utils.book_new();

                // Categories sheet
                const catData = categories.map(c => ({
                    'Category ID': c.id,
                    'Category Name': c.name,
                    'Description': c.description,
                    'Icon (FontAwesome)': c.icon,
                    'Color Theme': c.color,
                    'Display Order': c.order,
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(catData), 'Categories');

                // Credits sheet
                const credData = credits.map(c => ({
                    'Credit ID': c.id,
                    'Credit Name': c.name,
                    'Category': c.category?.charAt(0).toUpperCase() + c.category?.slice(1),
                    'Short Description': c.shortDescription,
                    'Full Description': c.description,
                    'Credit Aims': c.aims || '',
                    'Tips': c.tips || '',
                    'Is Required?': c.required ? 'Yes' : 'No',
                    'Max Points': c.maxPoints,
                    'Difficulty (Easy/Medium/Hard)': c.difficulty || 'Medium',
                    'Project Phases': c.projectPhases || '',
                    'Display Order': c.order,
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(credData), 'Credits');

                // Levels sheet
                const levelData = levels.map(l => ({
                    'Credit ID': l.creditId,
                    'Level Type': l.level === 'minimum' ? 'Minimum Expectation' :
                                  l.level === 'credit' ? 'Credit Achievement' : 'Exceptional Performance',
                    'Points': l.points,
                    'Summary': l.summary,
                    'Description': l.description,
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(levelData), 'Levels');

                // Criteria sheet
                const critData = criteria.map(c => ({
                    'Credit ID': c.creditId,
                    'Level Type': c.level === 'minimum' ? 'Minimum Expectation' :
                                  c.level === 'credit' ? 'Credit Achievement' : 'Exceptional Performance',
                    'Criteria #': c.criteriaNum,
                    'Criteria Text': c.text,
                    'Is Mandatory?': c.mandatory ? 'Yes' : 'No',
                    'Evidence Type': c.evidenceType,
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(critData), 'Criteria');

                // Documentation sheet
                const docData = documentation.map(d => ({
                    'Credit ID': d.creditId,
                    'Level Type': d.level === 'all' ? 'All Levels' :
                                  d.level === 'minimum' ? 'Minimum Expectation' :
                                  d.level === 'credit' ? 'Credit Achievement' : 'Exceptional Performance',
                    'Document Name': d.name,
                    'Document Type': d.type,
                    'Description': d.description,
                    'Template Available?': d.templateAvailable ? 'Yes' : 'No',
                    'Template Link': d.templateLink,
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(docData), 'Documentation');

                // Templates sheet
                const tplData = templates.map(t => ({
                    'Template ID': t.id,
                    'Template Name': t.name,
                    'Building Type': t.type,
                    'Description': t.description,
                    'Target Star Rating': t.targetRating,
                    'Recommended Credits (comma-separated)': t.credits,
                    'Is Active?': t.active ? 'Yes' : 'No',
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(tplData), 'Templates');

                // Synergies sheet
                const synData = synergies.map(s => ({
                    'Synergy ID': s.id,
                    'Credit 1': s.credit1,
                    'Credit 2': s.credit2,
                    'Synergy Type': s.type,
                    'Description': s.description,
                    'Recommendation': s.recommendation,
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(synData), 'Synergies');

                // Calculators sheet
                const calcData = calculators.map(c => ({
                    'Calculator ID': c.id,
                    'Calculator Name': c.name,
                    'Description': c.description,
                    'Icon (FontAwesome)': c.icon,
                    'Type': c.type,
                    'Is Active?': c.active ? 'Yes' : 'No',
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(calcData), 'Calculators');

                // Common Mistakes sheet
                const mistakesData = commonMistakes.map(m => ({
                    'Mistake ID': m.id,
                    'Credit ID': m.creditId,
                    'Common Mistake': m.mistake,
                    'Impact Level': m.impact,
                    'Prevention Tip': m.prevention,
                }));
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(mistakesData), 'CommonMistakes');

                // Save file
                XLSX.writeFile(wb, 'GreenStar_Admin_Data.xlsx');
                setToast({ message: 'Excel file downloaded!', type: 'success' });
            };

            const handleSave = () => {
                // Save to main app storage
                const appData = {
                    categories,
                    credits,
                    levels,
                    criteria,
                    documentation,
                    templates,
                    synergies,
                    calculators,
                    commonMistakes,
                    savedAt: new Date().toISOString(),
                };
                localStorage.setItem('greenstar_admin_data', JSON.stringify(appData));
                setToast({ message: 'Changes saved! Refresh the main app to see updates.', type: 'success' });
            };

            const renderContent = () => {
                switch (activeTab) {
                    case 'dashboard':
                        return <Dashboard stats={dataStats} onNavigate={setActiveTab} />;
                    case 'categories':
                        return <CategoriesEditor data={categories} onUpdate={setCategories} />;
                    case 'credits':
                        return <CreditsEditor data={credits} onUpdate={setCredits} categories={categories} />;
                    case 'levels':
                        return <LevelsEditor data={levels} onUpdate={setLevels} credits={credits} />;
                    case 'criteria':
                        return <CriteriaEditor data={criteria} onUpdate={setCriteria} credits={credits} />;
                    case 'documentation':
                        return <DocumentationEditor data={documentation} onUpdate={setDocumentation} credits={credits} />;
                    case 'templates':
                        return <TemplatesEditor data={templates} onUpdate={setTemplates} />;
                    case 'synergies':
                        return <SynergiesEditor data={synergies} onUpdate={setSynergies} credits={credits} />;
                    case 'calculators':
                        return <CalculatorsEditor data={calculators} onUpdate={setCalculators} />;
                    case 'mistakes':
                        return <CommonMistakesEditor data={commonMistakes} onUpdate={setCommonMistakes} credits={credits} />;
                    default:
                        return <Dashboard stats={dataStats} onNavigate={setActiveTab} />;
                }
            };

            const getPageTitle = () => {
                const titles = {
                    dashboard: { title: 'Dashboard', subtitle: 'Overview of all data' },
                    categories: { title: 'Categories', subtitle: 'Manage the 8 main category groups' },
                    credits: { title: 'Credits', subtitle: 'Manage individual credits' },
                    levels: { title: 'Performance Levels', subtitle: 'Define Minimum, Credit, and Exceptional levels' },
                    criteria: { title: 'Criteria', subtitle: 'Requirements for each level' },
                    documentation: { title: 'Documentation', subtitle: 'Required documents for each credit' },
                    templates: { title: 'Project Templates', subtitle: 'Pre-configured credit selections' },
                    synergies: { title: 'Credit Synergies', subtitle: 'Define credit relationships' },
                    calculators: { title: 'Calculators', subtitle: 'Manage calculators shown in the app' },
                    mistakes: { title: 'Common Mistakes', subtitle: 'Define common pitfalls for each credit' },
                };
                return titles[activeTab] || titles.dashboard;
            };

            const { title, subtitle } = getPageTitle();

            return (
                <div className="flex min-h-screen">
                    <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} dataStats={dataStats} onLogout={handleLogout} onStartTour={() => setShowTour(true)} />
                    <main className="flex-1 bg-surface-1">
                        <Header
                            title={title}
                            subtitle={subtitle}
                            onImport={() => setShowImportModal(true)}
                            onExport={handleExport}
                            onSave={handleSave}
                            onUndo={handleUndo}
                            onRedo={handleRedo}
                            canUndo={canUndo}
                            canRedo={canRedo}
                        />
                        {renderContent()}
                    </main>

                    <ImportModal
                        isOpen={showImportModal}
                        onClose={() => setShowImportModal(false)}
                        onImport={handleImport}
                    />

                    {toast && (
                        <Toast
                            message={toast.message}
                            type={toast.type}
                            onClose={() => setToast(null)}
                        />
                    )}

                    <AdminOnboardingTour
                        isOpen={showTour}
                        onComplete={completeTour}
                    />
                </div>
            );
        }

        // Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
